(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,8870],{18870:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return A}});var s=i(54880),l=(i(97042),i(60713),i(69225),i(65451)),r=(i(63390),i(25136)),n=(i(69957),i(44114),i(18111),i(7588),i(61701),i(14603),i(47566),i(98721),i(56768)),o=i(90144),a=i(24232),c=i(45130),h=i(94373),d=i(26695),u=i(57477),f=i(44003),p=i.n(f),g=i(27007),m=i(84068),w=i(18384),b=i(71066);i(66874);const v=["colspan","rowspan"],y=["src"],x=["src"];function C(e,t,i,s,l,r){return(0,n.uX)(),(0,n.CE)("td",{colspan:i.itemCell.mergeCellColSpan||1,rowspan:i.itemCell.mergeCellRowSpan||1,style:(0,a.Tr)({"border-top":i.itemCell.hasTopBorder?"1px solid"+i.itemCell.topBorderColor:"0","border-right":i.itemCell.hasRightBorder?"1px solid"+i.itemCell.rightBorderColor:"0","border-bottom":i.itemCell.hasBottomBorder?"1px solid"+i.itemCell.bottomBorderColor:"0","border-left":i.itemCell.hasLeftBorder?"1px solid"+i.itemCell.leftBorderColor:"0","background-color":i.itemCell.backgroundColor?i.itemCell.backgroundColor+" !important":void 0})},[(0,n.Lk)("div",{style:(0,a.Tr)([{display:"flex","align-items":"center","justify-content":"center","word-break":"break-all",overflow:"hidden"},{width:i.itemCell.mergeCell&&i.itemCell.mergeCellColSpan>1?r.getWidth(i.itemCell.colIndex,i.itemCell.mergeCellColSpan)+"px":i.itemCell.colWidth+"px",height:i.itemCell.imageCell&&i.itemCell.mergeCellRowSpan>1?r.getHeight(i.itemRow.rowIndex,i.itemCell.mergeCellRowSpan)+"px":i.itemRow.rowHeight+"px","font-weight":i.itemCell.bold?"bold":"normal","font-style":i.itemCell.italic?"italic":"normal","font-size":i.itemCell.fontSize?i.itemCell.fontSize+"px":void 0,"text-decoration":r.getTextdecoration(i.itemCell),color:i.itemCell.fontColor,display:"flex","justify-content":l.justifyContent[i.itemCell.horizontalType]||"center","align-items":l.alignItems[i.itemCell.verticalType]||"center"}])},[i.itemCell.imageCell?((0,n.uX)(),(0,n.CE)("img",{key:0,src:r.getImgUrl(i.itemCell.data),alt:"",style:{width:"100%",height:"100%"}},null,8,y)):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)((0,a.v_)(i.itemCell.data),1)],64)),i.itemCell.cellValue&&i.itemCell.cellValue.watermark&&i.itemCell.cellValue.watermarkData?((0,n.uX)(),(0,n.CE)("img",{key:2,src:r.getImgUrl(i.itemCell.cellValue.watermarkData),alt:"",style:(0,a.Tr)([{"z-index":"1"},{width:i.itemCell.cellValue.watermarkWidth+"px",height:i.itemCell.cellValue.watermarkHeight+"px",position:"absolute",top:r.getWatermarkTop(i.itemCell),left:r.getWatermarkLeft(i.itemCell)}])},null,12,x)):(0,n.Q3)("",!0)],4)],12,v)}var k={name:"previewPrintCell.vue",props:{itemCell:{type:Object,require:!0},itemRow:{type:Object,require:!0},rows:{type:Array,require:!0}},data(){return{justifyContent:{0:"center",1:"flex-start",2:"flex-end"},alignItems:{0:"center",1:"flex-start",2:"flex-end"}}},methods:{getImgUrl(e){null!=e&&""!==e&&"/"===e.substr(0,1)&&(e=e.substr(1));let t="./"+e+"&Authorization="+(0,g.gf)();return t},getWidth(e,t){let i=0;for(let s=e;s<e+t;s++)i+=Number(this.itemRow.cells[s].colWidth);return i},getHeight(e,t){let i=0;for(let s=e;s<e+t;s++)i+=Number(this.rows[s].rowHeight);return i},getTextdecoration(e){return e.cancelLine&&e.underline?"line-through underline":e.cancelLine?"line-through":e.underline?"underline":void 0},getCellX(e){let t=0;for(let i=0;i<e.colIndex;i++)t+=Number(this.itemRow.cells[i].colWidth)+3;return t},getCellY(e){let t=0;for(let i=0;i<e.rowIndex;i++)t+=Number(this.rows[i].rowHeight)+3;return t},getWatermarkTop(e){let t=this.getCellY(e);return t+e.cellValue.watermarkOffsetY+"px"},getWatermarkLeft(e){let t=this.getCellX(e);return t+e.cellValue.watermarkOffsetX+"px"}},mounted(){}},E=i(71241);const S=(0,E.A)(k,[["render",C]]);var T=S;const R={class:"preview-print-spread-sheet"},$=["colspan","height"];var I=(0,n.pM)({__name:"previewPrintSpreadSheet",props:{printId:{},printName:{},printParam:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const t=e,{thirdParams:i,onCloseThirdDialog:f}=(0,b.P)(t),v=(0,o.KR)(1),y=((0,o.KR)(),{styles:[],merges:[],rows:{},cols:{}}),x=((0,o.KR)(),(0,o.KR)([])),{buildGetUrl:C}=(0,m.a)(),k=(0,o.KR)({rows:[],maxCol:0}),E=(0,o.Kh)({width:"",height:"",topMargin:"",leftMargin:"",rightMargin:"",bottomMargin:"",landscape:!1}),S=(0,o.KR)(!0),I=async()=>{await h.A.post(C(w.x+"/report/reportPrint/preview"),{printId:t.printId||i.value.printId,printParam:t.printParam||i.value.printParam,renderType:3},{headers:{Authorization:(0,g.gf)()}}).then(e=>{200===e.status?(k.value=e.data.reportSheet,O(e.data)):d.nk.error("请求失败！")}).catch(()=>{d.nk.error("请求失败！")})},O=async e=>{console.log("data",e);const t=e.reportSheet?.rows;let i=-1,s={};t?.forEach((e,t)=>{let l={};e.cells.forEach(async(r,n)=>{0===t&&(s[n]={width:r.colWidth});let o="",a="text",c="";if(r.imageCell&&r.data){a="image",o="";const e=C(r.data+"&Authorization="+(0,g.gf)());x.value.push({url:e,row:t,col:n})}else o=r?.data;if(!r.emptyCell){i++;let h={border:{bottom:r?.hasBottomBorder?["medium",r.bottomBorderColor]:null,top:r?.hasTopBorder?["medium",r.topBorderColor]:null,left:r?.hasLeftBorder?["medium",r.leftBorderColor]:null,right:r?.hasRightBorder?["medium",r.rightBorderColor]:null},underline:r?.underline,valign:0===r?.verticalType?"middle":1===r?.verticalType?"top":"bottom",align:0===r?.horizontalType?"center":1===r?.horizontalType?"left":"right",font:{size:r.fontSize,bold:r.bold,italic:r.italic,name:"微软雅黑"}};if(y.styles[i]=h,l[n]={text:o,type:a,value:c,style:i},"image"===l[n].type&&(l[n].imagewidth=s[n].width-2,l[n].imageheight=e.rowHeight-2,l[n].top=0,l[n].left=0),r.mergeCell&&!r.emptyCell){l[n].merge=[r.mergeCellRowSpan-1,r.mergeCellColSpan-1];let e=D(n)+(t+1)+":"+D(n+r.mergeCellColSpan-1)+(r.mergeCellRowSpan+r.mergeCellTopRow);y.merges.push(e.toString())}}}),y.rows[t]={cells:l,height:e.rowHeight}}),await Promise.all(x.value.map(async e=>{const t=await A(e.url);return y.rows[e.row].cells[e.col].value=t,t})),y.cols=s},A=e=>new Promise(t=>{const i=new Image;i.crossOrigin="Anonymous",i.src=e,i.onload=()=>{const e=document.createElement("CANVAS");e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0);const s=e.toDataURL("image/jpeg");t(s)},i.onerror=()=>{t({message:"相片处理失败"})}}),D=e=>{let t=String.fromCharCode(65+e);return t},z=()=>{t.dialog?t.dialog.cancel():f(!0)},j=()=>{h.A.post(C(w.x+"/report/reportPrint/preview"),{printId:t.printId,printParam:t.printParam,renderType:2},{headers:{Authorization:(0,g.gf)()},responseType:"blob"}).then(e=>{200===e.status&&e.data instanceof Blob?H(t.printName||i.value.printName,e.data):d.nk.error("下载文件失败")}).catch(e=>{if(e instanceof Blob){let t=new FileReader;t.onload=()=>{d.nk.error(t.result?JSON.parse(t.result.toString()).errorMessage:"下载文件失败")},t.readAsText(e)}else d.nk.error("下载文件失败")})},H=(e,t)=>{let i=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});const s=document.createElement("a"),l=URL.createObjectURL(i);s.href=l,s.setAttribute("download",e+".xls"),s.style.display="none",s.click(),URL.revokeObjectURL(l),s.remove()},N=()=>{M(210),document.getElementById("print-table")?.getBoundingClientRect().width;p()({printable:"print-table",type:"html",scanStyles:!0,targetStyles:["*"],documentTitle:t.printName,font_size:"10px",style:`@page {size: ${E.width}mm ${E.height}mm portrait};`,onPrintDialogClose(){v.value=1}})},M=e=>{const t=document.createElement("div");t.style.width="1in",document.body.appendChild(t);const i=t.offsetWidth;document.body.removeChild(t);const s=Number(e),l=s/25.4,r=l*i;return Math.round(r)};return(0,n.sV)(async()=>{await I()}),(e,t)=>{const i=r.S2,h=l.S2,d=s.bZ,f=s.ZO;return(0,n.uX)(),(0,n.CE)("div",R,[(0,n.bF)(d,{class:"step-header",style:{overflow:"hidden",height:"72px",background:"white","border-bottom":"1px solid #ebeef5"}},{default:(0,n.k6)(()=>[(0,n.bF)(h,{type:"flex",justify:"space-between",align:"middle",style:{height:"100%"}},{default:(0,n.k6)(()=>[t[3]||(t[3]=(0,n.Lk)("div",{class:"title",style:{display:"flex",width:"200px",height:"40px","line-height":"40px"}},[(0,n.Lk)("span",{style:{"font-size":"22px",color:"#333","font-weight":"bold"}},"BIQS打印预览")],-1)),(0,n.bF)(h,{class:"operation",justify:"end"},{default:(0,n.k6)(()=>[(0,n.bF)(i,{size:"default",icon:(0,o.R1)(u.Printer),type:"primary",onClick:N,style:{width:"85px"}},{default:(0,n.k6)(()=>t[0]||(t[0]=[(0,n.eW)("打印")])),_:1,__:[0]},8,["icon"]),(0,n.bF)(i,{size:"default",icon:(0,o.R1)(u.Download),onClick:j,style:{width:"85px"}},{default:(0,n.k6)(()=>t[1]||(t[1]=[(0,n.eW)("Excel")])),_:1,__:[1]},8,["icon"]),(0,n.bF)(i,{size:"default",onClick:z,style:{width:"85px"}},{default:(0,n.k6)(()=>t[2]||(t[2]=[(0,n.eW)("退出")])),_:1,__:[2]})]),_:1})]),_:1,__:[3]})]),_:1}),(0,n.bF)(f,{style:{padding:"16px",background:"#f6f6f6","min-height":"calc(100vh - 72px)"}},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",{id:"print-container",style:(0,a.Tr)([{width:(0,o.R1)(E).width+"mm",height:(0,o.R1)(E).height+"mm"},{overflow:"auto","max-height":"calc(100vh - 104px)"}])},[(0,n.Lk)("div",{style:(0,a.Tr)({width:(0,o.R1)(E).width+"mm",height:(0,o.R1)(E).height+"mm",paddingTop:(0,o.R1)(E).topMargin+"mm",paddingRight:(0,o.R1)(E).rightMargin+"mm",paddingBottom:(0,o.R1)(E).bottomMargin+"mm",paddingLeft:(0,o.R1)(E).leftMargin+"mm",margin:"0 auto",pageBreakAfter:"always",display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"flex-start",boxSizing:"border-box"})},[(0,n.Lk)("table",{id:"print-table",style:(0,a.Tr)([{"border-collapse":"collapse",position:"relative","transform-origin":"top center"},{transform:`scale(${(0,o.R1)(v)})`}])},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,o.R1)(k).rows,e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.rowIndex},[1==e.emptyRow?((0,n.uX)(),(0,n.CE)("td",{key:0,colspan:(0,o.R1)(k).maxCol+1,height:e.rowHeight+"px"},null,8,$)):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(e.cells,t=>((0,n.uX)(),(0,n.CE)(n.FK,null,[t.mergeCell?t.mergeCell&&(t.mergeCellColSpan||t.mergeCellRowSpan)?((0,n.uX)(),(0,n.Wv)(T,{rows:(0,o.R1)(k).rows,"item-cell":t,"item-row":e,key:"row_"+e.rowIndex+"col_"+t.colIndex},null,8,["rows","item-cell","item-row"])):(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(T,{rows:(0,o.R1)(k).rows,"item-cell":t,"item-row":e,key:"row_"+e.rowIndex+"col_"+t.colIndex},null,8,["rows","item-cell","item-row"]))],64))),256))]))),128))],4)],4)],4),[[c.aG,(0,o.R1)(S)]])]),_:1})])}}});const O=(0,E.A)(I,[["__scopeId","data-v-a576c9e2"]]);var A=O},44003:function(e,t,i){i(16573),i(78100),i(77936),i(18111),i(7588),i(61701),i(79577),i(64979),i(14603),i(47566),i(98721),function(t,i){e.exports=i()}(window,function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var l=t[s]={i:s,l:!1,exports:{}};return e[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(s,l,function(t){return e[t]}.bind(null,l));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}({"./src/index.js":
/*!**********************!*\
      !*** ./src/index.js ***!
      \**********************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);i(/*! ./sass/index.scss */"./src/sass/index.scss");var s=i(/*! ./js/init */"./src/js/init.js"),l=s["default"].init;"undefined"!==typeof window&&(window.printJS=l),t["default"]=l},"./src/js/browser.js":
/*!***************************!*\
      !*** ./src/js/browser.js ***!
      \***************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s={isFirefox:function(){return"undefined"!==typeof InstallTrigger},isIE:function(){return-1!==navigator.userAgent.indexOf("MSIE")||!!document.documentMode},isEdge:function(){return!s.isIE()&&!!window.StyleMedia},isChrome:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return!!e.chrome},isSafari:function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0||-1!==navigator.userAgent.toLowerCase().indexOf("safari")},isIOSChrome:function(){return-1!==navigator.userAgent.toLowerCase().indexOf("crios")}};t["default"]=s},"./src/js/functions.js":
/*!*****************************!*\
      !*** ./src/js/functions.js ***!
      \*****************************/
/*! exports provided: addWrapper, capitalizePrint, collectStyles, addHeader, cleanUp, isRawHTML */function(e,t,i){"use strict";i.r(t),i.d(t,"addWrapper",function(){return n}),i.d(t,"capitalizePrint",function(){return o}),i.d(t,"collectStyles",function(){return a}),i.d(t,"addHeader",function(){return h}),i.d(t,"cleanUp",function(){return d}),i.d(t,"isRawHTML",function(){return u});var s=i(/*! ./modal */"./src/js/modal.js"),l=i(/*! ./browser */"./src/js/browser.js");function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){var i="font-family:"+t.font+" !important; width:100%;";return'<div style="'+i+'">'+e+"</div>"}function o(e){return e.charAt(0).toUpperCase()+e.slice(1)}function a(e,t){for(var i=document.defaultView||window,s="",l=i.getComputedStyle(e,""),r=0;r<l.length;r++)(-1!==t.targetStyles.indexOf("*")||-1!==t.targetStyle.indexOf(l[r])||c(t.targetStyles,l[r]))&&l.getPropertyValue(l[r])&&(s+=l[r]+":"+l.getPropertyValue(l[r])+";");return s+="max-width: "+t.maxWidth+"px !important;",s}function c(e,t){for(var i=0;i<e.length;i++)if("object"===r(t)&&-1!==t.indexOf(e[i]))return!0;return!1}function h(e,t){var i=document.createElement("div");if(u(t.header))i.innerHTML=t.header;else{var s=document.createElement("h1"),l=document.createTextNode(t.header);s.appendChild(l),s.setAttribute("style",t.headerStyle),i.appendChild(s)}e.insertBefore(i,e.childNodes[0])}function d(e){e.showModal&&s["default"].close(),e.onLoadingEnd&&e.onLoadingEnd(),(e.showModal||e.onLoadingStart)&&window.URL.revokeObjectURL(e.printable);var t="mouseover";(l["default"].isChrome()||l["default"].isFirefox())&&(t="focus");var i=function i(){window.removeEventListener(t,i),e.onPrintDialogClose();var s=document.getElementById(e.frameId);s&&s.remove()};window.addEventListener(t,i)}function u(e){var t=new RegExp("<([A-Za-z][A-Za-z0-9]*)\\b[^>]*>(.*?)</\\1>");return t.test(e)}},"./src/js/html.js":
/*!************************!*\
      !*** ./src/js/html.js ***!
      \************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s=i(/*! ./functions */"./src/js/functions.js"),l=i(/*! ./print */"./src/js/print.js");function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){for(var i=e.cloneNode(),l=Array.prototype.slice.call(e.childNodes),r=0;r<l.length;r++)if(-1===t.ignoreElements.indexOf(l[r].id)){var o=n(l[r],t);i.appendChild(o)}switch(t.scanStyles&&1===e.nodeType&&i.setAttribute("style",Object(s["collectStyles"])(e,t)),e.tagName){case"SELECT":i.value=e.value;break;case"CANVAS":i.getContext("2d").drawImage(e,0,0);break}return i}function o(e){return"object"===r(e)&&e&&(e instanceof HTMLElement||1===e.nodeType)}t["default"]={print:function(e,t){var i=o(e.printable)?e.printable:document.getElementById(e.printable);i?(e.printableElement=n(i,e),e.header&&Object(s["addHeader"])(e.printableElement,e),l["default"].send(e,t)):window.console.error("Invalid HTML element id: "+e.printable)}}},"./src/js/image.js":
/*!*************************!*\
      !*** ./src/js/image.js ***!
      \*************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s=i(/*! ./functions */"./src/js/functions.js"),l=i(/*! ./print */"./src/js/print.js"),r=i(/*! ./browser */"./src/js/browser.js");t["default"]={print:function(e,t){e.printable.constructor!==Array&&(e.printable=[e.printable]),e.printableElement=document.createElement("div"),e.printable.forEach(function(t){var i=document.createElement("img");if(i.setAttribute("style",e.imageStyle),i.src=t,r["default"].isFirefox()){var s=i.src;i.src=s}var l=document.createElement("div");l.appendChild(i),e.printableElement.appendChild(l)}),e.header&&Object(s["addHeader"])(e.printableElement,e),l["default"].send(e,t)}}},"./src/js/init.js":
/*!************************!*\
      !*** ./src/js/init.js ***!
      \************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s=i(/*! ./browser */"./src/js/browser.js"),l=i(/*! ./modal */"./src/js/modal.js"),r=i(/*! ./pdf */"./src/js/pdf.js"),n=i(/*! ./html */"./src/js/html.js"),o=i(/*! ./raw-html */"./src/js/raw-html.js"),a=i(/*! ./image */"./src/js/image.js"),c=i(/*! ./json */"./src/js/json.js");function h(e){return h="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}var d=["pdf","html","image","json","raw-html"];t["default"]={init:function(){var e={printable:null,fallbackPrintable:null,type:"pdf",header:null,headerStyle:"font-weight: 300;",maxWidth:800,properties:null,gridHeaderStyle:"font-weight: bold; padding: 5px; border: 1px solid #dddddd;",gridStyle:"border: 1px solid lightgray; margin-bottom: -1px;",showModal:!1,onError:function(e){throw e},onLoadingStart:null,onLoadingEnd:null,onPrintDialogClose:function(){},onIncompatibleBrowser:function(){},modalMessage:"Retrieving Document...",frameId:"printJS",printableElement:null,documentTitle:"Document",targetStyle:["clear","display","width","min-width","height","min-height","max-height"],targetStyles:["border","box","break","text-decoration"],ignoreElements:[],repeatTableHeader:!0,css:null,style:null,scanStyles:!0,base64:!1,onPdfOpen:null,font:"TimesNewRoman",font_size:"12pt",honorMarginPadding:!0,honorColor:!1,imageStyle:"max-width: 100%;"},t=arguments[0];if(void 0===t)throw new Error("printJS expects at least 1 attribute.");switch(h(t)){case"string":e.printable=encodeURI(t),e.fallbackPrintable=e.printable,e.type=arguments[1]||e.type;break;case"object":for(var i in e.printable=t.printable,e.fallbackPrintable="undefined"!==typeof t.fallbackPrintable?t.fallbackPrintable:e.printable,e.fallbackPrintable=e.base64?"data:application/pdf;base64,".concat(e.fallbackPrintable):e.fallbackPrintable,e)"printable"!==i&&"fallbackPrintable"!==i&&(e[i]="undefined"!==typeof t[i]?t[i]:e[i]);break;default:throw new Error('Unexpected argument type! Expected "string" or "object", got '+h(t))}if(!e.printable)throw new Error("Missing printable information.");if(!e.type||"string"!==typeof e.type||-1===d.indexOf(e.type.toLowerCase()))throw new Error("Invalid print type. Available types are: pdf, html, image and json.");e.showModal&&l["default"].show(e),e.onLoadingStart&&e.onLoadingStart();var u=document.getElementById(e.frameId);u&&u.parentNode.removeChild(u);var f=document.createElement("iframe");switch(s["default"].isFirefox()?f.setAttribute("style","width: 1px; height: 100px; position: fixed; left: 0; top: 0; opacity: 0; border-width: 0; margin: 0; padding: 0"):f.setAttribute("style","visibility: hidden; height: 0; width: 0; position: absolute; border: 0"),f.setAttribute("id",e.frameId),"pdf"!==e.type&&(f.srcdoc="<html><head><title>"+e.documentTitle+"</title>",e.css&&(Array.isArray(e.css)||(e.css=[e.css]),e.css.forEach(function(e){f.srcdoc+='<link rel="stylesheet" href="'+e+'">'})),f.srcdoc+="</head><body></body></html>"),e.type){case"pdf":if(s["default"].isIE())try{console.info("Print.js doesn't support PDF printing in Internet Explorer.");var p=window.open(e.fallbackPrintable,"_blank");p.focus(),e.onIncompatibleBrowser()}catch(g){e.onError(g)}finally{e.showModal&&l["default"].close(),e.onLoadingEnd&&e.onLoadingEnd()}else r["default"].print(e,f);break;case"image":a["default"].print(e,f);break;case"html":n["default"].print(e,f);break;case"raw-html":o["default"].print(e,f);break;case"json":c["default"].print(e,f);break}}}},"./src/js/json.js":
/*!************************!*\
      !*** ./src/js/json.js ***!
      \************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s=i(/*! ./functions */"./src/js/functions.js"),l=i(/*! ./print */"./src/js/print.js");function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e){var t=e.printable,i=e.properties,l='<table style="border-collapse: collapse; width: 100%;">';e.repeatTableHeader&&(l+="<thead>"),l+="<tr>";for(var r=0;r<i.length;r++)l+='<th style="width:'+i[r].columnSize+";"+e.gridHeaderStyle+'">'+Object(s["capitalizePrint"])(i[r].displayName)+"</th>";l+="</tr>",e.repeatTableHeader&&(l+="</thead>"),l+="<tbody>";for(var n=0;n<t.length;n++){l+="<tr>";for(var o=0;o<i.length;o++){var a=t[n],c=i[o].field.split(".");if(c.length>1)for(var h=0;h<c.length;h++)a=a[c[h]];else a=a[i[o].field];l+='<td style="width:'+i[o].columnSize+e.gridStyle+'">'+a+"</td>"}l+="</tr>"}return l+="</tbody></table>",l}t["default"]={print:function(e,t){if("object"!==r(e.printable))throw new Error("Invalid javascript data object (JSON).");if("boolean"!==typeof e.repeatTableHeader)throw new Error("Invalid value for repeatTableHeader attribute (JSON).");if(!e.properties||!Array.isArray(e.properties))throw new Error("Invalid properties array for your JSON data.");e.properties=e.properties.map(function(t){return{field:"object"===r(t)?t.field:t,displayName:"object"===r(t)?t.displayName:t,columnSize:"object"===r(t)&&t.columnSize?t.columnSize+";":100/e.properties.length+"%;"}}),e.printableElement=document.createElement("div"),e.header&&Object(s["addHeader"])(e.printableElement,e),e.printableElement.innerHTML+=n(e),l["default"].send(e,t)}}},"./src/js/modal.js":
/*!*************************!*\
      !*** ./src/js/modal.js ***!
      \*************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s={show:function(e){var t="font-family:sans-serif; display:table; text-align:center; font-weight:300; font-size:30px; left:0; top:0;position:fixed; z-index: 9990;color: #0460B5; width: 100%; height: 100%; background-color:rgba(255,255,255,.9);transition: opacity .3s ease;",i=document.createElement("div");i.setAttribute("style",t),i.setAttribute("id","printJS-Modal");var l=document.createElement("div");l.setAttribute("style","display:table-cell; vertical-align:middle; padding-bottom:100px;");var r=document.createElement("div");r.setAttribute("class","printClose"),r.setAttribute("id","printClose"),l.appendChild(r);var n=document.createElement("span");n.setAttribute("class","printSpinner"),l.appendChild(n);var o=document.createTextNode(e.modalMessage);l.appendChild(o),i.appendChild(l),document.getElementsByTagName("body")[0].appendChild(i),document.getElementById("printClose").addEventListener("click",function(){s.close()})},close:function(){var e=document.getElementById("printJS-Modal");e&&e.parentNode.removeChild(e)}};t["default"]=s},"./src/js/pdf.js":
/*!***********************!*\
      !*** ./src/js/pdf.js ***!
      \***********************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s=i(/*! ./print */"./src/js/print.js"),l=i(/*! ./functions */"./src/js/functions.js");function r(e,t,i){var l=new window.Blob([i],{type:"application/pdf"});l=window.URL.createObjectURL(l),t.setAttribute("src",l),s["default"].send(e,t)}t["default"]={print:function(e,t){if(e.base64){var i=Uint8Array.from(atob(e.printable),function(e){return e.charCodeAt(0)});r(e,t,i)}else{e.printable=/^(blob|http|\/\/)/i.test(e.printable)?e.printable:window.location.origin+("/"!==e.printable.charAt(0)?"/"+e.printable:e.printable);var s=new window.XMLHttpRequest;s.responseType="arraybuffer",s.addEventListener("error",function(){Object(l["cleanUp"])(e),e.onError(s.statusText,s)}),s.addEventListener("load",function(){if(-1===[200,201].indexOf(s.status))return Object(l["cleanUp"])(e),void e.onError(s.statusText,s);r(e,t,s.response)}),s.open("GET",e.printable,!0),s.send()}}}},"./src/js/print.js":
/*!*************************!*\
      !*** ./src/js/print.js ***!
      \*************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s=i(/*! ./browser */"./src/js/browser.js"),l=i(/*! ./functions */"./src/js/functions.js"),r={send:function(e,t){document.getElementsByTagName("body")[0].appendChild(t);var i=document.getElementById(e.frameId);i.onload=function(){if("pdf"!==e.type){var t=i.contentWindow||i.contentDocument;if(t.document&&(t=t.document),t.body.appendChild(e.printableElement),"pdf"!==e.type&&e.style){var l=document.createElement("style");l.innerHTML=e.style,t.head.appendChild(l)}var r=t.getElementsByTagName("img");r.length>0?o(Array.from(r)).then(function(){return n(i,e)}):n(i,e)}else s["default"].isFirefox()?setTimeout(function(){return n(i,e)},1e3):n(i,e)}}};function n(e,t){try{if(e.focus(),s["default"].isEdge()||s["default"].isIE())try{e.contentWindow.document.execCommand("print",!1,null)}catch(i){e.contentWindow.print()}else e.contentWindow.print()}catch(r){t.onError(r)}finally{s["default"].isFirefox()&&(e.style.visibility="hidden",e.style.left="-1px"),Object(l["cleanUp"])(t)}}function o(e){var t=e.map(function(e){if(e.src&&e.src!==window.location.href)return a(e)});return Promise.all(t)}function a(e){return new Promise(function(t){var i=function i(){e&&"undefined"!==typeof e.naturalWidth&&0!==e.naturalWidth&&e.complete?t():setTimeout(i,500)};i()})}t["default"]=r},"./src/js/raw-html.js":
/*!****************************!*\
      !*** ./src/js/raw-html.js ***!
      \****************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var s=i(/*! ./print */"./src/js/print.js");t["default"]={print:function(e,t){e.printableElement=document.createElement("div"),e.printableElement.setAttribute("style","width:100%"),e.printableElement.innerHTML=e.printable,s["default"].send(e,t)}}},"./src/sass/index.scss":
/*!*****************************!*\
      !*** ./src/sass/index.scss ***!
      \*****************************/
/*! no static exports found */function(e,t,i){},0:
/*!****************************!*\
      !*** multi ./src/index.js ***!
      \****************************/
/*! no static exports found */function(e,t,i){e.exports=i(/*! ./src/index.js */"./src/index.js")}})["default"]})},66874:function(e,t,i){"use strict";i.d(t,{A:function(){return Ls}});var s=i(29357);i(44114),i(18111),i(61701),i(7588);class l{constructor(e,t=""){"string"===typeof e?(this.el=document.createElement(e),this.el.className=t):this.el=e,this.data={}}data(e,t){return void 0!==t?(this.data[e]=t,this):this.data[e]}on(e,t){const[i,...s]=e.split(".");let l=i;return"mousewheel"===l&&/Firefox/i.test(window.navigator.userAgent)&&(l="DOMMouseScroll"),this.el.addEventListener(l,e=>{t(e);for(let t=0;t<s.length;t+=1){const i=s[t];if("left"===i&&0!==e.button)return;if("right"===i&&2!==e.button)return;"stop"===i&&e.stopPropagation()}}),this}offset(e){if(void 0!==e)return Object.keys(e).forEach(t=>{this.css(t,`${e[t]}px`)}),this;const{offsetTop:t,offsetLeft:i,offsetHeight:s,offsetWidth:l}=this.el;return{top:t,left:i,height:s,width:l}}scroll(e){const{el:t}=this;return void 0!==e&&(void 0!==e.left&&(t.scrollLeft=e.left),void 0!==e.top&&(t.scrollTop=e.top)),{left:t.scrollLeft,top:t.scrollTop}}box(){return this.el.getBoundingClientRect()}parent(){return new l(this.el.parentNode)}children(...e){return 0===arguments.length?this.el.childNodes:(e.forEach(e=>this.child(e)),this)}removeChild(e){this.el.removeChild(e)}child(e){let t=e;return"string"===typeof e?t=document.createTextNode(e):e instanceof l&&(t=e.el),this.el.appendChild(t),this}contains(e){return this.el.contains(e)}className(e){return void 0!==e?(this.el.className=e,this):this.el.className}addClass(e){return this.el.classList.add(e),this}hasClass(e){return this.el.classList.contains(e)}removeClass(e){return this.el.classList.remove(e),this}toggle(e="active"){return this.toggleClass(e)}toggleClass(e){return this.el.classList.toggle(e)}active(e=!0,t="active"){return e?this.addClass(t):this.removeClass(t),this}checked(e=!0){return this.active(e,"checked"),this}disabled(e=!0){return e?this.addClass("disabled"):this.removeClass("disabled"),this}attr(e,t){if(void 0!==t)this.el.setAttribute(e,t);else{if("string"===typeof e)return this.el.getAttribute(e);Object.keys(e).forEach(t=>{this.el.setAttribute(t,e[t])})}return this}removeAttr(e){return this.el.removeAttribute(e),this}html(e){return void 0!==e?(this.el.innerHTML=e,this):this.el.innerHTML}val(e){return void 0!==e?(this.el.value=e,this):this.el.value}focus(){this.el.focus()}cssRemoveKeys(...e){return e.forEach(e=>this.el.style.removeProperty(e)),this}css(e,t){return void 0===t&&"string"!==typeof e?(Object.keys(e).forEach(t=>{this.el.style[t]=e[t]}),this):void 0!==t?(this.el.style[e]=t,this):this.el.style[e]}computedStyle(){return window.getComputedStyle(this.el,null)}show(){return this.css("display","block"),this}hide(){return this.css("display","none"),this}}const r=(e,t="")=>new l(e,t);i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698);var n={toolbar:{undo:"Undo",redo:"Redo",print:"Print",paintformat:"Paint format",clearformat:"Clear format",format:"Format",fontName:"Font",fontSize:"Font size",fontBold:"Font bold",fontItalic:"Font italic",underline:"Underline",strike:"Strike",color:"Text color",bgcolor:"Fill color",border:"Borders",merge:"Merge cells",align:"Horizontal align",valign:"Vertical align",textwrap:"Text wrapping",freeze:"Freeze cell",autofilter:"Filter",formula:"Functions",more:"More"},contextmenu:{copy:"Copy",cut:"Cut",paste:"Paste",pasteValue:"Paste values only",pasteFormat:"Paste format only",hide:"Hide",insertRow:"Insert row",insertColumn:"Insert column",deleteSheet:"Delete",deleteRow:"Delete row",deleteColumn:"Delete column",deleteCell:"Delete cell",deleteCellText:"Delete cell text",validation:"Data validations",cellprintable:"Enable export",cellnonprintable:"Disable export",celleditable:"Enable editing",cellnoneditable:"Disable editing"},print:{size:"Paper size",orientation:"Page orientation",orientations:["Landscape","Portrait"]},format:{normal:"Normal",text:"Plain Text",number:"Number",percent:"Percent",rmb:"RMB",usd:"USD",eur:"EUR",date:"Date",time:"Time",datetime:"Date time",duration:"Duration"},formula:{sum:"Sum",average:"Average",max:"Max",min:"Min",_if:"IF",and:"AND",or:"OR",concat:"Concat"},validation:{required:"it must be required",notMatch:"it not match its validation rule",between:"it is between {} and {}",notBetween:"it is not between {} and {}",notIn:"it is not in list",equal:"it equal to {}",notEqual:"it not equal to {}",lessThan:"it less than {}",lessThanEqual:"it less than or equal to {}",greaterThan:"it greater than {}",greaterThanEqual:"it greater than or equal to {}"},error:{pasteForMergedCell:"Unable to do this for merged cells"},calendar:{weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},button:{next:"Next",cancel:"Cancel",remove:"Remove",save:"Save",ok:"OK"},sort:{desc:"Sort Z -> A",asc:"Sort A -> Z"},filter:{empty:"empty"},dataValidation:{mode:"Mode",range:"Cell Range",criteria:"Criteria",modeType:{cell:"Cell",column:"Colun",row:"Row"},type:{list:"List",number:"Number",date:"Date",phone:"Phone",email:"Email"},operator:{be:"between",nbe:"not betwwen",lt:"less than",lte:"less than or equal to",gt:"greater than",gte:"greater than or equal to",eq:"equal to",neq:"not equal to"}}};let o=["en"];const a={en:n};function c(e,t){if(t)for(const i of o){if(!t[i])break;let s=t[i];const l=e.match(/(?:\\.|[^.])+/g);for(let e=0;e<l.length;e+=1){const t=l[e],i=s[t];if(!i)break;if(e===l.length-1)return i;s=i}}}function h(e){let t=c(e,a);return!t&&window&&window.x_spreadsheet&&window.x_spreadsheet.$messages&&(t=c(e,window.x_spreadsheet.$messages)),t||""}function d(e){return()=>h(e)}function u(e,t,i=!1){i?o=[e]:o.unshift(e),t&&(a[e]=t)}const f=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function p(e){let t="",i=e;while(i>=f.length)i/=f.length,i-=1,t+=f[parseInt(i,10)%f.length];const s=e%f.length;return t+=f[s],t}function g(e){let t=0;for(let i=0;i!==e.length;++i)t=26*t+e.charCodeAt(i)-64;return t-1}function m(e){let t="",i="";for(let s=0;s<e.length;s+=1)e.charAt(s)>="0"&&e.charAt(s)<="9"?i+=e.charAt(s):t+=e.charAt(s);return[g(t),parseInt(i,10)-1]}function w(e,t){return`${p(e)}${t+1}`}function b(e,t,i,s=()=>!0){if(0===t&&0===i)return e;const[l,r]=m(e);return s(l,r)?w(l+t,r+i):e}class v{constructor(e,t,i,s,l=0,r=0){this.sri=e,this.sci=t,this.eri=i,this.eci=s,this.w=l,this.h=r}set(e,t,i,s){this.sri=e,this.sci=t,this.eri=i,this.eci=s}multiple(){return this.eri-this.sri>0||this.eci-this.sci>0}includes(...e){let[t,i]=[0,0];1===e.length?[i,t]=m(e[0]):2===e.length&&([t,i]=e);const{sri:s,sci:l,eri:r,eci:n}=this;return s<=t&&t<=r&&l<=i&&i<=n}each(e,t=()=>!0){const{sri:i,sci:s,eri:l,eci:r}=this;for(let n=i;n<=l;n+=1)if(t(n))for(let t=s;t<=r;t+=1)e(n,t)}contains(e){return this.sri<=e.sri&&this.sci<=e.sci&&this.eri>=e.eri&&this.eci>=e.eci}within(e){return this.sri>=e.sri&&this.sci>=e.sci&&this.eri<=e.eri&&this.eci<=e.eci}disjoint(e){return this.sri>e.eri||this.sci>e.eci||e.sri>this.eri||e.sci>this.eci}intersects(e){return this.sri<=e.eri&&this.sci<=e.eci&&e.sri<=this.eri&&e.sci<=this.eci}union(e){const{sri:t,sci:i,eri:s,eci:l}=this;return new v(e.sri<t?e.sri:t,e.sci<i?e.sci:i,e.eri>s?e.eri:s,e.eci>l?e.eci:l)}difference(e){const t=[],i=(e,i,s,l)=>{t.push(new v(e,i,s,l))},{sri:s,sci:l,eri:r,eci:n}=this,o=e.sri-s,a=e.sci-l,c=r-e.eri,h=n-e.eci;return o>0?(i(s,l,e.sri-1,n),c>0?(i(e.eri+1,l,r,n),a>0&&i(e.sri,l,e.eri,e.sci-1),h>0&&i(e.sri,e.eci+1,e.eri,n)):(a>0&&i(e.sri,l,r,e.sci-1),h>0&&i(e.sri,e.eci+1,r,n))):c>0&&(i(e.eri+1,l,r,n),a>0&&i(s,l,e.eri,e.sci-1),h>0&&i(s,e.eci+1,e.eri,n)),a>0?(i(s,l,r,e.sci-1),h>0?(i(s,e.eri+1,r,n),o>0&&i(s,e.sci,e.sri-1,e.eci),c>0&&i(e.sri+1,e.sci,r,e.eci)):(o>0&&i(s,e.sci,e.sri-1,n),c>0&&i(e.sri+1,e.sci,r,n))):h>0&&(i(r,e.eci+1,r,n),o>0&&i(s,l,e.sri-1,e.eci),c>0&&i(e.eri+1,l,r,e.eci)),t}size(){return[this.eri-this.sri+1,this.eci-this.sci+1]}toString(){const{sri:e,sci:t,eri:i,eci:s}=this;let l=w(t,e);return this.multiple()&&(l=`${l}:${w(s,i)}`),l}clone(){const{sri:e,sci:t,eri:i,eci:s,w:l,h:r}=this;return new v(e,t,i,s,l,r)}equals(e){return this.eri===e.eri&&this.eci===e.eci&&this.sri===e.sri&&this.sci===e.sci}static valueOf(e){const t=e.split(":"),[i,s]=m(t[0]);let[l,r]=[s,i];return t.length>1&&([r,l]=m(t[1])),new v(s,i,l,r)}}class y{constructor(){this.range=new v(0,0,0,0),this.ri=0,this.ci=0}multiple(){return this.range.multiple()}setIndexes(e,t){this.ri=e,this.ci=t}size(){return this.range.size()}}class x{constructor(){this.x=0,this.y=0,this.ri=0,this.ci=0}}class C{constructor(){this.undoItems=[],this.redoItems=[]}add(e){this.undoItems.push(JSON.stringify(e)),this.redoItems=[]}canUndo(){return this.undoItems.length>0}canRedo(){return this.redoItems.length>0}undo(e,t){const{undoItems:i,redoItems:s}=this;this.canUndo()&&(s.push(JSON.stringify(e)),t(JSON.parse(i.pop())))}redo(e,t){const{undoItems:i,redoItems:s}=this;this.canRedo()&&(i.push(JSON.stringify(e)),t(JSON.parse(s.pop())))}}class k{constructor(){this.range=null,this.state="clear"}copy(e){return this.range=e,this.state="copy",this}cut(e){return this.range=e,this.state="cut",this}isCopy(){return"copy"===this.state}isCut(){return"cut"===this.state}isClear(){return"clear"===this.state}clear(){this.range=null,this.state="clear"}}class E{constructor(e,t,i){this.ci=e,this.operator=t,this.value=i}set(e,t){this.operator=e,this.value=t}includes(e){const{operator:t,value:i}=this;return"all"===t||"in"===t&&i.includes(e)}vlength(){const{operator:e,value:t}=this;return"in"===e?t.length:0}getData(){const{ci:e,operator:t,value:i}=this;return{ci:e,operator:t,value:i}}}class S{constructor(e,t){this.ci=e,this.order=t}asc(){return"asc"===this.order}desc(){return"desc"===this.order}}class T{constructor(){this.ref=null,this.filters=[],this.sort=null}setData({ref:e,filters:t,sort:i}){null!=e&&(this.ref=e,this.filters=t.map(e=>new E(e.ci,e.operator,e.value)),i&&(this.sort=new S(i.ci,i.order)))}getData(){if(this.active()){const{ref:e,filters:t,sort:i}=this;return{ref:e,filters:t.map(e=>e.getData()),sort:i}}return{}}addFilter(e,t,i){const s=this.getFilter(e);null==s?this.filters.push(new E(e,t,i)):s.set(t,i)}setSort(e,t){this.sort=t?new S(e,t):null}includes(e,t){return!!this.active()&&this.hrange().includes(e,t)}getSort(e){const{sort:t}=this;return t&&t.ci===e?t:null}getFilter(e){const{filters:t}=this;for(let i=0;i<t.length;i+=1)if(t[i].ci===e)return t[i];return null}filteredRows(e){const t=new Set,i=new Set;if(this.active()){const{sri:s,eri:l}=this.range(),{filters:r}=this;for(let n=s+1;n<=l;n+=1)for(let s=0;s<r.length;s+=1){const l=r[s],o=e(n,l.ci),a=o?o.text:"";if(!l.includes(a)){t.add(n);break}i.add(n)}}return{rset:t,fset:i}}items(e,t){const i={};if(this.active()){const{sri:s,eri:l}=this.range();for(let r=s+1;r<=l;r+=1){const s=t(r,e);if(null===s||/^\s*$/.test(s.text))i[""]=(i[""]||0)+1;else{const e=s.text,t=(i[e]||0)+1;i[e]=t}}}return i}range(){return v.valueOf(this.ref)}hrange(){const e=this.range();return e.eri=e.sri,e}clear(){this.ref=null,this.filters=[],this.sort=null}active(){return null!==this.ref}}i(22489);class R{constructor(e=[]){this._=e}forEach(e){this._.forEach(e)}deleteWithin(e){this._=this._.filter(t=>!t.within(e))}getFirstIncludes(e,t){for(let i=0;i<this._.length;i+=1){const s=this._[i];if(s.includes(e,t))return s}return null}filterIntersects(e){return new R(this._.filter(t=>t.intersects(e)))}intersects(e){for(let t=0;t<this._.length;t+=1){const i=this._[t];if(i.intersects(e))return!0}return!1}union(e){let t=e;return this._.forEach(e=>{e.intersects(t)&&(t=e.union(t))}),t}add(e){this.deleteWithin(e),this._.push(e)}shift(e,t,i,s){this._.forEach(l=>{const{sri:r,sci:n,eri:o,eci:a}=l,c=l;"row"===e?r>=t?(c.sri+=i,c.eri+=i):r<t&&t<=o&&(c.eri+=i,s(r,n,i,0)):"column"===e&&(n>=t?(c.sci+=i,c.eci+=i):n<t&&t<=a&&(c.eci+=i,s(r,n,0,i)))})}move(e,t,i){this._.forEach(s=>{const l=s;l.within(e)&&(l.eri+=t,l.sri+=t,l.sci+=i,l.eci+=i)})}setData(e){return this._=e.map(e=>v.valueOf(e)),this}getData(){return this._.map(e=>e.toString())}}function $(e){return JSON.parse(JSON.stringify(e))}const I=(e={},...t)=>(t.forEach(t=>{Object.keys(t).forEach(i=>{const s=t[i];"string"===typeof s||"number"===typeof s||"boolean"===typeof s?e[i]=s:"function"!==typeof s&&!Array.isArray(s)&&s instanceof Object?(e[i]=e[i]||{},I(e[i],s)):e[i]=s})}),e);function O(e,t){const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let s=0;s<i.length;s+=1){const l=i[s],r=e[l],n=t[l];if(void 0===n)return!1;if("string"===typeof r||"number"===typeof r||"boolean"===typeof r){if(r!==n)return!1}else if(Array.isArray(r)){if(r.length!==n.length)return!1;for(let e=0;e<r.length;e+=1)if(!O(r[e],n[e]))return!1}else if("function"!==typeof r&&!Array.isArray(r)&&r instanceof Object&&!O(r,n))return!1}return!0}const A=(e,t=e=>e)=>{let i=0,s=0;return Object.keys(e).forEach(l=>{i+=t(e[l],l),s+=1}),[i,s]};function D(e,t){const i=e[`${t}`];return delete e[`${t}`],i}function z(e,t,i,s,l,r){let n=i,o=s,a=e;for(;a<t;a+=1){if(n>l)break;o=r(a),n+=o}return[a,n-o,o]}function j(e,t,i){let s=0;for(let l=e;l<t;l+=1)s+=i(l);return s}function H(e,t,i){for(let s=e;s<t;s+=1)i(s)}function N(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i+=1)if(e[i]!==t[i])return!1;return!0}function M(e){const t=`${e}`;let i=0,s=!1;for(let l=0;l<t.length;l+=1)!0===s&&(i+=1),"."===t.charAt(l)&&(s=!0);return i}function W(e,t,i){if(Number.isNaN(t)||Number.isNaN(i))return t+e+i;const s=M(t),l=M(i),r=Number(t),n=Number(i);let o=0;if("-"===e)o=r-n;else if("+"===e)o=r+n;else if("*"===e)o=r*n;else if("/"===e)return o=r/n,M(o)>5?o.toFixed(2):o;return o.toFixed(Math.max(s,l))}var F={cloneDeep:$,merge:(...e)=>I({},...e),equals:O,arrayEquals:N,sum:A,rangeEach:H,rangeSum:j,rangeReduceIf:z,deleteProperty:D,numberCalc:W};class P{constructor({len:e,height:t,indexHeight:i}){this._={},this.len=e,this.height=t,this.indexHeight=i}getHeight(e){if(this.isHide(e))return 0;const t=this.get(e);return t&&t.height?t.height:this.height}setHeight(e,t){const i=this.getOrNew(e);i.height=t}unhide(e){let t=e;while(t>0){if(t-=1,!this.isHide(t))break;this.setHide(t,!1)}}isHide(e){const t=this.get(e);return t&&t.hide}setHide(e,t){const i=this.getOrNew(e);!0===t?i.hide=!0:delete i.hide}setStyle(e,t){const i=this.getOrNew(e);i.style=t}sumHeight(e,t,i){return F.rangeSum(e,t,e=>i&&i.has(e)?0:this.getHeight(e))}totalHeight(){return this.sumHeight(0,this.len)}get(e){return this._[e]}getOrNew(e){return this._[e]=this._[e]||{cells:{}},this._[e]}getCell(e,t){const i=this.get(e);return void 0!==i&&void 0!==i.cells&&void 0!==i.cells[t]?i.cells[t]:null}getCellMerge(e,t){const i=this.getCell(e,t);return i&&i.merge?i.merge:[0,0]}getCellOrNew(e,t){const i=this.getOrNew(e);return i.cells[t]=i.cells[t]||{},i.cells[t]}setCell(e,t,i,s="all"){const l=this.getOrNew(e);"all"===s?l.cells[t]=i:"text"===s?(l.cells[t]=l.cells[t]||{},l.cells[t].text=i.text):"format"===s&&(l.cells[t]=l.cells[t]||{},l.cells[t].style=i.style,i.merge&&(l.cells[t].merge=i.merge))}setCellText(e,t,i){const s=this.getCellOrNew(e,t);!1!==s.editable&&(s.text=i)}copyPaste(e,t,i,s=!1,l=()=>{console.log("empty function")}){const{sri:r,sci:n,eri:o,eci:a}=e,c=t.sri,h=t.sci,d=t.eri,u=t.eci,[f,p]=e.size(),[g,m]=t.size();let w=!0,v=0;(d<r||u<n)&&(w=!1,v=d<r?g:m);for(let y=r;y<=o;y+=1)if(this._[y])for(let e=n;e<=a;e+=1)if(this._[y].cells&&this._[y].cells[e])for(let t=c;t<=d;t+=f)for(let g=h;g<=u;g+=p){const m=t+(y-r),x=g+(e-n),C=F.cloneDeep(this._[y].cells[e]);if(s&&C&&C.text&&C.text.length>0){const{text:e}=C;let i=g-h+(t-c)+2;if(w||(i-=v+1),"="===e[0])C.text=e.replace(/[a-zA-Z]{1,3}\d+/g,e=>{let[t,s]=[0,0];return r===c?t=i-1:s=i-1,/^\d+$/.test(e)?e:b(e,t,s)});else if(f<=1&&p>1&&(c>o||d<r)||p<=1&&f>1&&(h>a||u<n)||f<=1&&p<=1){const t=/[\\.\d]+$/.exec(e);if(null!==t){const s=Number(t[0])+i-1;C.text=e.substring(0,t.index)+s}}}this.setCell(m,x,C,i),l(m,x,C)}}cutPaste(e,t){const i={};this.each(s=>{this.eachCells(s,l=>{let r=parseInt(s,10),n=parseInt(l,10);e.includes(s,l)&&(r=t.sri+(r-e.sri),n=t.sci+(n-e.sci)),i[r]=i[r]||{cells:{}},i[r].cells[n]=this._[s].cells[l]})}),this._=i}paste(e,t){if(e.length<=0)return;const{sri:i,sci:s}=t;e.forEach((e,t)=>{const l=i+t;e.forEach((e,t)=>{const i=s+t;this.setCellText(l,i,e)})})}insert(e,t=1){const i={};this.each((s,l)=>{let r=parseInt(s,10);r>=e&&(r+=t,this.eachCells(s,(i,s)=>{s.text&&"="===s.text[0]&&(s.text=s.text.replace(/[a-zA-Z]{1,3}\d+/g,i=>b(i,0,t,(t,i)=>i>=e)))})),i[r]=l}),this._=i,this.len+=t}delete(e,t){const i=t-e+1,s={};this.each((l,r)=>{const n=parseInt(l,10);n<e?s[n]=r:l>t&&(s[n-i]=r,this.eachCells(l,(e,s)=>{s.text&&"="===s.text[0]&&(s.text=s.text.replace(/[a-zA-Z]{1,3}\d+/g,e=>b(e,0,-i,(e,i)=>i>t)))}))}),this._=s,this.len-=i}insertColumn(e,t=1){this.each((i,s)=>{const l={};this.eachCells(i,(i,s)=>{let r=parseInt(i,10);r>=e&&(r+=t,s.text&&"="===s.text[0]&&(s.text=s.text.replace(/[a-zA-Z]{1,3}\d+/g,i=>b(i,t,0,t=>t>=e)))),l[r]=s}),s.cells=l})}deleteColumn(e,t){const i=t-e+1;this.each((s,l)=>{const r={};this.eachCells(s,(s,l)=>{const n=parseInt(s,10);n<e?r[n]=l:n>t&&(r[n-i]=l,l.text&&"="===l.text[0]&&(l.text=l.text.replace(/[a-zA-Z]{1,3}\d+/g,e=>b(e,-i,0,e=>e>t))))}),l.cells=r})}deleteCells(e,t="all"){e.each((e,i)=>{this.deleteCell(e,i,t)})}deleteCell(e,t,i="all"){const s=this.get(e);if(null!==s){const l=this.getCell(e,t);null!==l&&!1!==l.editable&&("all"===i?delete s.cells[t]:"text"===i?(l.text&&delete l.text,l.value&&delete l.value):"format"===i?(void 0!==l.style&&delete l.style,l.merge&&delete l.merge):"merge"===i&&l.merge&&delete l.merge)}}maxCell(){const e=Object.keys(this._),t=e[e.length-1],i=this._[t];if(i){const{cells:e}=i,s=Object.keys(e),l=s[s.length-1];return[parseInt(t,10),parseInt(l,10)]}return[0,0]}each(e){Object.entries(this._).forEach(([t,i])=>{e(t,i)})}eachCells(e,t){this._[e]&&this._[e].cells&&Object.entries(this._[e].cells).forEach(([e,i])=>{t(e,i)})}setData(e){e.len&&(this.len=e.len,delete e.len),this._=e}getData(){const{len:e}=this;return Object.assign({len:e},this._)}}class _{constructor({len:e,width:t,indexWidth:i,minWidth:s}){this._={},this.len=e,this.width=t,this.indexWidth=i,this.minWidth=s}setData(e){e.len&&(this.len=e.len,delete e.len),this._=e}getData(){const{len:e}=this;return Object.assign({len:e},this._)}getWidth(e){if(this.isHide(e))return 0;const t=this._[e];return t&&t.width?t.width:this.width}getOrNew(e){return this._[e]=this._[e]||{},this._[e]}setWidth(e,t){const i=this.getOrNew(e);i.width=t}unhide(e){let t=e;while(t>0){if(t-=1,!this.isHide(t))break;this.setHide(t,!1)}}isHide(e){const t=this._[e];return t&&t.hide}setHide(e,t){const i=this.getOrNew(e);!0===t?i.hide=!0:delete i.hide}setStyle(e,t){const i=this.getOrNew(e);i.style=t}sumWidth(e,t){return F.rangeSum(e,t,e=>this.getWidth(e))}totalWidth(){return this.sumWidth(0,this.len)}}const B={phone:/^[1-9]\d{10}$/,email:/w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*/};function L(e,t,...i){let s="";return e||(s=h(`validation.${t}`,...i)),[e,s]}class V{constructor(e,t,i,s){this.required=t,this.value=i,this.type=e,this.operator=s,this.message=""}parseValue(e){const{type:t}=this;return"date"===t?new Date(e):"number"===t?Number(e):e}equals(e){let t=this.type===e.type&&this.required===e.required&&this.operator===e.operator;return t&&(t=Array.isArray(this.value)?F.arrayEquals(this.value,e.value):this.value===e.value),t}values(){return this.value.split(",")}validate(e){const{required:t,operator:i,value:s,type:l}=this;if(t&&/^\s*$/.test(e))return L(!1,"required");if(/^\s*$/.test(e))return[!0];if(B[l]&&!B[l].test(e))return L(!1,"notMatch");if("list"===l)return L(this.values().includes(e),"notIn");if(i){const t=this.parseValue(e);if("be"===i){const[e,i]=s;return L(t>=this.parseValue(e)&&t<=this.parseValue(i),"between",e,i)}if("nbe"===i){const[e,i]=s;return L(t<this.parseValue(e)||t>this.parseValue(i),"notBetween",e,i)}if("eq"===i)return L(t===this.parseValue(s),"equal",s);if("neq"===i)return L(t!==this.parseValue(s),"notEqual",s);if("lt"===i)return L(t<this.parseValue(s),"lessThan",s);if("lte"===i)return L(t<=this.parseValue(s),"lessThanEqual",s);if("gt"===i)return L(t>this.parseValue(s),"greaterThan",s);if("gte"===i)return L(t>=this.parseValue(s),"greaterThanEqual",s)}return[!0]}}class q{constructor(e,t,i){this.refs=t,this.mode=e,this.validator=i}includes(e,t){const{refs:i}=this;for(let s=0;s<i.length;s+=1){const l=v.valueOf(i[s]);if(l.includes(e,t))return!0}return!1}addRef(e){this.remove(v.valueOf(e)),this.refs.push(e)}remove(e){const t=[];this.refs.forEach(i=>{const s=v.valueOf(i);if(s.intersects(e)){const i=s.difference(e);i.forEach(e=>t.push(e.toString()))}else t.push(i)}),this.refs=t}getData(){const{refs:e,mode:t,validator:i}=this,{type:s,required:l,operator:r,value:n}=i;return{refs:e,mode:t,type:s,required:l,operator:r,value:n}}static valueOf({refs:e,mode:t,type:i,required:s,operator:l,value:r}){return new q(t,e,new V(i,s,r,l))}}class U{constructor(){this._=[],this.errors=new Map}getError(e,t){return this.errors.get(`${e}_${t}`)}validate(e,t,i){const s=this.get(e,t),l=`${e}_${t}`,{errors:r}=this;if(null!==s){const[e,t]=s.validator.validate(i);e?r.delete(l):r.set(l,t)}else r.delete(l);return!0}add(e,t,{type:i,required:s,value:l,operator:r}){const n=new V(i,s,l,r),o=this.getByValidator(n);null!==o?o.addRef(t):this._.push(new q(e,[t],n))}getByValidator(e){for(let t=0;t<this._.length;t+=1){const i=this._[t];if(i.validator.equals(e))return i}return null}get(e,t){for(let i=0;i<this._.length;i+=1){const s=this._[i];if(s.includes(e,t))return s}return null}remove(e){this.each(t=>{t.remove(e)})}each(e){this._.forEach(t=>e(t))}getData(){return this._.filter(e=>e.refs.length>0).map(e=>e.getData())}setData(e){this._=e.map(e=>q.valueOf(e))}}const X={mode:"edit",view:{height:()=>document.documentElement.clientHeight,width:()=>document.documentElement.clientWidth},showGrid:!0,showToolbar:!0,showContextmenu:!0,showBottomBar:!0,row:{len:100,height:25},col:{len:26,width:100,indexWidth:60,minWidth:60},style:{bgcolor:"#ffffff",align:"left",valign:"middle",textwrap:!1,strike:!1,underline:!1,color:"#0a0a0a",font:{name:"Arial",size:10,bold:!1,italic:!1},format:"normal"}},K=41,J=41;function Y(e,t,i=()=>{console.log("empty function")}){const{merges:s}=this,l=t.clone(),[r,n]=e.size(),[o,a]=t.size();return r>o&&(l.eri=t.sri+r-1),n>a&&(l.eci=t.sci+n-1),!s.intersects(l)||(i(h("error.pasteForMergedCell")),!1)}function Z(e,t,i,s=!1){const{rows:l,merges:r}=this;"all"!==i&&"format"!==i||(l.deleteCells(t,i),r.deleteWithin(t)),l.copyPaste(e,t,i,s,(e,t,i)=>{if(i&&i.merge){const[s,l]=i.merge;if(s<=0&&l<=0)return;r.add(new v(e,t,e+s,t+l))}})}function G(e,t){const{clipboard:i,rows:s,merges:l}=this;s.cutPaste(e,t),l.move(e,t.sri-e.sri,t.sci-e.sci),i.clear()}function Q(e,t,i){const{styles:s,rows:l}=this,r=l.getCellOrNew(e,t);let n={};void 0!==r.style&&(n=F.cloneDeep(s[r.style])),n=F.merge(n,{border:i}),r.style=this.addStyle(n)}function ee({mode:e,style:t,color:i}){const{styles:s,selector:l,rows:r}=this,{sri:n,sci:o,eri:a,eci:c}=l.range,h=!this.isSingleSelected();if(h||"inside"!==e&&"horizontal"!==e&&"vertical"!==e)if("outside"!==e||h){if("none"===e)l.range.each((e,t)=>{const i=r.getCell(e,t);if(i&&void 0!==i.style){const e=F.cloneDeep(s[i.style]);delete e.border,i.style=this.addStyle(e)}});else if("all"===e||"inside"===e||"outside"===e||"horizontal"===e||"vertical"===e){const s=[];for(let l=n;l<=a;l+=1)for(let d=o;d<=c;d+=1){const u=[];for(let e=0;e<s.length;e+=1){const[t,i,r,n]=s[e];if(l===t+r+1&&u.push(e),t<=l&&l<=t+r&&d===i){d+=n+1;break}}if(u.forEach(e=>s.splice(e,1)),d>c)break;const f=r.getCell(l,d);let[p,g]=[0,0];f&&f.merge&&([p,g]=f.merge,s.push([l,d,p,g]));const m=p>0&&l+p===a,w=g>0&&d+g===c;let b={};"all"===e?b={bottom:[t,i],top:[t,i],left:[t,i],right:[t,i]}:"inside"===e?(!w&&d<c&&(b.right=[t,i]),!m&&l<a&&(b.bottom=[t,i])):"horizontal"===e?!m&&l<a&&(b.bottom=[t,i]):"vertical"===e?!w&&d<c&&(b.right=[t,i]):"outside"===e&&h&&(n===l&&(b.top=[t,i]),(m||a===l)&&(b.bottom=[t,i]),o===d&&(b.left=[t,i]),(w||c===d)&&(b.right=[t,i])),Object.keys(b).length>0&&Q.call(this,l,d,b),d+=g}}else if("top"===e||"bottom"===e)for(let d=o;d<=c;d+=1)"top"===e&&(Q.call(this,n,d,{top:[t,i]}),d+=r.getCellMerge(n,d)[1]),"bottom"===e&&(Q.call(this,a,d,{bottom:[t,i]}),d+=r.getCellMerge(a,d)[1]);else if("left"===e||"right"===e)for(let d=n;d<=a;d+=1)"left"===e&&(Q.call(this,d,o,{left:[t,i]}),d+=r.getCellMerge(d,o)[0]),"right"===e&&(Q.call(this,d,c,{right:[t,i]}),d+=r.getCellMerge(d,c)[0])}else Q.call(this,n,o,{top:[t,i],bottom:[t,i],left:[t,i],right:[t,i]})}function te(e,t){const{rows:i}=this,s=this.freezeTotalHeight();let l=i.height;s+i.height<e&&(l-=t);const r=this.exceptRowSet;let n=0,o=l,{height:a}=i;for(;n<i.len;n+=1){if(o>e)break;r.has(n)||(a=i.getHeight(n),o+=a)}return o-=a,o<=0?{ri:-1,top:0,height:a}:{ri:n-1,top:o,height:a}}function ie(e,t){const{cols:i}=this,s=this.freezeTotalWidth();let l=i.indexWidth;s+i.indexWidth<e&&(l-=t);const[r,n,o]=F.rangeReduceIf(0,i.len,l,i.indexWidth,e,e=>i.getWidth(e));return n<=0?{ci:-1,left:0,width:i.indexWidth}:{ci:r-1,left:n,width:o}}class se{constructor(e,t){this.settings=F.merge(X,t||{}),this.name=e||"sheet",this.freeze=[0,0],this.styles=[],this.merges=new R,this.rows=new P(this.settings.row),this.cols=new _(this.settings.col),this.validations=new U,this.hyperlinks={},this.comments={},this.selector=new y,this.scroll=new x,this.history=new C,this.clipboard=new k,this.autoFilter=new T,this.change=()=>{console.log("empty function")},this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map}addValidation(e,t,i){this.changeData(()=>{this.validations.add(e,t,i)})}removeValidation(){const{range:e}=this.selector;this.changeData(()=>{this.validations.remove(e)})}getSelectedValidator(){const{ri:e,ci:t}=this.selector,i=this.validations.get(e,t);return i?i.validator:null}getSelectedValidation(){const{ri:e,ci:t,range:i}=this.selector,s=this.validations.get(e,t),l={ref:i.toString()};return null!==s&&(l.mode=s.mode,l.validator=s.validator),l}canUndo(){return this.history.canUndo()}canRedo(){return this.history.canRedo()}undo(){this.history.undo(this.getData(),e=>{this.setData(e)})}redo(){this.history.redo(this.getData(),e=>{this.setData(e)})}copy(){this.clipboard.copy(this.selector.range)}copyToSystemClipboard(e){let t=[];const{sri:i,eri:s,sci:l,eci:r}=this.selector.range;for(let n=i;n<=s;n+=1){const e=[];for(let t=l;t<=r;t+=1){const i=this.getCell(n,t);e.push(i&&i.text||"")}t.push(e)}t=t.map(e=>e.join("\t")).join("\n"),e&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",t),e.preventDefault()),navigator.clipboard&&navigator.clipboard.writeText(t).then(()=>{console.log("empty function")},e=>{console.log("text copy to the system clipboard error  ",t,e)})}cut(){this.clipboard.cut(this.selector.range)}paste(e="all",t=()=>{console.log("empty function")}){const{clipboard:i,selector:s}=this;return!i.isClear()&&(!!Y.call(this,i.range,s.range,t)&&(this.changeData(()=>{i.isCopy()?Z.call(this,i.range,s.range,e):i.isCut()&&G.call(this,i.range,s.range)}),!0))}pasteFromSystemClipboard(e,t){const{selector:i}=this;navigator.clipboard.readText().then(s=>{const l=this.parseClipboardContent(s);let r=i.ri;l.forEach(e=>{let t=i.ci;e.forEach(e=>{this.setCellText(r,t,e,"input"),t+=1}),r+=1}),e(),t(this.rows.getData())})}parseClipboardContent(e){const t=[],i=e.split("\n");let s=0;return i.forEach(e=>{t[s]=e.split("\t"),s+=1}),t}pasteFromText(e){let t=[];if(t=/\r\n/.test(e)?e.split("\r\n").map(e=>e.replace(/"/g,"").split("\t")):e.split("\n").map(e=>e.replace(/"/g,"").split("\t")),t.length){const{rows:e,selector:i}=this;this.changeData(()=>{e.paste(t,i.range)})}}autofill(e,t,i=()=>{console.log("empty function")}){const s=this.selector.range;return!!Y.call(this,s,e,i)&&(this.changeData(()=>{Z.call(this,s,e,t,!0)}),!0)}clearClipboard(){this.clipboard.clear()}calSelectedRangeByEnd(e,t){const{selector:i,rows:s,cols:l,merges:r}=this;let{sri:n,sci:o,eri:a,eci:c}=i.range;const h=i.ri,d=i.ci;let[u,f]=[e,t];return e<0&&(u=s.len-1),t<0&&(f=l.len-1),[n,a]=u>h?[h,u]:[u,h],[o,c]=f>d?[d,f]:[f,d],i.range=r.union(new v(n,o,a,c)),i.range=r.union(i.range),i.range}calSelectedRangeByStart(e,t){const{selector:i,rows:s,cols:l,merges:r}=this;let n=r.getFirstIncludes(e,t);return null===n&&(n=new v(e,t,e,t),-1===e&&(n.sri=0,n.eri=s.len-1),-1===t&&(n.sci=0,n.eci=l.len-1)),i.range=n,n}setSelectedCellAttr(e,t){this.changeData(()=>{const{selector:i,styles:s,rows:l}=this;if("merge"===e)t?this.merge():this.unmerge();else if("border"===e)ee.call(this,t);else if("formula"===e){const{ri:e,ci:s,range:r}=i;if(i.multiple()){const[s,n]=i.size(),{sri:o,sci:a,eri:c,eci:h}=r;if(s>1)for(let e=a;e<=h;e+=1){const i=l.getCellOrNew(c+1,e);i.text=`=${t}(${w(e,o)}:${w(e,c)})`}else if(n>1){const i=l.getCellOrNew(e,h+1);i.text=`=${t}(${w(a,e)}:${w(h,e)})`}}else{const i=l.getCellOrNew(e,s);i.text=`=${t}()`}}else i.range.each((i,r)=>{const n=l.getCellOrNew(i,r);let o={};if(void 0!==n.style&&(o=F.cloneDeep(s[n.style])),"format"===e)o.format=t,n.style=this.addStyle(o);else if("font-bold"===e||"font-italic"===e||"font-name"===e||"font-size"===e){const i={};i[e.split("-")[1]]=t,o.font=Object.assign(o.font||{},i),n.style=this.addStyle(o)}else"strike"===e||"textwrap"===e||"underline"===e||"align"===e||"valign"===e||"color"===e||"bgcolor"===e?(o[e]=t,n.style=this.addStyle(o)):n[e]=t})})}setSelectedCellText(e,t="input",i=""){const{autoFilter:s,selector:l,rows:r}=this,{ri:n,ci:o}=l;let a=n;this.unsortedRowMap.has(n)&&(a=this.unsortedRowMap.get(n));const c=r.getCell(a,o),h=c?c.text:"";if(this.setCellText(a,o,e,t),s.active()){const t=s.getFilter(o);if(t){const i=t.value.findIndex(e=>e===h);i>=0&&t.value.splice(i,1,e)}}}getSelectedCell(){const{ri:e,ci:t}=this.selector;let i=e;return this.unsortedRowMap.has(e)&&(i=this.unsortedRowMap.get(e)),this.rows.getCell(i,t)}xyInSelectedRect(e,t){const{left:i,top:s,width:l,height:r}=this.getSelectedRect(),n=e-this.cols.indexWidth,o=t-this.rows.height;return n>i&&n<i+l&&o>s&&o<s+r}getSelectedRect(){return this.getRect(this.selector.range)}getClipboardRect(){const{clipboard:e}=this;return e.isClear()?{left:-100,top:-100}:this.getRect(e.range)}getRect(e){const{scroll:t,rows:i,cols:s,exceptRowSet:l}=this,{sri:r,sci:n,eri:o,eci:a}=e;if(r<0&&n<0)return{left:0,l:0,top:0,t:0,scroll:t};const c=s.sumWidth(0,n),h=i.sumHeight(0,r,l),d=i.sumHeight(r,o+1,l),u=s.sumWidth(n,a+1);let f=c-t.x,p=h-t.y;const g=this.freezeTotalHeight(),m=this.freezeTotalWidth();return m>0&&m>c&&(f=c),g>0&&g>h&&(p=h),{l:c,t:h,left:f,top:p,height:d,width:u,scroll:t}}getCellRectByXY(e,t){const{scroll:i,merges:s,rows:l,cols:r}=this;let{ri:n,top:o,height:a}=te.call(this,t,i.y),{ci:c,left:h,width:d}=ie.call(this,e,i.x);if(-1===c&&(d=r.totalWidth()),-1===n&&(a=l.totalHeight()),n>=0||c>=0){const e=s.getFirstIncludes(n,c);e&&(n=e.sri,c=e.sci,({left:h,top:o,width:d,height:a}=this.cellRect(n,c)))}return{ri:n,ci:c,left:h,top:o,width:d,height:a}}isSingleSelected(){const{sri:e,sci:t,eri:i,eci:s}=this.selector.range,l=this.getCell(e,t);if(l&&l.merge){const[r,n]=l.merge;if(e+r===i&&t+n===s)return!0}return!this.selector.multiple()}canUnmerge(){const{sri:e,sci:t,eri:i,eci:s}=this.selector.range,l=this.getCell(e,t);if(l&&l.merge){const[r,n]=l.merge;if(e+r===i&&t+n===s)return!0}return!1}merge(){const{selector:e,rows:t}=this;if(this.isSingleSelected())return;const[i,s]=e.size();if(i>1||s>1){const{sri:l,sci:r}=e.range;this.changeData(()=>{const n=t.getCellOrNew(l,r);n.merge=[i-1,s-1],this.merges.add(e.range),this.rows.deleteCells(e.range),this.rows.setCell(l,r,n)})}}unmerge(){const{selector:e}=this;if(!this.isSingleSelected())return;const{sri:t,sci:i}=e.range;this.changeData(()=>{this.rows.deleteCell(t,i,"merge"),this.merges.deleteWithin(e.range)})}canAutofilter(){return!this.autoFilter.active()}autofilter(){const{autoFilter:e,selector:t}=this;this.changeData(()=>{e.active()?(e.clear(),this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map):e.ref=t.range.toString()})}setAutoFilter(e,t,i,s){const{autoFilter:l}=this;l.addFilter(e,i,s),l.setSort(e,t),this.resetAutoFilter()}resetAutoFilter(){const{autoFilter:e,rows:t}=this;if(!e.active())return;const{sort:i}=e,{rset:s,fset:l}=e.filteredRows((e,i)=>t.getCell(e,i)),r=Array.from(l),n=Array.from(l);i&&r.sort((e,t)=>"asc"===i.order?e-t:"desc"===i.order?t-e:0),this.exceptRowSet=s,this.sortedRowMap=new Map,this.unsortedRowMap=new Map,r.forEach((e,t)=>{this.sortedRowMap.set(n[t],e),this.unsortedRowMap.set(e,n[t])})}deleteCell(e="all"){const{selector:t}=this;this.changeData(()=>{this.rows.deleteCells(t.range,e),"all"!==e&&"format"!==e||this.merges.deleteWithin(t.range)})}insert(e,t=1){this.changeData(()=>{const{sri:i,sci:s}=this.selector.range,{rows:l,merges:r,cols:n}=this;let o=i;"row"===e?l.insert(i,t):"column"===e&&(l.insertColumn(s,t),o=s,n.len+=1),r.shift(e,o,t,(e,t,i,s)=>{const r=l.getCell(e,t);r.merge[0]+=i,r.merge[1]+=s})})}delete(e){this.changeData(()=>{const{rows:t,merges:i,selector:s,cols:l}=this,{range:r}=s,{sri:n,sci:o,eri:a,eci:c}=s.range,[h,d]=s.range.size();let u=n,f=h;"row"===e?t.delete(n,a):"column"===e&&(t.deleteColumn(o,c),u=r.sci,f=d,l.len-=c-o+1),i.shift(e,u,-f,(e,i,s,l)=>{const r=t.getCell(e,i);r.merge[0]+=s,r.merge[1]+=l,0===r.merge[0]&&0===r.merge[1]&&delete r.merge})})}scrollx(e,t){const{scroll:i,freeze:s,cols:l}=this,[,r]=s,[n,o,a]=F.rangeReduceIf(r,l.len,0,0,e,e=>l.getWidth(e));let c=o;e>0&&(c+=a),i.x!==c&&(i.ci=e>0?n:0,i.x=c,t())}scrolly(e,t){const{scroll:i,freeze:s,rows:l}=this,[r]=s,[n,o,a]=F.rangeReduceIf(r,l.len,0,0,e,e=>l.getHeight(e));let c=o;e>0&&(c+=a),i.y!==c&&(i.ri=e>0?n:0,i.y=c,t())}cellRect(e,t){const{rows:i,cols:s}=this,l=s.sumWidth(0,t),r=i.sumHeight(0,e),n=i.getCell(e,t);let o=s.getWidth(t),a=i.getHeight(e);if(null!==n&&n.merge){const[l,r]=n.merge;if(l>0)for(let t=1;t<=l;t+=1)a+=i.getHeight(e+t);if(r>0)for(let e=1;e<=r;e+=1)o+=s.getWidth(t+e)}return{left:l,top:r,width:o,height:a,cell:n}}getCell(e,t){return this.rows.getCell(e,t)}getCellTextOrDefault(e,t){const i=this.getCell(e,t);return i&&i.text?i.text:""}getCellStyle(e,t){const i=this.getCell(e,t);return i&&void 0!==i.style?this.styles[i.style]:null}getCellStyleOrDefault(e,t){const{styles:i,rows:s}=this,l=s.getCell(e,t),r=l&&void 0!==l.style?i[l.style]:{};return F.merge(this.defaultStyle(),r)}getSelectedCellStyle(){const{ri:e,ci:t}=this.selector;return this.getCellStyleOrDefault(e,t)}setCellText(e,t,i,s){const{rows:l,history:r,validations:n}=this;"finished"===s?(l.setCellText(e,t,""),r.add(this.getData()),l.setCellText(e,t,i)):(l.setCellText(e,t,i),this.change(this.getData())),n.validate(e,t,i)}freezeIsActive(){const[e,t]=this.freeze;return e>0||t>0}setFreeze(e,t){this.changeData(()=>{this.freeze=[e,t]})}freezeTotalWidth(){return this.cols.sumWidth(0,this.freeze[1])}freezeTotalHeight(){return this.rows.sumHeight(0,this.freeze[0])}setRowHeight(e,t){this.changeData(()=>{this.rows.setHeight(e,t)})}setColWidth(e,t){this.changeData(()=>{this.cols.setWidth(e,t)})}viewHeight(){const{view:e,showToolbar:t,showBottomBar:i}=this.settings;let s=e.height();return i&&(s-=J),t&&(s-=K),s}viewWidth(){return this.settings.view.width()}freezeViewRange(){const[e,t]=this.freeze;return new v(0,0,e-1,t-1,this.freezeTotalWidth(),this.freezeTotalHeight())}contentRange(){const{rows:e,cols:t}=this,[i,s]=e.maxCell(),l=e.sumHeight(0,i+1),r=t.sumWidth(0,s+1);return new v(0,0,i,s,r,l)}exceptRowTotalHeight(e,t){const{exceptRowSet:i,rows:s}=this,l=Array.from(i);let r=0;return l.forEach(i=>{if(i<e||i>t){const e=s.getHeight(i);r+=e}}),r}viewRange(){const{scroll:e,rows:t,cols:i,freeze:s,exceptRowSet:l}=this;let{ri:r,ci:n}=e;r<=0&&([r]=s),n<=0&&([,n]=s);let[o,a]=[0,0],[c,h]=[t.len,i.len];for(let d=r;d<t.len;d+=1)if(l.has(d)||(a+=t.getHeight(d),c=d),a>this.viewHeight())break;for(let d=n;d<i.len;d+=1)if(o+=i.getWidth(d),h=d,o>this.viewWidth())break;return new v(r,n,c,h,o,a)}eachMergesInView(e,t){this.merges.filterIntersects(e).forEach(e=>t(e))}hideRowsOrCols(){const{rows:e,cols:t,selector:i}=this,[s,l]=i.size(),{sri:r,sci:n,eri:o,eci:a}=i.range;if(s===e.len)for(let c=n;c<=a;c+=1)t.setHide(c,!0);else if(l===t.len)for(let c=r;c<=o;c+=1)e.setHide(c,!0)}unhideRowsOrCols(e,t){this[`${e}s`].unhide(t)}rowEach(e,t,i){let s=0;const{rows:l}=this,r=this.exceptRowSet,n=[...r];let o=0;for(let a=0;a<n.length;a+=1)n[a]<e&&(o+=1);for(let a=e+o;a<=t+o;a+=1)if(r.has(a))o+=1;else{const e=l.getHeight(a);if(e>0&&(i(a,s,e),s+=e,s>this.viewHeight()))break}}colEach(e,t,i){let s=0;const{cols:l}=this;for(let r=e;r<=t;r+=1){const e=l.getWidth(r);if(e>0&&(i(r,s,e),s+=e,s>this.viewWidth()))break}}defaultStyle(){return this.settings.style}addStyle(e){const{styles:t}=this;for(let i=0;i<t.length;i+=1){const s=t[i];if(F.equals(s,e))return i}return t.push(e),t.length-1}changeData(e){this.history.add(this.getData()),e(),this.change(this.getData())}setData(e){return Object.keys(e).forEach(t=>{if("merges"===t||"rows"===t||"cols"===t||"validations"===t)this[t].setData(e[t]);else if("freeze"===t){const[i,s]=m(e[t]);this.freeze=[s,i]}else"autofilter"===t?this.autoFilter.setData(e[t]):void 0!==e[t]&&(this[t]=e[t])}),this}getData(){const{name:e,freeze:t,styles:i,merges:s,rows:l,cols:r,validations:n,autoFilter:o}=this;return{name:e,freeze:w(t[1],t[0]),styles:i,merges:s.getData(),rows:l.getData(),cols:r.getData(),validations:n.getData(),autofilter:o.getData()}}}const le="x-spreadsheet";window.devicePixelRatio;i(81148),i(18237),i(13579);const re=[{key:"SUM",title:d("formula.sum"),render:e=>e.reduce((e,t)=>W("+",e,t),0)},{key:"AVERAGE",title:d("formula.average"),render:e=>e.reduce((e,t)=>Number(e)+Number(t),0)/e.length},{key:"MAX",title:d("formula.max"),render:e=>Math.max(...e.map(e=>Number(e)))},{key:"MIN",title:d("formula.min"),render:e=>Math.min(...e.map(e=>Number(e)))},{key:"IF",title:d("formula._if"),render:([e,t,i])=>e?t:i},{key:"AND",title:d("formula.and"),render:e=>e.every(e=>e)},{key:"OR",title:d("formula.or"),render:e=>e.some(e=>e)},{key:"CONCAT",title:d("formula.concat"),render:e=>e.join("")}],ne=re,oe={};re.forEach(e=>{oe[e.key]=e});function ae(e,t,i){e.addEventListener(t,i)}function ce(e,t,i){e.removeEventListener(t,i)}function he(e){e.xclickoutside&&(ce(window.document.body,"click",e.xclickoutside),delete e.xclickoutside)}function de(e,t){e.xclickoutside=i=>{2===i.detail||e.contains(i.target)||(t?t(e):(e.hide(),he(e)))},ae(window.document.body,"click",e.xclickoutside)}function ue(e,t,i){ae(e,"mousemove",t);const s=e;s.xEvtUp=s=>{ce(e,"mousemove",t),ce(e,"mouseup",e.xEvtUp),i(s)},ae(e,"mouseup",e.xEvtUp)}function fe(e,t,i,s){let l="";Math.abs(e)>Math.abs(t)?(l=e>0?"right":"left",s(l,e,i)):(l=t>0?"down":"up",s(l,t,i))}function pe(e,{move:t,end:i}){let s=0,l=0;ae(e,"touchstart",e=>{const{pageX:t,pageY:i}=e.touches[0];s=t,l=i}),ae(e,"touchmove",e=>{if(!t)return;const{pageX:i,pageY:r}=e.changedTouches[0],n=i-s,o=r-l;(Math.abs(n)>10||Math.abs(o)>10)&&(fe(n,o,e,t),s=i,l=r),e.preventDefault()}),ae(e,"touchend",e=>{if(!i)return;const{pageX:t,pageY:r}=e.changedTouches[0],n=t-s,o=r-l;fe(n,o,e,i)})}function ge(){const e=new Map;function t(t,i){const s=()=>{const s=e.get(t);return Array.isArray(s)&&s.push(i)||!1},l=()=>e.set(t,[].concat(i));return e.has(t)&&s()||l()}function i(t,i){const s=()=>{const s=e.get(t);for(const e of s)e.call(null,...i)};return e.has(t)&&s()}function s(t,i){const s=()=>{const s=e.get(t),l=s.indexOf(i);return l>=0&&s.splice(l,1)&&0===e.get(t).length&&e.delete(t)};return e.has(t)&&s()}function l(e,i){const l=(...t)=>{i.call(null,...t),s(e,l)};return t(e,l)}function r(){e.clear()}return{get current(){return e},on:t,once:l,fire:i,removeListener:s,removeAllListeners:r}}class me{constructor(e=!1,t){this.moving=!1,this.vertical=e,this.el=r("div",`${le}-resizer ${e?"vertical":"horizontal"}`).children(this.unhideHoverEl=r("div",`${le}-resizer-hover`).on("dblclick.stop",e=>this.mousedblclickHandler(e)).css("position","absolute").hide(),this.hoverEl=r("div",`${le}-resizer-hover`).on("mousedown.stop",e=>this.mousedownHandler(e)),this.lineEl=r("div",`${le}-resizer-line`).hide()).hide(),this.cRect=null,this.finishedFn=null,this.minDistance=t,this.unhideFn=()=>{console.log("empty function")}}showUnhide(e){this.unhideIndex=e,this.unhideHoverEl.show()}hideUnhide(){this.unhideHoverEl.hide()}show(e,t){const{moving:i,vertical:s,hoverEl:l,lineEl:r,el:n,unhideHoverEl:o}=this;if(i)return;this.cRect=e;const{left:a,top:c,width:h,height:d}=e;n.offset({left:s?a+h-5:a,top:s?c:c+d-5}).show(),l.offset({width:s?5:h,height:s?d:5}),r.offset({width:s?0:t.width,height:s?t.height:0}),o.offset({left:s?5-h:a,top:s?c:5-d,width:s?5:h,height:s?d:5})}hide(){this.el.offset({left:0,top:0}).hide(),this.hideUnhide()}mousedblclickHandler(){this.unhideIndex&&this.unhideFn(this.unhideIndex)}mousedownHandler(e){let t=e;const{el:i,lineEl:s,cRect:l,vertical:r,minDistance:n}=this;let o=r?l.width:l.height;s.show(),ue(window,e=>{this.moving=!0,null!==t&&1===e.buttons&&(r?(o+=e.movementX,o>n&&i.css("left",`${l.left+o}px`)):(o+=e.movementY,o>n&&i.css("top",`${l.top+o}px`)),t=e)},()=>{t=null,s.hide(),this.moving=!1,this.hide(),this.finishedFn&&(o<n&&(o=n),this.finishedFn(l,o))})}}class we{constructor(e){this.vertical=e,this.moveFn=null,this.el=r("div",`${le}-scrollbar ${e?"vertical":"horizontal"}`).child(this.contentEl=r("div","")).on("mousemove.stop",()=>{console.log("mousemove.stop")}).on("scroll.stop",e=>{const{scrollTop:t,scrollLeft:i}=e.target;this.moveFn&&this.moveFn(this.vertical?t:i,e)})}move(e){return this.el.scroll(e),this}scroll(){return this.el.scroll()}set(e,t){const i=e-1;if(t>i){const e=this.vertical?"height":"width";this.el.css(e,i-15+"px").show(),this.contentEl.css(this.vertical?"width":"height","1px").css(e,`${t}px`)}else this.el.hide();return this}}const be=3;let ve=10;class ye{constructor(e=!1,t=!0){this.useHideInput=e,this.autoFocus=t,this.inputChange=()=>{console.log("empty function")},this.cornerEl=r("div",`${le}-selector-corner`),this.areaEl=r("div",`${le}-selector-area`).child(this.cornerEl).hide(),this.clipboardEl=r("div",`${le}-selector-clipboard`).hide(),this.autofillEl=r("div",`${le}-selector-autofill`).hide(),this.el=r("div",`${le}-selector`).css("z-index",`${ve}`).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),e&&(this.hideInput=r("input","").on("compositionend",e=>{this.inputChange(e.target.value)}),this.el.child(this.hideInputDiv=r("div","hide-input").child(this.hideInput)),this.el.child(this.hideInputDiv=r("div","hide-input").child(this.hideInput))),ve+=1}setOffset(e){return this.el.offset(e).show(),this}hide(){return this.el.hide(),this}setAreaOffset(e){const{left:t,top:i,width:s,height:l}=e,r={width:s-be+.8,height:l-be+.8,left:t-.8,top:i-.8};this.areaEl.offset(r).show(),this.useHideInput&&(this.hideInputDiv.offset(r),this.autoFocus?this.hideInput.val("").focus():this.hideInput.val(""))}setClipboardOffset(e){const{left:t,top:i,width:s,height:l}=e;this.clipboardEl.offset({left:t,top:i,width:s-5,height:l-5})}showAutofill(e){const{left:t,top:i,width:s,height:l}=e;this.autofillEl.offset({width:s-be,height:l-be,left:t,top:i}).show()}hideAutofill(){this.autofillEl.hide()}showClipboard(){this.clipboardEl.show()}hideClipboard(){this.clipboardEl.hide()}}function xe(e){const{data:t}=this,{left:i,top:s,width:l,height:r,scroll:n,l:o,t:a}=e,c=t.freezeTotalWidth(),h=t.freezeTotalHeight();let d=i-c;c>o&&(d-=n.x);let u=s-h;return h>a&&(u-=n.y),{left:d,top:u,width:l,height:r}}function Ce(e){const{data:t}=this,{left:i,width:s,height:l,l:r,t:n,scroll:o}=e,a=t.freezeTotalWidth();let c=i-a;return a>r&&(c-=o.x),{left:c,top:n,width:s,height:l}}function ke(e){const{data:t}=this,{top:i,width:s,height:l,l:r,t:n,scroll:o}=e,a=t.freezeTotalHeight();let c=i-a;return a>n&&(c-=o.y),{left:r,top:c,width:s,height:l}}function Ee(e){const{br:t}=this;t.setAreaOffset(xe.call(this,e))}function Se(e){const{tl:t}=this;t.setAreaOffset(e)}function Te(e){const{t:t}=this;t.setAreaOffset(Ce.call(this,e))}function Re(e){const{l:t}=this;t.setAreaOffset(ke.call(this,e))}function $e(e){const{l:t}=this;t.setClipboardOffset(ke.call(this,e))}function Ie(e){const{br:t}=this;t.setClipboardOffset(xe.call(this,e))}function Oe(e){const{tl:t}=this;t.setClipboardOffset(e)}function Ae(e){const{t:t}=this;t.setClipboardOffset(Ce.call(this,e))}function De(e){Ee.call(this,e),Se.call(this,e),Te.call(this,e),Re.call(this,e)}function ze(e){Ie.call(this,e),Oe.call(this,e),Ae.call(this,e),$e.call(this,e)}class je{constructor(e){const{autoFocus:t}=e.settings;this.inputChange=()=>{console.log("empty function")},this.data=e,this.br=new ye(!0,t),this.t=new ye,this.l=new ye,this.tl=new ye,this.br.inputChange=e=>{this.inputChange(e)},this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.range=null,this.arange=null,this.el=r("div",`${le}-selectors`).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),this.lastri=-1,this.lastci=-1,ve+=1}resetData(e){this.data=e,this.range=e.selector.range,this.resetAreaOffset()}hide(){this.el.hide()}resetOffset(){const{data:e,tl:t,t:i,l:s,br:l}=this,r=e.freezeTotalHeight(),n=e.freezeTotalWidth();r>0||n>0?(t.setOffset({width:n,height:r}),i.setOffset({left:n,height:r}),s.setOffset({top:r,width:n}),l.setOffset({left:n,top:r})):(t.hide(),i.hide(),s.hide(),l.setOffset({left:0,top:0}))}resetAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();De.call(this,e),ze.call(this,t),this.resetOffset()}resetBRTAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();Ee.call(this,e),Te.call(this,e),Ie.call(this,t),Ae.call(this,t),this.resetOffset()}resetBRLAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();Ee.call(this,e),Re.call(this,e),Ie.call(this,t),$e.call(this,t),this.resetOffset()}set(e,t,i=!0){const{data:s}=this,l=s.calSelectedRangeByStart(e,t),{sri:r,sci:n}=l;if(i){let[i,l]=[e,t];e<0&&(i=0),t<0&&(l=0),s.selector.setIndexes(i,l),this.indexes=[i,l]}this.moveIndexes=[r,n],this.range=l,this.resetAreaOffset(),this.el.show()}setEnd(e,t,i=!0){const{data:s,lastri:l,lastci:r}=this;if(i){if(e===l&&t===r)return;this.lastri=e,this.lastci=t}this.range=s.calSelectedRangeByEnd(e,t),De.call(this,this.data.getSelectedRect())}reset(){const{eri:e,eci:t}=this.data.selector.range;this.setEnd(e,t)}showAutofill(e,t){if(-1===e&&-1===t)return;const{sri:i,sci:s,eri:l,eci:r}=this.range,[n,o]=[e,t],a=i-e,c=s-t,h=l-e,d=r-t;if(c>0)this.arange=new v(i,o,l,s-1);else if(a>0)this.arange=new v(n,s,i-1,r);else if(d<0)this.arange=new v(i,r+1,l,o);else{if(!(h<0))return void(this.arange=null);this.arange=new v(l+1,s,n,r)}if(null!==this.arange){const e=this.data.getRect(this.arange);e.width+=2,e.height+=2;const{br:t,l:i,t:s,tl:l}=this;t.showAutofill(xe.call(this,e)),i.showAutofill(ke.call(this,e)),s.showAutofill(Ce.call(this,e)),l.showAutofill(e)}}hideAutofill(){["br","l","t","tl"].forEach(e=>{this[e].hideAutofill()})}showClipboard(){const e=this.data.getClipboardRect();ze.call(this,e),["br","l","t","tl"].forEach(e=>{this[e].showClipboard()})}hideClipboard(){["br","l","t","tl"].forEach(e=>{this[e].hideClipboard()})}}function He(e){e.preventDefault(),e.stopPropagation();const{filterItems:t}=this;t.length<=0||(this.itemIndex>=0&&t[this.itemIndex].toggle(),this.itemIndex-=1,this.itemIndex<0&&(this.itemIndex=t.length-1),t[this.itemIndex].toggle())}function Ne(e){e.stopPropagation();const{filterItems:t}=this;t.length<=0||(this.itemIndex>=0&&t[this.itemIndex].toggle(),this.itemIndex+=1,this.itemIndex>t.length-1&&(this.itemIndex=0),t[this.itemIndex].toggle())}function Me(e){e.preventDefault();const{filterItems:t}=this;t.length<=0||(e.stopPropagation(),this.itemIndex<0&&(this.itemIndex=0),t[this.itemIndex].el.click(),this.hide())}function We(e){const{keyCode:t}=e;switch(e.ctrlKey&&e.stopPropagation(),t){case 37:e.stopPropagation();break;case 38:He.call(this,e);break;case 39:e.stopPropagation();break;case 40:Ne.call(this,e);break;case 13:Me.call(this,e);break;case 9:Me.call(this,e);break;default:e.stopPropagation();break}}class Fe{constructor(e,t,i="200px"){this.filterItems=[],this.items=e,this.el=r("div",`${le}-suggest`).css("width",i).hide(),this.itemClick=t,this.itemIndex=-1}setOffset(e){this.el.cssRemoveKeys("top","bottom").offset(e)}hide(){const{el:e}=this;this.filterItems=[],this.itemIndex=-1,e.hide(),he(this.el.parent())}setItems(e){this.items=e}search(e){let{items:t}=this;if(/^\s*$/.test(e)||(t=t.filter(t=>(t.key||t).startsWith(e.toUpperCase()))),t=t.map(e=>{let{title:t}=e;t?"function"===typeof t&&(t=t()):t=e;const i=r("div",`${le}-item`).child(t).on("click.stop",()=>{this.itemClick(e),this.hide()});return e.label&&i.child(r("div","label").html(e.label)),i}),this.filterItems=t,t.length<=0)return;const{el:i}=this;i.html("").children(...t).show(),de(i.parent(),()=>{this.hide()})}bindInputEvents(e){e.on("keydown",e=>We.call(this,e))}}function Pe(){const{inputText:e}=this;if(!/^\s*$/.test(e)){const{textlineEl:t,textEl:i,areaOffset:s}=this,l=e.split("\n"),r=Math.max(...l.map(e=>e.length)),n=t.offset(),o=n.width/e.length,a=(r+1)*o+5,c=this.viewFn().width-s.left-o;let h=l.length;if(a>s.width){let e=a;a>c&&(e=c,h+=parseInt(a/c,10),h+=a%c>0?1:0),i.css("width",`${e}px`)}h*=this.rowHeight,h>s.height&&i.css("height",`${h}px`)}}function _e({target:e},t){const{value:i,selectionEnd:s}=e,l=`${i.slice(0,s)}${t}${i.slice(s)}`;e.value=l,e.setSelectionRange(s+1,s+1),this.inputText=l,this.textlineEl.html(l),Pe.call(this)}function Be(e){const{keyCode:t,altKey:i}=e;13!==t&&9!==t&&e.stopPropagation(),13===t&&i&&(_e.call(this,e,"\n"),e.stopPropagation()),13!==t||i||e.preventDefault()}function Le(e){const t=e.target.value,{suggest:i,textlineEl:s,validator:l}=this,{cell:r}=this;if(null!==r)if("editable"in r&&!0===r.editable||void 0===r.editable){if(this.inputText=t,l)"list"===l.type?i.search(t):i.hide();else{const e=t.lastIndexOf("=");-1!==e?i.search(t.substring(e+1)):i.hide()}s.html(t),Pe.call(this),this.change("input",t)}else e.target.value=r.text||"";else{if(this.inputText=t,l)"list"===l.type?i.search(t):i.hide();else{const e=t.lastIndexOf("=");-1!==e?i.search(t.substring(e+1)):i.hide()}s.html(t),Pe.call(this),this.change("input",t)}}function Ve(e){const{el:t}=this.textEl;setTimeout(()=>{t.focus(),t.setSelectionRange(e,e)},0)}function qe(e,t){const{textEl:i,textlineEl:s}=this;i.el.blur(),i.val(e),s.html(e),Ve.call(this,t)}function Ue(e){const{inputText:t,validator:i}=this;let s=0;if(i&&"list"===i.type)this.inputText=e,s=this.inputText.length;else{const i=t.lastIndexOf("="),l=t.substring(0,i+1);let r=t.substring(i+1);r=-1!==r.indexOf(")")?r.substring(r.indexOf(")")):"",this.inputText=`${l+e.key}(`,s=this.inputText.length,this.inputText+=`)${r}`}qe.call(this,this.inputText,s)}function Xe(){this.suggest.setItems(this.formulas)}class Ke{constructor(e,t,i){this.viewFn=t,this.rowHeight=i,this.formulas=e,this.suggest=new Fe(e,e=>{Ue.call(this,e)}),this.areaEl=r("div",`${le}-editor-area`).children(this.textEl=r("textarea","").on("input",e=>Le.call(this,e)).on("paste.stop",()=>{console.log("empty function")}).on("keydown",e=>Be.call(this,e)),this.textlineEl=r("div","textline"),this.suggest.el).on("mousemove.stop",()=>{console.log("empty function")}).on("mousedown.stop",()=>{console.log("empty function")}),this.el=r("div",`${le}-editor`).child(this.areaEl).hide(),this.suggest.bindInputEvents(this.textEl),this.areaOffset=null,this.freeze={w:0,h:0},this.cell=null,this.inputText="",this.change=()=>{console.log("empty function")}}setFreezeLengths(e,t){this.freeze.w=e,this.freeze.h=t}clear(){""!==this.inputText&&this.change("finished",this.inputText),this.cell=null,this.areaOffset=null,this.inputText="",this.el.hide(),this.textEl.val(""),this.textlineEl.html(""),Xe.call(this)}setOffset(e,t="top"){const{textEl:i,areaEl:s,suggest:l,freeze:r,el:n}=this;if(e){this.areaOffset=e;const{left:o,top:a,width:c,height:h,l:d,t:u}=e,f={left:0,top:0};r.w>d&&r.h>u||(r.w<d&&r.h<u?(f.left=r.w,f.top=r.h):r.w>d?f.top=r.h:r.h>u&&(f.left=r.w)),n.offset(f),s.offset({left:o-f.left-.8,top:a-f.top-.8}),i.offset({width:c-9+.8,height:h-3+.8});const p={left:0};p[t]=h,l.setOffset(p),l.hide()}}setCell(e,t){if(e&&!1===e.editable)return;const{el:i,datepicker:s,suggest:l}=this;i.show(),this.cell=e;const r=e&&e.text||"";if(this.setText(r),this.validator=t,t){const{type:e}=t;"date"===e&&(/^\s*$/.test(r)||s.setValue(r)),"list"===e&&(l.setItems(t.values()),l.search(""))}}setText(e){this.inputText=e,qe.call(this,e,e.length),Pe.call(this)}}const Je=new Map;function Ye(){return window.devicePixelRatio||1}function Ze(){return Ye()-.5}function Ge(e){return parseInt(e*Ye(),10)}function Qe(e){const t=Ge(e);return t>0?t-.5:.5}class et{constructor(e,t,i,s,l=0){this.x=e,this.y=t,this.width=i,this.height=s,this.padding=l,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}setBorders({top:e,bottom:t,left:i,right:s}){e&&(this.borderTop=e),s&&(this.borderRight=s),t&&(this.borderBottom=t),i&&(this.borderLeft=i)}innerWidth(){return this.width-2*this.padding-2}innerHeight(){return this.height-2*this.padding-2}textx(e){const{width:t,padding:i}=this;let{x:s}=this;return"left"===e?s+=i:"center"===e?s+=t/2:"right"===e&&(s+=t-i),s}texty(e,t){const{height:i,padding:s}=this;let{y:l}=this;return"top"===e?l+=s:"middle"===e?l+=i/2-t/2:"bottom"===e&&(l+=i-s-t),l}topxys(){const{x:e,y:t,width:i}=this;return[[e,t],[e+i,t]]}rightxys(){const{x:e,y:t,width:i,height:s}=this;return[[e+i,t],[e+i,t+s]]}bottomxys(){const{x:e,y:t,width:i,height:s}=this;return[[e,t+s],[e+i,t+s]]}leftxys(){const{x:e,y:t,height:i}=this;return[[e,t],[e,t+i]]}}function tt(e,t,i,s,l,r,n){const o={x:0,y:0};"underline"===e?o.y="bottom"===l?0:"top"===l?-(r+2):-r/2:"strike"===e&&("bottom"===l?o.y=r/2:"top"===l&&(o.y=-(r/2+2))),"center"===s?o.x=n/2:"right"===s&&(o.x=n),this.line([t-o.x,i-o.y],[t-o.x+n,i-o.y])}class it{constructor(e,t,i){this.el=e,this.ctx=e.getContext("2d"),this.resize(t,i),this.ctx.scale(Ye(),Ye())}resize(e,t){this.el.style.width=`${e}px`,this.el.style.height=`${t}px`,this.el.width=Ge(e),this.el.height=Ge(t)}clear(){const{width:e,height:t}=this.el;return this.ctx.clearRect(0,0,e,t),this}attr(e){return Object.assign(this.ctx,e),this}save(){return this.ctx.save(),this.ctx.beginPath(),this}restore(){return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}translate(e,t){return this.ctx.translate(Ge(e),Ge(t)),this}scale(e,t){return this.ctx.scale(e,t),this}clearRect(e,t,i,s){return this.ctx.clearRect(e,t,i,s),this}fillRect(e,t,i,s){return this.ctx.fillRect(Ge(e)-.5,Ge(t)-.5,Ge(i),Ge(s)),this}fillText(e,t,i){return this.ctx.fillText(e,Ge(t),Ge(i)),this}fillImage(e,{value:t},{fixedIndexWidth:i,fixedIndexHeight:s},l,r){if(!r.imagewidth)return;""!=r.value&&void 0!=r.value||Je.forEach((e,t)=>{e[0]===r.scaledWidth&&e[1]===r.scaledHeight&&Je.delete(t)});const n=r.top,o=r.left,{x:a,y:c,width:h,height:d}=e,u=new Image;return u.src=t,u.onload=()=>{this.ctx.save();let e=a+i,t=c+s;l&&(e=e-l.scroll.x+0,t=t-l.scroll.y+0);const f=r.imagewidth,p=r.imageheight,g=d-2,m=h,w=d;let b=m/f,v=w/p;Math.min(b,v);Je.has(u.src)&&(0!=Je.get(u.src)[2]||0!=Je.get(u.src)[3])?n==c-l.scroll.y&&o==a-l.scroll.x&&(this.ctx.drawImage(u,Ge(e),Ge(t),Ge(f),Ge(g)),this.ctx.restore()):(this.ctx.drawImage(u,Ge(e),Ge(t),Ge(f),Ge(g)),this.ctx.restore())},this}async geometry(e,t,{fixedIndexWidth:i,fixedIndexHeight:s},l,r,n){const{type:o}=e;switch(o){case"image":await this.fillImage(t,e,{fixedIndexWidth:i,fixedIndexHeight:s},r,n);break;default:}return this}text(e,t,i={},s=!0){const{ctx:l}=this,{align:r,valign:n,font:o,color:a,strike:c,underline:h}=i,d=t.textx(r);l.save(),l.beginPath(),this.attr({textAlign:r,textBaseline:n,font:`${o.italic?"italic":""} ${o.bold?"bold":""} ${Ge(o.size)}px ${o.name}`,fillStyle:a,strokeStyle:a});const u=`${e}`.split("\n"),f=t.innerWidth(),p=[];u.forEach(e=>{const t=l.measureText(e).width;if(s&&t>Ge(f)){let t={w:0,len:0,start:0};for(let i=0;i<e.length;i+=1)t.w>=Ge(f)&&(p.push(e.substr(t.start,t.len)),t={w:0,len:0,start:i}),t.len+=1,t.w+=l.measureText(e[i]).width+1;t.len>0&&p.push(e.substr(t.start,t.len))}else p.push(e)});const g=(p.length-1)*(o.size+2);let m=t.texty(n,g);return p.forEach(e=>{const t=l.measureText(e).width;this.fillText(e,d,m),c&&tt.call(this,"strike",d,m,r,n,o.size,t),h&&tt.call(this,"underline",d,m,r,n,o.size,t),m+=o.size+2}),l.restore(),this}border(e,t){const{ctx:i}=this;return i.lineWidth=Ze,i.strokeStyle=t,"medium"===e?i.lineWidth=Ge(2)-.5:"thick"===e?i.lineWidth=Ge(3):"dashed"===e?i.setLineDash([Ge(3),Ge(2)]):"dotted"===e?i.setLineDash([Ge(1),Ge(1)]):"double"===e&&i.setLineDash([Ge(2),0]),this}line(...e){const{ctx:t}=this;if(e.length>1){t.beginPath();const[i,s]=e[0];t.moveTo(Qe(i),Qe(s));for(let l=1;l<e.length;l+=1){const[i,s]=e[l];t.lineTo(Qe(i),Qe(s))}t.stroke()}return this}strokeBorders(e){const{ctx:t}=this;t.save();const{borderTop:i,borderRight:s,borderBottom:l,borderLeft:r}=e;i&&(this.border(...i),this.line(...e.topxys())),s&&(this.border(...s),this.line(...e.rightxys())),l&&(this.border(...l),this.line(...e.bottomxys())),r&&(this.border(...r),this.line(...e.leftxys())),t.restore()}dropdown(e){const{ctx:t}=this,{x:i,y:s,width:l,height:r}=e,n=i+l-15,o=s+r-15;t.save(),t.beginPath(),t.moveTo(Ge(n),Ge(o)),t.lineTo(Ge(n+8),Ge(o)),t.lineTo(Ge(n+4),Ge(o+6)),t.closePath(),t.fillStyle="rgba(0, 0, 0, .45)",t.fill(),t.restore()}error(e){const{ctx:t}=this,{x:i,y:s,width:l}=e,r=i+l-1;t.save(),t.beginPath(),t.moveTo(Ge(r-8),Ge(s-1)),t.lineTo(Ge(r),Ge(s-1)),t.lineTo(Ge(r),Ge(s+8)),t.closePath(),t.fillStyle="rgba(255, 0, 0, .65)",t.fill(),t.restore()}frozen(e){const{ctx:t}=this,{x:i,y:s,width:l}=e,r=i+l-1;t.save(),t.beginPath(),t.moveTo(Ge(r-8),Ge(s-1)),t.lineTo(Ge(r),Ge(s-1)),t.lineTo(Ge(r),Ge(s+8)),t.closePath(),t.fillStyle="rgba(0, 255, 0, .85)",t.fill(),t.restore()}rect(e,t){const{ctx:i}=this,{x:s,y:l,width:r,height:n,bgcolor:o}=e;i.save(),i.beginPath(),i.fillStyle=o||"#fff",i.rect(Qe(s+1),Qe(l+1),Ge(r-2),Ge(n-2)),i.clip(),i.fill(),t(),i.restore()}}class st extends l{constructor(e,t=""){super("div",`${le}-button ${t}`),this.child(h(`button.${e}`))}}const lt=[{key:"Arial",title:"Arial"},{key:"Helvetica",title:"Helvetica"},{key:"Source Sans Pro",title:"Source Sans Pro"},{key:"Comic Sans MS",title:"Comic Sans MS"},{key:"Courier New",title:"Courier New"},{key:"Verdana",title:"Verdana"},{key:"Lato",title:"Lato"}],rt=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},{pt:42,px:56}];function nt(e){for(let t=0;t<rt.length;t+=1){const i=rt[t];if(i.pt===e)return i.px}return e}const ot=e=>{const t=[],i=[];let s=[],l=0,r="",n=1,o="";for(let c=0;c<e.length;c+=1){const h=e.charAt(c);if(" "!==h){if(h>="a"&&h<="z")s.push(h.toUpperCase());else if(h>="0"&&h<="9"||h>="A"&&h<="Z"||"."===h)s.push(h);else if('"'===h){c+=1;while('"'!==e.charAt(c))s.push(e.charAt(c)),c+=1;i.push(`"${s.join("")}`),s=[]}else if("-"===h&&/[+\-*/,(]/.test(o))s.push(h);else{if("("!==h&&s.length>0&&i.push(s.join("")),")"===h){let e=t.pop();if(2===l)try{const[t,s]=m(i.pop()),[l,r]=m(i.pop());let n=0;for(let e=l;e<=t;e+=1)for(let t=r;t<=s;t+=1)i.push(w(e,t)),n+=1;i.push([e,n])}catch(a){}else if(1===l||3===l)3===l&&i.push(r),i.push([e,n]),n=1;else while("("!==e){if(i.push(e),t.length<=0)break;e=t.pop()}l=0}else if("="===h||">"===h||"<"===h){const t=e.charAt(c+1);r=h,"="!==t&&"-"!==t||(r+=t,c+=1),l=3}else if(":"===h)l=2;else if(","===h)3===l&&i.push(r),l=1,n+=1;else if("("===h&&s.length>0)t.push(s.join(""));else{if(t.length>0&&("+"===h||"-"===h)){let e=t[t.length-1];if("("!==e&&i.push(t.pop()),"*"===e||"/"===e)while(t.length>0){if(e=t[t.length-1],"("===e)break;i.push(t.pop())}}else if(t.length>0){const e=t[t.length-1];"*"!==e&&"/"!==e||i.push(t.pop())}t.push(h)}s=[]}o=h}}s.length>0&&i.push(s.join(""));while(t.length>0)i.push(t.pop());return i},at=(e,t)=>{const[i]=e;let s=e;if('"'===i)return e.substring(1);let l=1;if("-"===i&&(s=e.substring(1),l=-1),s[0]>="0"&&s[0]<="9")return l*Number(s);const[r,n]=m(s);return l*t(r,n)},ct=(e,t,i,s)=>{const l=[];for(let r=0;r<e.length;r+=1){const n=e[r],o=n[0];if("+"===n){const e=l.pop();l.push(W("+",l.pop(),e))}else if("-"===n)if(1===l.length){const e=l.pop();l.push(W("*",e,-1))}else{const e=l.pop();l.push(W("-",l.pop(),e))}else if("*"===n)l.push(W("*",l.pop(),l.pop()));else if("/"===n){const e=l.pop();l.push(W("/",l.pop(),e))}else if("="===o||">"===o||"<"===o){let e=l.pop();Number.isNaN(e)||(e=Number(e));let t=l.pop();Number.isNaN(t)||(t=Number(t));let i=!1;"="===o?i=t===e:">"===n?i=t>e:">="===n?i=t>=e:"<"===n?i=t<e:"<="===n&&(i=t<=e),l.push(i)}else if(Array.isArray(n)){const[e,i]=n,s=[];for(let t=0;t<i;t+=1)s.push(l.pop());l.push(t[e].render(s.reverse()))}else{if(s.includes(n))return 0;(o>="a"&&o<="z"||o>="A"&&o<="Z")&&s.push(n),l.push(at(n,i)),s.pop()}}return l[0]},ht=(e,t,i,s=[])=>{if("="===e[0]){const l=ot(e.substring(1));return l.length<=0?e:ct(l,t,(e,l)=>ht(i(e,l),t,i,s),s)}return e};var dt={render:ht};const ut=e=>e,ft=e=>{if(/^(-?\d*.?\d*)$/.test(e)){const t=Number(e).toFixed(2).toString(),[i,...s]=t.split("\\.");return[i.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),...s]}return e},pt=[{key:"normal",title:d("format.normal"),type:"string",render:ut},{key:"text",title:d("format.text"),type:"string",render:ut},{key:"number",title:d("format.number"),type:"number",label:"1,000.12",render:ft},{key:"percent",title:d("format.percent"),type:"number",label:"10.12%",render:e=>`${e}%`},{key:"rmb",title:d("format.rmb"),type:"number",label:"￥10.00",render:e=>`￥${ft(e)}`},{key:"usd",title:d("format.usd"),type:"number",label:"$10.00",render:e=>`$${ft(e)}`},{key:"eur",title:d("format.eur"),type:"number",label:"€10.00",render:e=>`€${ft(e)}`},{key:"date",title:d("format.date"),type:"date",label:"26/09/2008",render:ut},{key:"time",title:d("format.time"),type:"date",label:"15:59:00",render:ut},{key:"datetime",title:d("format.datetime"),type:"date",label:"26/09/2008 15:59:00",render:ut},{key:"duration",title:d("format.duration"),type:"date",label:"24:01:00",render:ut}],gt={};pt.forEach(e=>{gt[e.key]=e});const mt=5,wt={fillStyle:"#fff"},bt={fillStyle:"#fff",lineWidth:Ze,strokeStyle:"#e6e6e6"};function vt(){return{textAlign:"center",textBaseline:"middle",font:`500 ${Ge(12)}px Source Sans Pro`,fillStyle:"#585757",lineWidth:Ze(),strokeStyle:"#e6e6e6"}}function yt(e,t,i,s=0){const{left:l,top:r,width:n,height:o}=e.cellRect(t,i);return new et(l,r+s,n,o,mt)}function xt(e,t,i,s,l=0,r){const{sortedRowMap:n,rows:o,cols:a}=t;if(o.isHide(i)||a.isHide(s))return;let c=i;n.has(i)&&(c=n.get(i));const h=t.getCell(c,s);if(null===h)return;let d=!1;"editable"in h&&!1===h.editable&&(d=!0);const u=t.getCellStyleOrDefault(c,s),f=yt(t,i,s,l);f.bgcolor=u.bgcolor,void 0!==u.border&&(f.setBorders(u.border),e.strokeBorders(f)),e.rect(f,()=>{if(["image"].includes(h.type)&&!h.hidden){let l=t.rows.getCell(i,s);const n=a.indexWidth,c=o.indexHeight;e.geometry(h,f,{fixedIndexWidth:n,fixedIndexHeight:c},u,r,l)}let l="";l=t.settings.evalPaused?h.text||"":dt.render(h.text||"",oe,(e,i)=>t.getCellTextOrDefault(i,e)),u.format&&(l=gt[u.format].render(l));const n=Object.assign({},u.font);n.size=nt(n.size),e.text(l,f,{align:u.align,valign:u.valign,font:n,color:u.color,strike:u.strike,underline:u.underline},u.textwrap);const c=t.validations.getError(i,s);c&&e.error(f),d&&e.frozen(f)})}function Ct(e){const{data:t,draw:i}=this;if(e){const{autoFilter:s}=t;if(!s.active())return;const l=s.hrange();e.intersects(l)&&l.each((e,s)=>{const l=yt(t,e,s);i.dropdown(l)})}}function kt(e,t,i,s,l,r){const{draw:n,data:o}=this;n.save(),n.translate(t,i).translate(s,l);const{exceptRowSet:a}=o,c=e=>{const t=a.has(e);if(t){const t=o.rows.getHeight(e);n.translate(0,-t)}return!t},h=o.exceptRowTotalHeight(e.sri,e.eri);n.save(),n.translate(0,-h),e.each((e,t)=>{xt(n,o,e,t,0,r)},e=>c(e)),n.restore();const d=new Set;n.save(),n.translate(0,-h),o.eachMergesInView(e,({sri:e,sci:t,eri:i})=>{if(a.has(e)){if(!d.has(e)){d.add(e);const t=o.rows.sumHeight(e,i+1);n.translate(0,-t)}}else xt(n,o,e,t,0,r)}),n.restore(),Ct.call(this,e),n.restore()}function Et(e,t,i,s){const{draw:l}=this;l.save(),l.attr({fillStyle:"rgba(76,76,76,.1)"}).fillRect(e,t,i,s),l.restore()}function St(e,t,i,s,l){const{draw:r}=this;l=l||{},r.save(),r.attr({fillStyle:"rgba(76,76,76,.1)",...l}).fillRect(e,t,i,s),r.restore()}function Tt(e,t,i,s,l,r){const{draw:n,data:o}=this,a=t.h,c=t.w,h=r+s,d=l+i;n.save(),n.attr(wt),"all"!==e&&"left"!==e||n.fillRect(0,h,i,a),"all"!==e&&"top"!==e||n.fillRect(d,0,c,s);const{sri:u,sci:f,eri:g,eci:m}=o.selector.range;n.attr(vt()),"all"!==e&&"left"!==e||(o.rowEach(t.sri,t.eri,(e,t,s)=>{const l=h+t,r=e;if(n.line([0,l],[i,l]),o.settings.leftFixHeaderRender&&o.settings.leftFixHeaderRender instanceof Function){let t=o.settings.leftFixHeaderRender(e);t?St.call(this,0,l,i,s,t):u<=r&&r<g+1&&Et.call(this,0,l,i,s)}else u<=r&&r<g+1&&Et.call(this,0,l,i,s);n.fillText(r+1,i/2,l+s/2),e>0&&o.rows.isHide(e-1)&&(n.save(),n.attr({strokeStyle:"#c6c6c6"}),n.line([5,l+5],[i-5,l+5]),n.restore())}),n.line([0,a+h],[i,a+h]),n.line([i,h],[i,a+h])),"all"!==e&&"top"!==e||(o.colEach(t.sci,t.eci,(e,t,i)=>{const l=d+t,r=e;n.line([l,0],[l,s]),f<=r&&r<m+1&&Et.call(this,l,0,i,s),n.fillText(p(r),l+i/2,s/2),e>0&&o.cols.isHide(e-1)&&(n.save(),n.attr({strokeStyle:"#c6c6c6"}),n.line([l+5,5],[l+5,s-5]),n.restore())}),n.line([c+d,0],[c+d,s]),n.line([0,s],[c+d,s])),n.restore()}function Rt(e,t){const{draw:i,data:s}=this;"edit"===s.settings.mode&&(i.save(),i.attr({fillStyle:"#fff"}).fillRect(0,0,e,t),i.restore())}function $t({sri:e,sci:t,eri:i,eci:s,w:l,h:r},n,o,a,c){const{draw:h,data:d}=this,{settings:u}=d;h.save(),h.attr(bt).translate(n+a,o+c),u.showGrid?(d.rowEach(e,i,(t,s,r)=>{t!==e&&h.line([0,s],[l,s]),t===i&&h.line([0,s+r],[l,s+r])}),d.colEach(t,s,(e,i,l)=>{e!==t&&h.line([i,0],[i,r]),e===s&&h.line([i+l,0],[i+l,r])}),h.restore()):h.restore()}function It(e,t,i,s){const{draw:l,data:r}=this,n=r.viewWidth()-e,o=r.viewHeight()-t;l.save().translate(e,t).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),l.line([0,s],[n,s]),l.line([i,0],[i,o]),l.restore()}class Ot{constructor(e,t){this.el=e,this.draw=new it(e,t.viewWidth(),t.viewHeight()),this.data=t}resetData(e){this.data=e,this.render()}render(){const{data:e}=this,{rows:t,cols:i}=e,s=i.indexWidth,l=t.height;this.draw.resize(e.viewWidth(),e.viewHeight()),this.clear();const r=e.viewRange(),n=e.freezeTotalWidth(),o=e.freezeTotalHeight(),{x:a,y:c}=e.scroll;$t.call(this,r,s,l,n,o),kt.call(this,r,s,l,-a,-c,e),Tt.call(this,"all",r,s,l,n,o),Rt.call(this,s,l);const[h,d]=e.freeze;if(h>0||d>0){if(h>0){const t=r.clone();t.sri=0,t.eri=h-1,t.h=o,$t.call(this,t,s,l,n,0),kt.call(this,t,s,l,-a,0,e),Tt.call(this,"top",t,s,l,n,0)}if(d>0){const t=r.clone();t.sci=0,t.eci=d-1,t.w=n,$t.call(this,t,s,l,0,o),Tt.call(this,"left",t,s,l,0,o),kt.call(this,t,s,l,0,-c,e)}const t=e.freezeViewRange();$t.call(this,t,s,l,0,0),Tt.call(this,"all",t,s,l,0,0),kt.call(this,t,s,l,0,0,e),It.call(this,s,l,n,o)}}clear(){this.draw.clear()}}var At=Ot;const Dt=[["A3",11.69,16.54],["A4",8.27,11.69],["A5",5.83,8.27],["B4",9.84,13.9],["B5",6.93,9.84]],zt=["landscape","portrait"];function jt(e){return parseInt(96*e,10)}function Ht(e){"cancel"===e?this.el.hide():this.toPrint()}function Nt(e){const{paper:t}=this,{value:i}=e.target,s=Dt[i];t.w=jt(s[1]),t.h=jt(s[2]),this.preview()}function Mt(e){const{paper:t}=this,{value:i}=e.target,s=zt[i];t.orientation=s,this.preview()}class Wt{constructor(e){this.paper={w:jt(Dt[0][1]),h:jt(Dt[0][2]),padding:50,orientation:zt[0],get width(){return"landscape"===this.orientation?this.h:this.w},get height(){return"landscape"===this.orientation?this.w:this.h}},this.data=e,this.el=r("div",`${le}-print`).children(r("div",`${le}-print-bar`).children(r("div","-title").child("Print settings"),r("div","-right").children(r("div",`${le}-buttons`).children(new st("cancel").on("click",Ht.bind(this,"cancel")),new st("next","primary").on("click",Ht.bind(this,"next"))))),r("div",`${le}-print-content`).children(this.contentEl=r("div","-content"),r("div","-sider").child(r("form","").children(r("fieldset","").children(r("label","").child(`${h("print.size")}`),r("select","").children(...Dt.map((e,t)=>r("option","").attr("value",t).child(`${e[0]} ( ${e[1]}''x${e[2]}'' )`))).on("change",Nt.bind(this))),r("fieldset","").children(r("label","").child(`${h("print.orientation")}`),r("select","").children(...zt.map((e,t)=>r("option","").attr("value",t).child(`${h("print.orientations")[t]}`))).on("change",Mt.bind(this))))))).hide()}resetData(e){this.data=e}preview(){const{data:e,paper:t}=this,{width:i,height:s,padding:l}=t,n=i-2*l,o=s-2*l,a=e.contentRange(),c=parseInt(a.h/o,10)+1,h=n/a.w;let d=l;const u=l;h>1&&(d+=(n-a.w)/2);let f=0,p=0;this.contentEl.html(""),this.canvases=[];const g={sri:0,sci:0,eri:0,eci:0};for(let m=0;m<c;m+=1){let t=0,l=0;const n=r("div",`${le}-canvas-card`),c=r("canvas",`${le}-canvas`);this.canvases.push(c.el);const m=new it(c.el,i,s);for(m.save(),m.translate(d,u),h<1&&m.scale(h,h);f<=a.eri;f+=1){const i=e.rows.getHeight(f);if(t+=i,!(t<o)){l=-(t-i);break}for(let t=0;t<=a.eci;t+=1)xt(m,e,f,t,p),g.eci=t}g.eri=f,m.restore(),m.save(),m.translate(d,u),h<1&&m.scale(h,h);const w=p;e.eachMergesInView(g,({sri:t,sci:i})=>{xt(m,e,t,i,w)}),m.restore(),g.sri=g.eri,g.sci=g.eci,p+=l,this.contentEl.child(r("div",`${le}-canvas-card-wraper`).child(n.child(c)))}this.el.show()}toPrint(){this.el.hide();const{paper:e}=this,t=r("iframe","").hide(),{el:i}=t;window.document.body.appendChild(i);const{contentWindow:s}=i,l=s.document,n=document.createElement("style");n.innerHTML=`\n      @page { size: ${e.width}px ${e.height}px; };\n      canvas {\n        page-break-before: auto;\n        page-break-after: always;\n        image-rendering: pixelated;\n      };\n    `,l.head.appendChild(n),this.canvases.forEach(e=>{const t=e.cloneNode(!1),i=t.getContext("2d");i.drawImage(e,0,0),l.body.appendChild(t)}),s.print()}}const Ft=[{key:"copy",title:d("contextmenu.copy"),label:"Ctrl+C"},{key:"cut",title:d("contextmenu.cut"),label:"Ctrl+X"},{key:"paste",title:d("contextmenu.paste"),label:"Ctrl+V"},{key:"paste-value",title:d("contextmenu.pasteValue"),label:"Ctrl+Shift+V"},{key:"paste-format",title:d("contextmenu.pasteFormat"),label:"Ctrl+Alt+V"},{key:"divider"},{key:"insert-row",title:d("contextmenu.insertRow")},{key:"insert-column",title:d("contextmenu.insertColumn")},{key:"divider"},{key:"delete-row",title:d("contextmenu.deleteRow")},{key:"delete-column",title:d("contextmenu.deleteColumn")},{key:"delete-cell-text",title:d("contextmenu.deleteCellText")},{key:"hide",title:d("contextmenu.hide")},{key:"divider"},{key:"validation",title:d("contextmenu.validation")},{key:"divider"},{key:"cell-printable",title:d("contextmenu.cellprintable")},{key:"cell-non-printable",title:d("contextmenu.cellnonprintable")},{key:"divider"},{key:"cell-editable",title:d("contextmenu.celleditable")},{key:"cell-non-editable",title:d("contextmenu.cellnoneditable")}];function Pt(e){return"divider"===e.key?r("div",`${le}-item divider`):r("div",`${le}-item`).on("click",()=>{this.itemClick(e.key),this.hide()}).children(e.title(),r("div","label").child(e.label||""))}function _t(){return Ft.map(e=>Pt.call(this,e))}class Bt{constructor(e,t=!1){this.menuItems=_t.call(this),this.el=r("div",`${le}-contextmenu`).children(...this.menuItems).hide(),this.viewFn=e,this.itemClick=()=>{console.log("empty function")},this.isHide=t,this.setMode("range")}setMode(e){const t=this.menuItems[12];"row-col"===e?t.show():t.hide()}hide(){const{el:e}=this;e.hide(),he(e)}setPosition(e,t){if(this.isHide)return;const{el:i}=this,{width:s}=i.show().offset(),l=this.viewFn(),r=l.height/2;let n=e;l.width-e<=s&&(n-=s),i.css("left",`${n}px`),t>r?i.css("bottom",l.height-t+"px").css("max-height",`${t}px`).css("top","auto"):i.css("top",`${t}px`).css("max-height",l.height-t+"px").css("bottom","auto"),de(i)}}class Lt extends l{constructor(e,t,i,s,...l){super("div",`${le}-dropdown ${s}`),this.title=e,this.change=()=>{console.log("empty function")},this.headerClick=()=>{console.log("empty function")},"string"===typeof e?this.title=r("div",`${le}-dropdown-title`).child(e):i&&this.title.addClass("arrow-left"),this.contentEl=r("div",`${le}-dropdown-content`).css("width",t).hide(),this.setContentChildren(...l),this.headerEl=r("div",`${le}-dropdown-header`),this.headerEl.on("click",()=>{"block"!==this.contentEl.css("display")?this.show():this.hide()}).children(this.title,i?r("div",`${le}-icon arrow-right`).child(r("div",`${le}-icon-img arrow-down`)):""),this.children(this.headerEl,this.contentEl)}setContentChildren(...e){this.contentEl.html(""),e.length>0&&this.contentEl.children(...e)}setTitle(e){this.title.html(e),this.hide()}show(){const{contentEl:e}=this;e.show(),this.parent().active(),de(this.parent(),()=>{this.hide()})}hide(){this.parent().active(!1),this.contentEl.hide(),he(this.parent())}}class Vt extends l{constructor(e){super("div",`${le}-icon`),this.iconNameEl=r("div",`${le}-icon-img ${e}`),this.child(this.iconNameEl)}setName(e){this.iconNameEl.className(`${le}-icon-img ${e}`)}}function qt(e){return r("div",`${le}-item`).child(new Vt(e))}class Ut extends Lt{constructor(e,t){const i=new Vt(`align-${t}`),s=e.map(e=>qt(`align-${e}`).on("click",()=>{this.setTitle(e),this.change(e)}));super(i,"auto",!0,"bottom-left",...s)}setTitle(e){this.title.setName(`align-${e}`),this.hide()}}function Xt(e,t){if(t.classList.contains("active"))return;const{left:i,top:s,width:l,height:n}=t.getBoundingClientRect(),o=r("div",`${le}-tooltip`).html(e).show();document.body.appendChild(o.el);const a=o.box();o.css("left",i+l/2-a.width/2+"px").css("top",`${s+n+2}px`),ae(t,"mouseleave",()=>{document.body.contains(o.el)&&document.body.removeChild(o.el)}),ae(t,"click",()=>{document.body.contains(o.el)&&document.body.removeChild(o.el)})}class Kt{constructor(e,t,i){this.tip="",e&&(this.tip=h(`toolbar.${e.replace(/-[a-z]/g,e=>e[1].toUpperCase())}`)),t&&(this.tip+=` (${t})`),this.tag=e,this.shortcut=t,this.value=i,this.el=this.element(),this.change=()=>{console.log("empty function")}}element(){const{tip:e}=this;return r("div",`${le}-toolbar-btn`).on("mouseenter",e=>{this.tip&&Xt(this.tip,e.target)}).attr("data-tooltip",e)}setState(){console.log("empty function")}}class Jt extends Kt{dropdown(){console.log("empty function")}getValue(e){return e}element(){const{tag:e}=this;return this.dd=this.dropdown(),this.dd.change=t=>this.change(e,this.getValue(t)),super.element().child(this.dd)}setState(e){e&&(this.value=e,this.dd.setTitle(e))}}class Yt extends Jt{constructor(e){super("align","",e)}dropdown(){const{value:e}=this;return new Ut(["left","center","right"],e)}}class Zt extends Jt{constructor(e){super("valign","",e)}dropdown(){const{value:e}=this;return new Ut(["top","middle","bottom"],e)}}class Gt extends Kt{element(){const{tag:e}=this;return super.element().child(new Vt(e)).on("click",()=>this.click())}click(){this.change(this.tag,this.toggle())}setState(e){this.el.active(e)}toggle(){return this.el.toggle()}active(){return this.el.hasClass("active")}}class Qt extends Gt{constructor(){super("font-bold","Ctrl+B")}}class ei extends Gt{constructor(){super("font-italic","Ctrl+I")}}class ti extends Gt{constructor(){super("strike","Ctrl+U")}}class ii extends Gt{constructor(){super("underline","Ctrl+U")}}const si=["#ffffff","#000100","#e7e5e6","#445569","#5b9cd6","#ed7d31","#a5a5a5","#ffc001","#4371c6","#71ae47"],li=[["#f2f2f2","#7f7f7f","#d0cecf","#d5dce4","#deeaf6","#fce5d5","#ededed","#fff2cd","#d9e2f3","#e3efd9"],["#d8d8d8","#595959","#afabac","#adb8ca","#bdd7ee","#f7ccac","#dbdbdb","#ffe59a","#b3c6e7","#c5e0b3"],["#bfbfbf","#3f3f3f","#756f6f","#8596b0","#9cc2e6","#f4b184","#c9c9c9","#fed964","#8eaada","#a7d08c"],["#a5a5a5","#262626","#3a3839","#333f4f","#2e75b5","#c45a10","#7b7b7b","#bf8e01","#2f5596","#538136"],["#7f7f7f","#0c0c0c","#171516","#222a35","#1f4e7a","#843c0a","#525252","#7e6000","#203864","#365624"]],ri=["#c00000","#fe0000","#fdc101","#ffff01","#93d051","#00b04e","#01b0f1","#0170c1","#012060","#7030a0"];function ni(e){return r("td","").child(r("div",`${le}-color-palette-cell`).on("click.stop",()=>this.change(e)).css("background-color",e))}class oi{constructor(){this.el=r("div",`${le}-color-palette`),this.change=()=>{console.log("empty function")};const e=r("table","").children(r("tbody","").children(r("tr",`${le}-theme-color-placeholders`).children(...si.map(e=>ni.call(this,e))),...li.map(e=>r("tr",`${le}-theme-colors`).children(...e.map(e=>ni.call(this,e)))),r("tr",`${le}-standard-colors`).children(...ri.map(e=>ni.call(this,e)))));this.el.child(e)}}class ai extends Lt{constructor(e,t){const i=new Vt(e).css("height","16px").css("border-bottom",`3px solid ${t}`),s=new oi;s.change=e=>{this.setTitle(e),this.change(e)},super(i,"auto",!1,"bottom-left",s.el)}setTitle(e){this.title.css("border-color",e),this.hide()}}const ci=[["thin",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" style="user-select: none;"></line></svg>'],["medium",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="2" style="user-select: none;"><line x1="0" y1="1.0" x2="50" y2="1.0" stroke-width="2" stroke="black" style="user-select: none;"></line></svg>'],["thick",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="3" style="user-select: none;"><line x1="0" y1="1.5" x2="50" y2="1.5" stroke-width="3" stroke="black" style="user-select: none;"></line></svg>'],["dashed",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="2" style="user-select: none;"></line></svg>'],["dotted",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="1" style="user-select: none;"></line></svg>']];class hi extends Lt{constructor(e){const t=new Vt("line-type");let i=0;const s=ci.map((t,l)=>r("div",`${le}-item state ${e===t[0]?"checked":""}`).on("click",()=>{s[i].toggle("checked"),s[l].toggle("checked"),i=l,this.hide(),this.change(t)}).child(r("div",`${le}-line-type`).html(t[1])));super(t,"auto",!1,"bottom-left",...s)}}function di(...e){return r("table","").child(r("tbody","").children(...e))}function ui(e){return r("td","").child(r("div",`${le}-border-palette-cell`).child(new Vt(`border-${e}`)).on("click",()=>{this.mode=e;const{mode:t,style:i,color:s}=this;this.change({mode:t,style:i,color:s})}))}class fi{constructor(){this.color="#000",this.style="thin",this.mode="all",this.change=()=>{console.log("empty function")},this.ddColor=new ai("line-color",this.color),this.ddColor.change=e=>{this.color=e},this.ddType=new hi(this.style),this.ddType.change=([e])=>{this.style=e},this.el=r("div",`${le}-border-palette`);const e=di(r("tr","").children(r("td",`${le}-border-palette-left`).child(di(r("tr","").children(...["all","inside","horizontal","vertical","outside"].map(e=>ui.call(this,e))),r("tr","").children(...["left","top","right","bottom","none"].map(e=>ui.call(this,e))))),r("td",`${le}-border-palette-right`).children(r("div",`${le}-toolbar-btn`).child(this.ddColor.el),r("div",`${le}-toolbar-btn`).child(this.ddType.el))));this.el.child(e)}}class pi extends Lt{constructor(){const e=new Vt("border-all"),t=new fi;t.change=e=>{this.change(e),this.hide()},super(e,"auto",!1,"bottom-left",t.el)}}class gi extends Jt{constructor(){super("border")}dropdown(){return new pi}}class mi extends Kt{element(){return super.element().child(new Vt(this.tag)).on("click",()=>this.change(this.tag))}setState(e){this.el.disabled(e)}}class wi extends mi{constructor(){super("clearformat")}}class bi extends Gt{constructor(){super("paintformat")}setState(){console.log("empty function")}}class vi extends Jt{constructor(e){super("color",void 0,e)}dropdown(){const{tag:e,value:t}=this;return new ai(e,t)}}class yi extends Jt{constructor(e){super("bgcolor",void 0,e)}dropdown(){const{tag:e,value:t}=this;return new ai(e,t)}}class xi extends Lt{constructor(){const e=rt.map(e=>r("div",`${le}-item`).on("click",()=>{this.setTitle(`${e.pt}`),this.change(e)}).child(`${e.pt}`));super("10","60px",!0,"bottom-left",...e)}}class Ci extends Jt{constructor(){super("font-size")}getValue(e){return e.pt}dropdown(){return new xi}}class ki extends Lt{constructor(){const e=lt.map(e=>r("div",`${le}-item`).on("click",()=>{this.setTitle(e.title),this.change(e)}).child(e.title));super(lt[0].title,"160px",!0,"bottom-left",...e)}}class Ei extends Jt{constructor(){super("font-name")}getValue(e){return e.key}dropdown(){return new ki}}class Si extends Lt{constructor(){let e=pt.slice(0);e.splice(2,0,{key:"divider"}),e.splice(8,0,{key:"divider"}),e=e.map(e=>{const t=r("div",`${le}-item`);return"divider"===e.key?t.addClass("divider"):(t.child(e.title()).on("click",()=>{this.setTitle(e.title()),this.change(e)}),e.label&&t.child(r("div","label").html(e.label))),t}),super("Normal","220px",!0,"bottom-left",...e)}setTitle(e){for(let t=0;t<pt.length;t+=1)pt[t].key===e&&this.title.html(pt[t].title());this.hide()}}class Ti extends Jt{constructor(){super("format")}getValue(e){return e.key}dropdown(){return new Si}}class Ri extends Gt{constructor(){super("merge")}setState(e,t){this.el.active(e).disabled(t)}}class $i extends mi{constructor(){super("redo","Ctrl+Y")}}class Ii extends mi{constructor(){super("undo","Ctrl+Z")}}class Oi extends Lt{constructor(){const e=new Vt("ellipsis"),t=r("div",`${le}-toolbar-more`);super(e,"auto",!1,"bottom-right",t),this.moreBtns=t,this.contentEl.css("max-width","420px")}}class Ai extends Jt{constructor(){super("more"),this.el.hide()}dropdown(){return new Oi}show(){this.el.show()}hide(){this.el.hide()}}function Di(){return r("div",`${le}-toolbar-divider`)}function zi(){this.btns2=[],this.items.forEach(e=>{if(Array.isArray(e))e.forEach(({el:e})=>{const t=e.box(),{marginLeft:i,marginRight:s}=e.computedStyle();this.btns2.push([e,t.width+parseInt(i,10)+parseInt(s,10)])});else{const t=e.box(),{marginLeft:i,marginRight:s}=e.computedStyle();this.btns2.push([e,t.width+parseInt(i,10)+parseInt(s,10)])}})}function ji(){const{el:e,btns:t,moreEl:i,btns2:s}=this,{moreBtns:l,contentEl:r}=i.dd;e.css("width",`${this.widthFn()}px`);const n=e.box();let o=160,a=12;const c=[],h=[];s.forEach(([e,t],i)=>{o+=t,i===s.length-1||o<n.width?c.push(e):(a+=t,h.push(e))}),t.html("").children(...c),l.html("").children(...h),r.css("width",`${a}px`),h.length>0?i.show():i.hide()}function Hi(e){const t=new Kt;t.el.on("click",()=>{e.onClick&&e.onClick(this.data.getData(),this.data)}),t.tip=e.tip||"";let{el:i}=e;if(e.icon&&(i=r("img").attr("src",e.icon)),i){const e=r("div",`${le}-icon`);e.child(i),t.el.child(e)}return t}class Ni{constructor(e,t,i=!1){this.data=e,this.change=()=>{console.log("empty function")},this.widthFn=t,this.isHide=i;const s=e.defaultStyle();this.items=[[this.undoEl=new Ii,this.redoEl=new $i,this.paintformatEl=new bi,this.clearformatEl=new wi],Di(),[this.formatEl=new Ti],Di(),[this.fontEl=new Ei,this.fontSizeEl=new Ci],Di(),[this.boldEl=new Qt,this.italicEl=new ei,this.underlineEl=new ii,this.strikeEl=new ti,this.textColorEl=new vi(s.color)],Di(),[this.fillColorEl=new yi(s.bgcolor),this.borderEl=new gi,this.mergeEl=new Ri],Di(),[this.alignEl=new Yt(s.align),this.valignEl=new Zt(s.valign)]];const{extendToolbar:l={}}=e.settings;if(l.left&&l.left.length>0){this.items.unshift(Di());const e=l.left.map(Hi.bind(this));this.items.unshift(e)}if(l.right&&l.right.length>0){this.items.push(Di());const e=l.right.map(Hi.bind(this));this.items.push(e)}this.items.push([this.moreEl=new Ai]),this.el=r("div",`${le}-toolbar`),this.btns=r("div",`${le}-toolbar-btns`),this.items.forEach(e=>{Array.isArray(e)?e.forEach(e=>{this.btns.child(e.el),e.change=(...e)=>{this.change(...e)}}):this.btns.child(e.el)}),this.el.child(this.btns),i?this.el.hide():(this.reset(),setTimeout(()=>{zi.call(this),ji.call(this)},0),ae(window,"resize",()=>{ji.call(this)}))}paintformatActive(){return this.paintformatEl.active()}paintformatToggle(){this.paintformatEl.toggle()}trigger(e){this[`${e}El`].click()}resetData(e){this.data=e,this.reset()}reset(){if(this.isHide)return;const{data:e}=this,t=e.getSelectedCellStyle();this.undoEl.setState(!e.canUndo()),this.redoEl.setState(!e.canRedo()),this.mergeEl.setState(e.canUnmerge(),!e.selector.multiple());const{font:i,format:s}=t;this.formatEl.setState(s),this.fontEl.setState(i.name),this.fontSizeEl.setState(i.size),this.boldEl.setState(i.bold),this.italicEl.setState(i.italic),this.underlineEl.setState(t.underline),this.strikeEl.setState(t.strike),this.textColorEl.setState(t.color),this.fillColorEl.setState(t.bgcolor),this.alignEl.setState(t.align),this.valignEl.setState(t.valign)}}class Mi{constructor(e,t,i="600px"){this.title=e,this.el=r("div",`${le}-modal`).css("width",i).children(r("div",`${le}-modal-header`).children(new Vt("close").on("click.stop",()=>this.hide()),this.title),r("div",`${le}-modal-content`).children(...t)).hide()}show(){this.dimmer=r("div",`${le}-dimmer active`),document.body.appendChild(this.dimmer.el);const{width:e,height:t}=this.el.show().box(),{clientHeight:i,clientWidth:s}=document.documentElement;this.el.offset({left:(s-e)/2,top:(i-t)/3}),window.xkeydownEsc=e=>{27===e.keyCode&&this.hide()},ae(window,"keydown",window.xkeydownEsc)}hide(){this.el.hide(),document.body.removeChild(this.dimmer.el),ce(window,"keydown",window.xkeydownEsc),delete window.xkeydownEsc}}class Wi{constructor(e,t){this.vchange=()=>{console.log("empty function")},this.el=r("div",`${le}-form-input`),this.input=r("input","").css("width",e).on("input",e=>this.vchange(e)).attr("placeholder",t),this.el.child(this.input)}focus(){setTimeout(()=>{this.input.el.focus()},10)}hint(e){this.input.attr("placeholder",e)}val(e){return this.input.val(e)}}class Fi{constructor(e,t,i,s=e=>e,l=()=>{console.log("empty function")}){this.key=e,this.getTitle=s,this.vchange=()=>{console.log("empty function")},this.el=r("div",`${le}-form-select`),this.suggest=new Fe(t.map(e=>({key:e,title:this.getTitle(e)})),e=>{this.itemClick(e.key),l(e.key),this.vchange(e.key)},i,this.el),this.el.children(this.itemEl=r("div","input-text").html(this.getTitle(e)),this.suggest.el).on("click",()=>this.show())}show(){this.suggest.search("")}itemClick(e){this.key=e,this.itemEl.html(this.getTitle(e))}val(e){return void 0!==e?(this.key=e,this.itemEl.html(this.getTitle(e)),this):this.key}}const Pi={number:/(^\d+$)|(^\d+(\.\d{0,4})?$)/,date:/^\d{4}-\d{1,2}-\d{1,2}$/};class _i{constructor(e,t,i,s){this.label="",this.rule=t,i&&(this.label=r("label","label").css("width",`${s}px`).html(i)),this.tip=r("div","tip").child("tip").hide(),this.input=e,this.input.vchange=()=>this.validate(),this.el=r("div",`${le}-form-field`).children(this.label,e.el,this.tip)}isShow(){return"none"!==this.el.css("display")}show(){this.el.show()}hide(){return this.el.hide(),this}val(e){return this.input.val(e)}hint(e){this.input.hint(e)}validate(){const{input:e,rule:t,tip:i,el:s}=this,l=e.val();if(t.required&&/^\s*$/.test(l))return i.html(h("validation.required")),s.addClass("error"),!1;if(t.type||t.pattern){const e=t.pattern||Pi[t.type];if(!e.test(l))return i.html(h("validation.notMatch")),s.addClass("error"),!1}return s.removeClass("error"),!0}}const Bi=100;class Li extends Mi{constructor(){const e=new _i(new Fi("cell",["cell"],"100%",e=>h(`dataValidation.modeType.${e}`)),{required:!0},`${h("dataValidation.range")}:`,Bi),t=new _i(new Wi("120px","E3 or E3:F12"),{required:!0,pattern:/^([A-Z]{1,2}[1-9]\d*)(:[A-Z]{1,2}[1-9]\d*)?$/}),i=new _i(new Fi("list",["list","number","date","phone","email"],"100%",e=>h(`dataValidation.type.${e}`),e=>this.criteriaSelected(e)),{required:!0},`${h("dataValidation.criteria")}:`,Bi),s=new _i(new Fi("be",["be","nbe","eq","neq","lt","lte","gt","gte"],"160px",e=>h(`dataValidation.operator.${e}`),e=>this.criteriaOperatorSelected(e)),{required:!0}).hide(),l=new _i(new Wi("70px","10"),{required:!0}).hide(),n=new _i(new Wi("70px","100"),{required:!0,type:"number"}).hide(),o=new _i(new Wi("120px","a,b,c"),{required:!0}),a=new _i(new Wi("70px","10"),{required:!0,type:"number"}).hide();super(h("contextmenu.validation"),[r("div",`${le}-form-fields`).children(e.el,t.el),r("div",`${le}-form-fields`).children(i.el,s.el,l.el,n.el,a.el,o.el),r("div",`${le}-buttons`).children(new st("cancel").on("click",()=>this.btnClick("cancel")),new st("remove").on("click",()=>this.btnClick("remove")),new st("save","primary").on("click",()=>this.btnClick("save")))]),this.mf=e,this.rf=t,this.cf=i,this.of=s,this.minvf=l,this.maxvf=n,this.vf=a,this.svf=o,this.change=()=>{console.log("empty function")}}showVf(e){const t="date"===e?"2018-11-12":"10",{vf:i}=this;i.input.hint(t),i.show()}criteriaSelected(e){const{of:t,minvf:i,maxvf:s,vf:l,svf:r}=this;"date"===e||"number"===e?(t.show(),i.rule.type=e,s.rule.type=e,"date"===e?(i.hint("2018-11-12"),s.hint("2019-11-12")):(i.hint("10"),s.hint("100")),i.show(),s.show(),l.hide(),r.hide()):("list"===e?r.show():r.hide(),l.hide(),t.hide(),i.hide(),s.hide())}criteriaOperatorSelected(e){if(!e)return;const{minvf:t,maxvf:i,vf:s}=this;if("be"===e||"nbe"===e)t.show(),i.show(),s.hide();else{const e=this.cf.val();s.rule.type=e,"date"===e?s.hint("2018-11-12"):s.hint("10"),s.show(),t.hide(),i.hide()}}btnClick(e){if("cancel"===e)this.hide();else if("remove"===e)this.change("remove"),this.hide();else if("save"===e){const e=["mf","rf","cf","of","svf","vf","minvf","maxvf"];for(let n=0;n<e.length;n+=1){const t=this[e[n]];if(t.isShow()&&!t.validate())return}const t=this.mf.val(),i=this.rf.val(),s=this.cf.val(),l=this.of.val();let r=this.svf.val();"number"!==s&&"date"!==s||(r="be"===l||"nbe"===l?[this.minvf.val(),this.maxvf.val()]:this.vf.val()),this.change("save",t,i,s,l,{required:!1,value:r}),this.hide()}}setValue(e){if(e){const{mf:t,rf:i,cf:s,of:l,svf:r,vf:n,minvf:o,maxvf:a}=this,{mode:c,ref:h,validator:d}=e,{type:u,operator:f,value:p}=d||{type:"list"};t.val(c||"cell"),i.val(h),s.val(u),l.val(f),Array.isArray(p)?(o.val(p[0]),a.val(p[1])):(r.val(p||""),n.val(p||"")),this.criteriaSelected(u),this.criteriaOperatorSelected(f)}this.show()}}function Vi(e){return r("div",`${le}-item ${e}`)}function qi(e){return Vi("state").child(h(`sort.${e}`)).on("click.stop",()=>this.itemClick(e))}function Ui(e){const{filterbEl:t,filterValues:i}=this;t.html("");const s=Object.keys(e);s.forEach((s,l)=>{const n=e[s],o=i.includes(s)?"checked":"";t.child(r("div",`${le}-item state ${o}`).on("click.stop",()=>this.filterClick(l,s)).children(""===s?h("filter.empty"):s,r("div","label").html(`(${n})`)))})}function Xi(){const{filterhEl:e,filterValues:t,values:i}=this;e.html(`${t.length} / ${i.length}`),e.checked(t.length===i.length)}class Ki{constructor(){this.filterbEl=r("div",`${le}-body`),this.filterhEl=r("div",`${le}-header state`).on("click.stop",()=>this.filterClick(0,"all")),this.el=r("div",`${le}-sort-filter`).children(this.sortAscEl=qi.call(this,"asc"),this.sortDescEl=qi.call(this,"desc"),Vi("divider"),r("div",`${le}-filter`).children(this.filterhEl,this.filterbEl),r("div",`${le}-buttons`).children(new st("cancel").on("click",()=>this.btnClick("cancel")),new st("ok","primary").on("click",()=>this.btnClick("ok")))).hide(),this.ci=null,this.sortDesc=null,this.values=null,this.filterValues=[]}btnClick(e){if("ok"===e){const{ci:e,sort:t,filterValues:i}=this;this.ok&&this.ok(e,t,"in",i)}this.hide()}itemClick(e){this.sort=e;const{sortAscEl:t,sortDescEl:i}=this;t.checked("asc"===e),i.checked("desc"===e)}filterClick(e,t){const{filterbEl:i,filterValues:s,values:l}=this,n=i.children();if("all"===t)n.length===s.length?(this.filterValues=[],n.forEach(e=>r(e).checked(!1))):(this.filterValues=Array.from(l),n.forEach(e=>r(e).checked(!0)));else{const i=r(n[e]).toggle("checked");i?s.push(t):s.splice(s.findIndex(e=>e===t),1)}Xi.call(this)}set(e,t,i,s){this.ci=e;const{sortAscEl:l,sortDescEl:r}=this;null!==s?(this.sort=s.order,l.checked(s.asc()),r.checked(s.desc())):(this.sortDesc=null,l.checked(!1),r.checked(!1)),this.values=Object.keys(t),this.filterValues=i?Array.from(i.value):Object.keys(t),Ui.call(this,t,i),Xi.call(this)}setOffset(e){this.el.offset(e).show();let t=1;de(this.el,()=>{t<=0&&this.hide(),t-=1})}show(){this.el.show()}hide(){this.el.hide(),he(this.el)}}function Ji(e,t){const i=r("div",`${le}-toast`),s=r("div",`${le}-dimmer active`),l=()=>{document.body.removeChild(i.el),document.body.removeChild(s.el)};i.children(r("div",`${le}-toast-header`).children(new Vt("close").on("click.stop",()=>l()),e),r("div",`${le}-toast-content`).html(t)),document.body.appendChild(i.el),document.body.appendChild(s.el);const{width:n,height:o}=i.box(),{clientHeight:a,clientWidth:c}=document.documentElement;i.offset({left:(c-n)/2,top:(a-o)/3})}function Yi(e,t){let i;return(...s)=>{const l=s;i||(i=setTimeout(()=>{i=null,e.apply(this,l)},t))}}function Zi(){const{data:e,verticalScrollbar:t,horizontalScrollbar:i}=this,{l:s,t:l,left:r,top:n,width:o,height:a}=e.getSelectedRect(),c=this.getTableOffset();if(Math.abs(r)+o>c.width)i.move({left:s+o-c.width});else{const t=e.freezeTotalWidth();r<t&&i.move({left:s-1-t})}if(Math.abs(n)+a>c.height)t.move({top:l+a-c.height-1});else{const i=e.freezeTotalHeight();n<i&&t.move({top:l-1-i})}}function Gi(e,t,i,s=!0,l=!1){if(-1===t&&-1===i)return;const{table:r,selector:n,toolbar:o,data:a,contextMenu:c}=this,h=a.getCell(t,i);e?(n.setEnd(t,i,l),this.trigger("cells-selected",h,n.range)):(n.set(t,i,s),this.trigger("cell-selected",h,t,i)),c.setMode(-1===t||-1===i?"row-col":"range"),o.reset(),r.render()}function Qi(e,t){const{selector:i,data:s}=this,{rows:l,cols:r}=s;let[n,o]=i.indexes;const{eri:a,eci:c}=i.range;e&&([n,o]=i.moveIndexes),"left"===t?o>0&&(o-=1):"right"===t?(c!==o&&(o=c),o<r.len-1&&(o+=1)):"up"===t?n>0&&(n-=1):"down"===t?(a!==n&&(n=a),n<l.len-1&&(n+=1)):"row-first"===t?o=0:"row-last"===t?o=r.len-1:"col-first"===t?n=0:"col-last"===t&&(n=l.len-1),e&&(i.moveIndexes=[n,o]),Gi.call(this,e,n,o),Zi.call(this)}function es(e){if(0!==e.buttons)return;if(e.target.className===`${le}-resizer-hover`)return;const{offsetX:t,offsetY:i}=e,{rowResizer:s,colResizer:l,tableEl:r,data:n}=this,{rows:o,cols:a}=n;if(t>a.indexWidth&&i>o.height)return s.hide(),void l.hide();const c=r.box(),h=n.getCellRectByXY(e.offsetX,e.offsetY);h.ri>=0&&-1===h.ci?(h.width=a.indexWidth,s.show(h,{width:c.width}),o.isHide(h.ri-1)?s.showUnhide(h.ri):s.hideUnhide()):s.hide(),-1===h.ri&&h.ci>=0?(h.height=o.height,l.show(h,{height:c.height}),a.isHide(h.ci-1)?l.showUnhide(h.ci):l.hideUnhide()):l.hide()}function ts(e){const{verticalScrollbar:t,horizontalScrollbar:i,data:s}=this,{top:l}=t.scroll(),{left:r}=i.scroll(),{rows:n,cols:o}=s,{deltaY:a,deltaX:c}=e,h=(e,t)=>{let i=e,s=0;do{s=t(i),i+=1}while(s<=0);return s},d=e=>{if(e>0){const e=s.scroll.ri+1;if(e<n.len){const i=h(e,e=>n.getHeight(e));t.move({top:l+i-1})}}else{const e=s.scroll.ri-1;if(e>=0){const i=h(e,e=>n.getHeight(e));t.move({top:0===e?0:l-i})}}},u=e=>{if(e>0){const e=s.scroll.ci+1;if(e<o.len){const t=h(e,e=>o.getWidth(e));i.move({left:r+t-1})}}else{const e=s.scroll.ci-1;if(e>=0){const t=h(e,e=>o.getWidth(e));i.move({left:0===e?0:r-t})}}},f=Math.abs(a),p=Math.abs(c),g=Math.max(f,p);/Firefox/i.test(window.navigator.userAgent)&&Yi(d(e.detail),50),g===p&&Yi(u(c),50),g===f&&Yi(d(a),50)}function is(e){const{selector:t,data:i,toolbar:s}=this;if("read"===i.settings.mode)return;const{offsetX:l,offsetY:r}=e,n=i.getCellRectByXY(l,r),{ri:o,ci:a}=n,c=i.getCell(o,a);t.set(o,a,!0),this.trigger("cell-drop",c,o,a,e),s.reset(),this.trigger("cell-selected",i.getCell(o,a),o,a)}function ss(e,t){const{verticalScrollbar:i,horizontalScrollbar:s}=this,{top:l}=i.scroll(),{left:r}=s.scroll();"left"===e||"right"===e?s.move({left:r-t}):"up"!==e&&"down"!==e||i.move({top:l-t})}function ls(){const{data:e,verticalScrollbar:t}=this,{height:i}=this.getTableOffset(),s=e.exceptRowTotalHeight(0,-1);t.set(i,e.rows.totalHeight()-s)}function rs(){const{data:e,horizontalScrollbar:t}=this,{width:i}=this.getTableOffset();e&&t.set(i,e.cols.totalWidth())}function ns(){const{selector:e,data:t,editor:i}=this,[s,l]=t.freeze;if(s>0||l>0){const e=t.freezeTotalWidth(),s=t.freezeTotalHeight();i.setFreezeLengths(e,s)}e.resetAreaOffset()}function os(){const{tableEl:e,overlayerEl:t,overlayerCEl:i,table:s,toolbar:l,selector:r,el:n}=this,o=this.getTableOffset(),a=this.getRect();e.attr(a),t.offset(a),i.offset(o),n.css("width",`${a.width}px`),ls.call(this),rs.call(this),ns.call(this),s.render(),l.reset(),r.reset()}function as(){const{data:e,selector:t}=this;e.clearClipboard(),t.hideClipboard()}function cs(e){const{data:t,selector:i}=this;"read"!==t.settings.mode&&(t.copy(),t.copyToSystemClipboard(e),i.showClipboard())}function hs(){const{data:e,selector:t}=this;"read"!==e.settings.mode&&(e.cut(),t.showClipboard())}function ds(e,t){const{data:i}=this;if("read"!==i.settings.mode)if(i.clipboard.isClear()){const e=()=>os.call(this),t=e=>{this.trigger("pasted-clipboard",e)};i.pasteFromSystemClipboard(e,t)}else if(i.paste(e,e=>Ji("Tip",e)))os.call(this);else if(t){const e=t.clipboardData.getData("text/plain");this.data.pasteFromText(e),os.call(this)}}function us(){this.data.hideRowsOrCols(),os.call(this)}function fs(e,t){this.data.unhideRowsOrCols(e,t),os.call(this)}function ps(){const{data:e}=this;e.autofilter(),os.call(this)}function gs(){const{toolbar:e}=this;e.paintformatActive()&&(ds.call(this,"format"),as.call(this),e.paintformatToggle())}function ms(e){const{selector:t,data:i,table:s,sortFilter:l}=this;if("read"===i.settings.mode)return;const{offsetX:r,offsetY:n}=e,o=e.target.className===`${le}-selector-corner`,a=i.getCellRectByXY(r,n),{left:c,top:h,width:d,height:u}=a;let{ri:f,ci:p}=a;const{autoFilter:g}=i;if(g.includes(f,p)&&c+d-20<r&&h+u-20<n){const e=g.items(p,(e,t)=>i.rows.getCell(e,t));return l.hide(),l.set(p,e,g.getFilter(p),g.getSort(p)),void l.setOffset({left:c,top:h+u+2})}e.shiftKey||(o?t.showAutofill(f,p):Gi.call(this,!1,f,p),ue(window,e=>{({ri:f,ci:p}=i.getCellRectByXY(e.offsetX,e.offsetY)),o?t.showAutofill(f,p):1!==e.buttons||e.shiftKey||Gi.call(this,!0,f,p,!0,!0)},()=>{o&&t.arange&&"read"!==i.settings.mode&&i.autofill(t.arange,"all",e=>Ji("Tip",e))&&s.render(),t.hideAutofill(),gs.call(this)})),o||1!==e.buttons||e.shiftKey&&Gi.call(this,!0,f,p)}function ws(){const{editor:e,data:t}=this,i=t.getSelectedRect(),s=this.getTableOffset();let l="top";i.top>s.height/2&&(l="bottom"),e.setOffset(i,l)}function bs(){const{editor:e,data:t}=this;if("read"===t.settings.mode)return;const i=t.getSelectedCell();i&&i.hidden||"edit"===t.settings.mode&&(ws.call(this),e.setCell(i,t.getSelectedValidator()),as.call(this))}function vs(e){const{data:t,table:i,selector:s}=this;t.scrolly(e,()=>{s.resetBRLAreaOffset(),ws.call(this),i.render()})}function ys(e){const{data:t,table:i,selector:s}=this;t.scrollx(e,()=>{s.resetBRTAreaOffset(),ws.call(this),i.render()})}function xs(e,t){const{ri:i}=e,{table:s,selector:l,data:r}=this,{sri:n,eri:o}=l.range;if(i>=n&&i<=o)for(let a=n;a<=o;a+=1)r.rows.setHeight(a,t);else r.rows.setHeight(i,t);s.render(),l.resetAreaOffset(),ls.call(this),ws.call(this)}function Cs(e,t){const{ci:i}=e,{table:s,selector:l,data:r}=this,{sci:n,eci:o}=l.range;if(i>=n&&i<=o)for(let a=n;a<=o;a+=1)r.cols.setWidth(a,t);else r.cols.setWidth(i,t);s.render(),l.resetAreaOffset(),rs.call(this),ws.call(this)}function ks(e,t="finished"){const{data:i,table:s}=this;if("read"===i.settings.mode)return;i.setSelectedCellText(e,t);const{ri:l,ci:r}=i.selector;"finished"===t?s.render():this.trigger("cell-edited",e,l,r)}function Es(e){const{data:t}=this;if("read"!==t.settings.mode){if("insert-row"===e)t.insert("row");else if("delete-row"===e)t.delete("row");else if("insert-column"===e)t.insert("column");else if("delete-column"===e)t.delete("column");else if("delete-cell"===e)t.deleteCell();else if("delete-cell-format"===e)t.deleteCell("format");else if("delete-cell-text"===e){t.deleteCell("text");const{ri:e,ci:i}=t.selector;this.trigger("cell-edited","",e,i)}else"cell-printable"===e?t.setSelectedCellAttr("printable",!0):"cell-non-printable"===e?t.setSelectedCellAttr("printable",!1):"cell-editable"===e?t.setSelectedCellAttr("editable",!0):"cell-non-editable"===e&&t.setSelectedCellAttr("editable",!1);as.call(this),os.call(this)}}function Ss(e,t){const{data:i}=this;if("undo"===e)this.undo();else if("redo"===e)this.redo();else if("print"===e)this.print.preview();else if("paintformat"===e)!0===t?cs.call(this):as.call(this);else if("clearformat"===e)Es.call(this,"delete-cell-format");else if("link"===e);else if("chart"===e)Is.call(this,e);else if("autofilter"===e)ps.call(this);else if("freeze"===e)if(t){const{ri:e,ci:t}=i.selector;this.freeze(e,t)}else this.freeze(0,0);else i.setSelectedCellAttr(e,t),"formula"!==e||i.selector.multiple()||bs.call(this),os.call(this)}function Ts(e,t,i,s){this.data.setAutoFilter(e,t,i,s),os.call(this)}function Rs(){const{selector:e,overlayerEl:t,rowResizer:i,colResizer:s,verticalScrollbar:l,horizontalScrollbar:r,editor:n,contextMenu:o,toolbar:a,modalValidation:c,sortFilter:h}=this;t.on("mousemove",e=>{es.call(this,e)}).on("mousedown",e=>{n.clear(),o.hide(),2===e.buttons?(this.data.xyInSelectedRect(e.offsetX,e.offsetY)||ms.call(this,e),o.setPosition(e.offsetX,e.offsetY),e.stopPropagation()):2===e.detail?bs.call(this):ms.call(this,e)}).on("mousewheel.stop",e=>{ts.call(this,e)}).on("mouseout",e=>{const{offsetX:t,offsetY:l}=e;l<=0&&s.hide(),t<=0&&i.hide()}).on("drop",e=>{e.preventDefault(),is.call(this,e)}),e.inputChange=e=>{ks.call(this,e,"input"),bs.call(this)},pe(t.el,{move:(e,t)=>{ss.call(this,e,t)}}),a.change=(e,t)=>Ss.call(this,e,t),h.ok=(e,t,i,s)=>Ts.call(this,e,t,i,s),i.finishedFn=(e,t)=>{xs.call(this,e,t)},s.finishedFn=(e,t)=>{Cs.call(this,e,t)},i.unhideFn=e=>{fs.call(this,"row",e)},s.unhideFn=e=>{fs.call(this,"col",e)},l.moveFn=(e,t)=>{vs.call(this,e,t)},r.moveFn=(e,t)=>{ys.call(this,e,t)},n.change=(e,t)=>{ks.call(this,t,e)},c.change=(e,...t)=>{"save"===e?this.data.addValidation(...t):this.data.removeValidation()},o.itemClick=e=>{"validation"===e?c.setValue(this.data.getSelectedValidation()):"copy"===e?cs.call(this):"cut"===e?hs.call(this):"paste"===e?ds.call(this,"all"):"paste-value"===e?ds.call(this,"text"):"paste-format"===e?ds.call(this,"format"):"hide"===e?us.call(this):Es.call(this,e)},ae(window,"resize",()=>{this.reload()}),ae(window,"click",e=>{this.focusing=t.contains(e.target)}),ae(window,"paste",e=>{this.focusing&&(ds.call(this,"all",e),e.preventDefault())}),ae(window,"copy",e=>{this.focusing&&(cs.call(this,e),e.preventDefault())}),ae(window,"keydown",e=>{if(!this.focusing)return;const t=e.keyCode||e.which,{key:i,ctrlKey:s,shiftKey:l,metaKey:r}=e;if(s||r)switch(t){case 90:this.undo(),e.preventDefault();break;case 89:this.redo(),e.preventDefault();break;case 67:break;case 88:hs.call(this),e.preventDefault();break;case 85:a.trigger("underline"),e.preventDefault();break;case 86:break;case 37:Qi.call(this,l,"row-first"),e.preventDefault();break;case 38:Qi.call(this,l,"col-first"),e.preventDefault();break;case 39:Qi.call(this,l,"row-last"),e.preventDefault();break;case 40:Qi.call(this,l,"col-last"),e.preventDefault();break;case 32:Gi.call(this,!1,-1,this.data.selector.ci,!1),e.preventDefault();break;case 66:a.trigger("bold");break;case 73:a.trigger("italic");break;default:break}else{switch(t){case 32:l&&Gi.call(this,!1,this.data.selector.ri,-1,!1);break;case 27:o.hide(),as.call(this);break;case 37:Qi.call(this,l,"left"),e.preventDefault();break;case 38:Qi.call(this,l,"up"),e.preventDefault();break;case 39:Qi.call(this,l,"right"),e.preventDefault();break;case 40:Qi.call(this,l,"down"),e.preventDefault();break;case 9:n.clear(),Qi.call(this,!1,l?"left":"right"),e.preventDefault();break;case 13:n.clear(),Qi.call(this,!1,l?"up":"down"),e.preventDefault();break;case 8:Es.call(this,"delete-cell-text"),e.preventDefault();break;default:break}"Delete"===i?(Es.call(this,"delete-cell-text"),e.preventDefault()):t>=65&&t<=90||t>=48&&t<=57||t>=96&&t<=105||"="===e.key?(ks.call(this,e.key,"input"),bs.call(this)):113===t&&bs.call(this)}})}function $s(){console.warn("fileOpen not implemented")}async function Is(e){try{const e=await $s({description:"Image files",mimeTypes:["image/jpg","image/png","image/gif","image/webp"],extensions:[".jpg",".jpeg",".png",".gif",".webp"]}),{data:t}=this,i=new FileReader;let s;i.readAsDataURL(e),i.onload=e=>{s=e.target.result,t.setSelectedCellAttr("type","image"),t.rows._[t.selector.ri].cells[t.selector.ci].value=s,t.rows._[t.selector.ri].cells[t.selector.ci].left=t.getSelectedRect().left,t.rows._[t.selector.ri].cells[t.selector.ci].top=t.getSelectedRect().top;const i=new Image;i.src=s,i.onload=function(){const e=this.width,i=this.height;t.rows._[t.selector.ri].cells[t.selector.ci].imagewidth=e,t.rows._[t.selector.ri].cells[t.selector.ci].imageheight=i},os.call(this)}}catch(t){console.error(t)}}const Os=()=>"100%";class As{cell(e,t,i){throw new Error("Method not implemented.")}constructor(e,t){this.eventMap=ge();const{showToolbar:i,showContextmenu:s,mode:l}=t.settings;this.el=r("div",`${le}-sheet`),this.toolbar=new Ni(t,Os,!i),this.print=new Wt(t),e.children(this.toolbar.el,this.el,this.print.el),this.data=t,this.tableEl=r("canvas",`${le}-table`),this.rowResizer=new me(!1,t.rows.height),this.colResizer=new me(!0,t.cols.minWidth),this.verticalScrollbar=new we(!0),this.horizontalScrollbar=new we(!1),this.editor=new Ke(ne,()=>this.getTableOffset(),t.rows.height),this.modalValidation=new Li,this.contextMenu=new Bt(()=>this.getRect(),!s),this.selector=new je(t),this.overlayerCEl=r("div",`${le}-overlayer-content`).children(this.editor.el,this.selector.el),this.overlayerEl=r("div",`${le}-overlayer`).child(this.overlayerCEl),this.sortFilter=new Ki,this.el.children(this.tableEl,this.overlayerEl.el,this.rowResizer.el,this.colResizer.el,this.verticalScrollbar.el,this.horizontalScrollbar.el,this.contextMenu.el,this.modalValidation.el,this.sortFilter.el),this.table=new At(this.tableEl.el,t),Rs.call(this),os.call(this),"read"!==l&&Gi.call(this,!1,0,0)}on(e,t){return this.eventMap.on(e,t),this}trigger(e,...t){const{eventMap:i}=this;i.fire(e,t)}resetData(e){this.editor.clear(),this.data=e,ls.call(this),rs.call(this),this.toolbar.resetData(e),this.print.resetData(e),this.selector.resetData(e),this.table.resetData(e)}loadData(e){return this.data.setData(e),os.call(this),this}freeze(e,t){const{data:i}=this;return i.setFreeze(e,t),os.call(this),this}undo(){this.data.undo(),os.call(this)}redo(){this.data.redo(),os.call(this)}reload(){return os.call(this),this}getRect(){const{data:e}=this;return{width:e.viewWidth(),height:e.viewHeight()}}getTableOffset(){const{rows:e,cols:t}=this.data,{width:i,height:s}=this.getRect();return{width:i-t.indexWidth,height:s-e.height,left:t.indexWidth,top:e.height}}}class Ds extends Lt{constructor(e){const t=new Vt("ellipsis");super(t,"auto",!1,"top-left"),this.contentClick=e}reset(e){const t=e.map((e,t)=>r("div",`${le}-item`).css("width","150px").css("font-weight","normal").on("click",()=>{this.contentClick(t),this.hide()}).child(e));this.setContentChildren(...t)}setTitle(){console.log("empty function")}}const zs=[{key:"delete",title:d("contextmenu.deleteSheet")}];function js(e){return r("div",`${le}-item`).child(e.title()).on("click",()=>{this.itemClick(e.key),this.hide()})}function Hs(){return zs.map(e=>js.call(this,e))}class Ns{constructor(){this.el=r("div",`${le}-contextmenu`).css("width","160px").children(...Hs.call(this)).hide(),this.itemClick=()=>{console.log("empty function")}}hide(){const{el:e}=this;e.hide(),he(e)}setOffset(e){const{el:t}=this;t.offset(e),t.show(),de(t)}}class Ms{constructor(e=()=>{console.log("empty function")},t=()=>{console.log("empty function")},i=()=>{console.log("empty function")},s=()=>{console.log("empty function")}){this.swapFunc=t,this.updateFunc=s,this.dataNames=[],this.activeEl=null,this.deleteEl=null,this.items=[],this.moreEl=new Ds(e=>{this.clickSwap2(this.items[e])}),this.contextMenu=new Ns,this.contextMenu.itemClick=i,this.el=r("div",`${le}-bottombar`).children(this.contextMenu.el,this.menuEl=r("ul",`${le}-menu`).child(r("li","").children(new Vt("add").on("click",()=>{e()}),r("span","").child(this.moreEl))))}addItem(e,t,i){this.dataNames.push(e);const s=r("li",t?"active":"").child(e);s.on("click",()=>{this.clickSwap2(s)}).on("contextmenu",e=>{if("read"===i.mode)return;const{offsetLeft:t,offsetHeight:l}=e.target;this.contextMenu.setOffset({left:t,bottom:l+1}),this.deleteEl=s}).on("dblclick",()=>{if("read"===i.mode)return;const e=s.html(),t=new Wi("auto","");t.val(e),t.input.on("blur",({target:t})=>{const{value:i}=t,s=this.dataNames.findIndex(t=>t===e);this.renameItem(s,i)}),s.html("").child(t.el),t.focus()}),t&&this.clickSwap(s),this.items.push(s),this.menuEl.child(s),this.moreEl.reset(this.dataNames)}renameItem(e,t){this.dataNames.splice(e,1,t),this.moreEl.reset(this.dataNames),this.items[e].html("").child(t),this.updateFunc(e,t)}clear(){this.items.forEach(e=>{this.menuEl.removeChild(e.el)}),this.items=[],this.dataNames=[],this.moreEl.reset(this.dataNames)}deleteItem(){const{activeEl:e,deleteEl:t}=this;if(this.items.length>1){const i=this.items.findIndex(e=>e===t);if(this.items.splice(i,1),this.dataNames.splice(i,1),this.menuEl.removeChild(t.el),this.moreEl.reset(this.dataNames),e===t){const[e]=this.items;return this.activeEl=e,this.activeEl.toggle(),[i,0]}return[i,-1]}return[-1]}clickSwap2(e){const t=this.items.findIndex(t=>t===e);this.clickSwap(e),this.activeEl.toggle(),this.swapFunc(t)}clickSwap(e){null!==this.activeEl&&this.activeEl.toggle(),this.activeEl=e}}class Ws{constructor(e,t={}){let i=e;this.options={showBottomBar:!0,...t},this.sheetIndex=1,this.datas=[],"string"===typeof e&&(i=document.querySelector(e)),this.bottombar=this.options.showBottomBar?new Ms(()=>{if("read"===this.options.mode)return;const e=this.addSheet();this.sheet.resetData(e)},e=>{const t=this.datas[e];this.sheet.resetData(t)},()=>{this.deleteSheet()},(e,t)=>{this.datas[e].name=t,this.sheet.trigger("change")}):null,this.data=this.addSheet();const s=r("div",`${le}`).on("contextmenu",e=>e.preventDefault());i.appendChild(s.el),this.sheet=new As(s,this.data),null!==this.bottombar&&s.child(this.bottombar.el)}addSheet(e,t=!0){const i=e||`sheet${this.sheetIndex}`,s=new se(i,this.options);return s.change=(...e)=>{this.sheet.trigger("change",...e)},this.datas.push(s),null!==this.bottombar&&this.bottombar.addItem(i,t,this.options),this.sheetIndex+=1,s}deleteSheet(){if(null===this.bottombar)return;const[e,t]=this.bottombar.deleteItem();e>=0&&(this.datas.splice(e,1),t>=0&&this.sheet.resetData(this.datas[t]),this.sheet.trigger("change"))}loadData(e){const t=Array.isArray(e)?e:[e];if(null!==this.bottombar&&this.bottombar.clear(),this.datas=[],t.length>0)for(let i=0;i<t.length;i+=1){const e=t[i],s=this.addSheet(e.name,0===i);s.setData(e),0===i&&this.sheet.resetData(s)}return this}getData(){return this.datas.map(e=>e.getData())}cellText(e,t,i,s=0){return this.datas[s].setCellText(e,t,i,"finished"),this}cell(e,t,i=0){return this.datas[i].getCell(e,t)}cellStyle(e,t,i=0){return this.datas[i].getCellStyle(e,t)}reRender(){return this.sheet.table.render(),this}on(e,t){return this.sheet.on(e,t),this}validate(){const{validations:e}=this.data;return e.errors.size<=0}change(e){return this.sheet.on("change",e),this}static locale(e,t){u(e,t)}}const Fs=(e,t={})=>new Ws(e,t);window&&(window.x_spreadsheet=Fs,window.x_spreadsheet.locale=(e,t)=>u(e,t));var Ps=Ws,_s={toolbar:{undo:"撤销",redo:"恢复",print:"打印",paintformat:"格式刷",clearformat:"清除格式",format:"数据格式",fontName:"字体",fontSize:"字号",fontBold:"加粗",fontItalic:"倾斜",underline:"下划线",strike:"删除线",color:"字体颜色",bgcolor:"填充颜色",border:"边框",merge:"合并单元格",align:"水平对齐",valign:"垂直对齐",textwrap:"自动换行",freeze:"冻结",autofilter:"自动筛选",formula:"函数",more:"更多"},contextmenu:{copy:"复制",cut:"剪切",paste:"粘贴",pasteValue:"粘贴数据",pasteFormat:"粘贴格式",hide:"隐藏",insertRow:"插入行",insertColumn:"插入列",deleteSheet:"删除",deleteRow:"删除行",deleteColumn:"删除列",deleteCell:"删除",deleteCellText:"删除数据",validation:"数据验证",cellprintable:"可打印",cellnonprintable:"不可打印",celleditable:"可编辑",cellnoneditable:"不可编辑"},print:{size:"纸张大小",orientation:"方向",orientations:["横向","纵向"]},format:{normal:"正常",text:"文本",number:"数值",percent:"百分比",rmb:"人民币",usd:"美元",eur:"欧元",date:"短日期",time:"时间",datetime:"长日期",duration:"持续时间"},formula:{sum:"求和",average:"求平均值",max:"求最大值",min:"求最小值",concat:"字符拼接",_if:"条件判断",and:"和",or:"或"},validation:{required:"此值必填",notMatch:"此值不匹配验证规则",between:"此值应在 {} 和 {} 之间",notBetween:"此值不应在 {} 和 {} 之间",notIn:"此值不在列表中",equal:"此值应该等于 {}",notEqual:"此值不应该等于 {}",lessThan:"此值应该小于 {}",lessThanEqual:"此值应该小于等于 {}",greaterThan:"此值应该大于 {}",greaterThanEqual:"此值应该大于等于 {}"},error:{pasteForMergedCell:"无法对合并的单元格执行此操作"},calendar:{weeks:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},button:{next:"下一步",cancel:"取消",remove:"删除",save:"保存",ok:"确认"},sort:{desc:"降序",asc:"升序"},filter:{empty:"空白"},dataValidation:{mode:"模式",range:"单元区间",criteria:"条件",modeType:{cell:"单元格",column:"列模式",row:"行模式"},type:{list:"列表",number:"数字",date:"日期",phone:"手机号",email:"电子邮件"},operator:{be:"在区间",nbe:"不在区间",lt:"小于",lte:"小于等于",gt:"大于",gte:"大于等于",eq:"等于",neq:"不等于"}}};Ps.locale("zh-cn",_s);class Bs{constructor(e,t){(0,s.A)(this,"xs",void 0);const i={...t};this.xs=new Ps(e,i)}getData(){return this.xs.getData()}setData(e){this.xs.loadData(e)}setCellText(e,t,i){this.xs.cellText(e,t,i).reRender()}setCellValue(e,t,i){console.log(e,t,i,"in setCellValue"),this.xs.sheet.data.rows.setCell(e,t,i),setTimeout(()=>{this.xs.reRender()},0)}getCellValue(e,t,i=0){this.xs.sheet.cell(e,t,i)}setRangeShow(e){if(console.log(e,"in set range show"),e=e||{},!e||e.row.length<2||e.column.length<2)return void console.error("range illegal");const{row:t,column:i}=e;if(t.includes(NaN)||i.includes(NaN))return void console.error("range illegal");const s=t[0],l=i[0],r=t[1],n=i[1];this.xs.sheet.selector.range.set(s,l,r,n),this.xs.sheet.selector.resetAreaOffset(),this.xs.sheet.selector.el.show(),this.xs.reRender()}clearRange(){console.log("clear range");const e=this.xs.sheet.data.selector.range;this.xs.sheet.data.rows.deleteCells(e),this.xs.reRender()}addRow(e,t=1){e=e||this.xs.sheet.data.rows.len,this.xs.sheet.data.rows.insert(+e,+t),this.xs.sheet.reload()}resize(){console.log("... SpreadSheet resize ...")}on(e,t){return this.xs.on(e,t)}}var Ls=Bs},71066:function(e,t,i){"use strict";i.d(t,{P:function(){return o},i:function(){return a}});var s=i(81387),l=i(27007),r=i(56768),n=i(90144);const o=e=>{console.log("接收到的第三方参数",e);const t=(0,n.KR)(0),i=(0,r.EW)(()=>{let t={};try{e.thirdParamsString&&(t=JSON.parse(e.thirdParamsString))}catch(i){console.log(i),t={}}return t});console.log("thirdParams",i);const s=(s,l,r)=>{console.log("onCloseThirdDialog",l,r),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:t.value,dialogKey:e.dialogKey,path:i.value.path,rowData:l?JSON.parse(JSON.stringify(l)):void 0,data:r?JSON.parse(JSON.stringify(r)):void 0,isSuccess:s}},"*")},o=(e,i)=>{switch(e){case"setToken":i.token&&(0,l.WG)(i.token);break;case"dialogIndex":t.value=i;break;case"refreshData":break;case"message":break}},a=e=>{o(e.data.type,e.data.data)};return(0,r.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",a,!1)}),(0,r.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",a)}),{thirdParams:i,onCloseThirdDialog:s}},a=()=>{let e;const t=(0,s.lq)(),i=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==t.path.indexOf("/thirdParty/")&&((0,r.sV)(()=>{(0,l.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),i()},18e4))}),(0,r.hi)(()=>{e&&clearInterval(e)}))}}}]);