"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,9878],{4642:function(e,a,r){r.d(a,{ZH:function(){return i},qr:function(){return n}});var t=r(24232);const n=(e="")=>e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"),i=e=>(0,t.ZH)(e)},4849:function(e,a,r){r.r(a),r.d(a,{default:function(){return _}});var t=r(52920),n=(r(97042),r(95509),r(21929)),i=(r(98421),r(65451)),l=(r(63390),r(32465),r(14022)),o=(r(72343),r(68368)),u=(r(81208),r(25136)),d=(r(69957),r(3740)),f=(r(42899),r(47001),r(77195)),s=(r(38389),r(61688),r(44114),r(18111),r(22489),r(7588),r(61701),r(18237),r(56768)),c=r(90144),v=r(57477),m=r(71066),p=r(82572),g=r(27007),h=r(22414);const b={class:"form-single-fragment third-party-dlg",style:{position:"relative",height:"100%"}},y={class:"table-box form-box"};var k=(0,s.pM)({__name:"formSetOnlineFormAuth",props:{formAuth:{},formWidgetConfig:{},bindFormType:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,p.l5)(),r=e,{thirdParams:k,onCloseThirdDialog:w}=(0,m.P)(r),A=(0,c.KR)("pc"),_=(0,c.KR)([]),F=(0,c.KR)([]),W=(0,c.KR)({variableName:""}),C=(0,c.KR)(),R=(0,c.KR)(),N=(0,s.EW)(()=>"pc"===A.value?_.value:F.value),x={variableName:[{required:!0,message:"组件标识不能为空",trigger:"blur"}]},z=(0,s.EW)(()=>({formAuth:r.formAuth||k.value.formAuth||{},formWidgetConfig:r.formWidgetConfig||k.value.formWidgetConfig||{},bindFormType:r.bindFormType||k.value.bindFormType||""})),S=(0,s.EW)(()=>z.value.bindFormType===h.SysFlowEntryBindFormType.ONLINE_FORM),T=()=>{_.value.push({variableName:W.value.variableName,disabled:!1,hidden:!1}),W.value.variableName="",C.value.hide(),R.value.resetFields()},V=e=>{_.value=_.value.filter(a=>a!==e)},E=()=>{r.dialog?r.dialog.cancel():w(!1)},I=(e,a)=>{(e.disabled||e.hidden)&&(a[e.variableName]=`${e.disabled?1:0},${e.hidden?1:0}`),Array.isArray(e.children)&&e.children.length&&e.children.forEach(e=>{I(e,a)})},O=()=>{let e={pc:{},mobile:{}};_.value.forEach(a=>{I(a,e.pc)}),F.value.forEach(a=>{I(a,e.mobile)}),console.log(e),r.dialog?r.dialog.submit(e):w(!0,void 0,e)},P=(e,a,r)=>{if(null==e)return;let t=(0,g.I_)(N.value,e.formId,"formId","children");Array.isArray(t)&&t.forEach(e=>{e[a]=r})},K=(e,a,r)=>{null!=e&&(e[a]=r,Array.isArray(e.children)&&e.children.length&&e.children.forEach(e=>{K(e,a,r)}))},U=(e,a)=>{a?K(e,"disabled",a):P(e,"disabled",a),"pc"===A.value?_.value=[..._.value]:F.value=[...F.value]},j=(e,a)=>{a?K(e,"hidden",a):P(e,"hidden",a),"pc"===A.value?_.value=[..._.value]:F.value=[...F.value]},L=(e,a)=>{let r=a[e.variableName]||[0,0];return{...e,disabled:1===r[0],hidden:1===r[1],children:Array.isArray(e.children)?e.children.map(e=>L(e,a)):void 0}};return(0,s.sV)(()=>{z.value.formWidgetConfig.pc?A.value="pc":A.value="mobile";let e={pc:Object.keys(z.value.formAuth.pc||{}).reduce((e,a)=>(e[a]=z.value.formAuth.pc[a].split(",").map(e=>parseInt(e)),e),{}),mobile:Object.keys(z.value.formAuth.mobile||{}).reduce((e,a)=>(e[a]=z.value.formAuth.mobile[a].split(",").map(e=>parseInt(e)),e),{})};z.value.formWidgetConfig.pc&&z.value.formWidgetConfig.pc.widgetList?_.value=z.value.formWidgetConfig.pc.widgetList.map(a=>L(a,e.pc)):(console.warn("PC端表单配置不存在",e),_.value=Object.keys(e.pc||{}).map(a=>L({variableName:a},e.pc))),z.value.formWidgetConfig.mobile&&z.value.formWidgetConfig.mobile.widgetList?F.value=z.value.formWidgetConfig.mobile.widgetList.map(a=>L(a,e.mobile)):F.value=[]}),(e,r)=>{const m=f.v$,p=f.q,g=o.o8,h=d.qi,k=u.S2,w=o.Up,_=l.WK,F=n.xE,I=i.S2,P=n.US,K=t.Vc;return(0,s.uX)(),(0,s.CE)("div",b,[(0,s.Lk)("div",y,[(0,s.bF)(p,{modelValue:(0,c.R1)(A),"onUpdate:modelValue":r[0]||(r[0]=e=>(0,c.i9)(A)?A.value=e:null)},{default:(0,s.k6)(()=>[(0,c.R1)(z).formWidgetConfig.pc?((0,s.uX)(),(0,s.Wv)(m,{key:0,label:"PC端表单",name:"pc"})):(0,s.Q3)("",!0),(0,c.R1)(z).formWidgetConfig.mobile&&(0,c.R1)(S)?((0,s.uX)(),(0,s.Wv)(m,{key:1,label:"移动端表单",name:"mobile"})):(0,s.Q3)("",!0)]),_:1},8,["modelValue"]),(0,s.bF)(w,{data:(0,c.R1)(N),"row-key":"formId",height:"100%",style:{"flex-grow":"1",height:"100%"},"default-expand-all":!0},{default:(0,s.k6)(()=>[(0,c.R1)(S)?((0,s.uX)(),(0,s.Wv)(g,{key:0,label:"组件名称",prop:"showName"})):(0,s.Q3)("",!0),(0,s.bF)(g,{label:"组件标识",prop:"variableName"}),(0,s.bF)(g,{label:"禁用"},{default:(0,s.k6)(e=>[(0,s.bF)(h,{modelValue:e.row.disabled,"onUpdate:modelValue":a=>e.row.disabled=a,size:"default",onChange:a=>U(e.row,a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),(0,s.bF)(g,{label:"隐藏"},{default:(0,s.k6)(e=>[(0,s.bF)(h,{modelValue:e.row.hidden,"onUpdate:modelValue":a=>e.row.hidden=a,size:"default",onChange:a=>j(e.row,a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),(0,c.R1)(S)?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(g,{key:1,label:"操作",width:"100"},{default:(0,s.k6)(e=>[(0,s.bF)(k,{class:"delete-btn",size:"default",type:"text",onClick:a=>V(e.row)},{default:(0,s.k6)(()=>r[6]||(r[6]=[(0,s.eW)(" 删除 ")])),_:2,__:[6]},1032,["onClick"])]),_:1}))]),_:1},8,["data"]),(0,s.bF)(K,{ref_key:"addVariablePopover",ref:C,placement:"bottom-end",width:400,trigger:"click",onHide:r[3]||(r[3]=()=>{(0,c.R1)(W).variableName="",(0,c.R1)(R).resetFields()})},{reference:(0,s.k6)(()=>[(0,c.R1)(S)?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(k,{key:0,class:"add-btn",size:"default",icon:(0,c.R1)(v.Plus),type:"primary"},{default:(0,s.k6)(()=>r[7]||(r[7]=[(0,s.eW)(" 添加 ")])),_:1,__:[7]},8,["icon"]))]),default:(0,s.k6)(()=>[(0,s.bF)(P,{ref_key:"addFormRef",ref:R,model:(0,c.R1)(W),rules:x,"label-width":"80px"},{default:(0,s.k6)(()=>[(0,s.bF)(F,{label:"组件标识",prop:"variableName"},{default:(0,s.k6)(()=>[(0,s.bF)(_,{modelValue:(0,c.R1)(W).variableName,"onUpdate:modelValue":r[1]||(r[1]=e=>(0,c.R1)(W).variableName=e),size:(0,c.R1)(a).defaultFormItemSize,placeholder:"请输入组件标识"},null,8,["modelValue","size"])]),_:1}),(0,s.bF)(I,{type:"flex",justify:"end",style:{width:"100%"}},{default:(0,s.k6)(()=>[(0,s.bF)(k,{size:(0,c.R1)(a).defaultFormItemSize,onClick:r[2]||(r[2]=e=>(0,c.R1)(C).hide())},{default:(0,s.k6)(()=>r[8]||(r[8]=[(0,s.eW)(" 取消 ")])),_:1,__:[8]},8,["size"]),(0,s.bF)(k,{type:"primary",size:(0,c.R1)(a).defaultFormItemSize,onClick:T},{default:(0,s.k6)(()=>r[9]||(r[9]=[(0,s.eW)(" 确认添加 ")])),_:1,__:[9]},8,["size"])]),_:1})]),_:1},8,["model"])]),_:1},512)]),(0,s.bF)(I,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end",style:{"padding-top":"10px"}},{default:(0,s.k6)(()=>[(0,s.bF)(k,{size:(0,c.R1)(a).defaultFormItemSize,plain:!0,onClick:r[4]||(r[4]=e=>E(!1))},{default:(0,s.k6)(()=>r[10]||(r[10]=[(0,s.eW)(" 取消 ")])),_:1,__:[10]},8,["size"]),(0,s.bF)(k,{type:"primary",size:(0,c.R1)(a).defaultFormItemSize,onClick:r[5]||(r[5]=e=>O())},{default:(0,s.k6)(()=>r[11]||(r[11]=[(0,s.eW)(" 保存 ")])),_:1,__:[11]},8,["size"])]),_:1})])}}}),w=r(71241);const A=(0,w.A)(k,[["__scopeId","data-v-11ac111e"]]);var _=A},6301:function(e,a,r){r.d(a,{A:function(){return c}});var t=r(60168),n=r(39578),i=function(){return n.A.Date.now()},l=i,o=r(10754),u="Expected a function",d=Math.max,f=Math.min;function s(e,a,r){var n,i,s,c,v,m,p=0,g=!1,h=!1,b=!0;if("function"!=typeof e)throw new TypeError(u);function y(a){var r=n,t=i;return n=i=void 0,p=a,c=e.apply(t,r),c}function k(e){return p=e,v=setTimeout(_,a),g?y(e):c}function w(e){var r=e-m,t=e-p,n=a-r;return h?f(n,s-t):n}function A(e){var r=e-m,t=e-p;return void 0===m||r>=a||r<0||h&&t>=s}function _(){var e=l();if(A(e))return F(e);v=setTimeout(_,w(e))}function F(e){return v=void 0,b&&n?y(e):(n=i=void 0,c)}function W(){void 0!==v&&clearTimeout(v),p=0,n=m=i=v=void 0}function C(){return void 0===v?c:F(l())}function R(){var e=l(),r=A(e);if(n=arguments,i=this,m=e,r){if(void 0===v)return k(m);if(h)return clearTimeout(v),v=setTimeout(_,a),y(m)}return void 0===v&&(v=setTimeout(_,a)),c}return a=(0,o.A)(a)||0,(0,t.A)(r)&&(g=!!r.leading,h="maxWait"in r,s=h?d((0,o.A)(r.maxWait)||0,a):s,b="trailing"in r?!!r.trailing:b),R.cancel=W,R.flush=C,R}var c=s},10754:function(e,a,r){r.d(a,{A:function(){return h}});var t=/\s/;function n(e){var a=e.length;while(a--&&t.test(e.charAt(a)));return a}var i=n,l=/^\s+/;function o(e){return e?e.slice(0,i(e)+1).replace(l,""):e}var u=o,d=r(60168),f=r(18095),s=NaN,c=/^[-+]0x[0-9a-f]+$/i,v=/^0b[01]+$/i,m=/^0o[0-7]+$/i,p=parseInt;function g(e){if("number"==typeof e)return e;if((0,f.A)(e))return s;if((0,d.A)(e)){var a="function"==typeof e.valueOf?e.valueOf():e;e=(0,d.A)(a)?a+"":a}if("string"!=typeof e)return 0===e?e:+e;e=u(e);var r=v.test(e);return r||m.test(e)?p(e.slice(2),r?2:8):c.test(e)?s:+e}var h=g},17582:function(e,a,r){r.d(a,{A:function(){return P}});var t=r(12739),n=r(57179),i=1,l=2;function o(e,a,r,o){var u=r.length,d=u,f=!o;if(null==e)return!d;e=Object(e);while(u--){var s=r[u];if(f&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}while(++u<d){s=r[u];var c=s[0],v=e[c],m=s[1];if(f&&s[2]){if(void 0===v&&!(c in e))return!1}else{var p=new t.A;if(o)var g=o(v,m,c,e,a,p);if(!(void 0===g?(0,n.A)(m,v,i|l,o,p):g))return!1}}return!0}var u=o,d=r(60168);function f(e){return e===e&&!(0,d.A)(e)}var s=f,c=r(96166);function v(e){var a=(0,c.A)(e),r=a.length;while(r--){var t=a[r],n=e[t];a[r]=[t,n,s(n)]}return a}var m=v;function p(e,a){return function(r){return null!=r&&(r[e]===a&&(void 0!==a||e in Object(r)))}}var g=p;function h(e){var a=m(e);return 1==a.length&&a[0][2]?g(a[0][0],a[0][1]):function(r){return r===e||u(r,e,a)}}var b=h,y=r(29615),k=r(6865),w=r(71191),A=r(13708),_=1,F=2;function W(e,a){return(0,w.A)(e)&&s(a)?g((0,A.A)(e),a):function(r){var t=(0,y.A)(r,e);return void 0===t&&t===a?(0,k.A)(r,e):(0,n.A)(a,t,_|F)}}var C=W,R=r(69937),N=r(23506);function x(e){return function(a){return null==a?void 0:a[e]}}var z=x,S=r(12623);function T(e){return function(a){return(0,S.A)(a,e)}}var V=T;function E(e){return(0,w.A)(e)?z((0,A.A)(e)):V(e)}var I=E;function O(e){return"function"==typeof e?e:null==e?R.A:"object"==typeof e?(0,N.A)(e)?C(e[0],e[1]):b(e):I(e)}var P=O},31112:function(e,a,r){r(97042)},71066:function(e,a,r){r.d(a,{P:function(){return o},i:function(){return u}});var t=r(81387),n=r(27007),i=r(56768),l=r(90144);const o=e=>{console.log("接收到的第三方参数",e);const a=(0,l.KR)(0),r=(0,i.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(r){console.log(r),a={}}return a});console.log("thirdParams",r);const t=(t,n,i)=>{console.log("onCloseThirdDialog",n,i),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:r.value.path,rowData:n?JSON.parse(JSON.stringify(n)):void 0,data:i?JSON.parse(JSON.stringify(i)):void 0,isSuccess:t}},"*")},o=(e,r)=>{switch(e){case"setToken":r.token&&(0,n.WG)(r.token);break;case"dialogIndex":a.value=r;break;case"refreshData":break;case"message":break}},u=e=>{o(e.data.type,e.data.data)};return(0,i.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",u,!1)}),(0,i.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",u)}),{thirdParams:r,onCloseThirdDialog:t}},u=()=>{let e;const a=(0,t.lq)(),r=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,i.sV)(()=>{(0,n.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),r()},18e4))}),(0,i.hi)(()=>{e&&clearInterval(e)}))}}}]);