"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[753,1066],{20753:function(e,a,l){l.r(a),l.d(a,{default:function(){return k}});var t=l(25136),o=(l(97042),l(69957),l(21929)),n=(l(98421),l(76408)),u=(l(87535),l(32465),l(18888)),s=(l(3172),l(85415)),d=(l(22243),l(7409),l(65451)),r=(l(63390),l(44114),l(18111),l(20116),l(7588),l(61701),l(56768)),i=l(90144),m=l(45130),c=l(24232),p=l(27007),v=l(92380),g=l(71066),f=l(82572),h=(0,r.pM)({__name:"editColumnBind",props:{rowData:{},dataset:{},supportColumnWidth:{type:Boolean,default:!1},columnList:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,f.l5)(),l=e,h=(0,r.EW)(()=>a.defaultFormItemSize),{thirdParams:y,onCloseThirdDialog:k}=(0,g.P)(l),b=(0,i.KR)(),w=(0,i.KR)({columnId:void 0,columnName:void 0}),I={columnId:[{required:!0,message:"字段名称不能为空",trigger:"blur"}]},_=(0,r.EW)(()=>D.value.dataset.datasetType===v.DatasetType.API),C=(0,r.EW)(()=>{let e=D.value.columnList.map(e=>({...e}));return(0,p.BN)(e,"columnId")}),W=(0,r.EW)(()=>null==w.value.columnId||""===w.value.columnId?[]:(0,p.Zi)(C.value,w.value.columnId,"columnId")),D=(0,r.EW)(()=>({rowData:l.rowData||y.value.rowData,dataset:l.dataset||y.value.dataset||{},supportColumnWidth:y.value&&null!=y.value.supportColumnWidth?y.value.supportColumnWidth:l.supportColumnWidth,columnList:(l.columnList||y.value.columnList||[]).map(e=>({...e,children:void 0}))})),N=()=>{l.dialog?l.dialog.cancel():k(!1)},R=()=>{b.value.validate(e=>{e&&(l.dialog?l.dialog.submit(w.value):k(!1,D.value.rowData,w.value))})},S=e=>{w.value.columnId=Array.isArray(e)?e[e.length-1]:void 0},L=e=>{const a=Array.isArray(e)?e[e.length-1]:e;let l=(0,p.PH)(D.value.columnList,a,"columnId"),t=[];if(Array.isArray(e))e.forEach((e,a)=>{if(a>0){let a=D.value.columnList.find(a=>a.columnId===e);a&&t.push(a)}});else{let a=D.value.columnList.find(a=>a.columnId===e);a&&t.push(a)}t&&(w.value={...l,columnName:t.map(e=>e.columnName),showName:t[t.length-1].columnComment})};return(0,r.sV)(()=>{D.value.rowData&&(w.value={...D.value.rowData})}),(e,a)=>{const l=d.S2,p=s.P9,v=s.AV,g=u._m,f=o.xE,y=n.uD,k=o.US,P=t.S2;return(0,r.uX)(),(0,r.Wv)(l,{class:"form-edit-widget-categroy-column third-party-dlg"},{default:(0,r.k6)(()=>[(0,r.bF)(k,{ref_key:"formEditWidgetCategroyColumn",ref:b,model:(0,i.R1)(w),class:"full-width-input form-box",rules:I,style:{width:"100%"},"label-width":"80px",size:(0,i.R1)(h),"label-position":"right",onSubmit:a[2]||(a[2]=(0,m.D$)(()=>{},["prevent"]))},{default:(0,r.k6)(()=>[(0,r.bF)(l,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(y,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(f,{label:"字段名称",prop:"columnId"},{default:(0,r.k6)(()=>[(0,i.R1)(_)?((0,r.uX)(),(0,r.Wv)(g,{key:1,options:(0,i.R1)(C),placeholder:"",clearable:"",modelValue:(0,i.R1)(W),"onUpdate:modelValue":[a[1]||(a[1]=e=>(0,i.i9)(W)?W.value=e:null),S],props:{label:"columnName",value:"columnId"},onChange:L},{default:(0,r.k6)(({data:e})=>[(0,r.bF)(l,{type:"flex",justify:"space-between",align:"middle"},{default:(0,r.k6)(()=>[(0,r.Lk)("span",null,(0,c.v_)(e.columnName),1)]),_:2},1024)]),_:1},8,["options","modelValue"])):((0,r.uX)(),(0,r.Wv)(v,{key:0,modelValue:(0,i.R1)(w).columnId,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,i.R1)(w).columnId=e),placeholder:"",clearable:"",onChange:L},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,i.R1)(D).columnList,e=>((0,r.uX)(),(0,r.Wv)(p,{key:e.columnId,label:e.columnName,value:e.columnId,disabled:e.disabled},{default:(0,r.k6)(()=>[(0,r.bF)(l,{type:"flex",justify:"space-between",align:"middle"},{default:(0,r.k6)(()=>[(0,r.Lk)("span",null,(0,c.v_)(e.columnName),1)]),_:2},1024)]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["model","size"]),(0,r.bF)(l,{class:"no-scroll menu-box",type:"flex",justify:"end"},{default:(0,r.k6)(()=>[(0,r.bF)(P,{size:(0,i.R1)(h),plain:!0,onClick:N},{default:(0,r.k6)(()=>a[3]||(a[3]=[(0,r.eW)(" 取消 ")])),_:1,__:[3]},8,["size"]),(0,r.bF)(P,{type:"primary",size:(0,i.R1)(h),onClick:R},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)(" 保存 ")])),_:1,__:[4]},8,["size"])]),_:1})]),_:1})}}});const y=h;var k=y},71066:function(e,a,l){l.d(a,{P:function(){return s},i:function(){return d}});var t=l(81387),o=l(27007),n=l(56768),u=l(90144);const s=e=>{console.log("接收到的第三方参数",e);const a=(0,u.KR)(0),l=(0,n.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(l){console.log(l),a={}}return a});console.log("thirdParams",l);const t=(t,o,n)=>{console.log("onCloseThirdDialog",o,n),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:l.value.path,rowData:o?JSON.parse(JSON.stringify(o)):void 0,data:n?JSON.parse(JSON.stringify(n)):void 0,isSuccess:t}},"*")},s=(e,l)=>{switch(e){case"setToken":l.token&&(0,o.WG)(l.token);break;case"dialogIndex":a.value=l;break;case"refreshData":break;case"message":break}},d=e=>{s(e.data.type,e.data.data)};return(0,n.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",d,!1)}),(0,n.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",d)}),{thirdParams:l,onCloseThirdDialog:t}},d=()=>{let e;const a=(0,t.lq)(),l=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,n.sV)(()=>{(0,o.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),l()},18e4))}),(0,n.hi)(()=>{e&&clearInterval(e)}))}}}]);