"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,5342],{35342:function(e,a,s){s.r(a),s.d(a,{default:function(){return k}});var t=s(25136),o=(s(97042),s(69957),s(21929)),n=(s(98421),s(65451)),r=(s(63390),s(76408)),l=(s(87535),s(32465),s(14022)),i=(s(72343),s(56768)),d=s(90144),c=s(45130),u=s(61617),p=s(71066),g=s(82572);const f={class:"form-single-fragment third-party-dlg",style:{position:"relative"}};var m=(0,i.pM)({__name:"stopTask",props:{processInstanceId:{},taskId:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,g.l5)(),s=e,{thirdParams:m,onCloseThirdDialog:h}=(0,p.P)(s),k=(0,i.EW)(()=>a.defaultFormItemSize||m.value.defaultFormItemSize?.value),v=(0,d.KR)(),I=(0,d.KR)({reason:void 0}),b={reason:[{required:!0,message:"请输入终止原因",trigger:"blur"}]},w=(0,i.EW)(()=>({processInstanceId:s.processInstanceId||m.value.processInstanceId,taskId:s.taskId||m.value.taskId})),y=()=>{s.dialog?s.dialog.cancel():h(!1)},S=()=>{v.value.validate(e=>{e&&u.wI.stopProcessInstance({processInstanceId:w.value.processInstanceId,taskId:w.value.taskId,stopReason:I.value.reason}).then(()=>{s.dialog?s.dialog.submit(!0):h(!0)}).catch(e=>{console.warn(e)})})};return(e,a)=>{const s=l.WK,u=o.xE,p=r.uD,g=n.S2,m=o.US,h=t.S2;return(0,i.uX)(),(0,i.CE)("div",f,[(0,i.bF)(m,{ref_key:"form",ref:v,model:(0,d.R1)(I),class:"full-width-input form-box",rules:b,style:{width:"100%"},"label-width":"80px",size:(0,d.R1)(k),"label-position":"right",onSubmit:a[1]||(a[1]=(0,c.D$)(()=>{},["prevent"]))},{default:(0,i.k6)(()=>[(0,i.bF)(g,{gutter:20},{default:(0,i.k6)(()=>[(0,i.bF)(p,{span:24},{default:(0,i.k6)(()=>[(0,i.bF)(u,{label:"终止原因",prop:"reason"},{default:(0,i.k6)(()=>[(0,i.bF)(s,{class:"input-item",modelValue:(0,d.R1)(I).reason,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,d.R1)(I).reason=e),type:"textarea",clearable:!0,placeholder:"终止原因"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","size"]),(0,i.bF)(g,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end"},{default:(0,i.k6)(()=>[(0,i.bF)(h,{size:(0,d.R1)(k),plain:!0,onClick:y},{default:(0,i.k6)(()=>a[2]||(a[2]=[(0,i.eW)(" 取消 ")])),_:1,__:[2]},8,["size"]),(0,i.bF)(h,{type:"primary",size:(0,d.R1)(k),onClick:S},{default:(0,i.k6)(()=>a[3]||(a[3]=[(0,i.eW)(" 保存 ")])),_:1,__:[3]},8,["size"])]),_:1})])}}});const h=m;var k=h},71066:function(e,a,s){s.d(a,{P:function(){return l},i:function(){return i}});var t=s(81387),o=s(27007),n=s(56768),r=s(90144);const l=e=>{console.log("接收到的第三方参数",e);const a=(0,r.KR)(0),s=(0,n.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(s){console.log(s),a={}}return a});console.log("thirdParams",s);const t=(t,o,n)=>{console.log("onCloseThirdDialog",o,n),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:s.value.path,rowData:o?JSON.parse(JSON.stringify(o)):void 0,data:n?JSON.parse(JSON.stringify(n)):void 0,isSuccess:t}},"*")},l=(e,s)=>{switch(e){case"setToken":s.token&&(0,o.WG)(s.token);break;case"dialogIndex":a.value=s;break;case"refreshData":break;case"message":break}},i=e=>{l(e.data.type,e.data.data)};return(0,n.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",i,!1)}),(0,n.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",i)}),{thirdParams:s,onCloseThirdDialog:t}},i=()=>{let e;const a=(0,t.lq)(),s=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,n.sV)(()=>{(0,o.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),s()},18e4))}),(0,n.hi)(()=>{e&&clearInterval(e)}))}}}]);