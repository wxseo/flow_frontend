"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1640],{56439:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKdJREFUOE9j/P//PzMDBYARnwGNjY3Mt2/f5liyZMlXXHbgNcDU1DSKgYHB+vTp09lkGWBmZhb3798/+zNnziSPBANMTExaGRgYzNH8KsHAwCDAwMBwA03845kzZ4JBYvBYsLCw0P7//78IssI/f/64MzAw6LOwsHQhizMzM385duzYWRQDsIXySIsFbGFgZWVl/ufPH/VTp04tIislEpNJ8WYmYgwAALTpjBHjM6aDAAAAAElFTkSuQmCC"},64772:function(e,o,n){n.d(o,{A:function(){return Ae}});n(44114),n(18111),n(22489),n(20116),n(7588),n(61701);var t=n(56768),l=n(45130),i=n(24232),d=n(90144),s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAcpJREFUWEftmP9VgzAQxwsMYJ2gjIAwgLiBI9gJxAmsE0gnsCO4gXQAICPUDVgA8Ht94b1IQRJ+PeoLf/XRu9wn31y4S4zVwh9j4XwrDTh0ha5PQcdx1qZpvmPmvmEYtoQCLM/zB8ZYJmGrbHKhoOu6AcAIUOVhcRzfqTjI2jYBRgC8L8tymyTJ4a+BSG3Lsk6wuYH9AfZb2cCydq2AfNmiroEA6QCS7AjyBZBhl4/K/4MBKRjS4gmqf/DAQVEUTAWCbNM0PTb5jALIIXeAfFUFE+wbN9togBySltfpAWljchukyB4pEoj+owL2ADu7II195PEXAI8A9DWgqpJawUoxKGHTb5S9k4qKsynoeV6GRC+R6LdLBSwJDHVZqUuaU0ENSHX13M10NQt8WZ6xomsh36qPbCS8yzDWHhtHfPcrRSdZYkwkxEQIsPPBvnnDxtm1GU4CSL1gve5SuSIIUr8GAwHbO+5JAJvUwGdGbxLpTXKtCn7yD/Vj584RDGbLQRUo0VYD9lWu8vufCsoc3IcqV/lXtxmyZ5I+Vx+jsDYd/C/6Nn6dEcKYLo82o0TuGASxvhErQokM6iVRqbGcA7YeQwMOVV0rOFTBH27JC0c58yRJAAAAAElFTkSuQmCC",a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAZRJREFUWEftl9FVgzAUhgssUB990wmMMEBxgjpC3cBR3EBGsBMUBwBxg775aBcA/K8HeuItkaQJPT2ansNDm+TPdz8SSIPZmX+CM+ebeUDbO/S/DCZJck/GiqJ4sTXXj3dqEIBtB+gs11kQgXlA23XjDXqDRxjwu/gIaT+GeIPeIDcQx/EqCIJlXdcPVVXt5HbVg1oIMY+i6Llt23VZlpmJ1cE1CIgtIHKcSlY8DBB0UlniqgB5J0MOAXZwG/QXuNbI/D7xsMIywC8Af83bDgARmKLaDQa8YkDKB9CEYRjmKOCGQ3JAGQ55703TpNw65UMI5S26gnN5TmNAGqyClAF14SYBVEHC/Ce1wcQF3QWq5TdzvSnnBvtgbrJbZ9Rc6cJNZlABuV8+OuYmN6iCNIGb3CCD/KDv2K2XQ7uVPxFOZlA1se7vk20SXYCxfh5wzNBY+581uEXl2Vj1jtrphHSl+y4WeE29OZrYKAaAt3g80Vto/1Edtx7RY26Ubt95h9PTE49x+p/EnvEwwQPaWvUGbQ1+AXhdtTj7I0ICAAAAAElFTkSuQmCC",A="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAydJREFUWEftV+1x2kAUtKAAuwPbFUSBAkIqMK7A0AGuIHIFtiuwXIGhguACALmCQAemAFB2Ne80h6z7kEQm/JBmGJB0d29vd9+7R3B24ldw4vjOWoBNFWoZbBlsykDT+UfxYBiGV0EQXOpg0jTdJEmy/m8AAeqm0+kMAWAIcBdlQADyE8+n+/1+CrCzOmArM9jr9X4h0KQAagswiQ4A70Pcn6tnBItn0WKxeK4C1Btgv9+/Q5AIQa4YAL8/8BULO6VSUnpheYR532TeWoC++gB1AkSQi263+0IpJcA7QEWQbO4TQI3BOgOAfVJAKf1utxtjHdrAeFkByqIvwhplnCyXy7gKsOJYWIRsPlF+rLfGZgnSuFkjQFmIzFFOsjZyZSU3hODparV6t21CpI8x9oesPzZtvBRgAdwDJkemgLQApHtEsJE+BpuiP+9tEiIOPc2kIwmlIL8AxCRKmgUzTdJ8RX/+xj0zNmOa34oZ/Ezgs58OkJRcKRWDjLG+0QOAAMfy8egDjmOQ2fQjs/sDbA2VBUTCKRMC754RdGKTvKDYPcbTo9mVAywMMnpCDwSAKe/B0nXRnwQJdv/wPWqfs1qY4mcTZccrFl+XrJq8A8pLWbHjQRlDCDqn3CLz3MYi3ykFWdShyHduOgeIYDwJmPoHFJsWZcb+K4CIucWmwhygoNfNeloSK5bqJgnmM1tv9SQBu290z9GSRIFUmcl7lx+lBtJn2TmLS/ks86Rk98C3zGDKKxJqpNvKp1BHSIIHixdZC1kW7vQxZE7ObONZy86IjYONDK+jjszIwb62ZSITh+9djYSUoMwCLqV8mgWemZfSz00ggVebZNqItG3saljSNnLGK2t8meYsoNJuxZh5I7OZEDxjjYuWgZOyxFMqYw3XDOuwAanfbumBWOlxz8Nd/fdg3YwRZGbqckRKboxzlZwbruPbtjkZLLIhpSjC82I7f9DyQ76w5G8BgeXnrM3P6l1lgGoivJT9YZJPDrYQdIv7KT/wLr8rX7UB6pHoU81b6hWUt/vLB+1RAPoEqjumBViXucZJ0jSw7/xWYl+mTONaBpsy+Bc8uR9HR5maOwAAAABJRU5ErkJggg==",p="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAUlJREFUWEftmTtOw0AQhmciR5TpKZJIyCLKJbBs09M4N4BrkCukDTewG6jJSj4CDSjIUOAiNS2KxTKbOAjlIVkZi3Ux2/kxu5+/Hbn4F4HGPM9P8Wt5DaBHADg09+wN/UIMsT5p3w263QWWcDEBzVrgxK7boxfsjSz7GH5DQaIgJMgRvmbvt3SB5+7Z2B7W7sobLgJ8e25BO7JtbhtxbXKZGIOa7GGT7G1YDJsAcnZGDHLsmVoxKAa5Brj10oNikGuAWy89+G8GfT8cI8IFd8Hdej1RSt0fmrfyFgdB+EmTdOoHhAelZldsQM/z+o7j9OsGLIriKU1T8/F7R2WDdYNVnU8Aq5qSLeaaEoNiUJKFI3tAftRHivstE4M1GWx+gNnsCPhPiP5IIXpiOwouQ/SI2uNyFaKbPikhb+gYgh404hgiIbipOYb4AavdXZAnU152AAAAAElFTkSuQmCC",r=n(56439),c=n(54428),g=n(22414),u=n(27007),m=n(82572),y=n(91542),E=(n(97042),n(37985),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAO9JREFUOE+tk69KREEUh78PDEajwWbRps1iFPYVBAXfwAcwuKLBB7CI1WDYF7AJLmw1KBqNC1aDQThy4K5crnd0YJ00w5zfN+fPb2TOZUkfEavAAFgEHtXbvtheQEQcAFfAQkt0re53IT8AEbEEvHXEM92m+tCG9AG2gEmhtF315i/AGvBcAGyr418BeRkRCUhQe70C6+pHDSDLuG/14RPYUe+KTYyIfPGwGVvG5QiXG8E7MGr2mcGF+pTn7yZGxDEwrPTVUD35d8ARcDZPBmmgjUrAizrtlrAHnFYCztXLLiB9v1IJmM78UPyNlSC+AGH+SxHMkfmgAAAAAElFTkSuQmCC"),C=n(57477),f=n(52920),N=(n(95509),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAqtJREFUWEftl8FLFHEUx7/vN2PuSoaBwXbTKDAoCCowOuShg4GBQdCsGOx4iaA/wYMQQYduXTrtrKDuRAeDhDoEdhGLiIKC9hDqUVBQUtzFnZkXM+vY7jLs/H47By/uYWF33vu+z3vv93tvl3DEL1KNb85Vb0HQOMDXAMqA0QPCOgE/GPSBy2K6YFJFVlcaIGftZkQqZYEw3EqcgTWwZlhZ+iIDIQXgB6dU5yIRDYBrsgwGUejufwIoeAu+23VJG55+QEtxEFIAE7YzD2A0TiwA45ABf1ZK2sVPU+S08osFyM3uXxGa+M5cn7EMSmAznjf02UQAZtF9SsST0iGD9gB+ZsyYsbL6w2QAr503xLivVoEaAgOfLUO/kQzAdhYJGKpvrmw1/BthGXp/IoAJ23kHYESpAocnkX/ljY7LiQBM23lJwJOwrzLZB1c0OAVYyBv63UQAuTlnVAjMqwCEAT32HheyJ14lA7A4RWl3lYCMDESYPQPbFW/vQnHs1GYiAN/ZtN1HBG6ZSXMQBk1ahvYsrmWxg8gXGJpi/dyA+x7A7VZVqHv2caWk3Ymbgr62FIBvmJ3725sSXV8J6ItbRhVv73pc6UMNaQDfITezPyh0sRx5JQ/S9zz3XmGs821c6SMBctZWj5bqvukJ9EYJEKgXzC+iAWpbyAM/J6JSlL/wsOlWdpYK5untSIAJu/oToEtx9JHnQOaKBMKNw+mwBX6P06Jr4/8qaYFRt3PjYBuf1yi9cuVswTy53nAIc8Vyn6COVaWRqxYdobbH1f5CNr12DHBcgcYKWFs9It29AUBXPFuq5o5X3jkTzoKGSWjazggRXVVVVLFn5m+WoS+0NYpVAsnaKu0CWVEVu0OAg5X7G8B5FYE2bBv+sDSfgWUCBtsQlXZp/ql+5C34B3FSMjDPMtqrAAAAAElFTkSuQmCC"),T="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAdhJREFUWEftl7FLHUEQh78fpLC0MBC7PFAwYECIAYOFFhYGElBIYWFqCfgnvE4ECzubdCGglYWCghYBK0lExEACpgjklYIWFhYWwsjIPZN7PN29PS42Tnk3O/Pt3Oxv9sQ9m4rmN7MRYBoYBJ4AncAx8B3YBj5LuoiNGw1gZp7sEzAeCN4ApiTtxUBEAWTJd4C+mKDAuYNK2g35xwKsAROhYC3vfwPPJF3etS4IYGYDwGHB5E33aUkrZQHmgHoiwLKk92UBVoF3iQDfJL0qC+DNN5oI0JBUKwuwAbxJBPgp6XlZgCVgNhFgU9LbsgB+/PwYptgHSR/LAnQAfzLZLQJxBvRKOi0F4IvNbAa4cydtktQlzYeIg0KUATwCtoCxUMDs/RfgdUgF3TcKIIPoAvaBpwEIH0YvQ6VvxogGyCCGgK8BgElJ65GVylfAzHy2DwO+23bmzxcDwReAX7f4eEPuSvIGvbZcBczsB9AfS5/olxOnGwAz892dJAYtuqxbkt+i/lbAzLy5/Lz/D6tJ8mZ9AHioQK4CrgF+Clx2qzS/pD5uakGrDvjF40WV2YEDSZtJUlwFWKFZUCmAmfm3PwJ6qkj0T8zcD0trD/ik84lXpeWu6vf+Ca4AyK6aIVjZBHYAAAAASUVORK5CYII=",v="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAdZJREFUWEftl79Lw0AUx78vjZBBxE526KAguPoHKKZQNRYtTUBxc3HUP0Bwc3HXVXAWzZUWaauCgVZwc3UQdHBw8AeCg9LokwhKm6ZN0GodkvXufe9z33cv947Q4Y86vD7+H4Be1I8JpLbbGQZbQhMJt26DA0bR4HYv/qlnambDeiFA6ECDAx2vgqAVkClk+iWSLhl8JTQxEDTOtwyDCoUAf+ZA+ijdJ5OsuFNjv9px+U2uMPiaumjEK3XM/CSS4q5VWlteRkbJWANjNei5cM9jsM3g+ayW3Wum0RRAL+kLxLTtiAC4bhBgyADiAGyQxzggE8gZf4aEpDlhnnhBeALoB/oY3nBEIBmERXPS3HIHBzkDRtHYALAExo1N9mhOy134lmG6kB6KUOSUQL3MvC6mxIoXeRAA9ViVoy9RQaBpAOfVanU0P5O/rdWrcyC1n4opEaUMYJCJd8WkmG2WuyAATqy6o3ZHe6JlAg0zc+VBeUhYCctJ68dXB5ApZg4lSEkQTu8f78etOevppwBO/MfGJOUMhBiATVMzl78AWv373V2M3z3h1fX46ZNfB1TbxfjNdXbl7nr8YkKA0IHOO+BXJrWPiV8pw+/edO2K+39vw3btLKjOO8R0KIQkz6h6AAAAAElFTkSuQmCC",R="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAGlQTFRFAAAA/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ButdgAAACN0Uk5TAL//IN8XHzvjE4P7U1/3P2OT5yQn74cEs9cUGNurDM/Du8dB45mUAAAAjUlEQVR4nNWR2w6CMBBE6VApWC+0CqIoCP//kaQk9AahTxicl2l65mFnN4p+I4IlERNY5MC+AsEWRjHo+kY2DRwSJYZ09CTz+dGrwE8uP4NTpVT7hdn8ypG7MwjIm+H3AqU35KPC8zXx+o3PrEXT4jsFOvTNvGYtIZQTs3hiH0H/W6dzzqjffxEI1txeA03WBoJ074xDAAAAAElFTkSuQmCC",w="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAalJREFUWEfF1r8uREEUx/HvLCESpVLBY1CwEgTRUfAcPAbPQUFF2KBAtULiEei0aChkR+6f/XP3zuw952zELTd37u8zc2bmrMP4+CsWabGfDq9x4Fa5s3zKWQb5BlvAMTCaj/8Bdtwap9rvqQGFcJ/HZV8xIVSAwMz7J6xGiAGC8DZGhRABFOFqRCXAEK5CDAQMES5GRAGi8JFJaH2DT8oefQbuiSBAHF5/g88neFyqOv5RRAkgCk/iJmZg4QW+XuF+tgoQvScKAHG4DRBEdACqcDughEgB6vDhAAWEy7vaTU9jkdTTsgfK13aNZecbnAGbJI0ldCbGp2H+GcamZLD2W+9NeJgLj+lmnf8d4KMJTQngkjqO638pgWcl24QXbFPjSIXQ3wO95fihxa7b4KR7DLUIO6ATnoiKF5EGYQMUwksAVTn0gFJ4ECBGJJ1Q04zymvefy3g7lpRD2o4j4dEVaCtNp6M4xeCy975S/ZdMshLh+64yvHIFhlgJUbgYIN6YmVgcrgIIEapwNaACoQ43ASIIU7gZkCKyLrqXVt1z6Na5DR+Gwb/+AsfR7uOR4PSBAAAAAElFTkSuQmCC",b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAABhQTFRFAAAA////////////////////////////I36dXwAAAAh0Uk5TAD+zU/v/QFR5oSx5AAAAo0lEQVR4nGXQTQoCMQwF4IBI9+IFXDhrF15ARLsVMRcYPEAXvT82P53kYVft42vShsjW4USwdo/PBYIr8x0BM5ABgAgAoiARA4k42IiC1z6IAg2MWAULlFgFC4R4Cw8GOXIO+EZnOVk7yd7/wRevPKlg0UbUc1DHzZIf1qRWj6Bq8RKfa9auz+9Xn0eZA2pzZB3BJAGcBDCSgZIMhCAgWhff/ADCNFiXJJxOcgAAAABJRU5ErkJggg==";const I={class:"add-node-btn"},h={class:"add-node-popover-body"},L={class:"item-wrapper"},k={class:"item-wrapper"},O={key:0,class:"btn",type:"button"};var S=(0,t.pM)({__name:"addNode",props:{childNodeP:{},nodeConfig:{},priorityLevel:{},isEnd:{type:Boolean},isGateway:{type:Boolean}},emits:["update:childNodeP"],setup(e,{emit:o}){const n=o,l=e,s=(0,d.KR)(!1),a=(0,d.KR)(Date.now()),A=(0,t.WQ)("bpmnModeler",{}),p=(0,t.WQ)("readonly",!1),r=(0,t.WQ)("flowEntry",()=>({})),c=e=>{s.value=!1;const o=A.get("elementRegistry").find(e=>"bpmn:StartEvent"===e.type);if(e===g.FlowNodeType.APPROVED_BY){const e=A.get("elementFactory").createShape({type:"bpmn:UserTask"});A.get("autoPlace").append(o,e);let t={nodeName:"审核人",error:!0,type:g.FlowNodeType.APPROVED_BY,element:(0,d.IG)(e),childNode:l.childNodeP,nodeUserList:[]};console.log("addNode add 1",t,l.childNodeP),n("update:childNodeP",t)}else if(e===g.FlowNodeType.SERVICE_TASK){const e=A.get("elementFactory").createShape({type:"bpmn:ServiceTask"});A.get("autoPlace").append(o,e);let t={nodeName:"服务任务",error:!0,type:g.FlowNodeType.SERVICE_TASK,element:(0,d.IG)(e),childNode:l.childNodeP,nodeUserList:[]};n("update:childNodeP",t)}else if(e===g.FlowNodeType.RECEIVE_TASK){const e=A.get("elementFactory").createShape({type:"bpmn:ReceiveTask"});A.get("autoPlace").append(o,e);let t={nodeName:"接收任务",error:!0,type:g.FlowNodeType.RECEIVE_TASK,element:(0,d.IG)(e),childNode:l.childNodeP,nodeUserList:[]};n("update:childNodeP",t)}else{let t={nodeName:e===g.FlowNodeType.CONDITIONAL_BRANCH?"网关":"并行网关",type:e,childNode:l.childNodeP?l.childNodeP:null,element:null,conditionNodes:[{nodeName:"",type:g.FlowNodeType.CONNECTING_LINE,element:null,priorityLevel:0,conditionStr:e===g.FlowNodeType.CONDITIONAL_BRANCH?"普通流转路径":"并行任务（同时进行）",nodeUserList:[],childNode:null},{nodeName:"",type:g.FlowNodeType.CONNECTING_LINE,element:null,priorityLevel:1,conditionStr:e===g.FlowNodeType.CONDITIONAL_BRANCH?"普通流转路径":"并行任务（同时进行）",nodeUserList:[],childNode:null}]};const i=A.get("elementFactory").createShape({type:e===g.FlowNodeType.CONDITIONAL_BRANCH?"bpmn:ExclusiveGateway":"bpmn:ParallelGateway"});t.element=(0,d.IG)(i);const s=A.get("elementFactory").createShape({type:e===g.FlowNodeType.CONDITIONAL_BRANCH?"bpmn:ExclusiveGateway":"bpmn:ParallelGateway"});t.endElement=(0,d.IG)(s),A.get("autoPlace").append(o,i),A.get("autoPlace").append(i,s),A.get("modeling").removeElements(i.outgoing),t.conditionNodes.forEach(e=>{e.element=(0,d.IG)(A.get("modeling").connect(i,s)),u(e)}),console.log("addNode add 2",t),n("update:childNodeP",t)}},u=e=>{if(console.log("addNode updateConnectData",e),"默认流转路径"===e.conditionStr&&A.get("modeling").updateProperties(e.element.source,{default:e.element}),e.extensionElements){let o=!1,n=null;e.extensionElements.values.forEach(t=>{"flowable:Properties"!==t.$type&&"flowable:properties"!==t.$type||(n=t,t.values.forEach(n=>{"priorityLevel"===n.name&&(o=!0,A.get("modeling").updateModdleProperties(t,n,{value:e.priorityLevel}))}))}),o||A.get("modeling").updateModdleProperties(e.extensionElements,n,{values:[...(n||{}).values,A.get("moddle").create("flowable:Property",{name:"priorityLevel",value:e.priorityLevel})]})}else e.extensionElements=A.get("moddle").create("bpmn:ExtensionElements",{values:[A.get("moddle").create("flowable:Properties",{values:[A.get("moddle").create("flowable:Property",{name:"priorityLevel",value:e.priorityLevel})]})]});A.get("modeling").updateProperties(e.element,{extensionElements:e.extensionElements,conditionExpression:e.conditionExpression})};return(e,o)=>{const n=y.tk,l=f.Vc;return(0,t.uX)(),(0,t.CE)("div",{class:"add-node-btn-box",key:a.value},[(0,t.Lk)("div",I,[(0,d.R1)(p)?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(l,{key:0,placement:"bottom",visible:s.value,"onUpdate:visible":o[5]||(o[5]=e=>s.value=e),trigger:"click",width:"auto"},{reference:(0,t.k6)(()=>[e.isGateway?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",O,[(0,t.bF)(n,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Plus))]),_:1})]))]),default:(0,t.k6)(()=>[(0,t.Lk)("div",h,[(0,d.R1)(r)().value.flowType===(0,d.R1)(g.FlowEntryType).NORMAL?((0,t.uX)(),(0,t.CE)("a",{key:0,class:"add-node-popover-item approver",onClick:o[0]||(o[0]=e=>c((0,d.R1)(g.FlowNodeType).APPROVED_BY))},o[6]||(o[6]=[(0,t.Lk)("div",{class:"item-wrapper"},[(0,t.Lk)("img",{class:"iconfont",src:N,alt:""}),(0,t.Lk)("img",{class:"iconfont",src:T,alt:""})],-1),(0,t.Lk)("p",null,"审批人",-1)]))):(0,t.Q3)("",!0),(0,d.R1)(r)().value.flowType===(0,d.R1)(g.FlowEntryType).NORMAL?((0,t.uX)(),(0,t.CE)("a",{key:1,class:"add-node-popover-item approver",onClick:o[1]||(o[1]=e=>c((0,d.R1)(g.FlowNodeType).SERVICE_TASK))},[(0,t.Lk)("div",L,[(0,t.bF)(n,{class:"iconfont"},{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Setting))]),_:1}),(0,t.bF)(n,{class:"iconfont"},{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Setting))]),_:1})]),o[7]||(o[7]=(0,t.Lk)("p",null,"服务任务",-1))])):(0,t.Q3)("",!0),(0,t.Lk)("a",{class:"add-node-popover-item approver",onClick:o[2]||(o[2]=e=>c((0,d.R1)(g.FlowNodeType).RECEIVE_TASK))},[(0,t.Lk)("div",k,[(0,t.bF)(n,{class:"iconfont"},{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Message))]),_:1}),(0,t.bF)(n,{class:"iconfont"},{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Message))]),_:1})]),(0,t.Lk)("p",null,(0,i.v_)((0,d.R1)(r)().value.flowType===(0,d.R1)(g.FlowEntryType).NORMAL?"接收任务":"自动化任务"),1)]),(0,t.Lk)("a",{class:"add-node-popover-item condition",onClick:o[3]||(o[3]=e=>c((0,d.R1)(g.FlowNodeType).CONDITIONAL_BRANCH))},o[8]||(o[8]=[(0,t.Lk)("div",{class:"item-wrapper"},[(0,t.Lk)("img",{class:"iconfont",src:v,alt:""}),(0,t.Lk)("img",{class:"iconfont",src:R,alt:""})],-1),(0,t.Lk)("p",null,"条件分支",-1)])),(0,t.Lk)("a",{class:"add-node-popover-item condition",onClick:o[4]||(o[4]=e=>c((0,d.R1)(g.FlowNodeType).PARALLEL_BRANCH))},o[9]||(o[9]=[(0,t.Lk)("div",{class:"item-wrapper"},[(0,t.Lk)("img",{class:"iconfont",src:w,alt:""}),(0,t.Lk)("img",{class:"iconfont",src:b,alt:""})],-1),(0,t.Lk)("p",null,"并行分支",-1)]))])]),_:1},8,["visible"]))])])}}}),B=n(71241);const P=(0,B.A)(S,[["__scopeId","data-v-74b5b74c"]]);var F=P;const G={key:0},D={key:0,class:"iconfont",src:E,alt:""},U={class:"editable-title"},x={class:"content"},Q={class:"text"},K={key:0,class:"placeholder"},M={key:1},V={key:0,class:"error_tip"},X={key:1,class:"branch-wrap"},Y={class:"branch-box-wrap"},_={class:"branch-box"},j={class:"condition-node"},J={class:"condition-node-box"},W=["onClick"],H={class:"title-wrapper"},Z={key:0,class:"editable-title"},z={key:1,class:"editable-title"},q={class:"priority-title"},$={class:"content"},ee={key:0,class:"error_tip"};var oe=(0,t.pM)({__name:"nodeWrap",props:{nodeConfig:{},parent:{},readonly:{type:Boolean,default:!1}},emits:["elementClick","update:nodeConfig"],setup(e,{emit:o}){const n=o,s=e;console.log("nodeWrap props",s),(0,t.Gt)("nodeConfig",s.nodeConfig),(0,t.Gt)("readonly",s.readonly),(0,t.Gt)("parent",s.parent);const a=(0,m.L4)(),A=(0,d.KR)(),p=(0,d.KR)(),r=["发起人","审核人","抄送人"],c=(0,d.KR)(!1),u=(0,d.KR)(""),E=(0,d.KR)(""),f=(0,d.KR)([]),N=(0,d.KR)(""),T=(0,t.WQ)("bpmnModeler",{}),v=(0,t.WQ)("groupMap",new Map),R=(0,t.WQ)("deptPostMap",new Map),w=(0,t.WQ)("postMap",new Map),b=(0,t.WQ)("roleMap",new Map),I=(0,t.WQ)("finishedTaskSet",(0,d.KR)([])),h=(0,t.WQ)("finishedSequenceFlowSet",(0,d.KR)([])),L=(0,t.WQ)("unfinishedTaskSet",(0,d.KR)([])),k=(0,t.EW)(()=>[g.FlowNodeType.ORIGINATOR,g.FlowNodeType.APPROVED_BY,g.FlowNodeType.CC_TO].indexOf(s.nodeConfig.type)>-1?"设置"+r[s.nodeConfig.type]:""),O=()=>{if(s.nodeConfig.type!==g.FlowNodeType.SERVICE_TASK&&s.nodeConfig.type!==g.FlowNodeType.RECEIVE_TASK)return["144, 145, 150","98, 168, 252","255, 164, 85"][s.nodeConfig.type];{let e,o=s.nodeConfig.element.businessObject.get("extensionElements");if(o){let n=o.values.filter(e=>"flowable:TaskInfo"===e.$type||"flowable:taskInfo"===e.$type)[0];n&&(e=n.data,e=e&&""!==e?JSON.parse(e):{})}if(!e)return["144, 145, 150","98, 168, 252","255, 164, 85"][s.nodeConfig.type];switch(e.actionType){case g.AutoTaskActionType.INSERT:case g.AutoTaskActionType.UPDATE:case g.AutoTaskActionType.DELETE:return"255, 164, 85";case g.AutoTaskActionType.QUERY_SINGLE_DATA:case g.AutoTaskActionType.AGGREGATE:case g.AutoTaskActionType.FORMULA:return"67, 92, 216";case g.AutoTaskActionType.HTTP:case g.AutoTaskActionType.LOAD_CACHE:case g.AutoTaskActionType.DELETE_CACHE:case g.AutoTaskActionType.SEND_MQ:return"126, 91, 191";default:return["144, 145, 150","98, 168, 252","255, 164, 85"][s.nodeConfig.type]}}},S=(0,t.EW)({get(){return s.nodeConfig},set(e){n("update:nodeConfig",e)}}),B=(0,t.EW)({get(){return s.nodeConfig.childNode},set(e){console.log("nodeConfig.childNode change",e,s.parent);const o={...s.nodeConfig};o.childNode=e,n("update:nodeConfig",o)}}),P=(0,t.EW)({get(){return s.nodeConfig.conditionNodes},set(e){console.log("nodeConfig.conditionNodes change",e)}}),oe=e=>{n("elementClick",e)},ne=(e=null)=>{const{type:o,element:n,conditionNodes:t}=s.nodeConfig;o!==g.FlowNodeType.CONDITIONAL_BRANCH&&o!==g.FlowNodeType.PARALLEL_BRANCH||null==e?(T.get("selection").select(n),oe(n)):(T.get("selection").select(t[e].element),oe(t[e].element))},le=e=>{console.log("updateConnectData",e),"默认流转路径"===e.conditionStr&&T.get("modeling").updateProperties(e.element.source,{default:e.element});let o=null;if(e.extensionElements){let n=!1;e.extensionElements.values&&e.extensionElements.values.forEach(t=>{"flowable:Properties"!==t.$type&&"flowable:properties"!==t.$type||(o=t,t.values.forEach(o=>{"priorityLevel"===o.name&&(n=!0,T.get("modeling").updateModdleProperties(t,o,{value:e.priorityLevel}))}))});const t=(o||{}).values;!n&&t&&T.get("modeling").updateModdleProperties(e.extensionElements,o,{values:[...t,T.get("moddle").create("flowable:Property",{name:"priorityLevel",value:e.priorityLevel})]})}else e.extensionElements=T.get("moddle").create("bpmn:ExtensionElements",{values:[T.get("moddle").create("flowable:Properties",{values:[T.get("moddle").create("flowable:Property",{name:"priorityLevel",value:e.priorityLevel})]})]});T.get("modeling").updateProperties(e.element,{extensionElements:e.extensionElements,conditionExpression:e.conditionExpression})},ie=(e,o)=>e.conditionNodes[o].conditionStr,de=()=>{const e=s.nodeConfig.conditionNodes;for(let o=0;o<s.nodeConfig.conditionNodes.length;o++)e[o].error=!ie(s.nodeConfig,o)&&o!==s.nodeConfig.conditionNodes.length-1},se=(e,o)=>{e.childNode?se(e.childNode,o):e.childNode=o},ae=()=>{const e=T.get("elementRegistry").find(e=>"bpmn:Process"===e.type);T.get("selection").select(e)},Ae=(e,o)=>{e&&(e.element&&o.push(e.element),e.endElement&&o.push(e.endElement),e.childNode&&Ae(e.childNode,o),e.conditionNodes&&e.conditionNodes.forEach(e=>{Ae(e.childNode,o)}))},pe=()=>{const e=s.parent;e&&(e.childNode=s.nodeConfig.childNode),T.get("modeling").removeElements([s.nodeConfig.element]),n("update:nodeConfig",s.nodeConfig.childNode)},re=()=>{if(s.readonly)return;let e=s.nodeConfig.conditionNodes.length,o={nodeName:"",type:g.FlowNodeType.CONNECTING_LINE,priorityLevel:e,extensionElements:void 0,conditionExpression:void 0,conditionStr:s.nodeConfig.type===g.FlowNodeType.CONDITIONAL_BRANCH?"普通流转路径":"并行任务（同时进行）",nodeUserList:[],element:(0,d.IG)(T.get("modeling").connect(s.nodeConfig.element,s.nodeConfig.endElement)),childNode:void 0};const t={...s.nodeConfig},l=t.conditionNodes;l.push(o),le(o),de(),n("update:nodeConfig",t)},ce=e=>{console.log("删除分支",s);const o=[],t={...s.nodeConfig},l=t.conditionNodes;2===l.length?(o.push(t.element),t.endElement&&o.push(t.endElement)):o.push(l[e]?.element),Ae(l[e],o),console.log("要删除的节点",o),T.get("modeling").removeElements(o),l.splice(e,1),l.length>1&&l.forEach((e,o)=>{e.priorityLevel=o,le(e)}),de(),console.log("delTerm nodeConfig >>>",{...t}),n("update:nodeConfig",t),1===l.length&&(t.childNode&&(l[0].childNode?se(l[0].childNode,t.childNode):l[0].childNode=t.childNode),n("update:nodeConfig",l[0].childNode||t.childNode))},ge=e=>(console.log("nodeConfig.nodeUserList",e.nodeUserList),e.nodeUserList?"ASSIGNEE"===e.groupType||"USERS"===e.groupType?e.nodeUserList.map(e=>a.getUserShowNameData[e.id]||e.name).toString():"DEPT"===e.groupType?e.nodeUserList.map(e=>v?.get(e.id)?.name||e.name).toString():"ROLE"===e.groupType?e.nodeUserList.map(e=>b?.get(e.id)?.name||e.name).toString():"POST"===e.groupType?e.nodeUserList.map(e=>"allDeptPost"===e.type?"全部 / "+(w?.get(e.id)?.name||e.name):"selfDeptPost"===e.type?"本部门 / "+(w?.get(e.id)?.name||e.name):"siblingDeptPost"===e.type?"同级部门 / "+(w?.get(e.id)?.name||e.name):"upDeptPost"===e.type?"上级部门 / "+(w?.get(e.id)?.name||e.name):"deptPost"===e.type?R?.get(e.id)?.deptName+" / "+(R?.get(e.id)?.postShowName||e.name):e.name).toString():"DEPT_POST_LEADER"===e.groupType?"发起人部门领导":"UP_DEPT_POST_LEADER"===e.groupType?"发起人上级部门领导":"VARIABLE"===e.groupType?"流程变量":"EXPRESSION"===e.groupType?"变量表达式":"API"===e.groupType?"接口服务":"OTHER_TASK_SUBMITTER"===e.groupType?"流程环节":void 0:""),ue=e=>{let o={};const n=s.nodeConfig;try{o=JSON.parse(e?.businessObject?.formKey),n.groupType=o.groupType}catch(t){console.warn("parse formKey error",e?.businessObject?.formKey)}return"ASSIGNEE"===o.groupType?(e?.businessObject?.assignee?.split(",")||[]).map(e=>({id:e,name:e})):"USERS"===o.groupType?(e?.businessObject?.candidateUsers?.split(",")||[]).map(e=>({id:e,name:e})):"DEPT"===o.groupType||"ROLE"===o.groupType?(e?.businessObject?.candidateGroups?.split(",")||[]).map(e=>({id:e,name:e})):"POST"===o.groupType?(e?.businessObject?.candidateGroups?.split(",")||[]).map(e=>{const o=e.split("__");return{id:o[1],name:o[1],type:o[0]}}):"DEPT_POST_LEADER"===o.groupType?[{name:"发起人部门领导",type:"DEPT_POST_LEADER"}]:"UP_DEPT_POST_LEADER"===o.groupType?[{name:"发起人上级部门领导",type:"DEPT_POST_LEADER"}]:"VARIABLE"===o.groupType?[{name:"变量",type:"VARIABLE"}]:"EXPRESSION"===o.groupType?[{name:"表达式",type:"EXPRESSION"}]:"API"===o.groupType?[{name:"接口服务",type:"API"}]:"OTHER_TASK_SUBMITTER"===o.groupType?[{name:"流程环节",type:"OTHER_TASK_SUBMITTER"}]:[]},me=e=>{const o=A.value?A.value[e]:null;let n=0;o&&(n=o.offsetLeft+o.querySelector(".condition-node-box").offsetLeft);let t=p.value?.offsetLeft||0;return n-t<0?"left":"right"},ye=()=>{const e=[...f.value];s.nodeConfig.conditionNodes&&s.nodeConfig.conditionNodes.forEach((o,n)=>{const t=A.value?A.value[n]:null;let l=0;t&&(l=t.offsetLeft+t.querySelector(".condition-node-box").offsetLeft);let i=p.value?.offsetLeft||0,d=l-i;e[n]=d>=0?l-i+170:i-(l+170)}),f.value=e},Ee=e=>{let o=s.nodeConfig.endElement?s.nodeConfig.endElement.id:s.nodeConfig.element.id;const n=e=>{e.childNode&&(o=e.childNode.endElement?e.childNode.endElement.id:e.childNode.element.id,n(e.childNode))};return n(e),I.value.indexOf(o)>-1&&-1===L.value.indexOf(o)};return(0,t.sV)(()=>{const e=s.nodeConfig;E.value=T.get("elementRegistry").find(e=>"bpmn:EndEvent"===e.type).id,T.on("selection.changed",({newSelection:e})=>{N.value=e[0]?.id}),T.on("element.changed",({element:o})=>{if(e.type===g.FlowNodeType.CONDITIONAL_BRANCH)console.log("bpmnModeler element.changed 1"),e.conditionNodes.forEach(e=>{if(o.id===e?.element?.id){let n=e.element.businessObject.get("extensionElements")||T.get("moddle").create("bpmn:ExtensionElements",{values:[]}),t=e.element.businessObject.get("conditionExpression")||T.get("moddle").create("bpmn:FormalExpression"),l=(n.values||[]).filter(e=>"flowable:CustomCondition"===e.$type)[0];e.element.source&&e.element.source.businessObject.default?.id===e.element.id?e.conditionStr="默认流转路径":e.element.businessObject.conditionExpression?l&&"operation"===l.type?e.conditionStr="内置按钮":e.conditionStr="条件流转路径":e.conditionStr="普通流转路径",e.extensionElements=n,e.conditionExpression=t,e.nodeName=o.businessObject.name||""}}),o.id===e?.element?.id&&(e.nodeName=o.businessObject.name||"网关");else if(e.type===g.FlowNodeType.PARALLEL_BRANCH)console.log("bpmnModeler element.changed 2"),e.conditionNodes.forEach(e=>{o.id===e?.element?.id&&(e.nodeName=o.businessObject.name||"")});else if(console.log("bpmnModeler element.changed 3",{...o}),o.id===e?.element?.id){let n="";e.type===g.FlowNodeType.ORIGINATOR?n="发起人":e.type===g.FlowNodeType.APPROVED_BY&&(n="审批人"),e.nodeName=o.businessObject.name||n,e.nodeUserList=ue(o),u.value=ge(s.nodeConfig)}}),e.type===g.FlowNodeType.APPROVED_BY?e.error=!ge(s.nodeConfig):e.type===g.FlowNodeType.CONDITIONAL_BRANCH&&de(),ye()}),(0,t.wB)(()=>s.nodeConfig,()=>{if(s.nodeConfig.type===g.FlowNodeType.SERVICE_TASK||s.nodeConfig.type===g.FlowNodeType.RECEIVE_TASK){let e,o=s.nodeConfig.element.businessObject.get("extensionElements");if(o){let n=o.values.filter(e=>"flowable:TaskInfo"===e.$type||"flowable:taskInfo"===e.$type)[0];n&&(e=n.data,e=e&&""!==e?JSON.parse(e):{})}u.value=e?g.AutoTaskActionType.getValue(e.actionType):g.AutoTaskActionType.getValue(g.AutoTaskActionType.INSERT)}else s.nodeConfig.nodeUserList&&(u.value=ge(s.nodeConfig))},{immediate:!0,deep:!0}),(0,t.wB)(()=>s.nodeConfig.conditionNodes,()=>{(0,t.dY)(ye)},{deep:!0}),(e,o)=>{const n=y.tk;return(0,t.uX)(),(0,t.CE)("div",{onClick:ae},[-1===[(0,d.R1)(g.FlowNodeType).CONDITIONAL_BRANCH,(0,d.R1)(g.FlowNodeType).PARALLEL_BRANCH].indexOf(e.nodeConfig.type)?((0,t.uX)(),(0,t.CE)("div",{key:0,class:(0,i.C4)(["node-wrap",{gateway:e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).CONDITIONAL_BRANCH,current:(0,d.R1)(L).indexOf(e.nodeConfig?.element?.id)>-1,success:(0,d.R1)(I).indexOf(e.nodeConfig?.element?.id)>-1&&-1===(0,d.R1)(L).indexOf(e.nodeConfig?.element?.id),start:e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).ORIGINATOR}])},[(0,t.Lk)("div",{class:(0,i.C4)(["node-wrap-box",(e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).ORIGINATOR?"start-node ":"")+(N.value===e.nodeConfig.element.id?"active ":"")+(0!==e.nodeConfig.nodeUserList.length||e.nodeConfig.type!==(0,d.R1)(g.FlowNodeType).APPROVED_BY||e.readonly?"":"error")])},[(0,t.Lk)("div",{onClick:o[0]||(o[0]=(0,l.D$)(e=>ne(),["stop"]))},[((0,t.uX)(),(0,t.CE)("div",{class:"title",key:e.nodeConfig.type,style:(0,i.Tr)(`background: rgb(${O()});`)},[e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).ORIGINATOR?((0,t.uX)(),(0,t.CE)("span",G,(0,i.v_)(e.nodeConfig.nodeName),1)):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).APPROVED_BY?((0,t.uX)(),(0,t.CE)("img",D)):(0,t.Q3)("",!0),e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).SERVICE_TASK?((0,t.uX)(),(0,t.Wv)(n,{key:1,class:"iconfont"},{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Setting))]),_:1})):(0,t.Q3)("",!0),e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).RECEIVE_TASK?((0,t.uX)(),(0,t.Wv)(n,{key:2,class:"iconfont"},{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Message))]),_:1})):(0,t.Q3)("",!0),(0,t.Lk)("span",U,(0,i.v_)(e.nodeConfig.nodeName),1),e.readonly?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(n,{key:3,class:"anticon anticon-close close",onClick:(0,l.D$)(pe,["stop"])},{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Close))]),_:1}))],64))],4)),(0,t.Lk)("div",x,[(0,t.Lk)("div",Q,[u.value?((0,t.uX)(),(0,t.CE)("span",M,(0,i.v_)(u.value),1)):((0,t.uX)(),(0,t.CE)("span",K,(0,i.v_)(k.value),1))])]),c.value&&e.nodeConfig.error?((0,t.uX)(),(0,t.CE)("div",V,o[7]||(o[7]=[(0,t.Lk)("i",{class:"anticon anticon-exclamation-circle"},null,-1)]))):(0,t.Q3)("",!0)])],2),((0,t.uX)(),(0,t.Wv)(F,{class:(0,i.C4)({active:(0,d.R1)(I).indexOf(e.nodeConfig?.element?.id)>-1}),childNodeP:B.value,"onUpdate:childNodeP":o[1]||(o[1]=e=>B.value=e),key:"a"+e.nodeConfig.type+e.nodeConfig?.element?.id,isGateway:[(0,d.R1)(g.FlowNodeType).CONDITIONAL_BRANCH,(0,d.R1)(g.FlowNodeType).PARALLEL_BRANCH].indexOf(e.nodeConfig.type)>-1,nodeConfig:S.value,"onUpdate:nodeConfig":o[2]||(o[2]=e=>S.value=e)},null,8,["class","childNodeP","isGateway","nodeConfig"]))],2)):(0,t.Q3)("",!0),[(0,d.R1)(g.FlowNodeType).CONDITIONAL_BRANCH,(0,d.R1)(g.FlowNodeType).PARALLEL_BRANCH].indexOf(e.nodeConfig.type)>-1?((0,t.uX)(),(0,t.CE)("div",X,[(0,t.Lk)("div",Y,[(0,t.Lk)("div",_,[(0,t.Lk)("button",{class:(0,i.C4)(["add-branch",{readonly:e.readonly}]),onClick:(0,l.D$)(re,["stop"]),ref_key:"addBranch",ref:p},(0,i.v_)(e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).CONDITIONAL_BRANCH?"添加条件":"添加分支"),3),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(P.value,(s,a)=>((0,t.uX)(),(0,t.CE)("div",{class:(0,i.C4)(["col-box",{active:(0,d.R1)(h).indexOf(s?.element?.id)>-1,done:Ee(s)}]),ref_for:!0,ref_key:"colBoxes",ref:A,key:e.nodeConfig?.element?.id+s?.element?.id+a},[((0,t.uX)(),(0,t.CE)("div",{class:(0,i.C4)(["top-line",me(a)]),key:"top-line"+e.nodeConfig?.element?.id+s?.element?.id+a,style:(0,i.Tr)("width:"+f.value[a]+"px")},null,6)),Ee(s)?((0,t.uX)(),(0,t.CE)("div",{class:(0,i.C4)(["end-line",me(a)]),key:"end-line"+e.nodeConfig?.element?.id+s?.element?.id+a,style:(0,i.Tr)("width:"+f.value[a]+"px")},null,6)):(0,t.Q3)("",!0),(0,t.Lk)("div",j,[(0,t.Lk)("div",J,[(0,t.Lk)("div",{onClick:(0,l.D$)(e=>ne(s.priorityLevel),["stop"]),class:(0,i.C4)(["auto-judge",{success:(0,d.R1)(h).indexOf(s?.element?.id)>-1,active:N.value===s.element.id}])},[(0,t.Lk)("div",H,[e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).CONDITIONAL_BRANCH?((0,t.uX)(),(0,t.CE)("span",Z,(0,i.v_)(s.nodeName||"满足条件"),1)):(0,t.Q3)("",!0),e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).PARALLEL_BRANCH?((0,t.uX)(),(0,t.CE)("span",z,(0,i.v_)(s.nodeName||"并行分支"),1)):(0,t.Q3)("",!0),(0,t.Lk)("div",null,[(0,t.Lk)("span",q,(0,i.v_)(e.nodeConfig.type===(0,d.R1)(g.FlowNodeType).CONDITIONAL_BRANCH?"优先级":"分支")+(0,i.v_)(a+1),1),e.readonly?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(n,{key:0,class:"anticon anticon-close close",onClick:(0,l.D$)(e=>ce(a),["stop"])},{default:(0,t.k6)(()=>[(0,t.bF)((0,d.R1)(C.Close))]),_:2},1032,["onClick"]))])]),(0,t.Lk)("div",$,(0,i.v_)(ie(e.nodeConfig,a)),1),c.value&&s.error?((0,t.uX)(),(0,t.CE)("div",ee,o[8]||(o[8]=[(0,t.Lk)("i",{class:"anticon anticon-exclamation-circle"},null,-1)]))):(0,t.Q3)("",!0)],10,W),((0,t.uX)(),(0,t.Wv)(F,{key:"a"+s.type+s?.element?.id,childNodeP:s.childNode,"onUpdate:childNodeP":e=>s.childNode=e,priorityLevel:s.priorityLevel,nodeConfig:S.value,"onUpdate:nodeConfig":o[3]||(o[3]=e=>S.value=e)},null,8,["childNodeP","onUpdate:childNodeP","priorityLevel","nodeConfig"]))])]),s.childNode?((0,t.uX)(),(0,t.Wv)(te,{key:"c"+s?.element?.id+(s?.childNode?.element?.id||""),nodeConfig:s.childNode,"onUpdate:nodeConfig":e=>s.childNode=e,readonly:e.readonly,parent:s,onElementClick:oe},null,8,["nodeConfig","onUpdate:nodeConfig","readonly","parent"])):(0,t.Q3)("",!0),a?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)(t.FK,{key:2},[o[9]||(o[9]=(0,t.Lk)("div",{class:"top-left-cover-line"},null,-1)),o[10]||(o[10]=(0,t.Lk)("div",{class:"bottom-left-cover-line"},null,-1))],64)),a===P.value.length-1?((0,t.uX)(),(0,t.CE)(t.FK,{key:3},[o[11]||(o[11]=(0,t.Lk)("div",{class:"top-right-cover-line"},null,-1)),o[12]||(o[12]=(0,t.Lk)("div",{class:"bottom-right-cover-line"},null,-1))],64)):(0,t.Q3)("",!0)],2))),128))]),((0,t.uX)(),(0,t.Wv)(F,{class:(0,i.C4)({active:(0,d.R1)(I).indexOf(e.nodeConfig?.childNode?.element?.id)>-1}),childNodeP:B.value,"onUpdate:childNodeP":o[4]||(o[4]=e=>B.value=e),key:"a"+e.nodeConfig.type+e.nodeConfig?.element?.id,isEnd:!0,nodeConfig:S.value,"onUpdate:nodeConfig":o[5]||(o[5]=e=>S.value=e)},null,8,["class","childNodeP","nodeConfig"]))])])):(0,t.Q3)("",!0),e.nodeConfig.childNode?((0,t.uX)(),(0,t.Wv)(te,{key:"b"+e.nodeConfig?.element?.id+(e.nodeConfig?.childNode?.element?.id||""),nodeConfig:B.value,"onUpdate:nodeConfig":o[6]||(o[6]=e=>B.value=e),onElementClick:oe,readonly:e.readonly,parent:e.nodeConfig},null,8,["nodeConfig","readonly","parent"])):(0,t.Q3)("",!0)])}}});const ne=oe;var te=ne;const le={class:"dingflow-design-header"},ie={class:"line"},de={class:"zoom"};var se=(0,t.pM)({__name:"index",props:{bpmnModeler:{},finishedInfo:{},readonly:{type:Boolean,default:!1},downloadProcessAsXml:{type:Function,default:()=>()=>{console.warn("default empty function {downloadProcessAsXml}")}},previewProcessXML:{type:Function,default:()=>()=>{console.warn("default empty function {previewProcessXML}")}},openFile:{type:Function,default:()=>()=>{console.warn("default empty function {openFile}")}}},emits:["elementClick"],setup(e,{expose:o,emit:n}){const y=e,E=(0,m.L4)(),C=(0,d.KR)(),f=(0,d.KR)({}),N=(0,d.KR)(100),T=(0,d.KR)([]),v=(0,d.KR)([]),R=new Map,w=(0,d.KR)([]),b=new Map,I=new Map;let h=(0,d.KR)([]);const L=new Map,k=(0,d.KR)([]),O=(0,d.KR)(!1),S=(0,d.KR)(!1),B=(0,d.KR)(0),P=(0,d.KR)(0),F=(0,d.KR)(0),G=(0,d.KR)(0),D=(0,d.KR)([]),U=(0,d.KR)(""),x=(0,t.EW)(()=>y.finishedInfo?y.finishedInfo.finishedSequenceFlowSet:[]),Q=(0,t.EW)(()=>y.finishedInfo?y.finishedInfo.finishedTaskSet:[]),K=(0,t.EW)(()=>y.finishedInfo?y.finishedInfo.unfinishedTaskSet:[]),M=e=>{if(1===e){if(50===N.value)return;N.value-=10}else{if(300===N.value)return;N.value+=10}},V=(e,o)=>{let n={};try{console.log("ding getNodeUserList",e),n=e?.businessObject?.formKey?JSON.parse(e?.businessObject?.formKey):JSON.parse(e?.businessObject?.$attrs["flowable:formKey"]),o.groupType=n.groupType}catch(t){console.warn(t)}return"ASSIGNEE"===n.groupType?(e?.businessObject?.assignee?.split(",")||e?.businessObject?.$attrs["flowable:assignee"]?.split(",")||[]).map(e=>(-1===T.value.indexOf(e)&&T.value.push(e),{id:e,name:e}))||[]:"USERS"===n.groupType?(e?.businessObject?.candidateUsers?.split(",")||e?.businessObject?.$attrs["flowable:candidateUsers"]?.split(",")||[]).map(e=>(-1===T.value.indexOf(e)&&T.value.push(e),{id:e,name:e}))||[]:"DEPT"===n.groupType||"ROLE"===n.groupType?(e?.businessObject?.candidateGroups?.split(",")||e?.businessObject?.$attrs["flowable:candidateGroups"]?.split(",")||[]).map(e=>({id:e,name:e}))||[]:"POST"===n.groupType?(e?.businessObject?.candidateGroups?.split(",")||e?.businessObject?.$attrs["flowable:candidateGroups"]?.split(",")||[]).map(e=>{const o=e.split("__");return{id:o[1],name:o[1],type:o[0]}})||[]:"DEPT_POST_LEADER"===n.groupType?[{name:"发起人部门领导",type:"DEPT_POST_LEADER"}]:"UP_DEPT_POST_LEADER"===n.groupType?[{name:"发起人上级部门领导",type:"DEPT_POST_LEADER"}]:"VARIABLE"===n.groupType?[{name:"流程变量",type:"VARIABLE"}]:"EXPRESSION"===n.groupType?[{name:"变量表达式",type:"EXPRESSION"}]:"API"===n.groupType?[{name:"接口服务",type:"API"}]:"OTHER_TASK_SUBMITTER"===n.groupType?[{name:"流程环节",type:"OTHER_TASK_SUBMITTER"}]:[]},X=e=>{const o={},n=(e,o)=>{let t=e?.incoming?.length>1?e:null;return t&&-1===o.indexOf(t.id)&&o.push(t.id),e&&e.outgoing.forEach(e=>{e.target&&n(e.target,o)}),o};e.conditionNodes.forEach(e=>{const t=n(e.element.target,[]);t.forEach(e=>{o[e]=Number.isInteger(o[e])?o[e]+1:1})});let t="";Object.keys(o).forEach(n=>{o[n]!==e.conditionNodes.length||t||-1!==D.value.indexOf(n)||(t=n)});let l=y.bpmnModeler?.get("elementRegistry").find(e=>["bpmn:UserTask","bpmn:ExclusiveGateway","bpmn:ParallelGateway"].indexOf(e.type)>-1&&e.id===t);return l&&D.value.push(l.id),l},Y=(e,o=null)=>{const n={},t=o?.target||(e.type===g.FlowNodeType.CONNECTING_LINE?e.element.target:e.element.outgoing[0].target);n.nodeName=t?.businessObject?.name||("bpmn:ExclusiveGateway"===t.type?"网关":"并行网关"),n.type="bpmn:ExclusiveGateway"===t.type?g.FlowNodeType.CONDITIONAL_BRANCH:g.FlowNodeType.PARALLEL_BRANCH,n.element=(0,d.IG)(t),n.conditionNodes=[],n.childNode=null,t.outgoing.forEach((e,o)=>{let l=e.businessObject.get("extensionElements")||y.bpmnModeler?.get("moddle").create("bpmn:ExtensionElements",{values:[]}),i=(l.values||[]).filter(e=>"flowable:CustomCondition"===e.$type||"flowable:customCondition"===e.$type)[0],s="";s="bpmn:ParallelGateway"===t.type?"并行任务（同时进行）":e.source.businessObject?.default?.id===e?.id?"默认流转路径":i&&"operation"===i.type?"内置按钮":e.businessObject.conditionExpression?"条件流转路径":"普通流转路径";let a=o;e?.businessObject?.extensionElements?.values&&e.businessObject.extensionElements.values.forEach(e=>{"flowable:Properties"!==e.$type&&"flowable:properties"!==e.$type||(e.values||e.$children).forEach(e=>{"priorityLevel"===e.name&&(a=e.value)})});let A={nodeName:e?.businessObject?.name||"",type:g.FlowNodeType.CONNECTING_LINE,priorityLevel:a,element:(0,d.IG)(e),conditionStr:s,extensionElements:e.businessObject.extensionElements,conditionExpression:e.businessObject.conditionExpression,childNode:null};n.conditionNodes.push(A)}),n.conditionNodes.sort((e,o)=>1*e.priorityLevel-1*o.priorityLevel),e.childNode=n;const l=X(n);return l&&("bpmn:ExclusiveGateway"!==l.type&&"bpmn:ParallelGateway"!==l.type||1!==l.outgoing.length?_(n,l.incoming[0]):(n.endElement=(0,d.IG)(l),1===l.outgoing[0]?.target?.incoming.length&&_(n,l.outgoing[0]))),n.conditionNodes.forEach(e=>{_(e)}),n},_=(e,o=null)=>{let n={};const t=o||(e.type===g.FlowNodeType.CONNECTING_LINE?e.element:e.element.outgoing&&e.element.outgoing[0]);if("bpmn:UserTask"!==t?.target.type||1!==t.target.incoming.length&&!o)"bpmn:ServiceTask"===t?.target.type?(n.nodeName=t.target?.businessObject?.name||"服务任务",n.type=g.FlowNodeType.SERVICE_TASK,n.element=(0,d.IG)(t.target),n.nodeUserList=[],n.childNode=null,_(n)):"bpmn:ReceiveTask"===t?.target.type?(n.nodeName=t.target?.businessObject?.name||"接收任务",n.type=g.FlowNodeType.RECEIVE_TASK,n.element=(0,d.IG)(t.target),n.nodeUserList=[],n.childNode=null,_(n)):n=("bpmn:ExclusiveGateway"===t?.target?.type||"bpmn:ParallelGateway"===t?.target?.type)&&t.target.outgoing.length>1&&(1===t.target.incoming.length||o)?Y(e,o):null;else{let e={};try{e=JSON.parse(t?.target?.businessObject?.formKey)}catch(l){console.warn(l)}n.nodeName=t.target?.businessObject?.name||"审核人",n.type=g.FlowNodeType.APPROVED_BY,n.groupType=e?e.groupType:"ASSIGNEE",n.element=(0,d.IG)(t.target),n.nodeUserList=V(t.target,n),_(n)}e.childNode=n},j=()=>{const e=y.bpmnModeler?.get("elementRegistry").find(e=>"bpmn:StartEvent"===e.type),o=e.outgoing[0]?.target;let n,t;"bpmn:UserTask"===o?.type?(n=o?.businessObject?.name||"发起人",t=g.FlowNodeType.ORIGINATOR):(n=o?.businessObject?.name||"接受任务",t=g.FlowNodeType.RECEIVE_TASK);const l={nodeName:n,type:t,element:(0,d.IG)(o),groupType:"",nodeUserList:[],childNode:null};l.nodeUserList=V(o,l),_(l),f.value=l},J=()=>new Promise((e,o)=>{let n={widgetType:"upms_dept",filter:{}};c.If.list(n,{showMask:!1}).then(o=>{let n=[];null==o.data.dataList&&(o.data.dataList=[]),o.data.dataList.forEach(e=>{const o={id:String(e.deptId),name:e.deptName,parentId:String(e.parentId),...e};b.set(o.id,o),n.push(o)}),w.value=(0,u.BN)(n),e(o)}).catch(e=>{o(e)})}),W=()=>new Promise((e,o)=>{let n={widgetType:"upms_post",filter:{}};c.If.list(n,{showMask:!1}).then(o=>{null==o.data.dataList&&(o.data.dataList=[]),o.data.dataList.forEach(e=>{const o={id:String(e.postId),name:e.postName,...e};L.set(o.id,o)}),k.value=o.data.dataList,e(o)}).catch(e=>{o(e)})}),H=()=>new Promise((e,o)=>{let n={widgetType:"upms_dept_post",filter:{}};c.If.list(n,{showMask:!1}).then(o=>{null==o.data.dataList&&(o.data.dataList=[]),o.data.dataList.forEach(e=>{I.set(e.deptPostId,e)}),h.value=o.data.dataList,e(o)}).catch(e=>{o(e)})}),Z=()=>new Promise((e,o)=>{let n={widgetType:"upms_role",filter:{}};c.If.list(n,{showMask:!1}).then(o=>{null==o.data.dataList&&(o.data.dataList=[]),v.value=o.data.dataList.map(e=>{let o={id:String(e.roleId),name:e.roleName,...e};return R.set(o.id,o),o}),e(o)}).catch(e=>{o(e)})}),z=()=>new Promise(e=>{let o={widgetType:"upms_user",fieldName:"loginName",fieldValues:T.value.join(",")};o.fieldValues=o.fieldValues.split(",").filter(e=>-1===["${startUserName}","${appointedAssignee}"].indexOf(e)).join(","),o.fieldValues?c.If.viewByIds(o).then(n=>{console.log("ProcessDingflowDesigner.getUserShowName.vieByIds",o,n);let t={...E.getUserShowNameData};(n.data||[]).forEach(e=>{t[e.loginName]=e.showName}),E.setUserShowNameData(t),e(n)}).catch(o=>{e(o)}):e(null)}),q=e=>{B.value=C.value.scrollTop,P.value=C.value.scrollLeft,F.value=e.clientX,G.value=e.clientY,S.value=!0},$=e=>{if(S.value){let o=F.value-e.clientX,n=G.value-e.clientY;C.value.scrollTop=n+B.value,C.value.scrollLeft=o+P.value}},ee=()=>{S.value=!1};(0,t.sV)(()=>{U.value=y.bpmnModeler?.get("elementRegistry").find(e=>"bpmn:EndEvent"===e.type).id,window.addEventListener("mouseup",ee);let e=[J(),H(),W(),Z()];Promise.all(e).then(()=>{j(),z().then(()=>{O.value=!0})})}),(0,t.hi)(()=>{window.removeEventListener("mouseup",ee)});const oe=n,ne=e=>{console.log("elementClick",e),oe("elementClick",e)},se=()=>{console.log("ProcessDingflowDesigner.refresh"),U.value=y.bpmnModeler?.get("elementRegistry").find(e=>"bpmn:EndEvent"===e.type).id,j(),z()},ae=()=>f.value;o({refresh:se,getNodeConfig:ae}),(0,t.Gt)("bpmnModeler",y.bpmnModeler),(0,t.Gt)("groupMap",b),(0,t.Gt)("deptPostMap",I),(0,t.Gt)("postMap",L),(0,t.Gt)("roleMap",R),(0,t.Gt)("finishedSequenceFlowSet",x),(0,t.Gt)("finishedTaskSet",Q),(0,t.Gt)("unfinishedTaskSet",K);const Ae=(0,d.KR)((new Date).getTime());return(0,t.wB)(f,(e,o)=>{console.log("nodeConfig changed",e,o),Ae.value=(new Date).getTime()}),(e,o)=>((0,t.uX)(),(0,t.CE)("div",{class:"dingflow-design",onMousedown:(0,l.D$)(q,["prevent"]),onMousemove:(0,l.D$)($,["prevent"])},[(0,t.Lk)("div",le,[(0,t.bo)((0,t.Lk)("div",{class:"img",onClick:o[0]||(o[0]=(...o)=>e.openFile&&e.openFile(...o))},o[6]||(o[6]=[(0,t.Lk)("img",{src:s,alt:""},null,-1)]),512),[[l.aG,!e.readonly]]),(0,t.bo)((0,t.Lk)("div",{class:"img",onClick:o[1]||(o[1]=(...o)=>e.downloadProcessAsXml&&e.downloadProcessAsXml(...o))},o[7]||(o[7]=[(0,t.Lk)("img",{src:a,alt:""},null,-1)]),512),[[l.aG,!e.readonly]]),(0,t.bo)((0,t.Lk)("div",{class:"img",onClick:o[2]||(o[2]=(...o)=>e.previewProcessXML&&e.previewProcessXML(...o))},o[8]||(o[8]=[(0,t.Lk)("img",{src:A,alt:""},null,-1)]),512),[[l.aG,!e.readonly]]),(0,t.bo)((0,t.Lk)("span",ie,null,512),[[l.aG,!e.readonly]]),(0,t.Lk)("div",de,[(0,t.Lk)("div",{class:(0,i.C4)(["img","zoom-out"+(50===(0,d.R1)(N)?" disabled":"")]),onClick:o[3]||(o[3]=e=>M(1))},o[9]||(o[9]=[(0,t.Lk)("img",{src:p,alt:""},null,-1)]),2),(0,t.Lk)("span",null,(0,i.v_)((0,d.R1)(N))+"%",1),(0,t.Lk)("div",{class:(0,i.C4)(["img","zoom-in"+(300===(0,d.R1)(N)?" disabled":"")]),onClick:o[4]||(o[4]=e=>M(2))},o[10]||(o[10]=[(0,t.Lk)("img",{src:r,alt:""},null,-1)]),2)])]),(0,t.Lk)("div",{class:"design-scroll",ref_key:"scroll",ref:C},[(0,d.R1)(f)&&(0,d.R1)(O)?((0,t.uX)(),(0,t.CE)("div",{class:"box-scale",id:"box-scale",key:(0,d.R1)(N)/100,style:(0,i.Tr)("transform: scale("+(0,d.R1)(N)/100+"); transform-origin: 50% 0px 0px;")},[((0,t.uX)(),(0,t.Wv)(te,{key:(0,d.R1)(Ae),nodeConfig:(0,d.R1)(f),"onUpdate:nodeConfig":o[5]||(o[5]=e=>(0,d.i9)(f)?f.value=e:null),bpmnModeler:e.bpmnModeler,onElementClick:ne,readonly:e.readonly},null,8,["nodeConfig","bpmnModeler","readonly"])),(0,t.Lk)("div",{class:(0,i.C4)(["end-node",{active:(0,d.R1)(Q).indexOf((0,d.R1)(U))>-1}])},o[11]||(o[11]=[(0,t.Lk)("div",{class:"end-node-circle"},null,-1),(0,t.Lk)("div",{class:"end-node-text"},"流程结束",-1)]),2)],4)):(0,t.Q3)("",!0)],512)],32))}});const ae=(0,B.A)(se,[["__scopeId","data-v-121163b8"]]);var Ae=ae}}]);