"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,5160],{71066:function(e,a,l){l.d(a,{P:function(){return n},i:function(){return i}});var t=l(81387),s=l(27007),o=l(56768),d=l(90144);const n=e=>{console.log("接收到的第三方参数",e);const a=(0,d.KR)(0),l=(0,o.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(l){console.log(l),a={}}return a});console.log("thirdParams",l);const t=(t,s,o)=>{console.log("onCloseThirdDialog",s,o),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:l.value.path,rowData:s?JSON.parse(JSON.stringify(s)):void 0,data:o?JSON.parse(JSON.stringify(o)):void 0,isSuccess:t}},"*")},n=(e,l)=>{switch(e){case"setToken":l.token&&(0,s.WG)(l.token);break;case"dialogIndex":a.value=l;break;case"refreshData":break;case"message":break}},i=e=>{n(e.data.type,e.data.data)};return(0,o.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",i,!1)}),(0,o.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",i)}),{thirdParams:l,onCloseThirdDialog:t}},i=()=>{let e;const a=(0,t.lq)(),l=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,o.sV)(()=>{(0,s.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),l()},18e4))}),(0,o.hi)(()=>{e&&clearInterval(e)}))}},95160:function(e,a,l){l.r(a),l.d(a,{default:function(){return I}});var t=l(25136),s=(l(97042),l(69957),l(21929)),o=(l(98421),l(65451)),d=(l(63390),l(85415)),n=(l(22243),l(7409),l(76408)),i=(l(87535),l(32465),l(14022)),r=(l(72343),l(18111),l(22489),l(56768)),u=l(90144),m=l(45130),b=l(26695),v=l(34894),g=l(92380),p=l(99080),c=l(71066),h=l(82572);const f={class:"form-single-fragment third-party-dlg",style:{position:"relative"}};var k=(0,r.pM)({__name:"editReportRelation",props:{masterDataset:{},rowData:{},datasetList:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,h.l5)(),l=e,{thirdParams:k,onCloseThirdDialog:D}=(0,c.P)(l),I=(0,r.EW)(()=>a.defaultFormItemSize||k.value.defaultFormItemSize?.value),R=(0,u.KR)(),w=(0,u.KR)({relationId:void 0,variableName:void 0,masterDatasetId:void 0,masterColumnId:void 0,slaveDatasetId:void 0,slaveColumnId:void 0,relationType:void 0}),C={variableName:[{required:!0,message:"请输入关联标识",trigger:"blur"}],relationType:[{required:!0,message:"请选择关联类型",trigger:"blur"}],masterDatasetId:[{required:!0,message:"请选择主数据集",trigger:"blur"}],masterColumnId:[{required:!0,message:"请选择主数据集关联字段",trigger:"blur"}],slaveDatasetId:[{required:!0,message:"请选择关联数据集",trigger:"blur"}],slaveColumnId:[{required:!0,message:"请选择关联数据集关联字段",trigger:"blur"}]},y=()=>new Promise((e,a)=>{let l={datasetId:P.value.masterDataset.datasetId};v.TR.view(l).then(a=>{e({dataList:a.data.columnList})}).catch(e=>{a(e)})}),F={loadData:y},V=(0,u.Kh)((0,p.B)(F)),_=()=>Promise.resolve({dataList:P.value.datasetList.filter(e=>e.datasetId!==P.value.masterDataset.datasetId&&e.datasetType!==g.DatasetType.SQL)}),L={loadData:_},S=(0,u.Kh)((0,p.B)(L)),T=()=>new Promise((e,a)=>{if(null==w.value.slaveDatasetId||""===w.value.slaveDatasetId)return void e([]);let l={datasetId:w.value.slaveDatasetId};v.TR.view(l).then(a=>{e({dataList:a.data.columnList})}).catch(e=>{a(e)})}),K={loadData:T},N=(0,u.Kh)((0,p.B)(K)),P=(0,r.EW)(()=>({rowData:l.rowData||k.value.rowData,masterDataset:l.masterDataset||k.value.masterDataset||{},datasetList:l.datasetList||k.value.datasetList||[]})),E=(0,r.EW)(()=>null!=P.value.rowData),W=(0,r.EW)(()=>P.value.masterDataset.datasetName),x=()=>{l.dialog?l.dialog.cancel():D(!1)},X=()=>{R.value.validate(e=>{if(!e)return;let a={reportDatasetRelationDto:{...w.value,masterDatasetId:P.value.masterDataset.datasetId}},t=E.value?v.$D.update(a):v.$D.add(a);t.then(()=>{b.nk.success("保存成功!"),l.dialog?l.dialog.submit(!0):D(!0,!0)}).catch(e=>{console.warn(e)})})},z=()=>{N.refresh(!1),w.value.slaveColumnId=void 0},q=()=>{null!=P.value.rowData&&(w.value={...P.value.rowData},V.onVisibleChange(!0),S.onVisibleChange(!0),N.onVisibleChange(!0))};return(0,r.sV)(()=>{q()}),(e,a)=>{const l=i.WK,b=s.xE,v=n.uD,p=d.P9,c=d.AV,h=o.S2,k=s.US,D=t.S2;return(0,r.uX)(),(0,r.CE)("div",f,[(0,r.bF)(k,{ref_key:"form",ref:R,model:(0,u.R1)(w),class:"full-width-input form-box",rules:C,style:{width:"100%"},"label-width":"120px",size:(0,u.R1)(I),"label-position":"right",onSubmit:a[5]||(a[5]=(0,m.D$)(()=>{},["prevent"]))},{default:(0,r.k6)(()=>[(0,r.bF)(h,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(v,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(b,{label:"关联标识",prop:"variableName"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{class:"input-item",modelValue:(0,u.R1)(w).variableName,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,u.R1)(w).variableName=e),clearable:!0,placeholder:"关联标识"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(v,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(b,{label:"关联类型",prop:"relationType"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{class:"input-item",modelValue:(0,u.R1)(w).relationType,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,u.R1)(w).relationType=e),placeholder:"关联类型"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,u.R1)(g.ReportRelationType).getList(),e=>((0,r.uX)(),(0,r.Wv)(p,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(v,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(b,{label:"主数据集"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{class:"input-item",value:(0,u.R1)(W),disabled:""},null,8,["value"])]),_:1})]),_:1}),(0,r.bF)(v,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(b,{label:"主数据集字段"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{class:"input-item",modelValue:(0,u.R1)(w).masterColumnId,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,u.R1)(w).masterColumnId=e),clearable:!0,filterable:"",placeholder:"数据集关联字段",loading:(0,u.R1)(V).loading,onVisibleChange:(0,u.R1)(V).onVisibleChange},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,u.R1)(V).dropdownList,e=>((0,r.uX)(),(0,r.Wv)(p,{key:e.columnId,value:e.columnId,label:e.columnName},null,8,["value","label"]))),128))]),_:1},8,["modelValue","loading","onVisibleChange"])]),_:1})]),_:1}),(0,r.bF)(v,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(b,{label:"关联数据集"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{class:"input-item",modelValue:(0,u.R1)(w).slaveDatasetId,"onUpdate:modelValue":a[3]||(a[3]=e=>(0,u.R1)(w).slaveDatasetId=e),clearable:!0,filterable:"",placeholder:"关联数据集",loading:(0,u.R1)(S).loading,onVisibleChange:(0,u.R1)(S).onVisibleChange,onChange:z},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,u.R1)(S).dropdownList,e=>((0,r.uX)(),(0,r.Wv)(p,{key:e.datasetId,value:e.datasetId,label:e.datasetName},null,8,["value","label"]))),128))]),_:1},8,["modelValue","loading","onVisibleChange"])]),_:1})]),_:1}),(0,r.bF)(v,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(b,{label:"关联数据集字段"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{class:"input-item",modelValue:(0,u.R1)(w).slaveColumnId,"onUpdate:modelValue":a[4]||(a[4]=e=>(0,u.R1)(w).slaveColumnId=e),clearable:!0,filterable:"",placeholder:"数据集关联字段",loading:(0,u.R1)(N).loading,onVisibleChange:(0,u.R1)(N).onVisibleChange},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,u.R1)(N).dropdownList,e=>((0,r.uX)(),(0,r.Wv)(p,{key:e.columnId,value:e.columnId,label:e.columnName},null,8,["value","label"]))),128))]),_:1},8,["modelValue","loading","onVisibleChange"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","size"]),(0,r.bF)(h,{class:"menu-box"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(h,{class:"no-scroll flex-box",type:"flex",justify:"end"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{size:(0,u.R1)(I),plain:!0,onClick:x},{default:(0,r.k6)(()=>a[7]||(a[7]=[(0,r.eW)(" 取消 ")])),_:1,__:[7]},8,["size"]),(0,r.bF)(D,{type:"primary",size:(0,u.R1)(I),onClick:a[6]||(a[6]=e=>X())},{default:(0,r.k6)(()=>a[8]||(a[8]=[(0,r.eW)(" 保存 ")])),_:1,__:[8]},8,["size"])]),_:1})]),_:1})]),_:1})])}}});const D=k;var I=D}}]);