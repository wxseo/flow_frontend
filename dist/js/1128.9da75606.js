"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,1128],{11128:function(e,l,a){a.r(l),a.d(l,{default:function(){return T}});var t=a(65451),u=(a(97042),a(63390),a(25136)),i=(a(69957),a(21929)),o=(a(98421),a(18888)),r=(a(3172),a(14022)),d=(a(72343),a(32465),a(85415)),n=(a(22243),a(7409),a(56768)),s=a(90144),p=a(45130),f=a(22414),m=a(61617),b=a(21016),v=a(27007),V=a(71066),c=a(82572);const g={class:"form-single-fragment third-party-dlg",style:{position:"relative",height:"100%"}};var y=(0,n.pM)({__name:"editSrcTableFilter",props:{dblinkId:{default:void 0},tableName:{default:void 0},data:{default:void 0},flowVariableList:{default:void 0},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const l=(0,c.l5)(),a=e,{thirdParams:y,onCloseThirdDialog:k}=(0,V.P)(a),T=(0,s.KR)(),h=(0,s.KR)({id:void 0,filterColumnName:"",filterType:0,valueType:f.AutoTaskValueType.FIXED,filterValue:""}),R=(0,s.KR)([]),w={filterColumnName:[{required:!0,message:"请选择过滤字段",trigger:"blur"}],filterType:[{required:!0,message:"请选择过滤类型",trigger:"blur"}],filterValue:[{required:!0,message:"请输入过滤值",trigger:"blur"}]},A=(0,n.EW)(()=>({dblinkId:a.dblinkId||y.value.dblinkId,tableName:a.tableName||y.value.tableName,data:a.data||y.value.data,flowVariableList:a.flowVariableList||y.value.flowVariableList})),F=()=>{h.value.filterValue=void 0},I=()=>{null!=A.value.dblinkId&&null!=A.value.tableName&&m.V7.listDblinkTableColumns({dblinkId:A.value.dblinkId,tableName:A.value.tableName}).then(e=>{R.value=e.data})},N=()=>{a.dialog?a.dialog.cancel():k(!1)},_=()=>{T.value.validate(e=>{if(e){let e;h.value.valueType===f.AutoTaskValueType.VARIABLE&&(e=Array.isArray(h.value.filterValue)?h.value.filterValue[h.value.filterValue.length-1]:void 0);let l={...h.value,filterValue:e||h.value.filterValue};null==l.id&&(l.id=(new Date).getTime()),a.dialog?a.dialog.submit(l):k(!0,A.value.data,l)}})};return(0,n.sV)(()=>{if(I(),A.value.data){let e=A.value.data.filterValue;A.value.data.valueType===f.AutoTaskValueType.VARIABLE&&(e=(0,v.Zi)(A.value.flowVariableList,e)),h.value={...A.value.data,valueType:A.value.data.valueType||0,filterValue:e}}}),(e,a)=>{const m=d.P9,v=d.AV,V=i.xE,c=r.WK,y=o._m,k=i.US,I=u.S2,C=t.S2;return(0,n.uX)(),(0,n.CE)("div",g,[(0,n.bF)(k,{ref_key:"form",ref:T,model:(0,s.R1)(h),class:"full-width-input form-box",rules:w,style:{width:"100%"},"label-width":"100px",size:(0,s.R1)(l).defaultFormItemSize,"label-position":"right",onSubmit:a[5]||(a[5]=(0,p.D$)(()=>{},["prevent"]))},{default:(0,n.k6)(()=>[(0,n.bF)(V,{label:"过滤字段",prop:"filterColumnName"},{default:(0,n.k6)(()=>[(0,n.bF)(v,{modelValue:(0,s.R1)(h).filterColumnName,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,s.R1)(h).filterColumnName=e),clearable:"",filterable:"",disabled:null!=(0,s.R1)(A).data,placeholder:"请选择过滤字段"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,s.R1)(R),e=>((0,n.uX)(),(0,n.Wv)(m,{key:e.columnName,label:e.columnName,value:e.columnName},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),(0,n.bF)(V,{label:"过滤类型"},{default:(0,n.k6)(()=>[(0,n.bF)(v,{modelValue:(0,s.R1)(h).filterType,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,s.R1)(h).filterType=e),placeholder:"请选择过滤类型"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,s.R1)(b.CriteriaFilterType).getList(),e=>((0,n.uX)(),(0,n.Wv)(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(V,{label:"字段值类型"},{default:(0,n.k6)(()=>[(0,n.bF)(v,{modelValue:(0,s.R1)(h).valueType,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,s.R1)(h).valueType=e),placeholder:"请选择过滤值类型",onChange:F},{default:(0,n.k6)(()=>[(0,n.bF)(m,{label:(0,s.R1)(f.AutoTaskValueType).getValue((0,s.R1)(f.AutoTaskValueType).FIXED),value:(0,s.R1)(f.AutoTaskValueType).FIXED},null,8,["label","value"]),(0,n.bF)(m,{label:(0,s.R1)(f.AutoTaskValueType).getValue((0,s.R1)(f.AutoTaskValueType).VARIABLE),value:(0,s.R1)(f.AutoTaskValueType).VARIABLE},null,8,["label","value"])]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(V,{label:"过滤值",prop:"filterValue"},{default:(0,n.k6)(()=>[(0,s.R1)(h).valueType===(0,s.R1)(f.AutoTaskValueType).FIXED?((0,n.uX)(),(0,n.Wv)(c,{key:0,modelValue:(0,s.R1)(h).filterValue,"onUpdate:modelValue":a[3]||(a[3]=e=>(0,s.R1)(h).filterValue=e),clearable:"",placeholder:"请输入过滤值"},null,8,["modelValue"])):(0,s.R1)(h).valueType===(0,s.R1)(f.AutoTaskValueType).VARIABLE?((0,n.uX)(),(0,n.Wv)(y,{key:1,options:(0,s.R1)(A).flowVariableList,props:{value:"id",label:"name",children:"children"},modelValue:(0,s.R1)(h).filterValue,"onUpdate:modelValue":a[4]||(a[4]=e=>(0,s.R1)(h).filterValue=e),clearable:"",filterable:"",placeholder:"请选择流程变量"},null,8,["options","modelValue"])):(0,n.Q3)("",!0)]),_:1})]),_:1},8,["model","size"]),(0,n.bF)(C,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end",style:{"padding-top":"10px"}},{default:(0,n.k6)(()=>[(0,n.bF)(I,{size:(0,s.R1)(l).defaultFormItemSize,plain:!0,onClick:a[6]||(a[6]=e=>N())},{default:(0,n.k6)(()=>a[8]||(a[8]=[(0,n.eW)(" 取消 ")])),_:1,__:[8]},8,["size"]),(0,n.bF)(I,{type:"primary",size:(0,s.R1)(l).defaultFormItemSize,onClick:a[7]||(a[7]=e=>_())},{default:(0,n.k6)(()=>a[9]||(a[9]=[(0,n.eW)(" 保存 ")])),_:1,__:[9]},8,["size"])]),_:1})])}}});const k=y;var T=k},71066:function(e,l,a){a.d(l,{P:function(){return r},i:function(){return d}});var t=a(81387),u=a(27007),i=a(56768),o=a(90144);const r=e=>{console.log("接收到的第三方参数",e);const l=(0,o.KR)(0),a=(0,i.EW)(()=>{let l={};try{e.thirdParamsString&&(l=JSON.parse(e.thirdParamsString))}catch(a){console.log(a),l={}}return l});console.log("thirdParams",a);const t=(t,u,i)=>{console.log("onCloseThirdDialog",u,i),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:l.value,dialogKey:e.dialogKey,path:a.value.path,rowData:u?JSON.parse(JSON.stringify(u)):void 0,data:i?JSON.parse(JSON.stringify(i)):void 0,isSuccess:t}},"*")},r=(e,a)=>{switch(e){case"setToken":a.token&&(0,u.WG)(a.token);break;case"dialogIndex":l.value=a;break;case"refreshData":break;case"message":break}},d=e=>{r(e.data.type,e.data.data)};return(0,i.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",d,!1)}),(0,i.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",d)}),{thirdParams:a,onCloseThirdDialog:t}},d=()=>{let e;const l=(0,t.lq)(),a=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==l.path.indexOf("/thirdParty/")&&((0,i.sV)(()=>{(0,u.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),a()},18e4))}),(0,i.hi)(()=>{e&&clearInterval(e)}))}}}]);