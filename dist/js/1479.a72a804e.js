"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1479],{30058:function(e,a,t){t.d(a,{A:function(){return g}});var l=t(65451),r=(t(97042),t(63390),t(91542)),o=(t(37985),t(25136)),i=(t(69957),t(76408)),n=(t(87535),t(18111),t(22489),t(56768)),s=t(90144),u=t(24232),d=t(57477);const p={style:{"margin-right":"4px","font-size":"14px"}},c={key:2,style:{"flex-grow":"1","min-width":"10px"}};var f=(0,n.pM)({__name:"index",props:{hasSearch:{type:Boolean,default:!0},hasReset:{type:Boolean,default:!0}},emits:["reset","search"],setup(e,{emit:a}){const t=(0,n.Ht)(),f=a,y=(0,s.KR)(!1),v=()=>{f("search")},g=()=>{f("reset")},k=(0,n.EW)(()=>{let e=t.default?t.default():[];return e.filter(e=>e.type&&e.type.name&&null!==e.type.name)}),m=(0,n.EW)(()=>{if(y.value){let e=k.value.length%4;return 0===e?24:6*(4-e)}return k.value.length<=3?6*(4-k.value.length):6});return(0,n.sV)(()=>{null!=t.operation&&(y.value=!0)}),(e,a)=>{const f=i.uD,b=o.S2,h=r.tk,A=l.S2;return(0,n.uX)(),(0,n.Wv)(A,{class:"flex-box",type:"flex"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,s.R1)(k),(e,a)=>((0,n.uX)(),(0,n.CE)(n.FK,{key:a},[a<((0,s.R1)(y)?(0,s.R1)(k).length:3)?((0,n.uX)(),(0,n.Wv)(f,{key:0,span:6},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.Wv)((0,n.$y)(e),{style:{width:"100%"}}))]),_:2},1024)):(0,n.Q3)("",!0)],64))),128)),e.hasSearch?((0,n.uX)(),(0,n.Wv)(f,{key:0,span:(0,s.R1)(m),class:"search-box"},{default:(0,n.k6)(()=>[(0,n.bF)(A,{type:"flex",align:"middle"},{default:(0,n.k6)(()=>[(0,n.bF)(b,{class:"search-btn",type:"default",plain:"",onClick:v,icon:(0,s.R1)(d.Search)},{default:(0,n.k6)(()=>a[1]||(a[1]=[(0,n.eW)(" 查询 ")])),_:1,__:[1]},8,["icon"]),e.hasReset?((0,n.uX)(),(0,n.Wv)(b,{key:0,type:"default",plain:"",onClick:g,style:{width:"72px"}},{default:(0,n.k6)(()=>a[2]||(a[2]=[(0,n.eW)("重置")])),_:1,__:[2]})):(0,n.Q3)("",!0),(0,s.R1)(k).length>3&&null==(0,s.R1)(t).operation?((0,n.uX)(),(0,n.Wv)(A,{key:1,type:"flex",align:"middle",class:"expand-btn",onClick:a[0]||(a[0]=e=>y.value=!(0,s.R1)(y))},{default:(0,n.k6)(()=>[(0,n.Lk)("span",p,(0,u.v_)((0,s.R1)(y)?"收起":"展开"),1),(0,n.bF)(h,null,{default:(0,n.k6)(()=>[(0,s.R1)(y)?((0,n.uX)(),(0,n.Wv)((0,s.R1)(d.ArrowUp),{key:0})):((0,n.uX)(),(0,n.Wv)((0,s.R1)(d.ArrowDown),{key:1}))]),_:1})]),_:1})):(0,n.Q3)("",!0),(0,s.R1)(t).operation?((0,n.uX)(),(0,n.CE)("div",c)):(0,n.Q3)("",!0),(0,n.RG)(e.$slots,"operation")]),_:3})]),_:3},8,["span"])):(0,n.Q3)("",!0)]),_:3})}}}),y=t(71241);const v=(0,y.A)(f,[["__scopeId","data-v-3d53564d"]]);var g=v},31479:function(e,a,t){t.r(a),t.d(a,{default:function(){return U}});var l=t(54880),r=(t(97042),t(51582),t(9267)),o=(t(48493),t(65451)),i=(t(63390),t(25136)),n=(t(69957),t(76408)),s=(t(87535),t(68368)),u=(t(81208),t(47001),t(60713),t(4311)),d=(t(25393),t(21929)),p=(t(98421),t(30058)),c=(t(32465),t(14022)),f=(t(72343),t(24404),t(38840)),y=(t(95304),t(2403)),v=(t(63266),t(50942)),g=(t(8696),t(44114),t(18111),t(22489),t(7588),t(61701),t(18237),t(56768)),k=t(24232),m=t(90144),b=t(45130),h=t(26695),A=t(81387),w=t(8588),R=t(31932),x=t(82572),D="data:image/png;base64,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",F=t(61617),N=t(22414);const I={style:{flex:"1",background:"white","border-radius":"4px",padding:"16px 24px"}},S={class:"card-list"},V={class:"card-content"},C={style:{"margin-left":"16px",color:"#7f8082"}};var T=(0,g.pM)({__name:"formAllStartTask",setup(e){(0,x.l5)();const{Plus:a,useDropdown:t,useTable:T,Dialog:K,mainContextHeight:J}=(0,w.x)(),{getUploadFileUrl:U,getUploadHeaders:X,getUploadActionUrl:E}=(0,R.v)(),Q=(0,A.rd)(),W=(0,m.KR)({categoryId:void 0,processDefinitionName:void 0}),O=(0,m.KR)({categoryId:void 0,processDefinitionName:void 0}),L=(0,m.KR)([]),_=(0,m.KR)(void 0),Z=(0,m.KR)(void 0),B=(0,m.KR)(),P=(0,g.EW)(()=>q.dataList.filter(e=>{let a=!0;return null!=O.value.processDefinitionName&&""!==O.value.processDefinitionName&&(a=-1!==e.processDefinitionName.indexOf(O.value.processDefinitionName)),null!=O.value.categoryId&&""!==O.value.categoryId&&"all"!==O.value.categoryId&&(a=a&&e.categoryId===O.value.categoryId),a})),Y=e=>(null==e&&(e={}),e={...e,flowEntryDtoFilter:{}},new Promise((a,t)=>{F.Dy.listAllByStartFlow(e).then(e=>{e.data.forEach(e=>{try{e.autoParamJson=JSON.parse(e.autoParamJson||"[]")}catch(a){console.error("JSON parse error",a),e.autoParamJson=[]}e.autoParamJson=e.autoParamJson.map(e=>({variableName:e.variableName,variableValue:e.variableValue}))}),a({dataList:e.data,totalCount:e.data.totalCount})}).catch(e=>{console.log(e),t(e)})})),z=()=>!0,M={loadTableData:Y,verifyTableParameter:z,paged:!0,orderFieldName:"entryId",ascending:!0},q=(0,m.Kh)(T(M)),H=()=>{O.value={...W.value}},G=()=>{W.value.processDefinitionName=void 0,H()},j=e=>{let a=e.imageData;return null==a||""===a?D:("string"===typeof a&&(a=JSON.parse(a)),U(a,{filename:a.filename}))},$=()=>{let e={};F.VU.dictFlowCategory(e).then(e=>{L.value=e.getList(),L.value.unshift({id:"all",name:"全部"}),Z.value=L.value[0],(0,g.dY)(()=>{B.value&&B.value.setCurrentKey(Z.value.id)})}).catch(e=>{console.error(e)})},ee=e=>{Z.value=e,W.value.categoryId=e.id,O.value.categoryId=e.id},ae=e=>{e.flowType===N.FlowEntryType.AUTO_TASK?(_.value=e,_.value.autoParamJson.forEach(e=>{e.variableValue=""})):(_.value=null,le(e))},te=e=>{let a={processDefinitionKey:e.processDefinitionKey,variableData:e.autoParamJson.reduce((e,a)=>(null!=a.variableValue&&""!==a.variableValue&&(e[a.variableName]=a.variableValue),e),{})};F.wI.startAuto(a).then(e=>{h.nk.success("启动成功！"),_.value=null}).catch(e=>{h.nk.error("启动失败！"),_.value=null})},le=e=>{let a={processDefinitionKey:e.processDefinitionKey};F.wI.viewInitialTaskInfo(a).then(a=>{if(a.data&&a.data.taskType===N.SysFlowTaskType.USER_TASK&&a.data.assignedMe){let t={processDefinitionKey:e.processDefinitionKey,formId:a.data.formId,routerName:a.data.routerName,readOnly:a.data.readOnly,taskName:"启动流程",taskKey:a.data.taskKey,flowEntryName:e.processDefinitionName,operationList:JSON.stringify((a.data.operationList||[]).filter(e=>e.type!==N.SysFlowTaskOperationType.CO_SIGN&&e.type!==N.SysFlowTaskOperationType.REVOKE&&e.type!==N.SysFlowTaskOperationType.SIGN_REDUCTION)),isDraft:"true",isPreview:"true",variableList:JSON.stringify(a.data.variableList)};Q.push({name:a.data.routerName||"handlerFlowTask",query:t})}else F.wI.startOnly({processDefinitionKey:e.processDefinitionKey}).then(e=>{h.nk.success("启动成功！")}).catch(e=>{})}).catch(e=>{})};return(0,g.sV)(()=>{$(),q.refreshTable()}),(0,g.n)(()=>{q.refreshTable()}),(e,a)=>{const t=v.qk,h=y.kA,A=f.Ik,w=l.Mb,R=c.WK,x=d.xE,D=p.A,F=d.US,N=u.Zq,T=l.ZO,K=s.o8,U=s.Up,X=n.uD,E=i.S2,Q=o.S2,O=r.kZ,Y=l.lX;return(0,g.uX)(),(0,g.Wv)(Y,{class:"advance-query-form advance-box flow-entry-card-list"},{default:(0,g.k6)(()=>[(0,g.bF)(w,{width:"300px"},{default:(0,g.k6)(()=>[(0,g.bF)(A,{class:"base-card",shadow:"never","body-style":{padding:"0px"},style:{border:"none",padding:"16px 0px"}},{default:(0,g.k6)(()=>[(0,g.bF)(h,{style:(0,k.Tr)({height:(0,m.R1)(J)-64+"px"})},{default:(0,g.k6)(()=>[(0,g.bF)(t,{ref_key:"categoryIdTree",ref:B,data:(0,m.R1)(L),props:{label:"name"},"node-key":"id","highlight-current":!0,"current-node-key":((0,m.R1)(Z)||{}).id,onNodeClick:ee},null,8,["data","current-node-key"])]),_:1},8,["style"])]),_:1})]),_:1}),(0,g.bF)(T,{style:{"margin-left":"15px",display:"flex","flex-direction":"column"}},{default:(0,g.k6)(()=>[(0,g.bF)(F,{ref:"formFlowEntry",model:(0,m.R1)(W),"label-width":"80px",size:e.defaultFormItemSize,"label-position":"right",onSubmit:a[2]||(a[2]=(0,b.D$)(()=>{},["prevent"]))},{default:(0,g.k6)(()=>[(0,g.bF)(D,{"item-width":350,onSearch:a[1]||(a[1]=e=>H()),onReset:G},{default:(0,g.k6)(()=>[(0,g.bF)(x,{label:"流程名称"},{default:(0,g.k6)(()=>[(0,g.bF)(R,{class:"filter-item",modelValue:(0,m.R1)(W).processDefinitionName,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,m.R1)(W).processDefinitionName=e),clearable:!0,placeholder:"流程名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model","size"]),(0,g.Lk)("div",I,[(0,g.bF)(h,{style:{height:"100%"}},{default:(0,g.k6)(()=>[(0,g.Lk)("div",S,[((0,g.uX)(!0),(0,g.CE)(g.FK,null,(0,g.pI)((0,m.R1)(P),(e,a)=>((0,g.uX)(),(0,g.Wv)(A,{key:a,class:"base-card card-item","body-style":{padding:"0px","border-radius":"10px"},shadow:"hover",onClick:a=>ae(e)},{default:(0,g.k6)(()=>[(0,g.Lk)("div",V,[(0,g.bF)(N,{src:j(e),class:"card-image"},null,8,["src"]),(0,g.Lk)("span",C,(0,k.v_)(e.processDefinitionName),1)])]),_:2},1032,["onClick"]))),128))])]),_:1})])]),_:1}),(0,m.R1)(_)?((0,g.uX)(),(0,g.Wv)(O,{key:0,title:"启动自动化任务",visible:!0,onClose:a[4]||(a[4]=e=>_.value=void 0)},{default:(0,g.k6)(()=>[(0,g.bF)(Q,null,{default:(0,g.k6)(()=>[(0,g.bF)(X,{span:24},{default:(0,g.k6)(()=>[(0,g.bF)(U,{data:(0,m.R1)(_).autoParamJson,height:"300px"},{default:(0,g.k6)(()=>[(0,g.bF)(K,{prop:"variableName",label:"参数名",width:"200px"}),(0,g.bF)(K,{prop:"variableValue",label:"参数值"},{default:(0,g.k6)(e=>[(0,g.bF)(R,{size:"mini",modelValue:e.row.variableValue,"onUpdate:modelValue":a=>e.row.variableValue=a,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1}),(0,g.bF)(X,{span:24,style:{"margin-top":"15px"}},{default:(0,g.k6)(()=>[(0,g.bF)(Q,{type:"flex",justify:"end"},{default:(0,g.k6)(()=>[(0,g.bF)(E,{size:"small",type:"primary",onClick:a[3]||(a[3]=e=>te((0,m.R1)(_)))},{default:(0,g.k6)(()=>a[5]||(a[5]=[(0,g.eW)(" 启动 ")])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1})):(0,g.Q3)("",!0)]),_:1})}}}),K=t(71241);const J=(0,K.A)(T,[["__scopeId","data-v-125544e6"]]);var U=J}}]);