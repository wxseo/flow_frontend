"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[378],{9924:function(e,a,l){l.d(a,{A:function(){return f}});var s=l(85415),t=(l(97042),l(22243),l(7409),l(44114),l(56768)),r=l(90144),n=l(27007),i=l(31372),o=l(93879);const u={class:"user-task-select"};var d=(0,t.pM)({__name:"index",props:{value:{},props:{default:()=>({label:"taskName",value:"taskId"})},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},size:{},placeholder:{},xml:{},finishedInfo:{}},emits:["update:value","change"],setup(e,{emit:a}){const l=a,d=e,c=(0,r.KR)(),p=(0,n.yk)(),f=(0,r.KR)([]),v=e=>{console.log(">>> ",e);const a=[];null!=e&&a.push(e),f.value=a,console.log(f.value),d.value!==(f.value[0]||{})[d.props.value]&&k()},h=e=>{e&&i.l.show("任务选择",o["default"],{area:["80vw","750px"],offset:"50px"},{xml:d.xml,path:"thirdSelectUserTask/"+p,finishedInfo:d.finishedInfo},{width:"1200px",height:"600px",pathName:"/thirdParty/thirdSelectUserTask"}).then(e=>{c.value.blur(),v(e)})},m=()=>{f.value=[],k()},k=()=>{let e=(f.value[0]||{})[d.props.value];l("update:value",e),l("change",e)};return(e,a)=>{const l=s.P9,n=s.AV;return(0,t.uX)(),(0,t.CE)("div",u,[(0,t.bF)(n,{"model-value":e.value,ref_key:"select",ref:c,style:{width:"100%"},disabled:e.disabled,size:e.size,clearable:e.clearable,placeholder:e.placeholder,teleported:!1,"popper-class":"user-task-select-popper",onVisibleChange:h,onClear:m},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,r.R1)(f),a=>((0,t.uX)(),(0,t.Wv)(l,{key:a[e.props.value],label:a[e.props.label],value:a[e.props.value]},null,8,["label","value"]))),128))]),_:1},8,["model-value","disabled","size","clearable","placeholder"])])}}}),c=l(71241);const p=(0,c.A)(d,[["__scopeId","data-v-1ca1d279"]]);var f=p},93879:function(e,a,l){l.r(a),l.d(a,{default:function(){return b}});var s=l(65451),t=(l(97042),l(63390),l(25136)),r=(l(19784),l(69957),l(18111),l(20116),l(7588),l(56768)),n=l(45130),i=l(90144),o=l(24232),u=l(57477),d=l(26695),c=l(47887),p=l(64772),f=l(22414),v=l(71066);const h={class:"process-viewer",style:{height:"640px"}},m={style:{position:"absolute",top:"0",left:"0",width:"100%"}};var k=(0,r.pM)({__name:"userTaskSelectDlg",props:{xml:{},finishedInfo:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=e,{thirdParams:l,onCloseThirdDialog:k}=(0,v.P)(a),y=(0,i.KR)(),b=(0,i.KR)(),g=(0,i.KR)(1),R=(0,i.KR)(!0);let w=null,x=(0,i.KR)();const I=(0,i.KR)(),A=(0,i.KR)(f.DiagramType.ORDINARY),_=(0,r.EW)(()=>({xml:a.xml||l.value.xml,finishedInfo:a.finishedInfo||l.value.finishedInfo})),T=()=>{g.value=1,w?.get("canvas").zoom("fit-viewport","auto")},z=(e=.1)=>{let a=Math.floor(100*g.value+100*e)/100;if(a>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");g.value=a,w?.get("canvas").zoom(g.value)},C=(e=.1)=>{let a=Math.floor(100*g.value-100*e)/100;if(a<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");g.value=a,w?.get("canvas").zoom(g.value)},E=()=>{y.value&&(y.value.innerHTML=""),w&&w.destroy(),w=null},M=e=>{null!=e&&null!=e.businessObject&&"bpmn:Process"!==e.type&&("bpmn:UserTask"===e.type?(x.value={taskId:e.businessObject.id,taskName:e.businessObject.name},a.dialog?a.dialog.submit(x.value):k(!0,void 0,x.value)):d.nk.warning("请选择用户任务节点！"))},D=e=>{if(I.value=e,R.value||!I.value||!w)return;let{finishedSequenceFlowSet:a,finishedTaskSet:l,unfinishedTaskSet:s}=I.value;const t=w.get("canvas"),r=w.get("elementRegistry");Array.isArray(a)&&a.forEach(e=>{if(null!=e){let a=r.get(e);if(null!=a){t.addMarker(e,"success");const l=a.businessObject.conditionExpression;l&&t.addMarker(e,"condition-expression")}}}),Array.isArray(l)&&l.forEach(e=>{if(null!=e){let a=r.get(e);a&&t.addMarker(e,"success")}}),Array.isArray(s)&&s.forEach(e=>{if(null!=e){let a=r.get(e);a&&t.addMarker(e,"current")}})},L=async e=>{if(E(),e)try{w=new c.A({container:y.value}),w?.on("element.click",({element:e})=>{M(e)}),R.value=!0,await(w?.importXML(e));const a=w?.get("elementRegistry").find(e=>"bpmn:Process"===e.type);a?.businessObject?.extensionElements?.values&&a.businessObject.extensionElements.values.forEach(e=>{"flowable:properties"!==e.$type&&"flowable:properties"!==e.$type||(e.values||e.$children).forEach(e=>{"$OrangeDiagramType"===e.name&&(A.value=e.value||0)})})}catch(a){console.error(a),E()}finally{R.value=!1,(0,r.dY)(()=>{D(_.value.finishedInfo)})}};return(0,r.hi)(()=>{E()}),(0,r.wB)(()=>_.value.xml,e=>{setTimeout(()=>{L(e).then(()=>{T()}).catch(e=>{console.warn(e)})},30)},{immediate:!0}),(e,a)=>{const l=t.S2,d=t.fg,c=s.S2;return(0,r.uX)(),(0,r.CE)("div",h,[(0,r.bo)((0,r.Lk)("div",{class:"process-canvas",style:{height:"100%"},ref_key:"processCanvas",ref:y},null,512),[[n.aG,!(0,i.R1)(R)&&(0,i.R1)(A)==(0,i.R1)(f.DiagramType).ORDINARY]]),!(0,i.R1)(R)&&(0,i.R1)(w)&&(0,i.R1)(A)==(0,i.R1)(f.DiagramType).DINGDING?((0,r.uX)(),(0,r.Wv)(p.A,{key:0,bpmnModeler:(0,i.R1)(w),onElementClick:M,readonly:!0,finishedInfo:(0,i.R1)(_).finishedInfo},null,8,["bpmnModeler","finishedInfo"])):(0,r.Q3)("",!0),(0,r.Lk)("defs",{ref_key:"customDefs",ref:b},a[3]||(a[3]=[(0,r.Lk)("marker",{id:"sequenceflow-end-white-success",viewBox:"0 0 20 20",refX:"11",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[(0,r.Lk)("path",{class:"success-arrow",d:"M 1 5 L 11 10 L 1 15 Z",style:{"stroke-width":"1px","stroke-linecap":"round","stroke-dasharray":"10000, 1"}})],-1),(0,r.Lk)("marker",{id:"conditional-flow-marker-white-success",viewBox:"0 0 20 20",refX:"-1",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[(0,r.Lk)("path",{class:"success-conditional",d:"M 0 10 L 8 6 L 16 10 L 8 14 Z",style:{"stroke-width":"1px","stroke-linecap":"round","stroke-dasharray":"10000, 1"}})],-1)]),512),(0,r.bo)((0,r.Lk)("div",m,[(0,r.bF)(c,{type:"flex",justify:"end"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{key:"scale-control",size:"default"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{size:"default",type:"default",plain:!0,disabled:(0,i.R1)(g)<=.3,icon:(0,i.R1)(u.ZoomOut),onClick:a[0]||(a[0]=e=>C())},null,8,["disabled","icon"]),(0,r.bF)(l,{size:"default",type:"default",style:{width:"90px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(Math.floor(10*(0,i.R1)(g)*10)+"%"),1)]),_:1}),(0,r.bF)(l,{size:"default",type:"default",plain:!0,disabled:(0,i.R1)(g)>=3.9,icon:(0,i.R1)(u.ZoomIn),onClick:a[1]||(a[1]=e=>z())},null,8,["disabled","icon"]),(0,r.bF)(l,{size:"default",type:"default",icon:(0,i.R1)(u.ScaleToOriginal),onClick:a[2]||(a[2]=e=>T())},null,8,["icon"]),(0,r.RG)(e.$slots,"default")]),_:3})]),_:3})],512),[[n.aG,(0,i.R1)(A)==(0,i.R1)(f.DiagramType).ORDINARY]])])}}});const y=k;var b=y},99397:function(e,a,l){l.d(a,{A:function(){return f}});var s=l(12687),t=(l(97042),l(31112),l(18111),l(22489),l(61701),l(56768)),r=l(90144),n=l(24232),i=l(82572);const o={class:"tag-select"},u={class:"tag-box"};var d=(0,t.pM)({__name:"TagSelect",props:{value:{}},emits:["update:value"],setup(e,{emit:a}){const l=a,d=e,c=(0,i.l5)(),p=(0,r.KR)([]),f={"${startUserName}":"流程发起人","${appointedAssignee}":"指定审批人 "},v=e=>{let a=p.value.filter(a=>a.id!==e.id);Array.isArray(d.value)?l("update:value",a):l("update:value",a.map(e=>e.id).join(","))};return(0,t.wB)(()=>d.value,e=>{null==e||""===e?p.value=[]:Array.isArray(e)?p.value=[...e].map(e=>({id:e.id,name:f[e.id]?f[e.id]:e.name||e.id})):p.value=e.split(",").map(e=>({id:e,name:f[e]?f[e]:e}))},{immediate:!0,deep:!0}),(e,a)=>{const l=s.u;return(0,t.uX)(),(0,t.CE)("div",o,[(0,t.Lk)("div",u,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,r.R1)(p),e=>((0,t.uX)(),(0,t.Wv)(l,{key:e.id,effect:"dark",style:{"margin-right":"5px"},type:"primary",size:(0,r.R1)(c).defaultFormItemSize,closable:"",onClose:a=>v(e)},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(e.name),1)]),_:2},1032,["size","onClose"]))),128))]),(0,t.RG)(e.$slots,"append")])}}}),c=l(71241);const p=(0,c.A)(d,[["__scopeId","data-v-907c424c"]]);var f=p}}]);