"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,7032],{37032:function(e,a,l){l.r(a),l.d(a,{default:function(){return y}});var t=l(65451),d=(l(97042),l(63390),l(25136)),i=(l(69957),l(21929)),o=(l(98421),l(85415)),r=(l(22243),l(7409),l(14022)),s=(l(72343),l(32465),l(18888)),n=(l(3172),l(18111),l(13579),l(56768)),u=l(90144),p=l(45130),v=l(26695),c=l(27007),m=l(71066),f=l(82572);const g={class:"form-single-fragment third-party-dlg",style:{position:"relative",height:"100%"}};var b=(0,n.pM)({__name:"editResponseData",props:{data:{default:void 0},usedFieldList:{default:void 0},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,u.KR)(["String","Number","Boolean","Object","Array"]),l=(0,f.l5)(),b=e,{thirdParams:h,onCloseThirdDialog:y}=(0,m.P)(b),k=(0,u.KR)(),F=(0,u.KR)({id:void 0,parentId:void 0,fieldName:"",fieldType:"String"}),R=(0,u.KR)([]),w={fieldName:[{required:!0,message:"请输入字段名",trigger:"blur"}],fieldType:[{required:!0,message:"请输入字段类型",trigger:"blur"}]},S=(0,n.EW)(()=>({data:b.data||h.value.data,usedFieldList:b.usedFieldList||h.value.usedFieldList||[]})),_=(0,n.EW)(()=>{let e=(0,c.I_)(S.value.usedFieldList,F.value.parentId);return e?e[e.length-1]:null}),N=e=>{F.value.parentId=R.value[R.value.length-1]},I=()=>{b.dialog?b.dialog.cancel():y(!1)},V=()=>{let e=_.value?_.value.children:S.value.usedFieldList;(e||[]).some(e=>e.fieldName===F.value.fieldName)?v.nk.error("字段名已存在"):k.value.validate(e=>{e&&(F.value.parentId=_.value?_.value.id:void 0,F.value.id=_.value?_.value.id+"."+F.value.fieldName:F.value.fieldName,b.dialog?b.dialog.submit(F.value):y(!0,S.value.data,F.value))})};return(0,n.sV)(()=>{S.value.data&&(F.value={...F.value,...S.value.data},R.value=(0,c.Zi)(S.value.usedFieldList,S.value.data.parentId))}),(e,v)=>{const c=s._m,m=i.xE,f=r.WK,b=o.P9,h=o.AV,y=i.US,_=d.S2,x=t.S2;return(0,n.uX)(),(0,n.CE)("div",g,[(0,n.bF)(y,{ref_key:"form",ref:k,model:(0,u.R1)(F),class:"full-width-input form-box",rules:w,style:{width:"100%"},"label-width":"100px",size:(0,u.R1)(l).defaultFormItemSize,"label-position":"right",onSubmit:v[3]||(v[3]=(0,p.D$)(()=>{},["prevent"]))},{default:(0,n.k6)(()=>[(0,n.bF)(m,{label:"父字段"},{default:(0,n.k6)(()=>[(0,n.bF)(c,{modelValue:(0,u.R1)(R),"onUpdate:modelValue":v[0]||(v[0]=e=>(0,u.i9)(R)?R.value=e:null),options:(0,u.R1)(S).usedFieldList,props:{value:"id",label:"fieldName",children:"children",checkStrictly:!0,disabled:"disabled"},clearable:"",filterable:"",disabled:null!=(0,u.R1)(S).data,placeholder:"请选择父字段",onChange:N},null,8,["modelValue","options","disabled"])]),_:1}),(0,n.bF)(m,{label:"字段名",prop:"fieldName"},{default:(0,n.k6)(()=>[(0,n.bF)(f,{modelValue:(0,u.R1)(F).fieldName,"onUpdate:modelValue":v[1]||(v[1]=e=>(0,u.R1)(F).fieldName=e),clearable:"",disabled:null!=(0,u.R1)(S).data},null,8,["modelValue","disabled"])]),_:1}),(0,n.bF)(m,{label:"字段类型",prop:"fieldType"},{default:(0,n.k6)(()=>[(0,n.bF)(h,{modelValue:(0,u.R1)(F).fieldType,"onUpdate:modelValue":v[2]||(v[2]=e=>(0,u.R1)(F).fieldType=e),clearable:"",placeholder:"请选择字段类型"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,u.R1)(a),e=>((0,n.uX)(),(0,n.Wv)(b,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","size"]),(0,n.bF)(x,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end",style:{"padding-top":"10px"}},{default:(0,n.k6)(()=>[(0,n.bF)(_,{size:(0,u.R1)(l).defaultFormItemSize,plain:!0,onClick:v[4]||(v[4]=e=>I())},{default:(0,n.k6)(()=>v[6]||(v[6]=[(0,n.eW)(" 取消 ")])),_:1,__:[6]},8,["size"]),(0,n.bF)(_,{type:"primary",size:(0,u.R1)(l).defaultFormItemSize,onClick:v[5]||(v[5]=e=>V())},{default:(0,n.k6)(()=>v[7]||(v[7]=[(0,n.eW)(" 保存 ")])),_:1,__:[7]},8,["size"])]),_:1})])}}});const h=b;var y=h},71066:function(e,a,l){l.d(a,{P:function(){return r},i:function(){return s}});var t=l(81387),d=l(27007),i=l(56768),o=l(90144);const r=e=>{console.log("接收到的第三方参数",e);const a=(0,o.KR)(0),l=(0,i.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(l){console.log(l),a={}}return a});console.log("thirdParams",l);const t=(t,d,i)=>{console.log("onCloseThirdDialog",d,i),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:l.value.path,rowData:d?JSON.parse(JSON.stringify(d)):void 0,data:i?JSON.parse(JSON.stringify(i)):void 0,isSuccess:t}},"*")},r=(e,l)=>{switch(e){case"setToken":l.token&&(0,d.WG)(l.token);break;case"dialogIndex":a.value=l;break;case"refreshData":break;case"message":break}},s=e=>{r(e.data.type,e.data.data)};return(0,i.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",s,!1)}),(0,i.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",s)}),{thirdParams:l,onCloseThirdDialog:t}},s=()=>{let e;const a=(0,t.lq)(),l=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,i.sV)(()=>{(0,d.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),l()},18e4))}),(0,i.hi)(()=>{e&&clearInterval(e)}))}}}]);