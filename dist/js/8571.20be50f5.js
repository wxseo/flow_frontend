"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,8571],{8571:function(e,l,a){a.r(l),a.d(l,{default:function(){return y}});var u=a(65451),t=(a(97042),a(63390),a(25136)),o=(a(69957),a(21929)),s=(a(98421),a(18888)),r=(a(3172),a(14022)),d=(a(72343),a(32465),a(85415)),n=(a(22243),a(7409),a(56768)),i=a(90144),c=a(45130),b=a(22414),m=a(27007),p=a(71066),v=a(82572),V=a(61617);const k={class:"form-single-fragment third-party-dlg",style:{position:"relative",height:"100%"}};var f=(0,n.pM)({__name:"editInsertData",props:{dblinkId:{default:void 0},tableName:{default:void 0},srcDblinkId:{default:void 0},srcTableName:{default:void 0},data:{default:void 0},flowVariableList:{default:void 0},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const l=(0,v.l5)(),a=e,{thirdParams:f,onCloseThirdDialog:g}=(0,p.P)(a),y=(0,i.KR)(),R=(0,i.KR)({type:b.AutoTaskValueType.FIXED,destColumnName:"",srcValue:""}),T=(0,i.KR)([]),h=(0,i.KR)([]),I=(0,i.KR)({destColumnName:[{required:!0,message:"请输入字段名",trigger:"blur"}],srcValue:[{required:!0,message:"请输入字段值",trigger:"blur"}]}),N=(0,n.EW)(()=>({dblinkId:a.dblinkId||f.value.dblinkId,tableName:a.tableName||f.value.tableName,srcDblinkId:a.srcDblinkId||f.value.srcDblinkId,srcTableName:a.srcTableName||f.value.srcTableName,data:a.data||f.value.data,flowVariableList:a.flowVariableList||f.value.flowVariableList||[]})),A=()=>{null!=N.value.dblinkId&&null!=N.value.tableName&&V.V7.listDblinkTableColumns({dblinkId:N.value.dblinkId,tableName:N.value.tableName}).then(e=>{T.value=e.data})},w=()=>{null!=N.value.srcDblinkId&&null!=N.value.srcTableName&&""!==N.value.srcDblinkId&&""!==N.value.srcTableName&&V.V7.listDblinkTableColumns({dblinkId:N.value.srcDblinkId,tableName:N.value.srcTableName}).then(e=>{h.value=e.data})},D=()=>{R.value.srcValue=void 0},F=()=>{a.dialog?a.dialog.cancel():g(!1)},E=()=>{y.value.validate(e=>{if(e){let e;e=R.value.srcValue,R.value.type===b.AutoTaskValueType.VARIABLE&&(e=Array.isArray(R.value.srcValue)?R.value.srcValue[R.value.srcValue.length-1]:void 0);let l={...R.value,srcValue:e};a.dialog?a.dialog.submit(l):g(!0,N.value.data,l)}})};return(0,n.sV)(()=>{if(A(),w(),N.value.data){let e=N.value.data.srcValue;N.value.data.type===b.AutoTaskValueType.VARIABLE&&(e=(0,m.Zi)(N.value.flowVariableList,e)),R.value={...R.value,...N.value.data,srcValue:e}}}),(e,a)=>{const m=d.P9,p=d.AV,v=o.xE,V=r.WK,f=s._m,g=o.US,A=t.S2,w=u.S2;return(0,n.uX)(),(0,n.CE)("div",k,[(0,n.bF)(g,{ref_key:"form",ref:y,model:(0,i.R1)(R),class:"full-width-input form-box",rules:(0,i.R1)(I),style:{width:"100%"},"label-width":"100px",size:(0,i.R1)(l).defaultFormItemSize,"label-position":"right",onSubmit:a[5]||(a[5]=(0,c.D$)(()=>{},["prevent"]))},{default:(0,n.k6)(()=>[(0,n.bF)(v,{label:"目标表字段",prop:"destColumnName"},{default:(0,n.k6)(()=>[(0,n.bF)(p,{modelValue:(0,i.R1)(R).destColumnName,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,i.R1)(R).destColumnName=e),clearable:"",filterable:"",disabled:null!=(0,i.R1)(N).data,placeholder:"请选择字段名"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,i.R1)(T),e=>((0,n.uX)(),(0,n.Wv)(m,{key:e.columnName,label:e.columnName,value:e.columnName},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),(0,n.bF)(v,{label:"字段值类型"},{default:(0,n.k6)(()=>[(0,n.bF)(p,{modelValue:(0,i.R1)(R).type,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,i.R1)(R).type=e),clearable:"",placeholder:"请选择值类型",onChange:D},{default:(0,n.k6)(()=>[(0,n.bF)(m,{label:(0,i.R1)(b.AutoTaskValueType).getValue((0,i.R1)(b.AutoTaskValueType).FIXED),value:(0,i.R1)(b.AutoTaskValueType).FIXED},null,8,["label","value"]),null!=(0,i.R1)(N).srcDblinkId&&null!=(0,i.R1)(N).srcTableName?((0,n.uX)(),(0,n.Wv)(m,{key:0,label:(0,i.R1)(b.AutoTaskValueType).getValue((0,i.R1)(b.AutoTaskValueType).FIELD),value:(0,i.R1)(b.AutoTaskValueType).FIELD},null,8,["label","value"])):(0,n.Q3)("",!0),(0,n.bF)(m,{label:(0,i.R1)(b.AutoTaskValueType).getValue((0,i.R1)(b.AutoTaskValueType).VARIABLE),value:(0,i.R1)(b.AutoTaskValueType).VARIABLE},null,8,["label","value"])]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(v,{label:"字段值",prop:"srcValue"},{default:(0,n.k6)(()=>[(0,i.R1)(R).type===(0,i.R1)(b.AutoTaskValueType).FIXED?((0,n.uX)(),(0,n.Wv)(V,{key:0,modelValue:(0,i.R1)(R).srcValue,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,i.R1)(R).srcValue=e),clearable:"",placeholder:"请输入字段值"},null,8,["modelValue"])):(0,i.R1)(R).type===(0,i.R1)(b.AutoTaskValueType).FIELD?((0,n.uX)(),(0,n.Wv)(p,{key:1,modelValue:(0,i.R1)(R).srcValue,"onUpdate:modelValue":a[3]||(a[3]=e=>(0,i.R1)(R).srcValue=e),clearable:"",filterable:"",placeholder:"请选择字段名"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,i.R1)(h),e=>((0,n.uX)(),(0,n.Wv)(m,{key:e.columnName,label:e.columnName,value:e.columnName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(0,i.R1)(R).type===(0,i.R1)(b.AutoTaskValueType).VARIABLE?((0,n.uX)(),(0,n.Wv)(f,{key:2,options:(0,i.R1)(N).flowVariableList,props:{value:"id",label:"name",children:"children"},modelValue:(0,i.R1)(R).srcValue,"onUpdate:modelValue":a[4]||(a[4]=e=>(0,i.R1)(R).srcValue=e),clearable:"",filterable:"",placeholder:"请选择流程变量"},null,8,["options","modelValue"])):(0,n.Q3)("",!0)]),_:1})]),_:1},8,["model","rules","size"]),(0,n.bF)(w,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end",style:{"padding-top":"10px"}},{default:(0,n.k6)(()=>[(0,n.bF)(A,{size:(0,i.R1)(l).defaultFormItemSize,plain:!0,onClick:a[6]||(a[6]=e=>F())},{default:(0,n.k6)(()=>a[8]||(a[8]=[(0,n.eW)(" 取消 ")])),_:1,__:[8]},8,["size"]),(0,n.bF)(A,{type:"primary",size:(0,i.R1)(l).defaultFormItemSize,onClick:a[7]||(a[7]=e=>E())},{default:(0,n.k6)(()=>a[9]||(a[9]=[(0,n.eW)(" 保存 ")])),_:1,__:[9]},8,["size"])]),_:1})])}}});const g=f;var y=g},71066:function(e,l,a){a.d(l,{P:function(){return r},i:function(){return d}});var u=a(81387),t=a(27007),o=a(56768),s=a(90144);const r=e=>{console.log("接收到的第三方参数",e);const l=(0,s.KR)(0),a=(0,o.EW)(()=>{let l={};try{e.thirdParamsString&&(l=JSON.parse(e.thirdParamsString))}catch(a){console.log(a),l={}}return l});console.log("thirdParams",a);const u=(u,t,o)=>{console.log("onCloseThirdDialog",t,o),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:l.value,dialogKey:e.dialogKey,path:a.value.path,rowData:t?JSON.parse(JSON.stringify(t)):void 0,data:o?JSON.parse(JSON.stringify(o)):void 0,isSuccess:u}},"*")},r=(e,a)=>{switch(e){case"setToken":a.token&&(0,t.WG)(a.token);break;case"dialogIndex":l.value=a;break;case"refreshData":break;case"message":break}},d=e=>{r(e.data.type,e.data.data)};return(0,o.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",d,!1)}),(0,o.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",d)}),{thirdParams:a,onCloseThirdDialog:u}},d=()=>{let e;const l=(0,u.lq)(),a=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==l.path.indexOf("/thirdParty/")&&((0,o.sV)(()=>{(0,t.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),a()},18e4))}),(0,o.hi)(()=>{e&&clearInterval(e)}))}}}]);