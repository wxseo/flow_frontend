"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[2397],{30058:function(e,t,a){a.d(t,{A:function(){return h}});var l=a(65451),i=(a(97042),a(63390),a(91542)),r=(a(37985),a(25136)),o=(a(69957),a(76408)),n=(a(87535),a(18111),a(22489),a(56768)),s=a(90144),d=a(24232),u=a(57477);const f={style:{"margin-right":"4px","font-size":"14px"}},p={key:2,style:{"flex-grow":"1","min-width":"10px"}};var c=(0,n.pM)({__name:"index",props:{hasSearch:{type:Boolean,default:!0},hasReset:{type:Boolean,default:!0}},emits:["reset","search"],setup(e,{emit:t}){const a=(0,n.Ht)(),c=t,y=(0,s.KR)(!1),m=()=>{c("search")},h=()=>{c("reset")},k=(0,n.EW)(()=>{let e=a.default?a.default():[];return e.filter(e=>e.type&&e.type.name&&null!==e.type.name)}),b=(0,n.EW)(()=>{if(y.value){let e=k.value.length%4;return 0===e?24:6*(4-e)}return k.value.length<=3?6*(4-k.value.length):6});return(0,n.sV)(()=>{null!=a.operation&&(y.value=!0)}),(e,t)=>{const c=o.uD,w=r.S2,v=i.tk,F=l.S2;return(0,n.uX)(),(0,n.Wv)(F,{class:"flex-box",type:"flex"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,s.R1)(k),(e,t)=>((0,n.uX)(),(0,n.CE)(n.FK,{key:t},[t<((0,s.R1)(y)?(0,s.R1)(k).length:3)?((0,n.uX)(),(0,n.Wv)(c,{key:0,span:6},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.Wv)((0,n.$y)(e),{style:{width:"100%"}}))]),_:2},1024)):(0,n.Q3)("",!0)],64))),128)),e.hasSearch?((0,n.uX)(),(0,n.Wv)(c,{key:0,span:(0,s.R1)(b),class:"search-box"},{default:(0,n.k6)(()=>[(0,n.bF)(F,{type:"flex",align:"middle"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{class:"search-btn",type:"default",plain:"",onClick:m,icon:(0,s.R1)(u.Search)},{default:(0,n.k6)(()=>t[1]||(t[1]=[(0,n.eW)(" 查询 ")])),_:1,__:[1]},8,["icon"]),e.hasReset?((0,n.uX)(),(0,n.Wv)(w,{key:0,type:"default",plain:"",onClick:h,style:{width:"72px"}},{default:(0,n.k6)(()=>t[2]||(t[2]=[(0,n.eW)("重置")])),_:1,__:[2]})):(0,n.Q3)("",!0),(0,s.R1)(k).length>3&&null==(0,s.R1)(a).operation?((0,n.uX)(),(0,n.Wv)(F,{key:1,type:"flex",align:"middle",class:"expand-btn",onClick:t[0]||(t[0]=e=>y.value=!(0,s.R1)(y))},{default:(0,n.k6)(()=>[(0,n.Lk)("span",f,(0,d.v_)((0,s.R1)(y)?"收起":"展开"),1),(0,n.bF)(v,null,{default:(0,n.k6)(()=>[(0,s.R1)(y)?((0,n.uX)(),(0,n.Wv)((0,s.R1)(u.ArrowUp),{key:0})):((0,n.uX)(),(0,n.Wv)((0,s.R1)(u.ArrowDown),{key:1}))]),_:1})]),_:1})):(0,n.Q3)("",!0),(0,s.R1)(a).operation?((0,n.uX)(),(0,n.CE)("div",p)):(0,n.Q3)("",!0),(0,n.RG)(e.$slots,"operation")]),_:3})]),_:3},8,["span"])):(0,n.Q3)("",!0)]),_:3})}}}),y=a(71241);const m=(0,y.A)(c,[["__scopeId","data-v-3d53564d"]]);var h=m},40299:function(e,t,a){a.d(t,{A:function(){return R}});var l=a(25136),i=(a(97042),a(19784),a(69957),a(9267)),r=(a(48493),a(65451)),o=(a(63390),a(68368)),n=(a(81208),a(12687)),s=(a(31112),a(47001),a(18111),a(22489),a(20116),a(7588),a(56768)),d=a(90144),u=a(45130),f=a(24232),p=a(61473),c=a(57477),y=a(47887),m=a(22414),h=a(64772),k=a(82572);const b={class:"process-viewer",style:{width:"100%"}},w={key:1,style:{position:"absolute",top:"0",left:"0",width:"100%"}};var v=(0,s.pM)({__name:"ProcessViewer",props:{xml:{},finishedInfo:{},allCommentList:{}},setup(e){const t=e,a=(0,k.l5)(),v=(0,d.KR)(),F=(0,d.KR)(),g=(0,d.KR)(!1),R=(0,d.KR)(),_=(0,d.KR)(1),E=(0,d.KR)(!0);let I=null;const S=(0,d.KR)(),T=(0,d.KR)(),z=(0,d.KR)(),C=(0,d.KR)(m.DiagramType.ORDINARY),x=()=>{_.value=1,I&&I.get("canvas").zoom("fit-viewport","auto")},D=(e=.1)=>{let t=Math.floor(100*_.value+100*e)/100;if(t>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");_.value=t,I&&I.get("canvas").zoom(_.value)},W=(e=.1)=>{let t=Math.floor(100*_.value-100*e)/100;if(t<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");_.value=t,I&&I.get("canvas").zoom(_.value)},P=e=>{switch(e){case m.SysFlowTaskOperationType.AGREE:case m.SysFlowTaskOperationType.MULTI_AGREE:return"success";case m.SysFlowTaskOperationType.REFUSE:case m.SysFlowTaskOperationType.PARALLEL_REFUSE:case m.SysFlowTaskOperationType.MULTI_REFUSE:return"warning";case m.SysFlowTaskOperationType.STOP:return"danger";default:return""}},V=()=>{v.value&&(v.value.innerHTML=""),I&&I.destroy(),I=null},L=()=>{if(!I)return;const e=I.get("canvas"),t=e._svg;t.appendChild(F.value)},K=(e=null)=>{T.value=void 0,R.value=void 0,null!=S.value&&null!=S.value.finishedTaskSet&&null!=e&&-1!==S.value.finishedTaskSet.indexOf(e.id)&&(T.value=e.id,R.value=e.businessObject?e.businessObject.name:void 0,z.value=(t.allCommentList||[]).filter(e=>e.taskKey===T.value),g.value=!0)},N=async e=>{if(V(),null!=e&&""!==e)try{if(I=new y.A({container:v.value,readOnly:!0}),I?I.on("element.click",({element:e})=>{K(e)}):console.warn("bpmnViewer is undefined"),E.value=!0,I){await I.importXML(e);const t=I.get("elementRegistry").find(e=>"bpmn:Process"===e.type);t?.businessObject?.extensionElements?.values&&t.businessObject.extensionElements.values.forEach(e=>{"flowable:Properties"!==e.$type&&"flowable:properties"!==e.$type||(e.values||e.$children).forEach(e=>{"$OrangeDiagramType"===e.name&&(C.value=e.value||0)})})}L()}catch(a){console.error(a),V()}finally{E.value=!1,t.finishedInfo&&O(t.finishedInfo)}},O=e=>{if(S.value=e,E.value||null==S.value||null==I)return;let{finishedSequenceFlowSet:t,finishedTaskSet:a,unfinishedTaskSet:l}=S.value;const i=I.get("canvas"),r=I.get("elementRegistry");Array.isArray(t)&&t.forEach(e=>{if(null!=e){let t=r.get(e);if(t){i.addMarker(e,"success");const a=t.businessObject.conditionExpression;a&&i.addMarker(e,"condition-expression")}}}),Array.isArray(a)&&a.forEach(e=>{if(null!=e){let t=r.get(e);t&&i.addMarker(e,"success")}}),Array.isArray(l)&&l.forEach(e=>{if(null!=e){let t=r.get(e);t&&i.addMarker(e,"current")}})};return(0,s.sV)(()=>{t.xml&&N(t.xml)}),(0,s.hi)(()=>{V()}),(0,s.wB)(()=>t.xml,e=>{e&&N(e)},{deep:!0}),(0,s.wB)(()=>t.finishedInfo,e=>{e&&O(e)},{deep:!0,immediate:!0}),(e,t)=>{const y=o.o8,k=n.u,S=o.Up,T=r.S2,V=i.kZ,L=l.S2,N=l.fg;return(0,s.uX)(),(0,s.CE)("div",b,[!(0,d.R1)(E)&&(0,d.R1)(I)&&(0,d.R1)(C)==(0,d.R1)(m.DiagramType).DINGDING?((0,s.uX)(),(0,s.Wv)(h.A,{key:0,bpmnModeler:(0,d.R1)(I),onElementClick:K,readonly:!0,finishedInfo:e.finishedInfo},null,8,["bpmnModeler","finishedInfo"])):(0,s.Q3)("",!0),(0,s.bo)((0,s.Lk)("div",{class:"process-canvas",style:{height:"100%"},ref_key:"processCanvas",ref:v},null,512),[[u.aG,!(0,d.R1)(E)&&(0,d.R1)(C)==(0,d.R1)(m.DiagramType).ORDINARY]]),(0,s.Lk)("defs",{ref_key:"customDefs",ref:F},t[4]||(t[4]=[(0,s.Lk)("marker",{id:"sequenceflow-end-white-success",viewBox:"0 0 20 20",refX:"11",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[(0,s.Lk)("path",{class:"success-arrow",d:"M 1 5 L 11 10 L 1 15 Z",style:{"stroke-width":"1px","stroke-linecap":"round","stroke-dasharray":"10000, 1"}})],-1),(0,s.Lk)("marker",{id:"conditional-flow-marker-white-success",viewBox:"0 0 20 20",refX:"-1",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[(0,s.Lk)("path",{class:"success-conditional",d:"M 0 10 L 8 6 L 16 10 L 8 14 Z",style:{"stroke-width":"1px","stroke-linecap":"round","stroke-dasharray":"10000, 1"}})],-1)]),512),(0,s.bF)(V,{class:"comment-dialog",title:(0,d.R1)(R)||"审批记录",modelValue:(0,d.R1)(g),"onUpdate:modelValue":t[0]||(t[0]=e=>(0,d.i9)(g)?g.value=e:null),"append-to-body":!0},{default:(0,s.k6)(()=>[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(S,{data:(0,d.R1)(z),size:(0,d.R1)(a).defaultFormItemSize,border:"","header-cell-class-name":"table-header-gray",height:"500px"},{empty:(0,s.k6)(()=>t[5]||(t[5]=[(0,s.Lk)("div",{class:"table-empty unified-font"},[(0,s.Lk)("img",{src:p}),(0,s.Lk)("span",null,"暂无数据")],-1)])),default:(0,s.k6)(()=>[(0,s.bF)(y,{label:"序号","header-align":"center",align:"center",type:"index",width:"70px"}),(0,s.bF)(y,{label:"执行人",prop:"createUsername",width:"150px"}),(0,s.bF)(y,{label:"操作",width:"150px"},{default:(0,s.k6)(e=>[(0,s.bF)(k,{size:(0,d.R1)(a).defaultFormItemSize,type:P(e.row.approvalType),effect:"dark"},{default:(0,s.k6)(()=>[(0,s.eW)((0,f.v_)((0,d.R1)(m.SysFlowTaskOperationType).getValue(e.row.approvalType)),1)]),_:2},1032,["size","type"]),null!=e.row.delegateAssignee?((0,s.uX)(),(0,s.Wv)(k,{key:0,size:(0,d.R1)(a).defaultFormItemSize,type:"success",effect:"plain",style:{"margin-left":"10px"}},{default:(0,s.k6)(()=>[(0,s.eW)((0,f.v_)(e.row.delegateAssignee),1)]),_:2},1032,["size"])):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)(y,{label:"审批意见"},{default:(0,s.k6)(e=>[(0,s.Lk)("span",null,(0,f.v_)(e.row.taskComment?e.row.taskComment:""),1)]),_:1}),(0,s.bF)(y,{label:"处理时间",prop:"createTime",width:"180px"})]),_:1},8,["data","size"])]),_:1})]),_:1},8,["title","modelValue"]),(0,d.R1)(C)==(0,d.R1)(m.DiagramType).ORDINARY?((0,s.uX)(),(0,s.CE)("div",w,[(0,s.bF)(T,{type:"flex",justify:"end"},{default:(0,s.k6)(()=>[(0,s.bF)(N,{key:"scale-control",size:"default"},{default:(0,s.k6)(()=>[(0,s.bF)(L,{size:"default",type:"default",plain:!0,disabled:(0,d.R1)(_)<=.3,icon:(0,d.R1)(c.ZoomOut),onClick:t[1]||(t[1]=e=>W())},null,8,["disabled","icon"]),(0,s.bF)(L,{size:"default",type:"default",style:{width:"90px"}},{default:(0,s.k6)(()=>[(0,s.eW)((0,f.v_)(Math.floor(10*(0,d.R1)(_)*10)+"%"),1)]),_:1}),(0,s.bF)(L,{size:"default",type:"default",plain:!0,disabled:(0,d.R1)(_)>=3.9,icon:(0,d.R1)(c.ZoomIn),onClick:t[2]||(t[2]=e=>D())},null,8,["disabled","icon"]),(0,s.bF)(L,{size:"default",type:"default",icon:(0,d.R1)(c.ScaleToOriginal),onClick:t[3]||(t[3]=e=>x())},null,8,["icon"]),(0,s.RG)(e.$slots,"default")]),_:3})]),_:3})])):(0,s.Q3)("",!0)])}}}),F=a(71241);const g=(0,F.A)(v,[["__scopeId","data-v-3aa8666a"]]);var R=g},48887:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var l=a(65451),i=(a(97042),a(63390),a(76408)),r=(a(87535),a(25136)),o=(a(69957),a(12687)),n=(a(31112),a(56768)),s=a(90144),d=a(24232),u=a(45130),f=a(61473),p=a(99540),c=a(26695),y=a(164),m=a(57477),h=a(61617),k=a(40299),b=a(60265),w=a(71066),v=a(82572);const F={class:"form-single-fragment",style:{position:"relative"}};var g=(0,n.pM)({__name:"formPublishedFlowEntry",props:{flowEntry:{default:void 0},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const t=(0,v.l5)(),a=e,{thirdParams:g}=(0,w.P)(a),R=(0,n.EW)(()=>t.defaultFormItemSize||g.value.defaultFormItemSize?.value),_=(0,s.KR)(),E=(0,n.EW)(()=>({flowEntry:a.flowEntry||g.value.flowEntry||{}})),I=e=>(null==e&&(e={}),e={...e,entryId:E.value.flowEntry.entryId},new Promise((t,a)=>{h.Dy.listFlowEntryPublish(e).then(e=>{t({dataList:e.data,totalCount:Array.isArray(e.data)?e.data.length:0})}).catch(e=>{a(e)})})),S=()=>!0,T={loadTableData:I,verifyTableParameter:S},z=(0,s.Kh)((0,b.K)(T)),C=(e=!1)=>{e?z.refreshTable(!0,1):z.refreshTable()},x=e=>{let t={entryPublishId:e.entryPublishId},a=e.activeStatus?h.Dy.suspendFlowEntryPublish(t):h.Dy.activateFlowEntryPublish(t);a.then(()=>{c.nk.success(""+(e.activeStatus?"挂起成功！":"激活成功！")),C()}).catch(e=>{console.warn(e)})},D=e=>{if(null==e.processDefinitionId||""===e.processDefinitionId)return void(_.value=void 0);let t={processDefinitionId:e.processDefinitionId};h.wI.viewProcessBpmn(t).then(e=>{_.value=e.data}).catch(e=>{console.warn(e)})},W=e=>{y.s.confirm("是否将当前版本设置为主版本？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t={entryId:E.value.flowEntry.entryId,newEntryPublishId:e.entryPublishId};return h.Dy.updateMainVersion(t)}).then(()=>{c.nk.success("设置成功！"),C()}).catch(e=>{console.warn(e)})};return(0,n.sV)(()=>{C()}),(e,t)=>{const a=o.u,c=r.S2,y=i.uD,h=l.S2;return(0,n.uX)(),(0,n.CE)("div",F,[(0,n.bF)(h,null,{default:(0,n.k6)(()=>[null==(0,s.R1)(_)?((0,n.uX)(),(0,n.Wv)(y,{key:0,span:24},{default:(0,n.k6)(()=>[(0,n.bF)((0,s.R1)(p.CP),{ref:"flowEntry",data:(0,s.R1)(z).dataList,size:(0,s.R1)(R),height:"655px","row-config":{isHover:!0},onSortChange:(0,s.R1)(z).onSortChange,"header-cell-class-name":"table-header-gray"},{empty:(0,n.k6)(()=>t[3]||(t[3]=[(0,n.Lk)("div",{class:"table-empty unified-font"},[(0,n.Lk)("img",{src:f}),(0,n.Lk)("span",null,"暂无数据")],-1)])),default:(0,n.k6)(()=>[(0,n.bF)((0,s.R1)(p.Wq),{title:"序号",type:"seq",width:"70px",index:(0,s.R1)(z).getTableIndex},null,8,["index"]),(0,n.bF)((0,s.R1)(p.Wq),{title:"流程名称"},{default:(0,n.k6)(()=>[(0,n.Lk)("span",null,(0,d.v_)((0,s.R1)(E).flowEntry.processDefinitionName),1)]),_:1}),(0,n.bF)((0,s.R1)(p.Wq),{title:"流程分类"},{default:(0,n.k6)(()=>[(0,n.Lk)("span",null,(0,d.v_)((0,s.R1)(E).flowEntry.flowCategory.name),1)]),_:1}),(0,n.bF)((0,s.R1)(p.Wq),{title:"流程版本",field:"publishVersion"},{default:(0,n.k6)(e=>[(0,n.bF)(a,{size:(0,s.R1)(R),type:"primary",effect:"dark"},{default:(0,n.k6)(()=>[(0,n.eW)((0,d.v_)("V:"+e.row.publishVersion),1)]),_:2},1032,["size"])]),_:1}),(0,n.bF)((0,s.R1)(p.Wq),{title:"激活状态",field:"activeStatus"},{default:(0,n.k6)(e=>[(0,n.bF)(a,{size:(0,s.R1)(R),effect:"dark",type:e.row.activeStatus?"success":"danger"},{default:(0,n.k6)(()=>[(0,n.eW)((0,d.v_)(e.row.activeStatus?"激活":"挂起"),1)]),_:2},1032,["size","type"])]),_:1}),(0,n.bF)((0,s.R1)(p.Wq),{title:"主版本",field:"mainVersion"},{default:(0,n.k6)(e=>[(0,n.bF)(a,{size:(0,s.R1)(R),effect:"dark",type:e.row.mainVersion?"success":"danger"},{default:(0,n.k6)(()=>[(0,n.eW)((0,d.v_)(e.row.mainVersion?"是":"否"),1)]),_:2},1032,["size","type"])]),_:1}),(0,n.bF)((0,s.R1)(p.Wq),{title:"发布时间",field:"publishTime","min-width":"150px"}),(0,n.bF)((0,s.R1)(p.Wq),{title:"操作",fixed:"right",width:"220px"},{default:(0,n.k6)(e=>[(0,n.bF)(c,{onClick:(0,u.D$)(t=>x(e.row),["stop"]),link:"",type:"danger",size:(0,s.R1)(R)},{default:(0,n.k6)(()=>[(0,n.eW)((0,d.v_)(e.row.activeStatus?"挂起":"激活"),1)]),_:2},1032,["onClick","size"]),(0,n.bF)(c,{type:"primary",link:"",size:(0,s.R1)(R),onClick:t=>D(e.row)},{default:(0,n.k6)(()=>t[1]||(t[1]=[(0,n.eW)(" 流程图 ")])),_:2,__:[1]},1032,["size","onClick"]),(0,n.bF)(c,{type:"primary",disabled:e.row.mainVersion,onClick:(0,u.D$)(t=>W(e.row),["stop"]),link:"",size:(0,s.R1)(R)},{default:(0,n.k6)(()=>t[2]||(t[2]=[(0,n.eW)(" 设置主版本 ")])),_:2,__:[2]},1032,["disabled","onClick","size"])]),_:1})]),_:1},8,["data","size","onSortChange"])]),_:1})):(0,n.Q3)("",!0),(0,n.bo)((0,n.bF)(y,{span:24},{default:(0,n.k6)(()=>[(0,n.bF)(k.A,{xml:(0,s.R1)(_),style:{height:"653px"}},{default:(0,n.k6)(()=>[(0,n.bF)(c,{type:"default",size:"default",icon:(0,s.R1)(m.CircleClose),onClick:t[0]||(t[0]=(0,u.D$)(e=>_.value=void 0,["stop"]))},null,8,["icon"])]),_:1},8,["xml"])]),_:1},512),[[u.aG,null!=(0,s.R1)(_)]])]),_:1})])}}});const R=g;var _=R},72397:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var l=a(9267),i=(a(97042),a(48493),a(76408)),r=(a(87535),a(68368)),o=(a(81208),a(47001),a(70944)),n=a(65451),s=(a(63390),a(69080)),d=(a(25374),a(12687)),u=(a(31112),a(25136)),f=(a(69957),a(21929)),p=(a(98421),a(30058)),c=a(14022),y=(a(72343),a(32465),a(85415)),m=(a(22243),a(7409),a(44114),a(18111),a(22489),a(7588),a(61701),a(18237),a(56768)),h=a(90144),k=a(45130),b=a(24232),w=a(26695),v=a(164),F=a(81387),g=a(8588),R=a(61617),_=a(22414),E=a(82572),I=a(48887),S=a(4248);const T={style:{position:"relative"}};var z=(0,m.pM)({__name:"formFlowEntry",setup(e,{expose:t}){const a=(0,E.l5)(),z=(0,h.KR)(),{Plus:C,useDropdown:x,useTable:D,Dialog:W}=(0,g.x)(),P=(0,h.KR)(void 0),V=()=>new Promise((e,t)=>{let a={};R.VU.dictFlowCategory(a).then(t=>{e({dataList:t.getList()})}).catch(e=>{t(e)})}),L={loadData:V},K=e=>(null==e&&(e={}),e={...e,flowEntryDtoFilter:{categoryId:A.formFilterCopy.categoryId,processDefinitionName:A.formFilterCopy.processDefinitionName,processDefinitionKey:A.formFilterCopy.processDefinitionKey,flowType:A.formFilterCopy.flowType,status:A.formFilterCopy.status}},new Promise((t,a)=>{R.Dy.list(e).then(e=>{e.data.dataList.forEach(e=>{e.autoParamJson=JSON.parse(e.autoParamJson||"[]"),e.autoParamJson=e.autoParamJson.map(e=>({variableName:e.variableName,variableValue:e.variableValue}))}),t({dataList:e.data.dataList,totalCount:e.data.totalCount})}).catch(e=>{a(e)})})),N=()=>(A.formFilterCopy.categoryId=A.formFilter.categoryId,A.formFilterCopy.flowType=A.formFilter.flowType,A.formFilterCopy.processDefinitionName=A.formFilter.processDefinitionName,A.formFilterCopy.processDefinitionKey=A.formFilter.processDefinitionKey,A.formFilterCopy.status=A.formFilter.status,!0),O={loadTableData:K,verifyTableParameter:N,paged:!0,orderFieldName:"entryId",ascending:!0},A=(0,h.Kh)({formFilter:{status:void 0,categoryId:void 0,processDefinitionName:void 0,processDefinitionKey:void 0,flowType:void 0},formFilterCopy:{status:void 0,categoryId:void 0,processDefinitionName:void 0,processDefinitionKey:void 0,flowType:void 0},categoryIdWidget:(0,h.Kh)(x(L)),flowEntryWidget:(0,h.Kh)(D(O)),isInit:!1}),X=(0,F.rd)(),M=(e=!1)=>{e?A.flowEntryWidget.refreshTable(!0,1):A.flowEntryWidget.refreshTable(),A.isInit||console.log(""),A.isInit=!0},U=()=>{z.value.resetFields(),M(!0)},$=e=>{e.flowType===_.FlowEntryType.AUTO_TASK?(P.value=e,P.value.autoParamJson.forEach(e=>{e.variableValue=""})):(P.value=void 0,B(e))},q=e=>{let t={processDefinitionKey:e.processDefinitionKey,variableData:e.autoParamJson.reduce((e,t)=>(null!=t.variableValue&&""!==t.variableValue&&(e[t.variableName]=t.variableValue),e),{})};R.wI.startAutoTask(t).then(()=>{w.nk.success("启动成功！"),P.value=void 0}).catch(e=>{console.warn(e)})},B=e=>{let t={processDefinitionKey:e.processDefinitionKey};R.wI.viewInitialTaskInfo(t).then(t=>{if(t.data&&t.data.taskType===_.SysFlowTaskType.USER_TASK&&t.data.assignedMe){let a={processDefinitionKey:e.processDefinitionKey||"",formId:t.data.formId||"",routerName:t.data.routerName,readOnly:t.data.readOnly,taskName:"启动流程",taskKey:t.data.taskKey,flowEntryName:e.processDefinitionName||"",operationList:JSON.stringify((t.data.operationList||[]).filter(e=>e.type!==_.SysFlowTaskOperationType.CO_SIGN&&e.type!==_.SysFlowTaskOperationType.REVOKE&&e.type!==_.SysFlowTaskOperationType.SIGN_REDUCTION)),isDraft:"true",isPreview:"true",variableList:JSON.stringify(t.data.variableList)};X.push({name:t.data.routerName||"handlerFlowTask",query:a})}else R.wI.startOnly({processDefinitionKey:e.processDefinitionKey}).then(()=>{w.nk.success("启动成功！")}).catch(e=>{console.warn(e)})}).catch(e=>{console.warn(e)})},Q=()=>{W.show("新建页面",S["default"],{area:["100vw","100vh"],skin:"fullscreen-dialog"},{},{fullscreen:!0,pathName:"/thirdParty/thirdFormEditFlowEntry"}).then(()=>{M()}).catch(e=>{console.log(e),M()})},G=e=>{W.show("编辑页面",S["default"],{area:["100vw","100vh"],skin:"fullscreen-dialog"},{flowEntry:e},{fullscreen:!0,pathName:"/thirdParty/thirdFormEditFlowEntry"}).then(()=>{M()}).catch(e=>{console.warn(e),M()})},J=e=>{v.s.confirm("是否发布当前工作流设计？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{if(null==e.entryId)return void w.nk.error("请求失败，发现必填参数为空！");let t={entryId:e.entryId};R.Dy.publish(t).then(()=>{w.nk.success("发布成功"),M()}).catch(e=>{console.warn(e)})}).catch(e=>{console.warn(e)})},j=e=>{W.show("版本管理",I["default"],{area:["1200px","750px"],end:()=>{M()}},{flowEntry:e},{width:"1200px",height:"780px",pathName:"/thirdParty/thirdFormPublishedFlowEntry"}).then(()=>{M()}).catch(()=>{M()})},H=e=>{if(null==e.entryId)return void w.nk.error("请求失败，发现必填参数为空！");let t={entryId:e.entryId};v.s.confirm("是否删除此流程？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{R.Dy.delete(t).then(()=>{w.nk.success("删除成功"),A.flowEntryWidget.refreshTable()}).catch(e=>{console.warn(e)})}).catch(e=>{console.warn(e)})},Y=()=>{M()},Z=()=>{M()};return(0,m.sV)(()=>{Z()}),(0,m.n)(()=>{Y()}),t({onResume:Y}),(e,t)=>{const w=y.P9,v=y.AV,F=f.xE,g=c.WK,R=p.A,E=f.US,I=u.S2,S=(0,m.g2)("vxe-column"),x=d.u,D=s.aQ,W=n.S2,V=o.A,L=r.o8,K=r.Up,N=i.uD,O=l.kZ;return(0,m.uX)(),(0,m.CE)("div",T,[(0,m.bF)(E,{ref_key:"form",ref:z,model:(0,h.R1)(A),"label-width":"80px",size:(0,h.R1)(a).defaultFormItemSize,"label-position":"right",onSubmit:t[5]||(t[5]=(0,k.D$)(()=>{},["prevent"]))},{default:(0,m.k6)(()=>[(0,m.bF)(R,{"item-width":350,onSearch:t[4]||(t[4]=e=>M(!0)),onReset:U},{default:(0,m.k6)(()=>[(0,m.bF)(F,{label:"流程分类",prop:"formFilter.categoryId"},{default:(0,m.k6)(()=>[(0,m.bF)(v,{class:"filter-item",modelValue:(0,h.R1)(A).formFilter.categoryId,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,h.R1)(A).formFilter.categoryId=e),clearable:!0,filterable:"",placeholder:"流程分类",loading:(0,h.R1)(A).categoryIdWidget.loading,onVisibleChange:(0,h.R1)(A).categoryIdWidget.onVisibleChange},{default:(0,m.k6)(()=>[((0,m.uX)(!0),(0,m.CE)(m.FK,null,(0,m.pI)((0,h.R1)(A).categoryIdWidget.dropdownList,e=>((0,m.uX)(),(0,m.Wv)(w,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","loading","onVisibleChange"])]),_:1}),(0,m.bF)(F,{label:"流程类型",prop:"formFilter.flowType"},{default:(0,m.k6)(()=>[(0,m.bF)(v,{class:"filter-item",modelValue:(0,h.R1)(A).formFilter.flowType,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,h.R1)(A).formFilter.flowType=e),clearable:!0,filterable:"",placeholder:"流程类型"},{default:(0,m.k6)(()=>[((0,m.uX)(!0),(0,m.CE)(m.FK,null,(0,m.pI)((0,h.R1)(_.FlowEntryType).getList(),e=>((0,m.uX)(),(0,m.Wv)(w,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,m.bF)(F,{label:"流程名称",prop:"formFilter.processDefinitionName"},{default:(0,m.k6)(()=>[(0,m.bF)(g,{class:"filter-item",modelValue:(0,h.R1)(A).formFilter.processDefinitionName,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,h.R1)(A).formFilter.processDefinitionName=e),clearable:!0,placeholder:"流程名称"},null,8,["modelValue"])]),_:1}),(0,m.bF)(F,{label:"发布状态",prop:"formFilter.status"},{default:(0,m.k6)(()=>[(0,m.bF)(v,{class:"filter-item",modelValue:(0,h.R1)(A).formFilter.status,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,h.R1)(A).formFilter.status=e),clearable:!0,filterable:"",placeholder:"发布状态"},{default:(0,m.k6)(()=>[((0,m.uX)(!0),(0,m.CE)(m.FK,null,(0,m.pI)((0,h.R1)(_.SysFlowEntryPublishedStatus).getList(),e=>((0,m.uX)(),(0,m.Wv)(w,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model","size"]),(0,m.bF)(V,{class:"page-table",ref:"flowEntry",data:(0,h.R1)(A).flowEntryWidget.dataList,size:(0,h.R1)(a).defaultFormItemSize,onSortChange:(0,h.R1)(A).flowEntryWidget.onSortChange,onRefresh:t[7]||(t[7]=e=>M(!0)),"seq-config":{startIndex:((0,h.R1)(A).flowEntryWidget.currentPage-1)*(0,h.R1)(A).flowEntryWidget.pageSize}},{operator:(0,m.k6)(()=>[(0,m.bF)(I,{type:"primary",icon:(0,h.R1)(C),size:(0,h.R1)(a).defaultFormItemSize,onClick:t[6]||(t[6]=e=>Q())},{default:(0,m.k6)(()=>t[10]||(t[10]=[(0,m.eW)("新建")])),_:1,__:[10]},8,["icon","size"])]),pagination:(0,m.k6)(()=>[(0,m.bF)(W,{type:"flex",justify:"end",style:{"margin-top":"16px"}},{default:(0,m.k6)(()=>[(0,m.bF)(D,{total:(0,h.R1)(A).flowEntryWidget.totalCount,"current-page":(0,h.R1)(A).flowEntryWidget.currentPage,"page-size":(0,h.R1)(A).flowEntryWidget.pageSize,"page-sizes":[10,20,50,100],layout:"total, prev, pager, next, sizes",onCurrentChange:(0,h.R1)(A).flowEntryWidget.onCurrentPageChange,onSizeChange:(0,h.R1)(A).flowEntryWidget.onPageSizeChange},null,8,["total","current-page","page-size","onCurrentChange","onSizeChange"])]),_:1})]),default:(0,m.k6)(()=>[(0,m.bF)(S,{title:"序号",type:"seq",width:"70px",index:(0,h.R1)(A).flowEntryWidget.getTableIndex},null,8,["index"]),(0,m.bF)(S,{title:"流程名称",field:"processDefinitionName"}),(0,m.bF)(S,{title:"流程标识",field:"processDefinitionKey"}),(0,m.bF)(S,{title:"流程分类",field:"flowCategory.name"}),(0,m.bF)(S,{title:"流程类型"},{default:(0,m.k6)(e=>[(0,m.bF)(x,{size:(0,h.R1)(a).defaultFormItemSize,type:e.row.flowType===(0,h.R1)(_.FlowEntryType).NORMAL?"success":"primary"},{default:(0,m.k6)(()=>[(0,m.eW)((0,b.v_)((0,h.R1)(_.FlowEntryType).getValue(e.row.flowType||(0,h.R1)(_.FlowEntryType).NORMAL)),1)]),_:2},1032,["size","type"])]),_:1}),(0,m.bF)(S,{title:"流程图类型"},{default:(0,m.k6)(e=>[(0,m.bF)(x,{size:(0,h.R1)(a).defaultFormItemSize,type:e.row.diagramType===(0,h.R1)(_.DiagramType).ORDINARY?"success":"primary"},{default:(0,m.k6)(()=>[(0,m.eW)((0,b.v_)((0,h.R1)(_.DiagramType).getValue(e.row.diagramType)),1)]),_:2},1032,["size","type"])]),_:1}),(0,m.bF)(S,{title:"发布状态",field:"status"},{default:(0,m.k6)(e=>[(0,m.bF)(x,{size:(0,h.R1)(a).defaultFormItemSize,type:e.row.status===(0,h.R1)(_.SysFlowEntryPublishedStatus).PUBLISHED?"success":"warning"},{default:(0,m.k6)(()=>[(0,m.eW)((0,b.v_)((0,h.R1)(_.SysFlowEntryPublishedStatus).getValue(e.row.status)),1)]),_:2},1032,["size","type"])]),_:1}),(0,m.bF)(S,{title:"流程主版本",field:"mainFlowEntryPublish",width:"170px"},{default:(0,m.k6)(e=>[e.row.mainFlowEntryPublish?((0,m.uX)(),(0,m.Wv)(x,{key:0,size:(0,h.R1)(a).defaultFormItemSize,type:"primary",effect:"dark",style:{"min-width":"60px"}},{default:(0,m.k6)(()=>[(0,m.eW)((0,b.v_)("V:"+e.row.mainFlowEntryPublish.publishVersion),1)]),_:2},1032,["size"])):(0,m.Q3)("",!0),e.row.mainFlowEntryPublish?((0,m.uX)(),(0,m.Wv)(x,{key:1,size:(0,h.R1)(a).defaultFormItemSize,effect:"dark",style:{"margin-left":"10px"},type:e.row.mainFlowEntryPublish.activeStatus?"success":"danger"},{default:(0,m.k6)(()=>[(0,m.eW)((0,b.v_)(e.row.mainFlowEntryPublish.activeStatus?"激活":"挂起"),1)]),_:2},1032,["size","type"])):(0,m.Q3)("",!0)]),_:1}),(0,m.bF)(S,{title:"最近发布时间",field:"latestPublishTime",sortable:"",width:"150px"}),(0,m.bF)(S,{title:"操作",fixed:"right",width:"280px"},{default:(0,m.k6)(e=>[(0,m.bF)(I,{onClick:(0,k.D$)(t=>$(e.row),["stop"]),type:"primary",link:"",size:(0,h.R1)(a).defaultFormItemSize,disabled:!(e.row.mainFlowEntryPublish&&e.row.mainFlowEntryPublish.activeStatus)},{default:(0,m.k6)(()=>t[11]||(t[11]=[(0,m.eW)(" 启动 ")])),_:2,__:[11]},1032,["onClick","size","disabled"]),(0,m.bF)(I,{onClick:(0,k.D$)(t=>G(e.row),["stop"]),type:"primary",link:"",size:(0,h.R1)(a).defaultFormItemSize},{default:(0,m.k6)(()=>t[12]||(t[12]=[(0,m.eW)(" 编辑 ")])),_:2,__:[12]},1032,["onClick","size"]),(0,m.bF)(I,{onClick:(0,k.D$)(t=>J(e.row),["stop"]),type:"primary",link:"",size:(0,h.R1)(a).defaultFormItemSize},{default:(0,m.k6)(()=>t[13]||(t[13]=[(0,m.eW)(" 发布 ")])),_:2,__:[13]},1032,["onClick","size"]),(0,m.bF)(I,{onClick:(0,k.D$)(t=>j(e.row),["stop"]),type:"primary",link:"",size:(0,h.R1)(a).defaultFormItemSize},{default:(0,m.k6)(()=>t[14]||(t[14]=[(0,m.eW)(" 版本管理 ")])),_:2,__:[14]},1032,["onClick","size"]),(0,m.bF)(I,{onClick:(0,k.D$)(t=>H(e.row),["stop"]),type:"danger",link:"",size:(0,h.R1)(a).defaultFormItemSize},{default:(0,m.k6)(()=>t[15]||(t[15]=[(0,m.eW)(" 删除 ")])),_:2,__:[15]},1032,["onClick","size"])]),_:1})]),_:1},8,["data","size","onSortChange","seq-config"]),(0,h.R1)(P)?((0,m.uX)(),(0,m.Wv)(O,{key:0,title:"启动自动化任务","model-value":!0,draggable:!0,onClose:t[9]||(t[9]=e=>P.value=void 0)},{default:(0,m.k6)(()=>[(0,m.bF)(W,null,{default:(0,m.k6)(()=>[(0,m.bF)(N,{span:24},{default:(0,m.k6)(()=>[(0,m.bF)(K,{data:(0,h.R1)(P).autoParamJson,height:"300px"},{default:(0,m.k6)(()=>[(0,m.bF)(L,{prop:"variableName",label:"参数名",width:"200px"}),(0,m.bF)(L,{prop:"variableValue",label:"参数值"},{default:(0,m.k6)(e=>[(0,m.bF)(g,{size:"default",modelValue:e.row.variableValue,"onUpdate:modelValue":t=>e.row.variableValue=t,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1}),(0,m.bF)(N,{span:24,style:{"margin-top":"15px"}},{default:(0,m.k6)(()=>[(0,m.bF)(W,{type:"flex",justify:"end"},{default:(0,m.k6)(()=>[(0,m.bF)(I,{size:"default",type:"primary",onClick:t[8]||(t[8]=e=>q((0,h.R1)(P)))},{default:(0,m.k6)(()=>t[16]||(t[16]=[(0,m.eW)(" 启动 ")])),_:1,__:[16]})]),_:1})]),_:1})]),_:1})]),_:1})):(0,m.Q3)("",!0)])}}});const C=z;var x=C}}]);