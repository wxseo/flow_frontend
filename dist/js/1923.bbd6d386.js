"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1923],{11923:function(e,a,t){t.r(a),t.d(a,{default:function(){return w}});var l=t(65451),o=(t(97042),t(63390),t(25136)),d=(t(69957),t(76408)),i=(t(87535),t(77649)),n=(t(87603),t(12687)),r=(t(31112),t(3740)),u=(t(42899),t(85415)),s=(t(22243),t(7409),t(44114),t(18111),t(20116),t(7588),t(61701),t(56768)),p=t(90144),m=t(99540),y=t(92380),f=t(7502),C=t(34894),I=t(71066),h=t(82572),T=(0,s.pM)({__name:"editTemplateWordColumn",props:{datasetInfo:{},datasetRelationList:{},datasetColumnInfo:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,h.l5)(),t=((0,f.s)(),e),{thirdParams:T,onCloseThirdDialog:c}=(0,I.P)(t),b=(0,s.EW)(()=>({datasetInfo:t.datasetInfo||T.value.datasetInfo,datasetRelationList:t.datasetRelationList||T.value.datasetRelationList||[],datasetColumnInfo:t.datasetColumnInfo||T.value.datasetColumnInfo})),w=(0,p.KR)([]),g=(0,s.EW)(()=>Array.isArray(b.value.datasetColumnInfo)?b.value.datasetColumnInfo:[]),v=()=>{t.dialog?t.dialog.cancel():c(!1)},k=()=>{let e=[];w.value.forEach(a=>{a.children&&a.children.forEach(t=>{let l={datasetId:a.datasetId,relationId:a.relationId,columnName:t.id,dataType:t.dataType};t.dataType===y.PrintCellType.COLUMN?"Date"===t.fieldType&&(l.dateFormat=t.dateFormat,e.push(l)):(l.barCodeShowWords=t.barCodeShowWords,l.barCodeType=t.barCodeType,l.autoSize=t.autoSize,l.imageWidth=t.imageWidth,l.imageHeight=t.imageHeight,e.push(l))})}),console.log(e),t.dialog?t.dialog.submit(e):c(!0,b.value.datasetColumnInfo,e)},W=e=>{switch(e.barCodeShowWords=!1,e.autoSize=!0,e.imageWidth=void 0,e.imageHeight=void 0,e.dateFormat=0,e.dataType){case y.PrintCellType.COLUMN:e.barCodeType=y.PrintBarCodeType.CODE_128;break;case y.PrintCellType.BARCODE:e.barCodeType=y.PrintBarCodeType.CODE_128,e.autoSize=!1;break;case y.PrintCellType.QRCODE:e.barCodeType=y.PrintQRCodeType.QR_CODE,e.autoSize=!1;break;case y.PrintCellType.IMAGE:e.barCodeType=y.PrintBarCodeType.CODE_128;break;default:e.barCodeType=y.PrintBarCodeType.CODE_128;break}},R=(e,a)=>new Promise((t,l)=>{C.TR.view({datasetId:(e||{}).datasetId||(a||{}).datasetId}).then(l=>{l.data.columnList.forEach(e=>{e.id=e.columnName,e.name=e.columnName}),t({columnList:l.data.columnList.map(e=>({...e,id:e.columnName})),datasetInfo:e,relationInfo:a})}).catch(e=>{l(e)})}),V=()=>{w.value=[];let e=[R(b.value.datasetInfo,void 0),...b.value.datasetRelationList.map(e=>R(void 0,e))];console.log(e),Promise.all(e).then(e=>{w.value=e.map(e=>({parentId:e.relationInfo?e.relationInfo.datasetId||b.value.datasetInfo.datasetId:e.datasetInfo?.datasetId,id:e.relationInfo?e.relationInfo.relationId:e.datasetInfo?.datasetId,name:e.relationInfo?e.relationInfo.name:e.datasetInfo?.name,type:e.relationInfo?"一对一关联":"主数据表",isColumn:!1,relationId:e.relationInfo?e.relationInfo.relationId:void 0,datasetId:e.relationInfo?void 0:e.datasetInfo?.datasetId,children:(e.columnList||[]).map(a=>{let t=g.value.find(t=>e.relationInfo?t.relationId===e.relationInfo.relationId&&t.columnName===a.columnName:t.datasetId===e.datasetInfo?.datasetId&&t.columnName===a.columnName);return{parentId:e.relationInfo?e.relationInfo.relationId:e.datasetInfo?.datasetId,id:a.columnName,name:a.columnName,fieldType:a.fieldType,columnInfo:a,type:"表字段",dataType:t?t.dataType:y.PrintCellType.COLUMN,barCodeShowWords:!!t&&t.barCodeShowWords,barCodeType:t?t.barCodeType:y.PrintBarCodeType.CODE_128,autoSize:!t||t.autoSize,imageWidth:t?t.imageWidth:void 0,imageHeight:t?t.imageHeight:void 0,dateFormat:t?t.dateFormat:0,isColumn:!0}})})),console.log(w.value)}).catch(e=>{console.log(e)})};return(0,s.sV)(()=>{V()}),(e,t)=>{const f=u.P9,C=u.AV,I=r.qi,h=n.u,T=i.lq,c=d.uD,b=o.S2,g=l.S2;return(0,s.uX)(),(0,s.Wv)(g,{class:"form-single-fragment third-party-dlg edit-template-word-column",style:{position:"relative"}},{default:(0,s.k6)(()=>[(0,s.bF)(c,{class:"form-box"},{default:(0,s.k6)(()=>[(0,s.bF)((0,p.R1)(m.CP),{class:"column-list",data:(0,p.R1)(w),height:"100%",size:(0,p.R1)(a).defaultFormItemSize,"row-config":{isHover:!0},style:{width:"100%"},"tree-config":{transform:!1,rowField:"id",parentField:"parentId",expandAll:!0},"header-cell-class-name":"table-header-gray"},{default:(0,s.k6)(()=>[(0,s.bF)((0,p.R1)(m.Wq),{title:"字段名称",field:"name","tree-node":"",width:"150px"}),(0,s.bF)((0,p.R1)(m.Wq),{title:"字段类型",field:"type",width:"150px"}),(0,s.bF)((0,p.R1)(m.Wq),{title:"显示类型",field:"dataType",width:"150px"},{default:(0,s.k6)(e=>[e.row.isColumn?((0,s.uX)(),(0,s.Wv)(C,{key:0,size:"default",modelValue:e.row.dataType,"onUpdate:modelValue":a=>e.row.dataType=a,placeholder:"显示类型",style:{width:"100%"},onChange:a=>W(e.row)},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,p.R1)(y.PrintCellType).getList(),e=>((0,s.uX)(),(0,s.Wv)(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)((0,p.R1)(m.Wq),{title:"显示文字",field:"barCodeShowWords",width:"100px"},{default:(0,s.k6)(e=>[e.row.isColumn?((0,s.uX)(),(0,s.Wv)(I,{key:0,modelValue:e.row.barCodeShowWords,"onUpdate:modelValue":a=>e.row.barCodeShowWords=a,size:"default",disabled:e.row.dataType!==(0,p.R1)(y.PrintCellType).BARCODE},null,8,["modelValue","onUpdate:modelValue","disabled"])):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)((0,p.R1)(m.Wq),{title:"字段设置"},{default:(0,s.k6)(e=>[e.row.dataType===(0,p.R1)(y.PrintCellType).BARCODE?((0,s.uX)(),(0,s.Wv)(C,{key:0,size:"default",modelValue:e.row.barCodeType,"onUpdate:modelValue":a=>e.row.barCodeType=a,placeholder:"条形码类型",style:{"margin-right":"10px"}},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,p.R1)(y.PrintBarCodeType).getList(),e=>((0,s.uX)(),(0,s.Wv)(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(0,s.Q3)("",!0),e.row.dataType===(0,p.R1)(y.PrintCellType).QRCODE?((0,s.uX)(),(0,s.Wv)(C,{key:1,size:"default",modelValue:e.row.barCodeType,"onUpdate:modelValue":a=>e.row.barCodeType=a,placeholder:"二维码类型",style:{"margin-right":"10px"}},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,p.R1)(y.PrintQRCodeType).getList(),e=>((0,s.uX)(),(0,s.Wv)(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(0,s.Q3)("",!0),null!=e.row.dataType&&e.row.dataType!==(0,p.R1)(y.PrintCellType).COLUMN?((0,s.uX)(),(0,s.Wv)(C,{key:2,size:"default",modelValue:e.row.autoSize,"onUpdate:modelValue":a=>e.row.autoSize=a,style:{"margin-right":"10px"}},{default:(0,s.k6)(()=>[(0,s.bF)(f,{disabled:e.row.dataType!==(0,p.R1)(y.PrintCellType).IMAGE,label:"自动调整图片大小",value:!0},null,8,["disabled"]),(0,s.bF)(f,{label:"指定图片大小",value:!1})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(0,s.Q3)("",!0),e.row.autoSize&&null!=e.row.dataType&&e.row.dataType!==(0,p.R1)(y.PrintCellType).COLUMN?((0,s.uX)(),(0,s.Wv)(h,{key:3,size:"default",type:"warning"},{default:(0,s.k6)(()=>t[2]||(t[2]=[(0,s.eW)(" 仅适用于图片位于表格内 ")])),_:1,__:[2]})):(0,s.Q3)("",!0),null==e.row.dataType||e.row.dataType===(0,p.R1)(y.PrintCellType).COLUMN||e.row.autoSize?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(T,{key:4,size:"default",modelValue:e.row.imageWidth,"onUpdate:modelValue":a=>e.row.imageWidth=a,"controls-position":"right",placeholder:"图片宽度(px)",style:{width:"150px"}},null,8,["modelValue","onUpdate:modelValue"])),null==e.row.dataType||e.row.dataType===(0,p.R1)(y.PrintCellType).COLUMN||e.row.autoSize?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(T,{key:5,size:"default",modelValue:e.row.imageHeight,"onUpdate:modelValue":a=>e.row.imageHeight=a,"controls-position":"right",placeholder:"图片高度(px)",style:{width:"150px","margin-left":"10px"}},null,8,["modelValue","onUpdate:modelValue"])),e.row.dataType===(0,p.R1)(y.PrintCellType).COLUMN?((0,s.uX)(),(0,s.Wv)(C,{key:6,size:"default",disabled:"Date"!==e.row.fieldType,modelValue:e.row.dateFormat,"onUpdate:modelValue":a=>e.row.dateFormat=a,placeholder:"日期显示格式"},{default:(0,s.k6)(()=>[(0,s.bF)(f,{label:"日期显示格式 - 数字格式",value:0}),(0,s.bF)(f,{label:"日期显示格式 - 中文格式",value:1})]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])):(0,s.Q3)("",!0)]),_:1})]),_:1},8,["data","size"])]),_:1}),(0,s.bF)(c,{class:"menu-box",span:24,style:{"margin-top":"15px","flex-basis":"0"}},{default:(0,s.k6)(()=>[(0,s.bF)(g,{type:"flex",justify:"end"},{default:(0,s.k6)(()=>[(0,s.bF)(b,{size:(0,p.R1)(a).defaultFormItemSize,plain:!0,onClick:t[0]||(t[0]=e=>v(!1))},{default:(0,s.k6)(()=>t[3]||(t[3]=[(0,s.eW)(" 取消 ")])),_:1,__:[3]},8,["size"]),(0,s.bF)(b,{type:"primary",size:(0,p.R1)(a).defaultFormItemSize,onClick:t[1]||(t[1]=e=>k())},{default:(0,s.k6)(()=>t[4]||(t[4]=[(0,s.eW)(" 确定 ")])),_:1,__:[4]},8,["size"])]),_:1})]),_:1})]),_:1})}}}),c=t(71241);const b=(0,c.A)(T,[["__scopeId","data-v-619f9efa"]]);var w=b}}]);