"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,2986],{2986:function(e,a,l){l.r(a),l.d(a,{default:function(){return k}});var t=l(65451),r=(l(97042),l(63390),l(25136)),s=(l(69957),l(21929)),o=(l(98421),l(18888)),u=(l(3172),l(85415)),i=(l(22243),l(7409),l(32465),l(14022)),d=(l(72343),l(18111),l(22489),l(56768)),n=l(90144),p=l(45130),c=l(26695),m=l(22414),V=l(27007),v=l(71066),g=l(82572);const y={class:"form-single-fragment third-party-dlg",style:{position:"relative",height:"100%"}};var b=(0,d.pM)({__name:"editHttpParameter",props:{data:{default:void 0},flowVariableList:{default:void 0},usedParamList:{default:void 0},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,g.l5)(),l=e,{thirdParams:b,onCloseThirdDialog:f}=(0,v.P)(l),k=(0,n.KR)(),h=(0,n.KR)({key:"",type:m.AutoTaskValueType.FIXED,srcValue:""}),R={key:[{required:!0,message:"请输入参数名称",trigger:"blur"}],type:[{required:!0,message:"请选择绑定值类型",trigger:"blur"}],srcValue:[{required:!0,message:"请输入参数值",trigger:"blur"}]},T=(0,d.EW)(()=>({data:l.data||b.value.data,flowVariableList:l.flowVariableList||b.value.flowVariableList,usedParamList:l.usedParamList||b.value.usedParamList})),w=(0,d.EW)(()=>T.value.data?T.value.usedParamList.filter(e=>e!==T.value.data.key):T.value.usedParamList),A=()=>{l.dialog?l.dialog.cancel():f(!1)},L=()=>{(w.value||[]).includes(h.value.key)?c.nk.error("参数名称已存在"):k.value.validate(e=>{if(e){let e;e=h.value.srcValue,h.value.type===m.AutoTaskValueType.VARIABLE&&(e=Array.isArray(h.value.srcValue)?h.value.srcValue[h.value.srcValue.length-1]:void 0);let a={...h.value,srcValue:e};l.dialog?l.dialog.submit(a):f(!0,T.value.data,a)}})};return(0,d.sV)(()=>{if(T.value.data){let e=T.value.data.srcValue;T.value.data.type===m.AutoTaskValueType.VARIABLE&&(e=(0,V.Zi)(T.value.flowVariableList,e)),h.value={...h.value,...T.value.data,srcValue:e}}}),(e,l)=>{const c=i.WK,V=s.xE,v=u.P9,g=u.AV,b=o._m,f=s.US,w=r.S2,F=t.S2;return(0,d.uX)(),(0,d.CE)("div",y,[(0,d.bF)(f,{ref_key:"form",ref:k,model:(0,n.R1)(h),class:"full-width-input form-box",rules:R,style:{width:"100%"},"label-width":"100px",size:(0,n.R1)(a).defaultFormItemSize,"label-position":"right",onSubmit:l[4]||(l[4]=(0,p.D$)(()=>{},["prevent"]))},{default:(0,d.k6)(()=>[(0,d.bF)(V,{label:"参数名称",prop:"key"},{default:(0,d.k6)(()=>[(0,d.bF)(c,{modelValue:(0,n.R1)(h).key,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,n.R1)(h).key=e),clearable:"",disabled:null!=(0,n.R1)(T).data},null,8,["modelValue","disabled"])]),_:1}),(0,d.bF)(V,{label:"绑定值类型",prop:"type"},{default:(0,d.k6)(()=>[(0,d.bF)(g,{modelValue:(0,n.R1)(h).type,"onUpdate:modelValue":l[1]||(l[1]=e=>(0,n.R1)(h).type=e),clearable:"",placeholder:"请选择绑定值类型"},{default:(0,d.k6)(()=>[(0,d.bF)(v,{label:(0,n.R1)(m.AutoTaskValueType).getValue((0,n.R1)(m.AutoTaskValueType).FIXED),value:(0,n.R1)(m.AutoTaskValueType).FIXED},null,8,["label","value"]),(0,d.bF)(v,{label:(0,n.R1)(m.AutoTaskValueType).getValue((0,n.R1)(m.AutoTaskValueType).VARIABLE),value:(0,n.R1)(m.AutoTaskValueType).VARIABLE},null,8,["label","value"])]),_:1},8,["modelValue"])]),_:1}),(0,d.bF)(V,{label:"参数值",prop:"srcValue"},{default:(0,d.k6)(()=>[(0,n.R1)(h).type===(0,n.R1)(m.AutoTaskValueType).FIXED?((0,d.uX)(),(0,d.Wv)(c,{key:0,modelValue:(0,n.R1)(h).srcValue,"onUpdate:modelValue":l[2]||(l[2]=e=>(0,n.R1)(h).srcValue=e),clearable:"",placeholder:"请输入参数值"},null,8,["modelValue"])):(0,n.R1)(h).type===(0,n.R1)(m.AutoTaskValueType).VARIABLE?((0,d.uX)(),(0,d.Wv)(b,{key:1,options:(0,n.R1)(T).flowVariableList,props:{value:"id",label:"name",children:"children"},modelValue:(0,n.R1)(h).srcValue,"onUpdate:modelValue":l[3]||(l[3]=e=>(0,n.R1)(h).srcValue=e),clearable:"",filterable:"",placeholder:"请选择流程变量"},null,8,["options","modelValue"])):(0,d.Q3)("",!0)]),_:1})]),_:1},8,["model","size"]),(0,d.bF)(F,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end",style:{"padding-top":"10px"}},{default:(0,d.k6)(()=>[(0,d.bF)(w,{size:(0,n.R1)(a).defaultFormItemSize,plain:!0,onClick:l[5]||(l[5]=e=>A())},{default:(0,d.k6)(()=>l[7]||(l[7]=[(0,d.eW)(" 取消 ")])),_:1,__:[7]},8,["size"]),(0,d.bF)(w,{type:"primary",size:(0,n.R1)(a).defaultFormItemSize,onClick:l[6]||(l[6]=e=>L())},{default:(0,d.k6)(()=>l[8]||(l[8]=[(0,d.eW)(" 保存 ")])),_:1,__:[8]},8,["size"])]),_:1})])}}});const f=b;var k=f},71066:function(e,a,l){l.d(a,{P:function(){return u},i:function(){return i}});var t=l(81387),r=l(27007),s=l(56768),o=l(90144);const u=e=>{console.log("接收到的第三方参数",e);const a=(0,o.KR)(0),l=(0,s.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(l){console.log(l),a={}}return a});console.log("thirdParams",l);const t=(t,r,s)=>{console.log("onCloseThirdDialog",r,s),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:l.value.path,rowData:r?JSON.parse(JSON.stringify(r)):void 0,data:s?JSON.parse(JSON.stringify(s)):void 0,isSuccess:t}},"*")},u=(e,l)=>{switch(e){case"setToken":l.token&&(0,r.WG)(l.token);break;case"dialogIndex":a.value=l;break;case"refreshData":break;case"message":break}},i=e=>{u(e.data.type,e.data.data)};return(0,s.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",i,!1)}),(0,s.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",i)}),{thirdParams:l,onCloseThirdDialog:t}},i=()=>{let e;const a=(0,t.lq)(),l=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,s.sV)(()=>{(0,r.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),l()},18e4))}),(0,s.hi)(()=>{e&&clearInterval(e)}))}}}]);