"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[6659],{76659:function(e,l,t){t.r(l),t.d(l,{default:function(){return K}});var a=t(25136),i=(t(97042),t(69957),t(85415)),r=(t(22243),t(25032),t(7409),t(2403)),u=(t(63266),t(44114),t(18111),t(61701),t(56768)),o=t(90144),d=t(21016),s=t(11194),n=(t(57583),t(14022)),m=(t(72343),t(3740)),p=(t(42899),t(88284)),c=(t(36715),t(77649)),y=(t(87603),t(18888)),f=(t(3172),t(52920)),g=(t(95509),t(76601)),V=(t(73821),t(72855)),v=(t(64491),t(72153),t(31328),t(91542)),F=(t(37985),t(22489),t(20116),t(24232)),k=t(57477),C=t(27007);const T={class:"custom-query-group"},L={class:"item-logic-operator"},b={style:{height:"32px","line-height":"32px",color:"#606266"}},I={class:"group-item-content"},h={class:"title"},_={style:{color:"#606266","font-size":"14px",cursor:"pointer"}},D={class:"el-dropdown-link"},N=["onClick"],z={key:0,class:"filter-value-select"},Q={key:1,class:"filter-item-tool"},X={class:"group-logic-operator"},R={class:"el-dropdown-link"},E={class:"group-tool"};var w=(0,u.pM)({name:"CustomQueryGroup",__name:"CustomQueryGroup",props:{modelValue:{},fieldList:{default:()=>[]},dictList:{default:()=>[]},getDictDataList:{}},emits:["update:modelValue","add","delete"],setup(e,{emit:l}){const t=l,a=e,r=e=>{t("update:modelValue",e)},w=e=>e.valueType===d.CustomQueryFilterValueType.DICT&&(e.filterType===d.CriteriaFilterType.IN||e.filterType===d.CriteriaFilterType.NOT_IN),O=e=>{let l=S(e);return d.CriteriaFilterType.getList().filter(e=>e.id!==d.CriteriaFilterType.BETWEEN).map(e=>{let t=!1;return e.id!==d.CriteriaFilterType.IN&&e.id!==d.CriteriaFilterType.NOT_IN||(t=!(l&&l.dictInfo)),{...e,disabled:t}})},W=e=>{let l=S(e);return null==l||e.filterType!==d.CriteriaFilterType.IN&&e.filterType!==d.CriteriaFilterType.NOT_IN},x=e=>{const l=a.fieldList.find(l=>l.id===e.tableName);if(l){const t=l.children.find(l=>l.id===e.columnName);return l.name+" / "+t.name}return"T 描述"},S=e=>{const l=a.fieldList.find(l=>l.id===e.tableName);return l?l.children.find(l=>l.id===e.columnName):void 0},U=(e,l)=>{w(e)?e.filterItemValue=(l||[]).filter(e=>e.length>1):e.filterItemValue=l&&l.length>1?l:void 0},B=e=>{let l=[];if(e.valueType===d.CustomQueryFilterValueType.DICT){let t=S(e);return t&&t.dictInfo&&(l=a.dictList.filter(e=>e.id===t.dictInfo.dictId)),l.length<=0&&(l=a.dictList),l}return[]},A=(e,l,t)=>{let i=S(e);if(0===l.level){let l=B(e);return t(l)}(i||{}).dictInfo;const r=l.data,u=r.children;l.level>1?t(u):null!=a.getDictDataList?u&&u.length>0?t(u):a.getDictDataList(r,{},!1).then(e=>{r&&r.treeFlag&&(e=(0,C.BN)(e)),(0,C.DS)(e,e=>{e.leaf=!e.children||e.children.length<=0}),r.children=e,t(e)}).catch(()=>{t([])}):t([])},K=e=>{switch(e){case"String":case"Long":return"String";case"Date":return"Date";case"Boolean":return"Boolean";case"Integer":case"Float":case"Double":case"BigDecimal":return"Number";default:return}},H=e=>{const l=S(e);return l?K(l.objectFieldType):"String"},Y=(e,l)=>{e.logicOperator=l;let t={...a.modelValue,filterList:a.modelValue.filterList};r(t)},M=()=>{let e={...a.modelValue};e.filterList.push({tableName:void 0,columnName:void 0,valueType:d.CustomQueryFilterValueType.FIXED,filterType:d.CriteriaFilterType.EQ,logicOperator:d.LogicOperatorType.AND,filterItemValue:""}),r(e)},q=e=>{let l={...a.modelValue};1===l.filterList.length?(l.filterList=[],l.filterList.push({tableName:void 0,columnName:void 0,valueType:d.CustomQueryFilterValueType.FIXED,filterType:d.CriteriaFilterType.EQ,logicOperator:d.LogicOperatorType.AND,filterItemValue:""})):l.filterList=a.modelValue.filterList.filter(l=>l!==e),r(l)},P=(e,l)=>{e.tableName=l[0],e.columnName=l[1],e.filterType=d.CriteriaFilterType.EQ;let t=S(e);t&&"Boolean"===H(e)?e.filterItemValue=!1:e.filterItemValue="",t&&t.dictInfo?e.valueType=d.CustomQueryFilterValueType.DICT:e.valueType=d.CustomQueryFilterValueType.FIXED;let i={...a.modelValue};r(i)},G=e=>{let l={...a.modelValue,logicOperator:e};r(l)},j=()=>{t("add")},J=()=>{t("delete",a.modelValue)},Z=(e,l)=>{e.filterType=l;let t=S(e);t&&"Boolean"===H(e)?e.filterItemValue=!1:e.filterItemValue="",r(a.modelValue)};return(e,l)=>{const t=v.tk,a=V.c6,r=V.Iy,C=V.dW,S=g.kQ,B=f.Vc,K=i.P9,$=i.AV,ee=y._m,le=c.lq,te=p.MG,ae=m.qi,ie=n.WK,re=s.fR;return(0,u.uX)(),(0,u.CE)("div",T,[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(e.modelValue.filterList,(i,s)=>((0,u.uX)(),(0,u.CE)("div",{class:"group-item",key:i.columnName},[(0,u.Lk)("div",L,[(0,u.bF)(C,{disabled:0===s,trigger:"click",onCommand:e=>Y(i,e)},{dropdown:(0,u.k6)(()=>[(0,u.bF)(r,null,{default:(0,u.k6)(()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)((0,o.R1)(d.LogicOperatorType).getList(),l=>((0,u.uX)(),(0,u.Wv)(a,{key:l.id,command:l.id},{default:(0,u.k6)(()=>[(0,u.Lk)("span",{class:(0,F.C4)({"el-dropdown-item-active":l.id==e.modelValue.logicOperator})},(0,F.v_)(l.name),3)]),_:2},1032,["command"]))),128))]),_:1})]),default:(0,u.k6)(()=>[(0,u.Lk)("span",b,[(0,u.eW)((0,F.v_)((0,o.R1)(d.LogicOperatorType).getValue(i.logicOperator))+" ",1),0!==s?((0,u.uX)(),(0,u.Wv)(t,{key:0},{default:(0,u.k6)(()=>[(0,u.bF)((0,o.R1)(k.CaretBottom))]),_:1})):(0,u.Q3)("",!0)])]),_:2},1032,["disabled","onCommand"])]),(0,u.Lk)("div",I,[(0,u.Lk)("div",h,[(0,u.bF)(B,{placement:"bottom-start",trigger:"click","popper-class":"custom-query-group-field-select-popper"},{reference:(0,u.k6)(()=>[(0,u.Lk)("span",_,(0,F.v_)(x(i)),1)]),default:(0,u.k6)(()=>[(0,u.bF)(S,{modelValue:[i.tableName,i.columnName],options:e.fieldList,props:{value:"id",label:"name",children:"children"},onChange:e=>P(i,e)},null,8,["modelValue","options","onChange"])]),_:2},1024),(0,u.bF)(C,{trigger:"click",style:{"margin-left":"10px"},onCommand:e=>Z(i,e)},{dropdown:(0,u.k6)(()=>[(0,u.bF)(r,null,{default:(0,u.k6)(()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(O(i),e=>((0,u.uX)(),(0,u.Wv)(a,{key:e.id,disabled:e.disabled,command:e.id},{default:(0,u.k6)(()=>[(0,u.Lk)("span",{class:(0,F.C4)(["el-dropdown-item-select",{"el-dropdown-item-active":e.id==i.filterType}])},(0,F.v_)(e.name),3)]),_:2},1032,["disabled","command"]))),128))]),_:2},1024)]),default:(0,u.k6)(()=>[(0,u.Lk)("span",D,[(0,u.eW)((0,F.v_)((0,o.R1)(d.CriteriaFilterType).getValue(i.filterType)||"等于")+" ",1),(0,u.bF)(t,null,{default:(0,u.k6)(()=>[(0,u.bF)((0,o.R1)(k.CaretBottom))]),_:1})])]),_:2},1032,["onCommand"]),l[3]||(l[3]=(0,u.Lk)("div",{style:{width:"100px","flex-grow":"1","flex-shrink":"1"}},null,-1)),(0,u.Lk)("div",{class:"rules-tool",onClick:e=>q(i)},[(0,u.bF)(t,null,{default:(0,u.k6)(()=>[(0,u.bF)((0,o.R1)(k.Close))]),_:1})],8,N)]),i.filterType!==(0,o.R1)(d.CriteriaFilterType).NOT_NULL&&i.filterType!==(0,o.R1)(d.CriteriaFilterType).IS_NULL?((0,u.uX)(),(0,u.CE)("div",z,[(0,u.bF)($,{modelValue:i.valueType,"onUpdate:modelValue":e=>i.valueType=e,size:e.defaultFormItemSize,style:{"margin-right":"10px",width:"250px"}},{default:(0,u.k6)(()=>[(0,u.bF)(K,{label:(0,o.R1)(d.CustomQueryFilterValueType).getValue((0,o.R1)(d.CustomQueryFilterValueType).FIXED),value:(0,o.R1)(d.CustomQueryFilterValueType).FIXED,disabled:!W(i)},null,8,["label","value","disabled"]),(0,u.bF)(K,{label:(0,o.R1)(d.CustomQueryFilterValueType).getValue((0,o.R1)(d.CustomQueryFilterValueType).DICT),value:(0,o.R1)(d.CustomQueryFilterValueType).DICT},null,8,["label","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","size"]),i.valueType==(0,o.R1)(d.CustomQueryFilterValueType).DICT?((0,u.uX)(),(0,u.Wv)(ee,{key:0,modelValue:i.filterItemValue,size:e.defaultFormItemSize,"popper-class":"custom-query-group-casecade-popper",style:{width:"100%"},props:{multiple:w(i),value:"id",label:"name",checkStrictly:!0,lazy:!0,lazyLoad:(e,l)=>A(i,e,l)},clearable:"","collapse-tags":"","collapse-tags-tooltip":"","onUpdate:modelValue":e=>U(i,e)},null,8,["modelValue","size","props","onUpdate:modelValue"])):((0,u.uX)(),(0,u.CE)(u.FK,{key:1},["Number"===H(i)?((0,u.uX)(),(0,u.Wv)(le,{key:0,modelValue:i.filterItemValue,"onUpdate:modelValue":e=>i.filterItemValue=e,size:e.defaultFormItemSize,style:{width:"100%"},clearable:"",placeholder:"请输入过滤值"},null,8,["modelValue","onUpdate:modelValue","size"])):"Date"===H(i)?((0,u.uX)(),(0,u.Wv)(te,{key:1,modelValue:i.filterItemValue,"onUpdate:modelValue":e=>i.filterItemValue=e,size:e.defaultFormItemSize,type:"datetime",style:{width:"100%"},clearable:"","value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",placeholder:"请输入过滤值"},null,8,["modelValue","onUpdate:modelValue","size"])):"Boolean"===H(i)?((0,u.uX)(),(0,u.Wv)(ae,{key:2,modelValue:i.filterItemValue,"onUpdate:modelValue":e=>i.filterItemValue=e,style:{width:"100%"},size:e.defaultFormItemSize},null,8,["modelValue","onUpdate:modelValue","size"])):((0,u.uX)(),(0,u.Wv)(ie,{key:3,modelValue:i.filterItemValue,"onUpdate:modelValue":e=>i.filterItemValue=e,size:e.defaultFormItemSize,style:{width:"100%"},clearable:"",placeholder:"请输入过滤值"},null,8,["modelValue","onUpdate:modelValue","size"]))],64))])):(0,u.Q3)("",!0),s===e.modelValue.filterList.length-1?((0,u.uX)(),(0,u.CE)("div",Q,[(0,u.bF)(t,{onClick:l[0]||(l[0]=e=>M())},{default:(0,u.k6)(()=>[(0,u.bF)((0,o.R1)(k.CirclePlus))]),_:1})])):(0,u.Q3)("",!0)])]))),128)),(0,u.Lk)("div",X,[(0,u.bF)(re,null,{default:(0,u.k6)(()=>[(0,u.bF)(C,{trigger:"click",onCommand:G},{dropdown:(0,u.k6)(()=>[(0,u.bF)(r,null,{default:(0,u.k6)(()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)((0,o.R1)(d.LogicOperatorType).getList(),l=>((0,u.uX)(),(0,u.Wv)(a,{key:l.id,command:l.id},{default:(0,u.k6)(()=>[(0,u.Lk)("span",{class:(0,F.C4)({"el-dropdown-item-active":l.id==e.modelValue.logicOperator})},(0,F.v_)(l.name),3)]),_:2},1032,["command"]))),128))]),_:1})]),default:(0,u.k6)(()=>[(0,u.Lk)("span",R,[(0,u.eW)((0,F.v_)((0,o.R1)(d.LogicOperatorType).getValue(e.modelValue.logicOperator)||"且")+" ",1),(0,u.bF)(t,null,{default:(0,u.k6)(()=>[(0,u.bF)((0,o.R1)(k.CaretBottom))]),_:1})])]),_:1})]),_:1}),(0,u.Lk)("div",E,[(0,u.bF)(t,{onClick:l[1]||(l[1]=e=>j())},{default:(0,u.k6)(()=>[(0,u.bF)((0,o.R1)(k.CirclePlus))]),_:1}),(0,u.bF)(t,{style:{"margin-left":"5px"},onClick:l[2]||(l[2]=e=>J())},{default:(0,u.k6)(()=>[(0,u.bF)((0,o.R1)(k.Delete))]),_:1})])])])}}}),O=t(71241);const W=(0,O.A)(w,[["__scopeId","data-v-091d1aa8"]]);var x=W;const S={class:"custom-query"},U={class:"btn-group"};var B=(0,u.pM)({name:"CustomQuery",__name:"index",props:{data:{default:()=>[]},dictList:{default:()=>[]},fieldList:{default:()=>[]},customQueryHistory:{default:()=>[]},getDictDataList:{type:Function,default:void 0},dialog:{}},setup(e){const l=e,t=(0,o.KR)([]),s=(0,o.KR)(),n=(0,u.EW)(()=>(console.log("props.customQueryHistory",l.customQueryHistory),l.customQueryHistory.map(e=>({id:e.id,name:e.name,data:e.data})))),m=()=>{t.value.push({id:(new Date).getTime(),logicOperator:d.LogicOperatorType.AND,filterList:[{tableName:void 0,columnName:void 0,valueType:d.CustomQueryFilterValueType.FIXED,filterType:d.CriteriaFilterType.EQ,logicOperator:d.LogicOperatorType.AND,filterItemValue:""}]})},p=(e,l)=>{const a=t.value.findIndex(l=>l===e);t.value.splice(a,1,l)},c=()=>{t.value=[],m()},y=e=>{if(1===t.value.length)c();else{const l=t.value.findIndex(l=>l===e);t.value.splice(l,1)}},f=()=>{l.dialog&&l.dialog.submit(t.value)},g=()=>{l.dialog&&l.dialog.cancel(!1)};return(0,u.wB)(()=>n.value,e=>{Array.isArray(e)&&e.length>0?s.value=e[0].data:s.value=void 0},{immediate:!0,deep:!0}),(0,u.wB)(()=>s.value,e=>{null==e||""===e?c():setTimeout(()=>{t.value=JSON.parse(e)},10)},{immediate:!0}),(e,l)=>{const d=r.kA,V=i.P9,v=i.EL,F=i.AV,k=a.S2;return(0,u.uX)(),(0,u.CE)("div",S,[(0,u.bF)(d,{class:"group-list custom-scroll",style:{height:"600px"}},{default:(0,u.k6)(()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)((0,o.R1)(t),(l,t)=>((0,u.uX)(),(0,u.Wv)(x,{key:t,fieldList:e.fieldList,dictList:e.dictList,historyList:(0,o.R1)(n),getDictDataList:e.getDictDataList,modelValue:l,"onUpdate:modelValue":e=>p(l,e),onAdd:m,onDelete:e=>y(l)},null,8,["fieldList","dictList","historyList","getDictDataList","modelValue","onUpdate:modelValue","onDelete"]))),128))]),_:1}),(0,u.Lk)("div",U,[l[4]||(l[4]=(0,u.Lk)("span",{style:{"font-size":"14px","padding-right":"10px"}},"历史查询记录",-1)),(0,u.bF)(F,{modelValue:(0,o.R1)(s),"onUpdate:modelValue":l[0]||(l[0]=e=>(0,o.i9)(s)?s.value=e:null),size:e.defaultFormItemSize,placeholder:"历史查询记录",style:{width:"250px"}},{default:(0,u.k6)(()=>[(0,o.R1)(n).length>0?((0,u.uX)(),(0,u.Wv)(v,{key:0,label:"历史查询记录(最多10条)"},{default:(0,u.k6)(()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)((0,o.R1)(n),e=>((0,u.uX)(),(0,u.Wv)(V,{key:e.id,label:e.name,value:e.data},null,8,["label","value"]))),128))]),_:1})):(0,u.Q3)("",!0)]),_:1},8,["modelValue","size"]),l[5]||(l[5]=(0,u.Lk)("div",{style:{flex:"1"}},null,-1)),(0,u.bF)(k,{plain:!0,size:e.defaultFormItemSize,onClick:g},{default:(0,u.k6)(()=>l[1]||(l[1]=[(0,u.eW)("取消")])),_:1,__:[1]},8,["size"]),(0,u.bF)(k,{plain:!0,type:"primary",size:e.defaultFormItemSize,onClick:c},{default:(0,u.k6)(()=>l[2]||(l[2]=[(0,u.eW)(" 重置 ")])),_:1,__:[2]},8,["size"]),(0,u.bF)(k,{type:"primary",size:e.defaultFormItemSize,onClick:f},{default:(0,u.k6)(()=>l[3]||(l[3]=[(0,u.eW)("查询")])),_:1,__:[3]},8,["size"])])])}}});const A=(0,O.A)(B,[["__scopeId","data-v-4d3548b3"]]);var K=A}}]);