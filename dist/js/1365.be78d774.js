"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1365],{51365:function(e,i,l){l.r(i),l.d(i,{default:function(){return X}});var a=l(65451),m=(l(97042),l(63390),l(25136)),t=(l(69957),l(21929)),o=(l(98421),l(2403)),n=(l(63266),l(32465),l(44114),l(18111),l(7588),l(56768)),d=l(90144),s=l(45130),u=l(21016),r=l(71066),v=(l(61701),l(24232)),p=l(57477);const c={class:"expression-editor"},K={class:"expression-box"},f={class:"expression-con"},R={class:"formula-edit-box"},C={class:"formula-item"},k={key:0,class:"cursor"},F=["onClick"],E={key:0,class:"cursor"},I={class:"expression-toolbar"},N={class:"expression-form"},g={class:"expression-form-row"},x={class:"expression-form-inline"},b=["onClick"],L={class:"expression-form-row"},h={class:"expression-form-inline"},A=["onClick"],y={class:"expression-form-row"},O={class:"expression-form-inline"},B=["onClick"];var _=(0,n.pM)({__name:"index",props:{modelValue:{},options:{}},emits:"update:modelValue",setup(e,{emit:i}){const l=e,a=i;let t=(0,d.KR)([{itemName:"+",itemCode:"+",itemKind:u.FormulaItemKind.OPERATOR},{itemName:"-",itemCode:"-",itemKind:u.FormulaItemKind.OPERATOR},{itemName:"×",itemCode:"*",itemKind:u.FormulaItemKind.OPERATOR},{itemName:"÷",itemCode:"/",itemKind:u.FormulaItemKind.OPERATOR},{itemName:"(",itemCode:"(",itemKind:u.FormulaItemKind.OPERATOR},{itemName:")",itemCode:")",itemKind:u.FormulaItemKind.OPERATOR}]),s=(0,d.KR)([{itemName:"1",itemCode:"1",itemKind:u.FormulaItemKind.NUMBER},{itemName:"2",itemCode:"2",itemKind:u.FormulaItemKind.NUMBER},{itemName:"3",itemCode:"3",itemKind:u.FormulaItemKind.NUMBER},{itemName:"4",itemCode:"4",itemKind:u.FormulaItemKind.NUMBER},{itemName:"5",itemCode:"5",itemKind:u.FormulaItemKind.NUMBER},{itemName:"6",itemCode:"6",itemKind:u.FormulaItemKind.NUMBER},{itemName:"7",itemCode:"7",itemKind:u.FormulaItemKind.NUMBER},{itemName:"8",itemCode:"8",itemKind:u.FormulaItemKind.NUMBER},{itemName:"9",itemCode:"9",itemKind:u.FormulaItemKind.NUMBER},{itemName:"0",itemCode:"0",itemKind:u.FormulaItemKind.NUMBER},{itemName:".",itemCode:".",itemKind:u.FormulaItemKind.NUMBER}]);const r=(0,n.EW)(()=>l.options?.operatorList||t.value),_=(0,n.EW)(()=>l.options?.numberList||s.value),T=(0,n.EW)(()=>(l.options?.variableList||[]).map(e=>({...e,itemKind:u.FormulaItemKind.VARABLE}))),V=(0,d.KR)([]),w=(0,d.KR)(0),M=(0,n.EW)(()=>V.value[w.value-1]);const S=e=>{if(null==e||""===e)return[];let i=[];try{i=JSON.parse(e)}catch(l){console.error("parse error",l)}if(Array.isArray(i)){let e=(new Date).getTime();i.forEach(i=>{i.id=e++})}return i},U=e=>Array.isArray(e)&&e.length>0?JSON.stringify(e):"",P=()=>{0!==w.value&&((M.value.itemKind===u.FormulaItemKind.NUMBER||M.value.itemKind===u.FormulaItemKind.STRING)&&M.value.itemName.length>1?M.value.itemName=M.value.itemName.slice(0,M.value.itemName.length-1):(V.value.splice(w.value-1,1),w.value=w.value-1))},X=()=>{V.value=[],w.value=0},z=e=>{null!=e&&(V.value.splice(w.value,0,e),w.value=w.value+1)},W=e=>{e={...e},null!=e&&(0!==V.value.length?0!==w.value?(M.value.itemKind===u.FormulaItemKind.VARABLE?e.itemKind===u.FormulaItemKind.OPERATOR&&z(e):M.value.itemKind===u.FormulaItemKind.NUMBER?e.itemKind===u.FormulaItemKind.OPERATOR?z(e):e.itemKind!==u.FormulaItemKind.NUMBER&&e.itemKind!==u.FormulaItemKind.STRING||(M.value.itemName+=e.itemCode,e.itemKind===u.FormulaItemKind.STRING&&(M.value.itemKind=u.FormulaItemKind.STRING)):M.value.itemKind===u.FormulaItemKind.STRING?e.itemKind===u.FormulaItemKind.OPERATOR?z(e):e.itemKind!==u.FormulaItemKind.NUMBER&&e.itemKind!==u.FormulaItemKind.STRING||(M.value.itemName+=e.itemCode):M.value.itemKind===u.FormulaItemKind.OPERATOR&&(e.itemKind!==u.FormulaItemKind.OPERATOR?z(e):"("===M.value.itemCode?e.itemCode===M.value.itemCode&&z(e):")"===M.value.itemCode?"("!==e.itemCode&&z(e):"("===e.itemCode&&z(e)),V.value=[...V.value]):z(e):"("!==e.itemCode&&e.itemKind===u.FormulaItemKind.OPERATOR||(w.value=w.value+1,V.value.push(e)))},G=(0,d.KR)(),D=()=>{let e;e=null!=l.options?.stringify?l.options?.stringify(V.value):U(V.value),G.value=e,a("update:modelValue",e),a("change",e)},J=e=>{w.value=e+1};return(0,n.wB)(()=>l.modelValue,()=>{G.value!==l.modelValue&&(null!=l.options?.parse?V.value=l.options.parse(l.modelValue):V.value=S(l.modelValue),w.value=V.value.length)},{immediate:!0}),(0,n.wB)(()=>V.value,()=>{D()},{immediate:!0,deep:!0}),(e,i)=>{const l=o.kA,a=m.S2;return(0,n.uX)(),(0,n.CE)("div",c,[(0,n.Lk)("div",K,[(0,n.Lk)("div",f,[i[3]||(i[3]=(0,n.Lk)("div",{style:{display:"inline"}},[(0,n.Lk)("span",{class:"expression-filed"},"计算公式"),(0,n.Lk)("span",{class:"expression-filed"},"=")],-1)),(0,n.bF)(l,{style:{"flex-grow":"1",width:"100px"}},{default:(0,n.k6)(()=>[(0,n.Lk)("div",R,[(0,n.Lk)("div",C,[(0,n.Lk)("span",{class:"expression-filed",onClick:i[0]||(i[0]=e=>J(-1))}),0===w.value?((0,n.uX)(),(0,n.CE)("span",k)):(0,n.Q3)("",!0)]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(V.value,(e,i)=>((0,n.uX)(),(0,n.CE)("div",{class:"formula-item",key:e.itemName+"_"+i},[(0,n.Lk)("span",{style:(0,v.Tr)({"background-color":e.itemKind==(0,d.R1)(u.FormulaItemKind).VARABLE?"#eee":"",padding:e.itemKind==(0,d.R1)(u.FormulaItemKind).VARABLE?"2px 8px":"2px 0"}),class:"expression-filed",onClick:e=>J(i)},(0,v.v_)(e.itemName),13,F),w.value===i+1?((0,n.uX)(),(0,n.CE)("span",E)):(0,n.Q3)("",!0)]))),128))])]),_:1})]),(0,n.Lk)("div",I,[(0,n.bF)(a,{link:"",icon:(0,d.R1)(p.Back),onClick:i[1]||(i[1]=e=>P())},null,8,["icon"]),(0,n.bF)(a,{link:"",icon:(0,d.R1)(p.Delete),onClick:i[2]||(i[2]=e=>X())},null,8,["icon"])])]),i[7]||(i[7]=(0,n.Lk)("div",{class:"expression-tips"}," 编辑计算公式可用来完成审批单内数据的自动结算，例如：采购单内设置计算公式“合计=单价x数量”，发起人填写单价、数量后，组件将自动计算出合计金额，免手动计算 ",-1)),(0,n.Lk)("div",N,[(0,n.Lk)("div",g,[i[4]||(i[4]=(0,n.Lk)("div",{class:"expression-form-label"},"计算对象：",-1)),(0,n.Lk)("div",x,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,d.R1)(T),(e,i)=>((0,n.uX)(),(0,n.CE)("span",{key:i,class:"expression-form-value",onClick:i=>W(e)},(0,v.v_)(e.itemName),9,b))),128))])]),(0,n.Lk)("div",L,[i[5]||(i[5]=(0,n.Lk)("div",{class:"expression-form-label"},"计算符号：",-1)),(0,n.Lk)("div",h,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,d.R1)(r),(e,i)=>((0,n.uX)(),(0,n.CE)("span",{key:i,class:"expression-form-value",onClick:i=>W(e)},(0,v.v_)(e.itemName),9,A))),128))])]),(0,n.Lk)("div",y,[i[6]||(i[6]=(0,n.Lk)("div",{class:"expression-form-label"},"数字键盘：",-1)),(0,n.Lk)("div",O,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,d.R1)(_),(e,i)=>((0,n.uX)(),(0,n.CE)("span",{key:i,class:"expression-form-value",onClick:i=>W(e)},(0,v.v_)(e.itemName),9,B))),128))])])])])}}}),T=l(71241);const V=(0,T.A)(_,[["__scopeId","data-v-b2565c5c"]]);var w=V,M=l(82572);const S={class:"form-single-fragment third-party-dlg",style:{position:"relative",height:"100%"}};var U=(0,n.pM)({__name:"editFormulaData",props:{data:{default:void 0},flowVariableList:{default:void 0},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const i=(0,M.l5)(),l=e,{thirdParams:v,onCloseThirdDialog:p}=(0,r.P)(l),c=(0,d.KR)(),K=(0,d.KR)({formulaConfig:""}),f={formulaConfig:[{required:!0,message:"请输入表达式",trigger:"blur"}]},R=(0,n.EW)(()=>({data:l.data||v.value.data,flowVariableList:l.flowVariableList||v.value.flowVariableList})),C=(0,n.EW)(()=>{let e=R.value.flowVariableList,i=[];const l=(e,a)=>{a.children&&a.children.length>0?a.children.forEach(i=>{l(e,i)}):i.push({itemName:e.name+"."+a.id,itemCode:a.id,itemKind:u.FormulaItemKind.VARABLE})};return e.forEach(e=>{l(e,e)}),i}),k=(0,n.EW)(()=>({variableList:C.value})),F=()=>{l.dialog?l.dialog.cancel():p(!1)},E=()=>{c.value.validate(e=>{e&&(l.dialog?l.dialog.submit(K.value.formulaConfig):p(!0,R.value.data,K.value.formulaConfig))})};return(0,n.sV)(()=>{R.value.data&&(K.value.formulaConfig=R.value.data)}),(e,l)=>{const u=t.xE,r=o.kA,v=t.US,p=m.S2,R=a.S2;return(0,n.uX)(),(0,n.CE)("div",S,[(0,n.bF)(v,{ref_key:"form",ref:c,model:(0,d.R1)(K),class:"full-width-input form-box",rules:f,style:{width:"100%"},"label-width":"100px",size:(0,d.R1)(i).defaultFormItemSize,"label-position":"top",onSubmit:l[1]||(l[1]=(0,s.D$)(()=>{},["prevent"]))},{default:(0,n.k6)(()=>[(0,n.bF)(r,null,{default:(0,n.k6)(()=>[(0,n.bF)(u,{label:"","label-width":"0px",prop:"formulaConfig"},{default:(0,n.k6)(()=>[(0,n.bF)(w,{modelValue:(0,d.R1)(K).formulaConfig,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,d.R1)(K).formulaConfig=e),options:(0,d.R1)(k)},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1},8,["model","size"]),(0,n.bF)(R,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end",style:{"padding-top":"10px"}},{default:(0,n.k6)(()=>[(0,n.bF)(p,{size:(0,d.R1)(i).defaultFormItemSize,plain:!0,onClick:l[2]||(l[2]=e=>F())},{default:(0,n.k6)(()=>l[4]||(l[4]=[(0,n.eW)(" 取消 ")])),_:1,__:[4]},8,["size"]),(0,n.bF)(p,{type:"primary",size:(0,d.R1)(i).defaultFormItemSize,onClick:l[3]||(l[3]=e=>E())},{default:(0,n.k6)(()=>l[5]||(l[5]=[(0,n.eW)(" 保存 ")])),_:1,__:[5]},8,["size"])]),_:1})])}}});const P=U;var X=P}}]);