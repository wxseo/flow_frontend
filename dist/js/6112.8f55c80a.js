"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[378,1078,2827,5906,6112,9183],{9924:function(e,a,t){t.d(a,{A:function(){return y}});var l=t(85415),s=(t(97042),t(22243),t(7409),t(44114),t(56768)),o=t(90144),n=t(27007),i=t(31372),r=t(93879);const d={class:"user-task-select"};var p=(0,s.pM)({__name:"index",props:{value:{},props:{default:()=>({label:"taskName",value:"taskId"})},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},size:{},placeholder:{},xml:{},finishedInfo:{}},emits:["update:value","change"],setup(e,{emit:a}){const t=a,p=e,u=(0,o.KR)(),c=(0,n.yk)(),y=(0,o.KR)([]),m=e=>{console.log(">>> ",e);const a=[];null!=e&&a.push(e),y.value=a,console.log(y.value),p.value!==(y.value[0]||{})[p.props.value]&&k()},f=e=>{e&&i.l.show("任务选择",r["default"],{area:["80vw","750px"],offset:"50px"},{xml:p.xml,path:"thirdSelectUserTask/"+c,finishedInfo:p.finishedInfo},{width:"1200px",height:"600px",pathName:"/thirdParty/thirdSelectUserTask"}).then(e=>{u.value.blur(),m(e)})},v=()=>{y.value=[],k()},k=()=>{let e=(y.value[0]||{})[p.props.value];t("update:value",e),t("change",e)};return(e,a)=>{const t=l.P9,n=l.AV;return(0,s.uX)(),(0,s.CE)("div",d,[(0,s.bF)(n,{"model-value":e.value,ref_key:"select",ref:u,style:{width:"100%"},disabled:e.disabled,size:e.size,clearable:e.clearable,placeholder:e.placeholder,teleported:!1,"popper-class":"user-task-select-popper",onVisibleChange:f,onClear:v},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,o.R1)(y),a=>((0,s.uX)(),(0,s.Wv)(t,{key:a[e.props.value],label:a[e.props.label],value:a[e.props.value]},null,8,["label","value"]))),128))]),_:1},8,["model-value","disabled","size","clearable","placeholder"])])}}}),u=t(71241);const c=(0,u.A)(p,[["__scopeId","data-v-1ca1d279"]]);var y=c},18191:function(e,a,t){t.d(a,{A:function(){return i}});var l=t(56768),s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAO9JREFUOE+lkq1KRFEYRdcCH0IQm8FHEMRgNAgKgsUgiBgMFoNgkAkzYvA9LDaDWCyCzWwwmMwGg+DAliMz4h3mytw7J+9vcfaPTPmc8p4KIMkesKTuTwr+BSQ5BzaATfW5ESBJDzgB3oCvmuMCfQAu1c+h5ucHSeaBO+AJOK0BLALbxSKwpr4W3V8Ls8A9cKV26iwkOQK2gFW1PxpigSyr1/9lkOQR6Ki3rWpMcgb01W5bQGnsXb1oCygWuupNY0CSA2AXWBkX4gwwVxPgArAzqHFdfanUONjDIXBcAygHwyF9VIY06WzH6RpnMAr5BthUTBGjeu26AAAAAElFTkSuQmCC",o=(0,l.pM)({__name:"index",emits:["close"],setup(e,{emit:a}){const t=a,o=()=>{t("close")};return(e,a)=>((0,l.uX)(),(0,l.CE)("label",{class:"page-close-box",onClick:a[0]||(a[0]=e=>o())},a[1]||(a[1]=[(0,l.Lk)("img",{src:s,alt:""},null,-1)])))}});const n=o;var i=n},19183:function(e,a,t){t.r(a),t.d(a,{default:function(){return E}});var l=t(69080),s=(t(97042),t(25374),t(76408)),o=(t(87535),t(17851)),n=(t(68489),t(68368)),i=(t(81208),t(62436),t(47001),t(21929)),r=(t(98421),t(25136)),d=(t(69957),t(65451)),p=(t(63390),t(18888)),u=(t(3172),t(32465),t(14022)),c=(t(72343),t(18111),t(22489),t(56768)),y=t(90144),m=t(45130),f=t(24232),v=t(61473),k=t(54428),g=t(60265),h=t(99080),I=t(27007),w=t(65185),R=t(71066),T=t(82572);const b={class:"form-single-fragment",style:{position:"relative"}};var F=(0,c.pM)({__name:"TaskUserSelect",props:{showAssignee:{type:Boolean,default:!0},showStartUser:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},usedUserIdList:{default:()=>[]},filterObject:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e,{expose:a}){const t=e,{thirdParams:F,onCloseThirdDialog:S}=(0,R.P)(t),_=(0,T.l5)(),{formatDateByStatsType:E}=(0,w.S)(),O=(0,y.KR)(),C=(0,y.KR)(),L=(0,y.KR)([]),A=(0,y.KR)([]),N=(0,c.EW)(()=>(console.log("dialogParams",t),{showAssignee:t.showAssignee||F.value.showAssignee,showStartUser:t.showStartUser||F.value.showStartUser,multiple:t.multiple||F.value.multiple,usedUserIdList:t.usedUserIdList||F.value.usedUserIdList,filterObject:t.filterObject||F.value.filterObject})),D=(0,c.EW)(()=>N.value.multiple?L.value.length>0:null!=C.value&&""!==C.value||null!=O.value),x=e=>(e.widgetType="upms_user",e.filter={...N.value.filterObject,deptId:K.formFilterCopy.deptId,loginName:K.formFilterCopy.sysUserLoginName,showName:K.formFilterCopy.showName},new Promise((a,t)=>{k.If.list(e).then(e=>{a({dataList:e.data.dataList,totalCount:e.data.totalCount})}).catch(e=>{t(e)})})),U=()=>(K.formFilterCopy.deptId=K.formFilter.deptId,K.formFilterCopy.sysUserLoginName=K.formFilter.sysUserLoginName,K.formFilterCopy.showName=K.formFilter.showName,!0),W={loadTableData:x,verifyTableParameter:U,paged:!0},P=()=>new Promise((e,a)=>{let t={widgetType:"upms_dept"};k.If.list(t).then(a=>{e({dataList:(0,I.BN)(a.data.dataList,"deptId")})}).catch(e=>{a(e)})}),z={loadData:P,idKey:"deptId"},K=(0,y.Kh)({formFilter:{deptId:void 0,sysUserLoginName:void 0,showName:void 0},formFilterCopy:{deptId:void 0,sysUserLoginName:void 0,showName:void 0},sysUserWidget:(0,g.K)(W),deptId:{impl:(0,h.B)(z)},isInit:!1}),V=e=>{K.deptId.impl.onVisibleChange(e).catch(e=>{console.warn(e)})},G=e=>{K.formFilter.deptId=Array.isArray(e)?e[e.length-1]:void 0,J(!0)},M=()=>{let e=L.value;if(!N.value.multiple){if(null!=O.value&&""!==O.value){const e={loginName:O.value};return void(t.dialog?t.dialog.submit(e):S(!0,void 0,e))}e=(0,I.PH)(K.sysUserWidget.dataList,C.value,"userId")}t.dialog?t.dialog.submit(e):S(!0,void 0,e)},X=()=>{t.dialog&&t.dialog.submit(null)},B=()=>{const e={loginName:"${startUserName}"};t.dialog?t.dialog.submit(e):S(!0,void 0,e)},Q=()=>{const e={loginName:"${appointedAssignee}"};t.dialog?t.dialog.submit(e):S(!0,void 0,e)},j=e=>!(Array.isArray(N.value.usedUserIdList)&&N.value.usedUserIdList.length>0)||-1===N.value.usedUserIdList.indexOf(e.loginName),$=e=>{L.value=e},J=(e=!1)=>{e?K.sysUserWidget.refreshTable(!0,1):K.sysUserWidget.refreshTable(),K.isInit=!0};return(0,c.sV)(()=>{J()}),a({onClear:X}),(e,a)=>{const t=u.WK,k=i.xE,g=p._m,h=d.S2,I=r.S2,w=i.US,R=n.o8,T=o.ll,F=n.Up,S=o.MQ,L=s.uD,x=l.aQ;return(0,c.uX)(),(0,c.CE)("div",b,[(0,c.bF)(w,{"label-width":"100px",size:(0,y.R1)(_).defaultFormItemSize,"label-position":"right",onSubmit:a[6]||(a[6]=(0,m.D$)(()=>{},["prevent"]))},{default:(0,c.k6)(()=>[(0,c.bF)(h,{style:{"flex-wrap":"nowrap"}},{default:(0,c.k6)(()=>[(0,c.bF)(k,{label:"登录名称"},{default:(0,c.k6)(()=>[(0,c.bF)(t,{class:"filter-item",modelValue:(0,y.R1)(K).formFilter.sysUserLoginName,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,y.R1)(K).formFilter.sysUserLoginName=e),onChange:a[1]||(a[1]=e=>J(!0)),clearable:!0,placeholder:"登录名称",style:{width:"170px"}},null,8,["modelValue"])]),_:1}),(0,c.bF)(k,{label:"用户昵称"},{default:(0,c.k6)(()=>[(0,c.bF)(t,{class:"filter-item",modelValue:(0,y.R1)(K).formFilter.showName,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,y.R1)(K).formFilter.showName=e),onChange:a[3]||(a[3]=e=>J(!0)),clearable:!0,placeholder:"用户昵称",style:{width:"170px"}},null,8,["modelValue"])]),_:1}),(0,c.bF)(k,{label:"所属部门"},{default:(0,c.k6)(()=>[(0,c.bF)(g,{class:"filter-item",modelValue:(0,y.R1)(A),"onUpdate:modelValue":a[4]||(a[4]=e=>(0,y.i9)(A)?A.value=e:null),clearable:!0,placeholder:"所属部门",loading:(0,y.R1)(K).deptId.impl.loading,props:{value:"deptId",label:"deptName",checkStrictly:!0},onVisibleChange:V,options:(0,y.R1)(K).deptId.impl.dropdownList,onChange:G},null,8,["modelValue","loading","options"])]),_:1}),(0,c.bF)(t,{disabled:(0,y.R1)(N).multiple,size:(0,y.R1)(_).defaultFormItemSize,modelValue:(0,y.R1)(O),"onUpdate:modelValue":a[5]||(a[5]=e=>(0,y.i9)(O)?O.value=e:null),placeholder:"自定义用户",style:{width:"200px","margin-bottom":"16px","margin-left":"20px","flex-grow":"1"}},null,8,["disabled","size","modelValue"])]),_:1}),(0,c.bF)(h,{type:"flex",justify:"end",style:{"margin-bottom":"15px"}},{default:(0,c.k6)(()=>[(0,y.R1)(N).showStartUser?((0,c.uX)(),(0,c.Wv)(I,{key:0,type:"primary",size:(0,y.R1)(_).defaultFormItemSize,onClick:B},{default:(0,c.k6)(()=>a[8]||(a[8]=[(0,c.eW)(" 流程发起人 ")])),_:1,__:[8]},8,["size"])):(0,c.Q3)("",!0),(0,y.R1)(N).showAssignee?((0,c.uX)(),(0,c.Wv)(I,{key:1,type:"primary",size:(0,y.R1)(_).defaultFormItemSize,onClick:Q},{default:(0,c.k6)(()=>a[9]||(a[9]=[(0,c.eW)(" 使用指定审批人 ")])),_:1,__:[9]},8,["size"])):(0,c.Q3)("",!0),(0,c.bF)(I,{type:"primary",size:(0,y.R1)(_).defaultFormItemSize,onClick:M,disabled:!(0,y.R1)(D)},{default:(0,c.k6)(()=>a[10]||(a[10]=[(0,c.eW)(" 添加用户 ")])),_:1,__:[10]},8,["size","disabled"])]),_:1})]),_:1},8,["size"]),(0,c.bF)(h,null,{default:(0,c.k6)(()=>[(0,c.bF)(L,{span:24},{default:(0,c.k6)(()=>[(0,c.bF)(S,{class:"radio-table",modelValue:(0,y.R1)(C),"onUpdate:modelValue":a[7]||(a[7]=e=>(0,y.i9)(C)?C.value=e:null),style:{width:"100%"}},{default:(0,c.k6)(()=>[(0,c.bF)(F,{data:(0,y.R1)(K).sysUserWidget.dataList,size:(0,y.R1)(_).defaultFormItemSize,height:"410px","header-cell-class-name":"table-header-gray","row-key":"userId",onSortChange:(0,y.R1)(K).sysUserWidget.onSortChange,onSelectionChange:$},{empty:(0,c.k6)(()=>a[11]||(a[11]=[(0,c.Lk)("div",{class:"table-empty unified-font"},[(0,c.Lk)("img",{src:v}),(0,c.Lk)("span",null,"暂无数据")],-1)])),default:(0,c.k6)(()=>[(0,y.R1)(N).multiple?((0,c.uX)(),(0,c.Wv)(R,{key:0,"header-align":"center","reserve-selection":(0,y.R1)(N).multiple,align:"center",type:"selection",width:"50px",selectable:j},null,8,["reserve-selection"])):((0,c.uX)(),(0,c.Wv)(R,{key:1,label:"","header-align":"center",align:"center",width:"50px"},{default:(0,c.k6)(e=>[(0,c.bF)(T,{value:e.row.userId},null,8,["value"])]),_:1})),(0,c.bF)(R,{label:"用户名",prop:"loginName"}),(0,c.bF)(R,{label:"昵称",prop:"showName"}),(0,c.bF)(R,{label:"所属部门",prop:"deptIdDictMap.name"}),(0,c.bF)(R,{label:"账号类型",prop:"userTypeDictMap.name"}),(0,c.bF)(R,{label:"创建时间"},{default:(0,c.k6)(e=>[(0,c.Lk)("span",null,(0,f.v_)((0,y.R1)(E)(e.row.createTime,"day")),1)]),_:1})]),_:1},8,["data","size","onSortChange"])]),_:1},8,["modelValue"])]),_:1}),(0,c.bF)(L,{span:24},{default:(0,c.k6)(()=>[(0,c.bF)(h,{type:"flex",justify:"end",style:{"margin-top":"16px"}},{default:(0,c.k6)(()=>[(0,c.bF)(x,{total:(0,y.R1)(K).sysUserWidget.totalCount,"current-page":(0,y.R1)(K).sysUserWidget.currentPage,"page-size":(0,y.R1)(K).sysUserWidget.pageSize,"page-sizes":[10,20,50,100],layout:"total, prev, pager, next, sizes",onCurrentChange:(0,y.R1)(K).sysUserWidget.onCurrentPageChange,onSizeChange:(0,y.R1)(K).sysUserWidget.onPageSizeChange},null,8,["total","current-page","page-size","onCurrentChange","onSizeChange"])]),_:1})]),_:1})]),_:1})])}}}),S=t(71241);const _=(0,S.A)(F,[["__scopeId","data-v-16d68636"]]);var E=_},40299:function(e,a,t){t.d(a,{A:function(){return T}});var l=t(25136),s=(t(97042),t(19784),t(69957),t(9267)),o=(t(48493),t(65451)),n=(t(63390),t(68368)),i=(t(81208),t(12687)),r=(t(31112),t(47001),t(18111),t(22489),t(20116),t(7588),t(56768)),d=t(90144),p=t(45130),u=t(24232),c=t(61473),y=t(57477),m=t(47887),f=t(22414),v=t(64772),k=t(82572);const g={class:"process-viewer",style:{width:"100%"}},h={key:1,style:{position:"absolute",top:"0",left:"0",width:"100%"}};var I=(0,r.pM)({__name:"ProcessViewer",props:{xml:{},finishedInfo:{},allCommentList:{}},setup(e){const a=e,t=(0,k.l5)(),I=(0,d.KR)(),w=(0,d.KR)(),R=(0,d.KR)(!1),T=(0,d.KR)(),b=(0,d.KR)(1),F=(0,d.KR)(!0);let S=null;const _=(0,d.KR)(),E=(0,d.KR)(),O=(0,d.KR)(),C=(0,d.KR)(f.DiagramType.ORDINARY),L=()=>{b.value=1,S&&S.get("canvas").zoom("fit-viewport","auto")},A=(e=.1)=>{let a=Math.floor(100*b.value+100*e)/100;if(a>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");b.value=a,S&&S.get("canvas").zoom(b.value)},N=(e=.1)=>{let a=Math.floor(100*b.value-100*e)/100;if(a<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");b.value=a,S&&S.get("canvas").zoom(b.value)},D=e=>{switch(e){case f.SysFlowTaskOperationType.AGREE:case f.SysFlowTaskOperationType.MULTI_AGREE:return"success";case f.SysFlowTaskOperationType.REFUSE:case f.SysFlowTaskOperationType.PARALLEL_REFUSE:case f.SysFlowTaskOperationType.MULTI_REFUSE:return"warning";case f.SysFlowTaskOperationType.STOP:return"danger";default:return""}},x=()=>{I.value&&(I.value.innerHTML=""),S&&S.destroy(),S=null},U=()=>{if(!S)return;const e=S.get("canvas"),a=e._svg;a.appendChild(w.value)},W=(e=null)=>{E.value=void 0,T.value=void 0,null!=_.value&&null!=_.value.finishedTaskSet&&null!=e&&-1!==_.value.finishedTaskSet.indexOf(e.id)&&(E.value=e.id,T.value=e.businessObject?e.businessObject.name:void 0,O.value=(a.allCommentList||[]).filter(e=>e.taskKey===E.value),R.value=!0)},P=async e=>{if(x(),null!=e&&""!==e)try{if(S=new m.A({container:I.value,readOnly:!0}),S?S.on("element.click",({element:e})=>{W(e)}):console.warn("bpmnViewer is undefined"),F.value=!0,S){await S.importXML(e);const a=S.get("elementRegistry").find(e=>"bpmn:Process"===e.type);a?.businessObject?.extensionElements?.values&&a.businessObject.extensionElements.values.forEach(e=>{"flowable:Properties"!==e.$type&&"flowable:properties"!==e.$type||(e.values||e.$children).forEach(e=>{"$OrangeDiagramType"===e.name&&(C.value=e.value||0)})})}U()}catch(t){console.error(t),x()}finally{F.value=!1,a.finishedInfo&&z(a.finishedInfo)}},z=e=>{if(_.value=e,F.value||null==_.value||null==S)return;let{finishedSequenceFlowSet:a,finishedTaskSet:t,unfinishedTaskSet:l}=_.value;const s=S.get("canvas"),o=S.get("elementRegistry");Array.isArray(a)&&a.forEach(e=>{if(null!=e){let a=o.get(e);if(a){s.addMarker(e,"success");const t=a.businessObject.conditionExpression;t&&s.addMarker(e,"condition-expression")}}}),Array.isArray(t)&&t.forEach(e=>{if(null!=e){let a=o.get(e);a&&s.addMarker(e,"success")}}),Array.isArray(l)&&l.forEach(e=>{if(null!=e){let a=o.get(e);a&&s.addMarker(e,"current")}})};return(0,r.sV)(()=>{a.xml&&P(a.xml)}),(0,r.hi)(()=>{x()}),(0,r.wB)(()=>a.xml,e=>{e&&P(e)},{deep:!0}),(0,r.wB)(()=>a.finishedInfo,e=>{e&&z(e)},{deep:!0,immediate:!0}),(e,a)=>{const m=n.o8,k=i.u,_=n.Up,E=o.S2,x=s.kZ,U=l.S2,P=l.fg;return(0,r.uX)(),(0,r.CE)("div",g,[!(0,d.R1)(F)&&(0,d.R1)(S)&&(0,d.R1)(C)==(0,d.R1)(f.DiagramType).DINGDING?((0,r.uX)(),(0,r.Wv)(v.A,{key:0,bpmnModeler:(0,d.R1)(S),onElementClick:W,readonly:!0,finishedInfo:e.finishedInfo},null,8,["bpmnModeler","finishedInfo"])):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("div",{class:"process-canvas",style:{height:"100%"},ref_key:"processCanvas",ref:I},null,512),[[p.aG,!(0,d.R1)(F)&&(0,d.R1)(C)==(0,d.R1)(f.DiagramType).ORDINARY]]),(0,r.Lk)("defs",{ref_key:"customDefs",ref:w},a[4]||(a[4]=[(0,r.Lk)("marker",{id:"sequenceflow-end-white-success",viewBox:"0 0 20 20",refX:"11",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[(0,r.Lk)("path",{class:"success-arrow",d:"M 1 5 L 11 10 L 1 15 Z",style:{"stroke-width":"1px","stroke-linecap":"round","stroke-dasharray":"10000, 1"}})],-1),(0,r.Lk)("marker",{id:"conditional-flow-marker-white-success",viewBox:"0 0 20 20",refX:"-1",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[(0,r.Lk)("path",{class:"success-conditional",d:"M 0 10 L 8 6 L 16 10 L 8 14 Z",style:{"stroke-width":"1px","stroke-linecap":"round","stroke-dasharray":"10000, 1"}})],-1)]),512),(0,r.bF)(x,{class:"comment-dialog",title:(0,d.R1)(T)||"审批记录",modelValue:(0,d.R1)(R),"onUpdate:modelValue":a[0]||(a[0]=e=>(0,d.i9)(R)?R.value=e:null),"append-to-body":!0},{default:(0,r.k6)(()=>[(0,r.bF)(E,null,{default:(0,r.k6)(()=>[(0,r.bF)(_,{data:(0,d.R1)(O),size:(0,d.R1)(t).defaultFormItemSize,border:"","header-cell-class-name":"table-header-gray",height:"500px"},{empty:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.Lk)("div",{class:"table-empty unified-font"},[(0,r.Lk)("img",{src:c}),(0,r.Lk)("span",null,"暂无数据")],-1)])),default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"序号","header-align":"center",align:"center",type:"index",width:"70px"}),(0,r.bF)(m,{label:"执行人",prop:"createUsername",width:"150px"}),(0,r.bF)(m,{label:"操作",width:"150px"},{default:(0,r.k6)(e=>[(0,r.bF)(k,{size:(0,d.R1)(t).defaultFormItemSize,type:D(e.row.approvalType),effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,u.v_)((0,d.R1)(f.SysFlowTaskOperationType).getValue(e.row.approvalType)),1)]),_:2},1032,["size","type"]),null!=e.row.delegateAssignee?((0,r.uX)(),(0,r.Wv)(k,{key:0,size:(0,d.R1)(t).defaultFormItemSize,type:"success",effect:"plain",style:{"margin-left":"10px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,u.v_)(e.row.delegateAssignee),1)]),_:2},1032,["size"])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(m,{label:"审批意见"},{default:(0,r.k6)(e=>[(0,r.Lk)("span",null,(0,u.v_)(e.row.taskComment?e.row.taskComment:""),1)]),_:1}),(0,r.bF)(m,{label:"处理时间",prop:"createTime",width:"180px"})]),_:1},8,["data","size"])]),_:1})]),_:1},8,["title","modelValue"]),(0,d.R1)(C)==(0,d.R1)(f.DiagramType).ORDINARY?((0,r.uX)(),(0,r.CE)("div",h,[(0,r.bF)(E,{type:"flex",justify:"end"},{default:(0,r.k6)(()=>[(0,r.bF)(P,{key:"scale-control",size:"default"},{default:(0,r.k6)(()=>[(0,r.bF)(U,{size:"default",type:"default",plain:!0,disabled:(0,d.R1)(b)<=.3,icon:(0,d.R1)(y.ZoomOut),onClick:a[1]||(a[1]=e=>N())},null,8,["disabled","icon"]),(0,r.bF)(U,{size:"default",type:"default",style:{width:"90px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,u.v_)(Math.floor(10*(0,d.R1)(b)*10)+"%"),1)]),_:1}),(0,r.bF)(U,{size:"default",type:"default",plain:!0,disabled:(0,d.R1)(b)>=3.9,icon:(0,d.R1)(y.ZoomIn),onClick:a[2]||(a[2]=e=>A())},null,8,["disabled","icon"]),(0,r.bF)(U,{size:"default",type:"default",icon:(0,d.R1)(y.ScaleToOriginal),onClick:a[3]||(a[3]=e=>L())},null,8,["icon"]),(0,r.RG)(e.$slots,"default")]),_:3})]),_:3})])):(0,r.Q3)("",!0)])}}}),w=t(71241);const R=(0,w.A)(I,[["__scopeId","data-v-3aa8666a"]]);var T=R},42399:function(e,a,t){t.r(a),t.d(a,{default:function(){return q}});t(18111),t(7588),t(18237);var l=t(56768),s=t(90144),o=t(24232),n=t(164),i=t(26695),r=t(43881),d=t(61617),p=t(22414),u=t(82572),c=t(2403),y=(t(97042),t(63266),t(21929)),m=(t(98421),t(76408)),f=(t(87535),t(65451)),v=(t(63390),t(25136)),k=(t(69957),t(17851)),g=(t(68489),t(20709),t(12687)),h=(t(31112),t(61701),t(45130)),I=t(61473),w=t(99540),R=t(18191),T=t(68368),b=(t(81208),t(47001),t(44114),t(22489),t(20116),t(57477)),F=t(54428),S=t(27007),_=t(31372),E=t(42421);const O={class:"copy-select",span:24};var C=(0,l.pM)({__name:"index",props:{value:{default:()=>[]}},emits:["update:value"],setup(e,{emit:a}){const t=a,i=e,r=(0,u.l5)(),d=(0,s.KR)(!1),c={"${startUserName}":"流程发起人","${appointedAssignee}":"指定审批人 "},y=(0,s.KR)([]),m=new Map,f=(0,s.KR)([]),k=new Map,h=(0,s.KR)([]),w=new Map,R=(0,s.KR)([]),C=new Map,L=(0,l.EW)(()=>d.value&&Array.isArray(i.value)?i.value.map(e=>{let a=(e.id||"").split(",");switch(e.type){case p.SysFlowCopyForType.USER:{let t=e?.userName||[];a=a.map(e=>e&&""!==e?{id:e,name:c[e]?c[e]:t.find(a=>a.id===e)?.name||e}:void 0).filter(e=>null!=e);break}case p.SysFlowCopyForType.ROLE:a=a.map(e=>{let a=m.get(e);return a?{id:e,name:a.name}:void 0}).filter(e=>null!=e);break;case p.SysFlowCopyForType.DEPT:a=a.map(e=>{let a=k.get(e);return a?{id:e,name:a.name}:void 0}).filter(e=>null!=e);break;case p.SysFlowCopyForType.SELF_DEPT_LEADER:case p.SysFlowCopyForType.UP_DEPT_LEADER:a=[];break;case p.SysFlowCopyForType.POST:case p.SysFlowCopyForType.SELF_DEPT_POST:case p.SysFlowCopyForType.SLIBING_DEPT_POST:case p.SysFlowCopyForType.UP_DEPT_POST:a=a.map(e=>{let a=w.get(e);return a?{id:e,name:a.postName}:void 0}).filter(e=>null!=e);break;case p.SysFlowCopyForType.DEPT_POST:a=a.map(e=>{let a=C.get(e);return a?{id:e,name:a.deptName+" / "+a.postShowName}:void 0}).filter(e=>null!=e);break}return{...e,showNameList:a}}):[]),A=e=>{n.s.confirm("是否删除此抄送人？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let a=(i.value||[]).filter(a=>e.type!==a.type);t("update:value",a)}).catch(e=>{console.warn(e)})},N=(e,a)=>{n.s.confirm("是否移除此抄送人？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let l=(i.value||[]).filter(t=>{if(e.type===t.type){if(null==t.id||""===t.id)return!1;let e=(t.id||"").split(",");return e=e.filter(e=>e!==a.id),!(e.length<=0)&&(t.id=e.join(","),!0)}return!0});t("update:value",l)}).catch(e=>{console.warn(e)})},D=()=>{_.l.show("添加抄送人",E["default"],{area:"600px"},{roleList:y.value,deptList:f.value,postList:h.value,deptPostList:R.value,path:"thirdAddCopyForItem"},{width:"600px",height:"450px",pathName:"/thirdParty/thirdAddCopyForItem"}).then(e=>{x(e)}).catch(e=>{console.warn(e)})},x=e=>{let a=e.type,l=!1,s=(i.value||[]).map(t=>{if(t.type===a){l=!0;let a=(t.id||"").split(","),s=(e.id||"").split(","),o=a;return s.forEach(e=>{-1===o.indexOf(e)&&o.push(e)}),{...t,id:o.join(","),userName:e.userName}}return{...t}});l||s.push({...e}),t("update:value",s)},U=()=>new Promise((e,a)=>{let t={widgetType:"upms_dept",filter:{}};F.If.list(t,{showMask:!1}).then(a=>{let t=[];null==a.data.dataList&&(a.data.dataList=[]),a.data.dataList.forEach(e=>{const a={id:String(e.deptId),name:e.deptName,parentId:e.parentId,...e};k.set(a.id,a),t.push(a)}),f.value=(0,S.BN)(t),e(!0)}).catch(e=>{a(e)})}),W=()=>new Promise((e,a)=>{let t={widgetType:"upms_dept_post",filter:{}};F.If.list(t,{showMask:!1}).then(a=>{null==a.data.dataList&&(a.data.dataList=[]),a.data.dataList.forEach(e=>{C.set(e.deptPostId,e)}),R.value=a.data.dataList.sort((e,a)=>e.postLevel-a.postLevel),e(!0)}).catch(e=>{a(e)})}),P=()=>new Promise((e,a)=>{let t={widgetType:"upms_post",filter:{}};F.If.list(t,{showMask:!1}).then(a=>{null==a.data.dataList&&(a.data.dataList=[]),a.data.dataList.forEach(e=>{const a={id:String(e.postId),name:e.postName,...e};w.set(a.id,a)}),h.value=a.data.dataList,e(!0)}).catch(e=>{a(e)})}),z=()=>new Promise((e,a)=>{let t={widgetType:"upms_role",filter:{}};F.If.list(t,{showMask:!1}).then(a=>{null==a.data.dataList&&(a.data.dataList=[]),y.value=a.data.dataList.map(e=>({id:String(e.roleId),name:e.roleName,...e})),y.value.forEach(e=>{m.set(e.id,e)}),e(!0)}).catch(e=>{a(e)})});return(0,l.sV)(()=>{let e=[U(),P(),W(),z()];Promise.all(e).then(()=>{d.value=!0}).catch(e=>{console.warn(e)})}),(0,l.hi)(()=>{m.clear(),k.clear(),w.clear(),C.clear()}),(e,a)=>{const t=v.S2,n=T.o8,i=g.u,d=T.Up;return(0,l.uX)(),(0,l.CE)("div",O,[(0,l.bF)(d,{data:(0,s.R1)(L),"show-header":!1},{empty:(0,l.k6)(()=>a[1]||(a[1]=[(0,l.Lk)("div",{class:"table-empty unified-font"},[(0,l.Lk)("img",{src:I}),(0,l.Lk)("span",null,"暂无数据")],-1)])),default:(0,l.k6)(()=>[(0,l.bF)(n,{label:"操作",width:"28px"},{default:(0,l.k6)(e=>[(0,l.bF)(t,{link:"",icon:(0,s.R1)(b.Remove),onClick:a=>A(e.row)},null,8,["icon","onClick"])]),_:1}),(0,l.bF)(n,{label:"抄送类型",width:"150px"},{default:(0,l.k6)(e=>[(0,l.Lk)("span",null,(0,o.v_)((0,s.R1)(p.SysFlowCopyForType).getValue(e.row.type)),1)]),_:1}),(0,l.bF)(n,{label:"抄送对象"},{default:(0,l.k6)(e=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.row.showNameList,a=>((0,l.uX)(),(0,l.Wv)(i,{size:(0,s.R1)(r).defaultFormItemSize,type:"primary",effect:"dark",key:a.id,closable:"",onClose:t=>N(e.row,a)},{default:(0,l.k6)(()=>[(0,l.eW)((0,o.v_)(a.name),1)]),_:2},1032,["size","onClose"]))),128))]),_:1})]),_:1},8,["data"]),(0,l.bF)(t,{class:"add-btn",size:(0,s.R1)(r).defaultFormItemSize,icon:(0,s.R1)(b.Plus),onClick:a[0]||(a[0]=e=>D())},{default:(0,l.k6)(()=>a[2]||(a[2]=[(0,l.eW)("添加抄送人")])),_:1,__:[2]},8,["size","icon"])])}}}),L=t(71241);const A=(0,L.A)(C,[["__scopeId","data-v-0b1819d4"]]);var N=A,D=t(40299);const x={class:"flow-task",style:{position:"relative",padding:"16px 24px","background-color":"white"}},U={class:"task-title"},W={class:"text"};var P=(0,l.pM)({__name:"HandlerFlowTask",props:{processInstanceId:{},processDefinitionId:{},isRuntime:{type:[Boolean,String]},isDraft:{type:[Boolean,String],default:!1},flowEntryName:{},processInstanceInitiator:{},taskId:{},taskName:{},operationList:{}},emits:["start","submit","close","draft","printForm"],setup(e,{emit:a}){const t=(0,u.l5)(),n=a,i=e,r=(0,l.WQ)("mainContextHeight",200),T=(new Date).getTime(),F=(0,s.KR)("formInfo"),S=(0,s.KR)(),_=(0,s.KR)(),E=(0,s.Kh)({taskName:i.taskName,flowEntryName:i.flowEntryName,processInstanceInitiator:i.processInstanceInitiator}),O=(0,s.KR)([]),C=(0,s.KR)([]),L=(0,s.KR)([]),A=(0,l.EW)(()=>{const e=Array.isArray(i.operationList)?i.operationList:JSON.parse(i.operationList||"[]");return Array.isArray(e)?e.map(e=>{if(e.type===p.SysFlowTaskOperationType.MULTI_SIGN&&null!=e.multiSignAssignee){let a={...e.multiSignAssignee};return a.assigneeList=e.multiSignAssignee.assigneeList?a.assigneeList.split(","):void 0,{...e,multiSignAssignee:a}}return{...e}}):[]}),P=(0,l.EW)(()=>null==i.processInstanceId||i.isDraft||"true"===i.isDraft),z=(e,a)=>{if(a)return a;switch(e){case p.SysFlowTaskOperationType.AGREE:case p.SysFlowTaskOperationType.TRANSFER:case p.SysFlowTaskOperationType.CO_SIGN:case p.SysFlowTaskOperationType.SIGN_REDUCTION:case p.SysFlowTaskOperationType.BFORE_CONSIGN:case p.SysFlowTaskOperationType.AFTER_CONSIGN:case p.SysFlowTaskOperationType.MULTI_AGREE:case p.SysFlowTaskOperationType.MULTI_SIGN:case p.SysFlowTaskOperationType.SET_ASSIGNEE:return"primary";case p.SysFlowTaskOperationType.SAVE:return"success";case p.SysFlowTaskOperationType.REFUSE:case p.SysFlowTaskOperationType.PARALLEL_REFUSE:case p.SysFlowTaskOperationType.MULTI_REFUSE:return"default";case p.SysFlowTaskOperationType.REJECT:case p.SysFlowTaskOperationType.REJECT_TO_START:case p.SysFlowTaskOperationType.REJECT_TO_TASK:case p.SysFlowTaskOperationType.REVOKE:return"danger";default:return"default"}},K=e=>{switch(e){case p.SysFlowTaskOperationType.AGREE:case p.SysFlowTaskOperationType.MULTI_AGREE:case p.SysFlowTaskOperationType.SET_ASSIGNEE:return"success";case p.SysFlowTaskOperationType.REFUSE:case p.SysFlowTaskOperationType.PARALLEL_REFUSE:case p.SysFlowTaskOperationType.MULTI_REFUSE:return"warning";case p.SysFlowTaskOperationType.STOP:case p.SysFlowTaskOperationType.REJECT:case p.SysFlowTaskOperationType.REJECT_TO_START:case p.SysFlowTaskOperationType.REJECT_TO_TASK:case p.SysFlowTaskOperationType.REVOKE:return"danger";default:return""}},V=()=>{n("draft")},G=()=>{n("close")},M=e=>{e.type!==p.SysFlowTaskOperationType.PRINT_FORM?null==i.processInstanceId&&null==i.taskId?n("start",e,C.value,S.value):n("submit",e,C.value,S.value):n("printForm",e,C.value)},X=()=>{if(null==i.processInstanceId||""===i.processInstanceId)return;let e={processInstanceId:i.processInstanceId};d.wI.viewHighlightFlowData(e).then(e=>{_.value=e.data}).catch(e=>{console.warn(e)})},B=()=>{if(null==i.processDefinitionId||""===i.processDefinitionId)return;let e={processDefinitionId:i.processDefinitionId};d.wI.viewProcessBpmn(e).then(e=>{S.value=e.data}).catch(e=>{console.warn(e)})},Q=()=>{O.value=[],null!=i.processInstanceId&&""!==i.processInstanceId&&d.wI.listFlowTaskComment({processInstanceId:i.processInstanceId}).then(e=>{console.log("listFlowTaskComment",e),e.data&&(O.value=e.data.map(e=>({...e})))}).catch(e=>{console.warn(e)})},j=()=>{if(null==i.taskId)return;let e={processDefinitionId:i.processDefinitionId,processInstanceId:i.processInstanceId,taskId:i.taskId,historic:!(i.isRuntime||"true"===i.isRuntime)};d.wI.viewTaskUserInfo(e).then(e=>{L.value=(e.data||[]).map(e=>({...e}))}).catch(e=>{console.warn(e)})};return(0,l.sV)(()=>{X(),B(),Q(),j()}),(e,a)=>{const n=g.u,i=k.Zh,d=k.MQ,u=v.S2,X=f.S2,B=m.uD,Q=y.US,j=c.kA;return(0,l.uX)(),(0,l.CE)("div",x,[(0,l.Lk)("div",U,[(0,l.Lk)("div",null,[(0,l.Lk)("span",W,(0,o.v_)((0,s.R1)(E).flowEntryName),1),(0,s.R1)(E).taskName?((0,l.uX)(),(0,l.Wv)(n,{key:0,effect:"dark",size:e.size,type:"success"},{default:(0,l.k6)(()=>[(0,l.eW)((0,o.v_)("当前节点："+(0,s.R1)(E).taskName),1)]),_:1},8,["size"])):(0,l.Q3)("",!0),(0,s.R1)(E).processInstanceInitiator?((0,l.uX)(),(0,l.Wv)(n,{key:1,effect:"dark",size:e.size,type:"info"},{default:(0,l.k6)(()=>[(0,l.eW)((0,o.v_)("发起人："+(0,s.R1)(E).processInstanceInitiator),1)]),_:1},8,["size"])):(0,l.Q3)("",!0)])]),(0,l.bF)(X,{justify:"space-between",style:{"margin-bottom":"24px","flex-wrap":"nowrap"}},{default:(0,l.k6)(()=>[(0,l.bF)(d,{size:"default",modelValue:(0,s.R1)(F),"onUpdate:modelValue":a[0]||(a[0]=e=>(0,s.i9)(F)?F.value=e:null),style:{"min-width":"400px"}},{default:(0,l.k6)(()=>[(0,l.bF)(i,{value:"formInfo"},{default:(0,l.k6)(()=>a[3]||(a[3]=[(0,l.eW)("表单信息")])),_:1,__:[3]}),null==e.processInstanceId||e.isRuntime||"true"===e.isRuntime||e.isDraft||"true"===e.isDraft?((0,l.uX)(),(0,l.Wv)(i,{key:0,value:"copyInfo"},{default:(0,l.k6)(()=>a[4]||(a[4]=[(0,l.eW)(" 抄送设置 ")])),_:1,__:[4]})):(0,l.Q3)("",!0),null==e.processInstanceId||e.isDraft?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(i,{key:1,value:"flowProcess"},{default:(0,l.k6)(()=>a[5]||(a[5]=[(0,l.eW)("流程图")])),_:1,__:[5]})),null==e.processInstanceId||e.isDraft?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(i,{key:2,value:"approveInfo"},{default:(0,l.k6)(()=>a[6]||(a[6]=[(0,l.eW)("审批记录")])),_:1,__:[6]})),null==e.taskId||e.isDraft?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(i,{key:3,value:"assigneeList"},{default:(0,l.k6)(()=>a[7]||(a[7]=[(0,l.eW)("审批人")])),_:1,__:[7]}))]),_:1},8,["modelValue"]),(0,l.bF)(X,{class:"task-operation",justify:"end",style:{"flex-wrap":"nowrap"}},{default:(0,l.k6)(()=>[(0,s.R1)(P)?((0,l.uX)(),(0,l.Wv)(u,{key:0,size:"default",type:"success",plain:!0,onClick:V},{default:(0,l.k6)(()=>a[8]||(a[8]=[(0,l.eW)("保存草稿")])),_:1,__:[8]})):(0,l.Q3)("",!0),e.$slots.operations?(0,l.RG)(e.$slots,"operations",{key:1}):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:2},(0,l.pI)((0,s.R1)(A),(e,a)=>((0,l.uX)(),(0,l.Wv)(u,{key:a,size:"default",type:z(e.type,e.buttonStyle)||"primary",icon:e.buttonIcon?b[e.buttonIcon]:void 0,plain:!(!e.buttonPlain||"true"!=e.buttonPlain)||!1,onClick:a=>M(e)},{default:(0,l.k6)(()=>[(0,l.eW)((0,o.v_)(e.label),1)]),_:2},1032,["type","icon","plain","onClick"]))),128))]),_:3})]),_:3}),(0,l.bF)(j,{class:"custom-scroll",style:(0,o.Tr)({height:(0,s.R1)(r)-180+"px"})},{default:(0,l.k6)(()=>[(0,l.bF)(Q,{ref:"form",class:"full-width-input",style:{width:"100%"},"label-width":"100px",size:e.size,"label-position":"right",onSubmit:a[2]||(a[2]=(0,h.D$)(()=>{},["prevent"]))},{default:(0,l.k6)(()=>[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(X,{type:"flex",key:(0,s.R1)(T)},{default:(0,l.k6)(()=>[(0,l.RG)(e.$slots,"default")]),_:3})),[[h.aG,"formInfo"===(0,s.R1)(F)]]),(0,l.bo)((0,l.bF)(X,{gutter:20},{default:(0,l.k6)(()=>[(0,l.bF)(B,{span:24},{default:(0,l.k6)(()=>[(0,l.bF)((0,s.R1)(w.CP),{data:(0,s.R1)(O),size:(0,s.R1)(t).defaultFormItemSize,"header-cell-class-name":"table-header-gray",height:(0,s.R1)(r)-150+"px","row-config":{isHover:!0}},{empty:(0,l.k6)(()=>a[9]||(a[9]=[(0,l.Lk)("div",{class:"table-empty unified-font"},[(0,l.Lk)("img",{src:I}),(0,l.Lk)("span",null,"暂无数据")],-1)])),default:(0,l.k6)(()=>[(0,l.bF)((0,s.R1)(w.Wq),{title:"序号",type:"seq",width:"100"}),(0,l.bF)((0,s.R1)(w.Wq),{title:"流程环节",field:"taskName"}),(0,l.bF)((0,s.R1)(w.Wq),{title:"实际审批人",field:"createUsername"}),(0,l.bF)((0,s.R1)(w.Wq),{title:"受委托人",field:"delegateShowName"}),(0,l.bF)((0,s.R1)(w.Wq),{title:"审批操作"},{default:(0,l.k6)(e=>[(0,l.bF)(n,{size:(0,s.R1)(t).defaultFormItemSize,type:K(e.row.approvalType),effect:"dark"},{default:(0,l.k6)(()=>[(0,l.eW)((0,o.v_)((0,s.R1)(p.SysFlowTaskOperationType).getValue(e.row.approvalType)),1)]),_:2},1032,["size","type"]),null!=e.row.delegateAssignee?((0,l.uX)(),(0,l.Wv)(n,{key:0,size:(0,s.R1)(t).defaultFormItemSize,type:"success",effect:"plain",style:{"margin-left":"10px"}},{default:(0,l.k6)(()=>[(0,l.eW)((0,o.v_)(e.row.delegateAssignee),1)]),_:2},1032,["size"])):(0,l.Q3)("",!0)]),_:1}),(0,l.bF)((0,s.R1)(w.Wq),{title:"审批意见"},{default:(0,l.k6)(e=>[(0,l.Lk)("span",null,(0,o.v_)(e.row.taskComment?e.row.taskComment:""),1)]),_:1}),(0,l.bF)((0,s.R1)(w.Wq),{title:"处理时间",field:"createTime"})]),_:1},8,["data","size","height"])]),_:1})]),_:1},512),[[h.aG,"approveInfo"===(0,s.R1)(F)]]),"flowProcess"===(0,s.R1)(F)?((0,l.uX)(),(0,l.Wv)(X,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(D.A,{style:(0,o.Tr)({height:(0,s.R1)(r)-148+"px"}),xml:(0,s.R1)(S),finishedInfo:(0,s.R1)(_),allCommentList:(0,s.R1)(O)},null,8,["style","xml","finishedInfo","allCommentList"])]),_:1})):(0,l.Q3)("",!0),(0,l.bo)((0,l.bF)(X,null,{default:(0,l.k6)(()=>[(0,l.bF)(B,{span:24,style:{"border-top":"1px solid #ebeef5"}},{default:(0,l.k6)(()=>[(0,l.bF)(N,{value:(0,s.R1)(C),"onUpdate:value":a[1]||(a[1]=e=>(0,s.i9)(C)?C.value=e:null)},null,8,["value"])]),_:1})]),_:1},512),[[h.aG,"copyInfo"===(0,s.R1)(F)]]),(0,l.bo)((0,l.bF)(X,{gutter:20},{default:(0,l.k6)(()=>[(0,l.bF)(B,{span:24},{default:(0,l.k6)(()=>[(0,l.bF)((0,s.R1)(w.CP),{data:(0,s.R1)(L),size:(0,s.R1)(t).defaultFormItemSize,"header-cell-class-name":"table-header-gray",height:(0,s.R1)(r)-150+"px","row-config":{isHover:!0}},{empty:(0,l.k6)(()=>a[10]||(a[10]=[(0,l.Lk)("div",{class:"table-empty unified-font"},[(0,l.Lk)("img",{src:I}),(0,l.Lk)("span",null,"暂无数据")],-1)])),default:(0,l.k6)(()=>[(0,l.bF)((0,s.R1)(w.Wq),{title:"序号",type:"seq",width:"100"}),(0,l.bF)((0,s.R1)(w.Wq),{title:"审批人登录名",field:"loginName"}),(0,l.bF)((0,s.R1)(w.Wq),{title:"审批人姓名",field:"showName"}),(0,l.bF)((0,s.R1)(w.Wq),{title:"被委托人",field:"delegatedUsername"}),(0,l.bF)((0,s.R1)(w.Wq),{title:"处理时间",field:"lastApprovalTime"})]),_:1},8,["data","size","height"])]),_:1})]),_:1},512),[[h.aG,"assigneeList"===(0,s.R1)(F)]])]),_:3},8,["size"])]),_:3},8,["style"]),(0,l.bF)(R.A,{onClose:G})])}}});const z=(0,L.A)(P,[["__scopeId","data-v-1525f695"]]);var K=z,V=t(81387),G=t(71066),M=t(91906);const X=e=>{(0,u.l5)();const a=(0,V.rd)(),t=(0,V.lq)(),o=(0,s.KR)(),{thirdParams:n}=(0,G.P)(e),r=(0,l.EW)(()=>{let a=null==e.operationList||""===e.operationList?n.value.operationList:e.operationList;return a="string"==typeof a?JSON.parse(a):a,{isRuntime:"true"===e.isRuntime||n.value.isRuntime||!1,isDraft:"true"===e.isDraft||n.value.isDraft||!1,isPreview:"true"===e.isPreview||n.value.isPreview||!1,processDefinitionKey:e.processDefinitionKey||n.value.processDefinitionKey,formId:e.formId||n.value.formId,routerName:e.routerName||n.value.routerName,readOnly:"true"===e.readOnly||n.value.readOnly,messageId:e.messageId||n.value.messageId,processInstanceId:e.processInstanceId||n.value.processInstanceId,processDefinitionId:e.processDefinitionId||n.value.processDefinitionId,taskId:e.taskId||n.value.taskId,flowEntryName:e.flowEntryName||n.value.flowEntryName,processInstanceInitiator:e.processInstanceInitiator||n.value.processInstanceInitiator,taskName:e.taskName||n.value.taskName,operationList:a,variableList:"string"==typeof e.variableList?JSON.parse(e.variableList):e.variableList||n.value.variableList,delegateUserId:e.delegateUserId||n.value.delegateUserId}}),c=(e,a=!0,t=void 0)=>new Promise((l,s)=>{const o={taskId:r.value.taskId,processInstanceId:r.value.processInstanceId,newAssignees:Array.isArray(e)?e:e.split(","),isAdd:a,before:t};d.wI.submitConsign(o).then(()=>{i.nk.success(null!=t||a?"加签成功！":"减签成功！"),l(!0)}).catch(e=>{console.warn("加签异常",e),s()})}),y=()=>{e.dialog?e.dialog.cancel():(t.meta.refreshParentCachedPage=!0,a.go(-1))},m=(e,a,t,l=null)=>new Promise((s,n)=>{if(null==e)return void(a?s(null):n());let i=!a&&e.type!==p.SysFlowTaskOperationType.REVOKE||e.type===p.SysFlowTaskOperationType.SET_ASSIGNEE;if(e.type===p.SysFlowTaskOperationType.MULTI_SIGN&&(i=!e.multiSignAssignee||!Array.isArray(e.multiSignAssignee.assigneeList)||e.multiSignAssignee.assigneeList.length<=0),i){let i="提交";if(!a)switch(e.type){case p.SysFlowTaskOperationType.CO_SIGN:case p.SysFlowTaskOperationType.SIGN_REDUCTION:case p.SysFlowTaskOperationType.BFORE_CONSIGN:case p.SysFlowTaskOperationType.AFTER_CONSIGN:i=p.SysFlowTaskOperationType.getValue(e.type);break;default:i="审批";break}_.l.show(i,M["default"],{area:"500px"},{operation:e,rowData:{copyItemList:l,operation:e},copyItemList:l,processInstanceId:r.value.processInstanceId,taskId:r.value.taskId,xml:t,finishedInfo:(o.value||{}).finishedInfo,path:"thirdTaskCommit"},{width:"500px",height:"380px",pathName:"/thirdParty/thirdTaskCommit"}).then(e=>{s(e)}).catch(e=>{n(e)})}else s(null)});return{handlerFlowTaskRef:o,dialogParams:r,submitConsign:c,handlerClose:y,preHandlerOperation:m}};var B=t(52125),Q=t.n(B);const j=async(e,a)=>{if(e)try{i.nk.info("正在准备打印...");const t=e.querySelectorAll(".active-widget-drag, .menu");t.forEach(e=>e.style.display="none"),e=e.querySelector(".el-scrollbar__view")||e;const l=await Q()(e,{logging:!1,allowTaint:!0,scale:2,scrollY:0,scrollX:0,useCORS:!0,backgroundColor:"#ffffff",onclone:e=>{const a=e.createElement("style");a.textContent="\n          * {\n            -webkit-print-color-adjust: exact !important;\n            color-adjust: exact !important;\n            print-color-adjust: exact !important;\n          }\n          table, th, tr, td {\n            border: 1px solid #000 !important;\n            border-collapse: collapse !important;\n          }\n          .el-table {\n            border: 1px solid #000 !important;\n          }\n          .el-table__header-wrapper th {\n            background-color: #ffffff !important;\n            color: #000 !important;\n            border: 1px solid #000 !important;\n          }\n          .el-table__body-wrapper td {\n            border: 1px solid #000 !important;\n          }\n          /** element 样式重写，可参考这里 */\n          .el-textarea__inner, .el-input__wrapper, .el-select__wrapper {\n            box-shadow: none !important;\n            border: 1px solid #dcdfe6 !important;\n            border-radius: 4px !important;\n            transition: none !important;\n          }\n          .no-print {\n            display: none !important;\n          }\n        ",e.head.appendChild(a)}}),s=window.open("","_blank");if(!s)throw new Error("无法打开打印窗口");s.document.write(`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>${a}</title>\n          <meta charset="utf-8">\n          <style>\n            @page {\n              size: A4;\n              margin: 0;\n              margin-top: 0mm;\n              margin-bottom: 0mm;\n            }\n            body {\n              margin: 0;\n              padding: 0;\n              -webkit-print-color-adjust: exact !important;\n              print-color-adjust: exact !important;\n            }\n            .container {\n              padding: 28px;\n              box-sizing: border-box;\n            }\n            img {\n              max-width: 100%;\n              height: auto;\n              display: block;\n              margin: 0 auto;\n              page-break-inside: avoid;\n            }\n          </style>\n        </head>\n        <body>\n          <div class="container">\n            <img src="${l.toDataURL("image/png",1)}" />\n          </div>\n          <script>\n            window.onload = () => {\n              setTimeout(() => {\n                window.print();\n                window.close();\n              }, 500);\n            };\n          <\/script>\n        </body>\n      </html>\n    `),s.document.close(),i.nk.success("打印准备完成")}catch(t){i.nk.error("打印失败: "+t),console.error("打印错误:",t)}else i.nk.warning("打印内容未准备好")};var $=(0,l.pM)({__name:"index",props:{isRuntime:{type:[Boolean,String]},isDraft:{type:[Boolean,String]},isPreview:{type:[Boolean,String]},processDefinitionKey:{},formId:{},routerName:{},readOnly:{type:[Boolean,String]},messageId:{},processInstanceId:{},processDefinitionId:{},taskId:{},flowEntryName:{},processInstanceInitiator:{},taskName:{},taskKey:{},operationList:{},variableList:{},dialog:{},delegateUserId:{},thirdParamsString:{},dialogKey:{}},setup(e){(0,V.lq)();const a=e,t=(0,l.WQ)("mainContextHeight",200),c=(0,s.KR)(),y=(0,s.KR)(),m=(0,s.KR)(!1),f=(0,s.KR)(),v=(0,s.KR)(),k=(0,s.KR)(),g=(0,s.KR)(),{handlerFlowTaskRef:h,preHandlerOperation:I,submitConsign:w,handlerClose:R,dialogParams:T}=X(a),b=(0,l.EW)(()=>!!T.value.formId),F=(0,l.EW)(()=>"string"===typeof T.value.isDraft?"true"===T.value.isDraft:T.value.isDraft),S=(0,l.EW)(()=>"string"===typeof T.value.isPreview?"true"===T.value.isPreview:T.value.isPreview),_=(0,l.EW)(()=>"string"===typeof T.value.isRuntime?"true"===T.value.isRuntime:T.value.isRuntime),E=(0,l.EW)(()=>"string"===typeof T.value.readOnly?"true"===T.value.readOnly:T.value.readOnly),O=(0,l.EW)(()=>({processInstanceId:T.value.processInstanceId,taskId:T.value.taskId,processDefinitionKey:T.value.processDefinitionKey,processInstanceInitiator:T.value.processInstanceInitiator,messageId:T.value.messageId,isRuntime:_.value,isDraft:F.value,delegateUserId:T.value.delegateUserId})),C=(0,l.EW)(()=>{let e=T.value.variableList;const a=Array.isArray(e)?e:JSON.parse(e||"[]");return a}),L=(0,u.JX)(),A=e=>y.value&&"function"===typeof y.value[e]?y.value[e]:void 0,N=(e,a)=>new Promise((t,l)=>{if(!b.value||!c.value.getFormData){let e=A("getMasterData");return e?e(C):l()}c.value.getFormData(!1,C).then(s=>{if(console.log("handleerFlowTask.getMasterData 表单数据",s),null==s)return void l();const o=a&&""!==a?a.split(","):void 0;e===p.SysFlowTaskOperationType.MULTI_SIGN?(null==s.taskVariableData&&(s.taskVariableData={}),s.taskVariableData.assigneeList=o):e===p.SysFlowTaskOperationType.SET_ASSIGNEE&&(null==s.taskVariableData&&(s.taskVariableData={}),s.taskVariableData.appointedAssignee=o?o.join(","):void 0),t(s)}).catch(e=>{l(e)})}),D=(e,a,t)=>{if([p.SysFlowTaskOperationType.CO_SIGN,p.SysFlowTaskOperationType.SIGN_REDUCTION,p.SysFlowTaskOperationType.BFORE_CONSIGN,p.SysFlowTaskOperationType.AFTER_CONSIGN].includes(e.type)){let a;return e.type!==p.SysFlowTaskOperationType.BFORE_CONSIGN&&e.type!==p.SysFlowTaskOperationType.AFTER_CONSIGN||(a=e.type===p.SysFlowTaskOperationType.BFORE_CONSIGN),void w((t||{}).assignee,e.type===p.SysFlowTaskOperationType.CO_SIGN,a).then(()=>{R()}).catch(e=>{console.warn(e)})}e.type!==p.SysFlowTaskOperationType.FREE_JUMP?e.type!==p.SysFlowTaskOperationType.REJECT&&e.type!==p.SysFlowTaskOperationType.REJECT_TO_TASK?e.type!==p.SysFlowTaskOperationType.REJECT_TO_START?e.type!==p.SysFlowTaskOperationType.REVOKE?N(e.type,(t||{}).assignee).then(l=>{let s,o={taskId:T.value.taskId||f.value,processInstanceId:T.value.processInstanceId||v.value,delegateUserId:T.value.delegateUserId,masterData:l.masterData,slaveData:l.slaveData,flowTaskCommentDto:{taskComment:(t||{}).message,approvalType:e.type,delegateAssignee:e.type===p.SysFlowTaskOperationType.TRANSFER?(t||{}).assignee:void 0},taskVariableData:{...l.taskVariableData,latestApprovalStatus:e.latestApprovalStatus},copyData:(a||[]).reduce((e,a)=>(e[a.type]=a.id,e),{})};if(null!=e.variableList&&""!==e.variableList)if("string"===typeof e.variableList)try{s=JSON.parse(e.variableList)}catch(n){console.error(n)}else s=e.variableList;null!=s&&(o.taskVariableData={...o.taskVariableData,...s}),d.wI.submitUserTask(o).then(()=>{R(),L.reloadMessage(),i.nk.success("提交成功！")}).catch(e=>{console.warn(e)})}).catch(e=>{console.warn(e)}):n.s.confirm("是否撤销此任务？","",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.wI.revokeHistoricTask({processInstanceId:T.value.processInstanceId,taskId:T.value.taskId,taskComment:"任务处理人撤销任务",taskVariableData:{latestApprovalStatus:e.latestApprovalStatus},delegateUserId:T.value.delegateUserId}).then(()=>{R()}).catch(e=>{console.warn(e)})}).catch(e=>{console.warn(e)}):d.wI.rejectToStartUserTask({processInstanceId:T.value.processInstanceId,taskId:T.value.taskId,taskComment:(t||{}).message,taskVariableData:{latestApprovalStatus:e.latestApprovalStatus},delegateUserId:T.value.delegateUserId}).then(()=>{R()}).catch(e=>{console.warn(e)}):d.wI.rejectRuntimeTask({processInstanceId:T.value.processInstanceId,taskId:T.value.taskId,targetTaskKey:(t||{}).targetTaskKey,taskComment:(t||{}).message,taskVariableData:{latestApprovalStatus:e.latestApprovalStatus},delegateUserId:T.value.delegateUserId}).then(()=>{R()}).catch(e=>{console.warn(e)}):d.wI.freeJump({processInstanceId:T.value.processInstanceId,sourceTaskId:T.value.taskId,targetTaskKey:(t||{}).targetTaskKey,delegateAssignee:(t||{}).assignee,taskComment:(t||{}).message,taskVariableData:{latestApprovalStatus:e.latestApprovalStatus},delegateUserId:T.value.delegateUserId}).then(()=>{R()}).catch(e=>{console.warn(e)})},x=(e,a,t)=>{if(b.value)I(e,m.value||F.value,t,a).then(t=>{D(e,a,t)}).catch(e=>{console.warn(e)});else{let l=A("handlerOperation");l?l(e,a,t).then(()=>{R()}).catch(e=>{console.warn(e)}):i.nk.error("当前流程并未实现处理功能，请联系管理员！")}},U=(e,a,t)=>{if(null==v.value||null==f.value)if(b.value)I(e,!0,t).then(t=>{N(e.type,(t||{}).assignee).then(t=>{let l,s={processDefinitionKey:T.value.processDefinitionKey,masterData:t.masterData||{},slaveData:t.slaveData,taskVariableData:{...t.taskVariableData,latestApprovalStatus:e.latestApprovalStatus},flowTaskCommentDto:{approvalType:e.type},copyData:(a||[]).reduce((e,a)=>(e[a.type]=a.id,e),{})};if(null!=e.variableList&&""!==e.variableList)if("string"===typeof e.variableList)try{l=JSON.parse(e.variableList)}catch(o){console.error(o)}else l=e.variableList;null!=l&&(s.taskVariableData={...s.taskVariableData,...l}),d.wI.startAndTakeUserTask(s,{processDefinitionKey:S.value?void 0:T.value.processDefinitionKey}).then(()=>{R(),i.nk.success("启动成功！")}).catch(e=>{console.warn(e)})}).catch(e=>{console.warn(e)})}).catch(e=>{console.warn(e)});else{let l=A("handlerStart");null!=l?l(e,a,t).then(()=>{R()}).catch(e=>{console.warn(e)}):i.nk.error("当前流程并未实现启动功能，请联系管理员！")}else x(e,a,t)},W=()=>new Promise((e,a)=>{c.value.getFormData(!0).then(a=>{e(a)}).catch(e=>{a(e)})}),P=()=>{if(b.value)W().then(e=>{if(null==e)return;let a={processDefinitionKey:T.value.processDefinitionKey,processInstanceId:T.value.processInstanceId||v.value,masterData:e.masterData,slaveData:e.slaveData};d.wI.startAndSaveDraft(a,{processDefinitionKey:T.value.processDefinitionKey}).then(e=>{i.nk.success("草稿保存成功！"),v.value=e.data.processInstanceId,f.value=e.data.taskId}).catch(e=>{console.warn(e)})}).catch(e=>{console.warn(e)});else{let e=A("handlerDraft");e?e().catch(e=>{console.warn(e)}):i.nk.error("当前流程并未实现保存草稿，请联系管理员！")}},z=()=>{if(null!=T.value.processInstanceId&&""!==T.value.processInstanceId&&null!=T.value.formId)if(b.value){let e={processInstanceId:T.value.processInstanceId,taskId:T.value.taskId,delegateUserId:T.value.delegateUserId},a=null;a=F.value?d.wI.viewOnlineDraftData({processDefinitionKey:T.value.processDefinitionKey,processInstanceId:T.value.processInstanceId}):null!=T.value.messageId?d.wI.viewOnlineCopyBusinessData({messageId:T.value.messageId}):null!=T.value.taskId&&_.value?d.wI.viewUserTask(e):d.wI.viewHistoricProcessInstance(e),a.then(e=>{if(m.value=null==e.data,g.value=(e.data||{}).oneToMany,F.value&&null!=g.value){let e=(new Date).getTime();Object.keys(g.value).forEach(a=>{const t=g.value?g.value[a]:null;Array.isArray(t)&&t.forEach(a=>{a.__cascade_add_id__=e++})})}null!=(e.data||{}).masterAndOneToOne&&(k.value={...e.data.masterAndOneToOne})}).catch(e=>{console.warn(e)})}else{let e=A("initFormData");e?e():i.nk.error("当前流程并未实现页面初始化功能，请联系管理员！")}},G=async(e,a)=>{if(!c.value)return void i.nk.warning("打印内容未准备好");const t=c.value.$el,l=T.value.flowEntryName||"流程表单";await j(t,l)};return(0,l.sV)(()=>{z()}),(e,a)=>{const n=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.Wv)(K,{ref_key:"handlerFlowTaskRef",ref:h,processInstanceId:(0,s.R1)(T).processInstanceId,processDefinitionId:(0,s.R1)(T).processDefinitionId,flowEntryName:(0,s.R1)(T).flowEntryName,processInstanceInitiator:(0,s.R1)(T).processInstanceInitiator,taskId:(0,s.R1)(T).taskId,taskName:(0,s.R1)(T).taskName,operationList:(0,s.R1)(T).operationList,isRuntime:(0,s.R1)(_),isDraft:(0,s.R1)(F),onClose:(0,s.R1)(R),onStart:U,onSubmit:x,onDraft:P,onPrintForm:G},{default:(0,l.k6)(()=>[null==(0,s.R1)(T).routerName&&null!=(0,s.R1)(T).formId?((0,l.uX)(),(0,l.Wv)(r["default"],{key:0,ref_key:"workflowFormRef",ref:c,style:(0,o.Tr)([{width:"100%"},{height:(0,s.R1)(t)-188+"px"}]),formId:(0,s.R1)(T).formId,readOnly:(0,s.R1)(E),flowInfo:(0,s.R1)(O)},null,8,["style","formId","readOnly","flowInfo"])):(0,l.Q3)("",!0),(0,l.bF)(n,null,{default:(0,l.k6)(({Component:e,route:a})=>[((0,l.uX)(),(0,l.Wv)((0,l.$y)(e),{ref_key:"routerFlowForm",ref:y,key:a.path,style:{width:"100%"},isRuntimeTask:(0,s.R1)(_),isDraft:(0,s.R1)(F),readOnly:(0,s.R1)(E),processInstanceId:(0,s.R1)(T).processInstanceId,taskId:(0,s.R1)(T).taskId,taskVariableList:(0,s.R1)(C),delegateUserId:(0,s.R1)(T).delegateUserId},null,8,["isRuntimeTask","isDraft","readOnly","processInstanceId","taskId","taskVariableList","delegateUserId"]))]),_:1})]),_:1},8,["processInstanceId","processDefinitionId","flowEntryName","processInstanceInitiator","taskId","taskName","operationList","isRuntime","isDraft","onClose"])}}});const J=(0,L.A)($,[["__scopeId","data-v-a88f7a02"]]);var q=J},42421:function(e,a,t){t.r(a),t.d(a,{default:function(){return F}});var l=t(65451),s=(t(97042),t(63390),t(21929)),o=(t(98421),t(18888)),n=(t(3172),t(25136)),i=(t(69957),t(32465),t(85415)),r=(t(22243),t(7409),t(44114),t(18111),t(22489),t(7588),t(61701),t(56768)),d=t(90144),p=t(45130),u=t(26695),c=t(57477),y=t(27007),m=t(99397),f=t(19183),v=t(99564),k=t(31372),g=t(22414),h=t(71066),I=t(82572);const w={class:"form-single-fragment third-party-dlg",style:{position:"relative"}};var R=(0,r.pM)({__name:"addCopyForItem",props:{deptList:{},postList:{},deptPostList:{},roleList:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,I.l5)(),t=e,{thirdParams:R,onCloseThirdDialog:T}=(0,h.P)(t),b=(0,d.KR)(),F=(0,d.KR)([]),S=(0,d.KR)({type:g.SysFlowCopyForType.USER,id:void 0}),_=(0,d.KR)([]),E=(0,r.EW)(()=>({deptList:t.deptList||R.value.deptList,postList:t.postList||R.value.postList,deptPostList:t.deptPostList||R.value.deptPostList,roleList:t.roleList||R.value.roleList})),O=(0,r.EW)(()=>{let e=Array.isArray(b.value)?b.value[b.value.length-1]:void 0;return null==e?[]:E.value.deptPostList.filter(a=>a.deptId===e)}),C=()=>{t.dialog?t.dialog.cancel():T(!1)},L=()=>{if(S.value.type===g.SysFlowCopyForType.DEPT_POST&&(null==b.value||""===b.value))return void u.nk.warning("请选择抄送部门");if((null==S.value.id||""===S.value.id)&&S.value.type!==g.SysFlowCopyForType.SELF_DEPT_LEADER&&S.value.type!==g.SysFlowCopyForType.UP_DEPT_LEADER)return void u.nk.warning("请选择"+g.SysFlowCopyForType.getValue(S.value.type));let e=null;switch(S.value.type){case g.SysFlowCopyForType.ROLE:e=S.value.id.join(",");break;case g.SysFlowCopyForType.USER:case g.SysFlowCopyForType.DEPT:e=S.value.id;break;case g.SysFlowCopyForType.POST:case g.SysFlowCopyForType.SELF_DEPT_POST:case g.SysFlowCopyForType.SLIBING_DEPT_POST:case g.SysFlowCopyForType.UP_DEPT_POST:case g.SysFlowCopyForType.DEPT_POST:e=S.value.id.join(",");break;default:e="";break}const a={type:S.value.type,id:e,userName:_.value};t.dialog?t.dialog.submit(a):T(!1,void 0,a)},A=()=>{S.value.id=void 0},N=()=>{S.value.id=void 0,b.value=void 0,_.value=[],F.value=[]},D=()=>{let e=null==S.value.id||""===S.value.id?[]:S.value.id.split(",");k.l.show("添加抄送人",f["default"],{area:["1000px","650px"]},{multiple:!0,props:{label:"showName",value:"userId"},usedUserIdList:e,path:"thirdTaskUserSelect"},{width:"1000px",height:"690px",pathName:"/thirdParty/thirdTaskUserSelect"}).then(e=>{x(e)}).catch(e=>{console.warn(e)})},x=e=>{if(Array.isArray(e)){let a=_.value.map(e=>e.id);const t=[];e.forEach(e=>{-1===a.indexOf(e.loginName)&&t.push({id:e.loginName,name:e.showName||e.loginName})}),_.value=_.value.concat(t)}else _.value=e?[{id:e.loginName,name:e.showName||e.loginName}]:[]},U=()=>{let e=null==S.value.id||""===S.value.id?[]:S.value.id.split(",");k.l.show("选择部门",v["default"],{area:["600px","600px"]},{allGroupList:E.value.deptList,usedIdList:e,path:"thirdTaskGroupSelect"},{width:"600px",height:"630px",pathName:"/thirdParty/thirdTaskGroupSelect"}).then(e=>{W(e)}).catch(e=>{console.warn(e)})},W=e=>{if(Array.isArray(e)){const a=[];e.forEach(e=>{null==(0,y.PH)(F.value,e.id,"id")&&a.push(e)}),F.value=a}S.value.id=Array.isArray(F.value)?F.value.map(e=>e.id).join(","):""};return(0,r.wB)(_,e=>{let a=e.map(e=>e.id);S.value.id=a.join(",")},{deep:!0}),(e,t)=>{const u=i.P9,y=i.AV,f=s.xE,v=n.S2,k=o._m,h=s.US,I=l.S2;return(0,r.uX)(),(0,r.CE)("div",w,[(0,r.bF)(h,{ref:"form",model:(0,d.R1)(S),class:"full-width-input form-box",style:{width:"100%"},"label-width":"90px",size:(0,d.R1)(a).defaultFormItemSize,"label-position":"right",onSubmit:t[7]||(t[7]=(0,p.D$)(()=>{},["prevent"]))},{default:(0,r.k6)(()=>[(0,r.bF)(f,{label:"抄送类型",prop:"type"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{class:"input-item",modelValue:(0,d.R1)(S).type,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,d.R1)(S).type=e),placeholder:"抄送类型",onChange:N},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,d.R1)(g.SysFlowCopyForType).getList(),e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,d.R1)(S).type===(0,d.R1)(g.SysFlowCopyForType).USER?((0,r.uX)(),(0,r.Wv)(f,{key:0,label:"抄送人",prop:"id"},{default:(0,r.k6)(()=>[(0,r.bF)(m.A,{value:(0,d.R1)(_),"onUpdate:value":t[1]||(t[1]=e=>(0,d.i9)(_)?_.value=e:null)},{append:(0,r.k6)(()=>[(0,r.bF)(v,{class:"append-add",type:"default",icon:(0,d.R1)(c.Plus),onClick:D},null,8,["icon"])]),_:1},8,["value"])]),_:1})):(0,r.Q3)("",!0),(0,d.R1)(S).type===(0,d.R1)(g.SysFlowCopyForType).ROLE?((0,r.uX)(),(0,r.Wv)(f,{key:1,label:"抄送角色",prop:"id"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{modelValue:(0,d.R1)(S).id,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,d.R1)(S).id=e),placeholder:"",multiple:!0},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,d.R1)(E).roleList,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(0,r.Q3)("",!0),(0,d.R1)(S).type===(0,d.R1)(g.SysFlowCopyForType).DEPT?((0,r.uX)(),(0,r.Wv)(f,{key:2,label:"抄送部门",prop:"id"},{default:(0,r.k6)(()=>[(0,r.bF)(m.A,{value:(0,d.R1)(F),"onUpdate:value":t[3]||(t[3]=e=>(0,d.i9)(F)?F.value=e:null)},{append:(0,r.k6)(()=>[(0,r.bF)(v,{class:"append-add",type:"default",icon:(0,d.R1)(c.Plus),onClick:U},null,8,["icon"])]),_:1},8,["value"])]),_:1})):(0,r.Q3)("",!0),-1!==[(0,d.R1)(g.SysFlowCopyForType).POST,(0,d.R1)(g.SysFlowCopyForType).SELF_DEPT_POST,(0,d.R1)(g.SysFlowCopyForType).SLIBING_DEPT_POST,(0,d.R1)(g.SysFlowCopyForType).UP_DEPT_POST].indexOf((0,d.R1)(S).type)?((0,r.uX)(),(0,r.Wv)(f,{key:3,label:(0,d.R1)(g.SysFlowCopyForType).getValue((0,d.R1)(S).type),prop:"id"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{modelValue:(0,d.R1)(S).id,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,d.R1)(S).id=e),placeholder:"",multiple:!0},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,d.R1)(E).postList,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.postId,label:e.postName,value:e.postId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):(0,r.Q3)("",!0),(0,d.R1)(S).type===(0,d.R1)(g.SysFlowCopyForType).DEPT_POST?((0,r.uX)(),(0,r.Wv)(f,{key:4,label:"抄送部门",prop:"deptId"},{default:(0,r.k6)(()=>[(0,r.bF)(k,{modelValue:(0,d.R1)(b),"onUpdate:modelValue":t[5]||(t[5]=e=>(0,d.i9)(b)?b.value=e:null),clearable:!0,size:(0,d.R1)(a).defaultFormItemSize,placeholder:"",props:{value:"id",label:"name",checkStrictly:!0},options:(0,d.R1)(E).deptList,onChange:A},null,8,["modelValue","size","options"])]),_:1})):(0,r.Q3)("",!0),(0,d.R1)(S).type===(0,d.R1)(g.SysFlowCopyForType).DEPT_POST?((0,r.uX)(),(0,r.Wv)(f,{key:5,label:"抄送岗位",prop:"id"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{modelValue:(0,d.R1)(S).id,"onUpdate:modelValue":t[6]||(t[6]=e=>(0,d.R1)(S).id=e),placeholder:"",multiple:!0},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,d.R1)(O),e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.deptPostId,label:e.postShowName,value:e.deptPostId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(0,r.Q3)("",!0)]),_:1},8,["model","size"]),(0,r.bF)(I,{type:"flex",justify:"end",class:"no-scroll menu-box"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{size:(0,d.R1)(a).defaultFormItemSize,plain:!0,onClick:C},{default:(0,r.k6)(()=>t[8]||(t[8]=[(0,r.eW)(" 取消 ")])),_:1,__:[8]},8,["size"]),(0,r.bF)(v,{type:"primary",size:(0,d.R1)(a).defaultFormItemSize,onClick:L},{default:(0,r.k6)(()=>t[9]||(t[9]=[(0,r.eW)(" 保存 ")])),_:1,__:[9]},8,["size"])]),_:1})])}}}),T=t(71241);const b=(0,T.A)(R,[["__scopeId","data-v-6e74d280"]]);var F=b},43881:function(e,a,t){t.r(a),t.d(a,{default:function(){return g}});var l=t(56768),s=t(24232),o=t(90144),n=t(36947),i=t(21016),r=t(91324),d=t(86555),p=t(45352),u=t(54607),c=t(49825),y=t(77783),m=t(28181),f=(0,l.pM)({__name:"index",props:{formId:{},entryId:{},flowInfo:{},readOnly:{type:Boolean,default:!1}},setup(e,{expose:a}){const t=(0,l.WQ)("mainContextHeight",200),f=e,v=(0,o.KR)(),k=(0,o.KR)(),g=(0,o.KR)(!1),h=()=>{k.value=null},I=()=>{g.value=!1,h(),n.k$.render({formId:f.formId}).then(e=>{let a=e.data.onlineForm,t=JSON.parse(a.widgetJson);t=t.pc,k.value={rawData:e.data,readOnly:f.readOnly,formName:a.formName,formType:a.formType,formKind:a.formKind,masterTableId:a.masterTableId,labelWidth:t.labelWidth,labelPosition:t.labelPosition,filterItemWidth:t.filterItemWidth,gutter:t.gutter,height:t.height,width:t.width,widgetList:t.widgetList,operationList:(t.operationList||[]).sort((e,a)=>(e.showOrder||0)-(a.showOrder||0)),tableWidget:t.tableWidget,leftWidget:t.leftWidget,groupWidget:t.groupWidget,customFieldList:t.customFieldList,formEventList:t.formEventList,maskFieldList:t.maskFieldList,leftTreeRightTable:t.leftTreeRightTable},g.value=!0}).catch(e=>{console.log(e)})},w=(e,a)=>v.value?v.value.getFormData(e,a):Promise.reject();return a({getFormData:w}),(0,l.wB)(()=>f.formId,()=>{I()},{deep:!0,immediate:!0}),(e,a)=>((0,l.uX)(),(0,l.CE)("div",{class:(0,s.C4)({advance:(0,o.R1)(k)&&(0,o.R1)(k).formType===(0,o.R1)(i.SysOnlineFormType).ADVANCE_QUERY}),style:{position:"relative",width:"100",padding:"0 !important"}},[(0,o.R1)(g)&&(0,o.R1)(k)&&(0,o.R1)(k).formType===(0,o.R1)(i.SysOnlineFormType).QUERY?((0,l.uX)(),(0,l.Wv)(r.A,{key:0,height:(0,o.R1)(t)-32+"px",formConfig:(0,o.R1)(k)},null,8,["height","formConfig"])):(0,l.Q3)("",!0),(0,o.R1)(g)&&(0,o.R1)(k)&&(0,o.R1)(k).formType===(0,o.R1)(i.SysOnlineFormType).ADVANCE_QUERY?((0,l.uX)(),(0,l.Wv)(d.A,{key:1,height:(0,o.R1)(t)-32+"px",formConfig:(0,o.R1)(k)},null,8,["height","formConfig"])):(0,l.Q3)("",!0),(0,o.R1)(g)&&(0,o.R1)(k)&&(0,o.R1)(k).formType===(0,o.R1)(i.SysOnlineFormType).GROUP_QUERY?((0,l.uX)(),(0,l.Wv)(p.A,{key:2,height:e.getMainContextHeight-32+"px",formConfig:(0,o.R1)(k)},null,8,["height","formConfig"])):(0,l.Q3)("",!0),(0,o.R1)(g)&&(0,o.R1)(k)&&(0,o.R1)(k).formType===(0,o.R1)(i.SysOnlineFormType).ONE_TO_ONE_QUERY?((0,l.uX)(),(0,l.Wv)(u.A,{key:3,height:(0,o.R1)(t)-32+"px",formConfig:(0,o.R1)(k)},null,8,["height","formConfig"])):(0,l.Q3)("",!0),(0,o.R1)(g)&&(0,o.R1)(k)&&(0,o.R1)(k).formType===(0,o.R1)(i.SysOnlineFormType).FORM?((0,l.uX)(),(0,l.Wv)(c["default"],{key:4,formConfig:(0,o.R1)(k),readOnly:e.readOnly},null,8,["formConfig","readOnly"])):(0,l.Q3)("",!0),(0,o.R1)(g)&&(0,o.R1)(k)&&(0,o.R1)(k).formType===(0,o.R1)(i.SysOnlineFormType).FLOW?((0,l.uX)(),(0,l.Wv)(y.A,{key:5,ref_key:"workflow",ref:v,formConfig:(0,o.R1)(k),flowInfo:e.flowInfo,readOnly:e.readOnly},null,8,["formConfig","flowInfo","readOnly"])):(0,l.Q3)("",!0),(0,o.R1)(g)&&(0,o.R1)(k)&&(0,o.R1)(k).formType===(0,o.R1)(i.SysOnlineFormType).WORK_ORDER?((0,l.uX)(),(0,l.Wv)(m.A,{key:6,height:(0,o.R1)(t)-32+"px",formConfig:(0,o.R1)(k),entryId:e.entryId},null,8,["height","formConfig","entryId"])):(0,l.Q3)("",!0)],2))}}),v=t(71241);const k=(0,v.A)(f,[["__scopeId","data-v-7ee0ac23"]]);var g=k},68489:function(e,a,t){t(97042)},91906:function(e,a,t){t.r(a),t.d(a,{default:function(){return E}});var l=t(21929),s=(t(97042),t(98421),t(14022)),o=(t(72343),t(85415)),n=(t(22243),t(7409),t(65451)),i=(t(63390),t(12687)),r=(t(31112),t(25136)),d=(t(69957),t(76408)),p=(t(87535),t(32465),t(44114),t(18111),t(7588),t(61701),t(56768)),u=t(90144),c=t(45130),y=t(24232),m=t(57477),f=t(99397),v=t(19183),k=t(9924),g=t(61617),h=t(22414),I=t(99080),w=t(31372),R=t(71066),T=t(82572);const b={class:"form-single-fragment third-party-dlg",style:{position:"relative"}};var F=(0,p.pM)({__name:"TaskCommit",props:{operation:{},processInstanceId:{},taskId:{},xml:{},finishedInfo:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,T.l5)(),t=e,{thirdParams:F,onCloseThirdDialog:S}=(0,R.P)(t),_=(0,p.EW)(()=>a.defaultFormItemSize||F.value.defaultFormItemSize?.value),E=(0,u.KR)(),O=(0,u.KR)({message:void 0,assignee:void 0,targetTaskKey:void 0}),C=(0,p.EW)(()=>({operation:t.operation||F.value.operation||{},processInstanceId:t.processInstanceId||F.value.processInstanceId,taskId:t.taskId||F.value.taskId,xml:t.xml||F.value.xml,finishedInfo:t.finishedInfo||F.value.finishedInfo})),L=()=>new Promise((e,a)=>{g.wI.listMultiSignAssignees({processInstanceId:C.value.processInstanceId,taskId:C.value.taskId}).then(a=>{console.log(">>>listMultiSignAssigneesDropdownData<<<",a),e({dataList:a.data.sort((e,a)=>e.approved===a.approved?0:e.approved?1:-1)})}).catch(e=>{a(e)})}),A={loadData:L},N=(0,u.Kh)((0,I.B)(A)),D=()=>new Promise((e,a)=>{g.wI.listRejectCandidateUserTask({processInstanceId:C.value.processInstanceId,taskId:C.value.taskId}).then(a=>{e({dataList:a.data})}).catch(e=>{a(e)})}),x={loadData:D},U=(0,u.Kh)((0,I.B)(x)),W={message:[{required:!0,message:"审批意见不能为空",trigger:"blur"}],assignee:[{required:!0,message:"指派用户不能为空",trigger:"blur"}],targetTaskKey:[{required:!0,message:"任务节点不能为空",trigger:"blur"}]},P=(0,u.KR)([]);let z;const K=(0,p.EW)(()=>{let e=!1;return C.value.operation.type===h.SysFlowTaskOperationType.MULTI_SIGN&&(e=!C.value.operation.multiSignAssignee||!Array.isArray(C.value.operation.multiSignAssignee.assigneeList)||C.value.operation.multiSignAssignee.assigneeList.length<=0),-1!==[h.SysFlowTaskOperationType.TRANSFER,h.SysFlowTaskOperationType.CO_SIGN,h.SysFlowTaskOperationType.BFORE_CONSIGN,h.SysFlowTaskOperationType.AFTER_CONSIGN,h.SysFlowTaskOperationType.SET_ASSIGNEE].indexOf(C.value.operation.type)||e}),V=(0,p.EW)(()=>-1!==[h.SysFlowTaskOperationType.CO_SIGN,h.SysFlowTaskOperationType.MULTI_SIGN,h.SysFlowTaskOperationType.BFORE_CONSIGN,h.SysFlowTaskOperationType.AFTER_CONSIGN,h.SysFlowTaskOperationType.TRANSFER,h.SysFlowTaskOperationType.SET_ASSIGNEE].indexOf(C.value.operation.type)),G=()=>{t.dialog?t.dialog.cancel():S(!1)},M=()=>{E.value.validate(e=>{e&&(t.dialog?t.dialog.submit(O.value):S(!0,F.value.rowData,O.value))})},X=()=>{let e=null==O.value.assignee||""===O.value.assignee?[]:O.value.assignee.split(",");w.l.show("选择用户",v["default"],{area:["1000px","650px"]},{showAssignee:!1,showStartUser:C.value.operation.type!==h.SysFlowTaskOperationType.CO_SIGN&&C.value.operation.type!==h.SysFlowTaskOperationType.SIGN_REDUCTION&&C.value.operation.type!==h.SysFlowTaskOperationType.BFORE_CONSIGN&&C.value.operation.type!==h.SysFlowTaskOperationType.BFORE_CONSIGN,multiple:V.value,usedUserIdList:e,filterObject:z,path:"thirdTaskUserSelect"},{width:"1000px",height:"690px",pathName:"/thirdParty/thirdTaskUserSelect"}).then(e=>{B(e)}).catch(e=>{console.warn(e)})},B=e=>{if(Array.isArray(e)){let a=P.value.map(e=>e.id);e.forEach(e=>{-1===a.indexOf(e.loginName)&&P.value.push({id:e.loginName,name:e.showName||e.loginName})})}else P.value=e?[{id:e.loginName,name:e.showName||e.loginName}]:[]};return(0,p.sV)(()=>{t.operation&&t.operation.type===h.SysFlowTaskOperationType.SET_ASSIGNEE&&t.operation.multiSignAssignee&&t.operation.multiSignAssignee.assigneeType&&t.operation.multiSignAssignee.assigneeList&&(z={USER_FILTER_GROUP:JSON.stringify({type:t.operation.multiSignAssignee.assigneeType,values:t.operation.multiSignAssignee.assigneeList})})}),(0,p.wB)(P,e=>{if(e){let a=e.map(e=>e.id);O.value.assignee=a.join(",")}},{deep:!0}),(e,a)=>{const t=l.xE,v=d.uD,g=r.S2,I=i.u,w=n.S2,R=o.P9,T=o.AV,F=s.WK,S=l.US;return(0,p.uX)(),(0,p.CE)("div",b,[(0,p.bF)(S,{ref_key:"form",ref:E,model:(0,u.R1)(O),class:"full-width-input form-box",rules:W,style:{width:"100%"},"label-width":"100px",size:(0,u.R1)(_),"label-position":"right",onSubmit:a[5]||(a[5]=(0,c.D$)(()=>{},["prevent"]))},{default:(0,p.k6)(()=>[(0,p.bF)(w,{gutter:20},{default:(0,p.k6)(()=>[(0,u.R1)(C).operation.type===(0,u.R1)(h.SysFlowTaskOperationType).FREE_JUMP?((0,p.uX)(),(0,p.Wv)(v,{key:0,span:24},{default:(0,p.k6)(()=>[(0,p.bF)(t,{label:"任务节点",prop:"targetTaskKey"},{default:(0,p.k6)(()=>[(0,p.bF)(k.A,{value:(0,u.R1)(O).targetTaskKey,"onUpdate:value":a[0]||(a[0]=e=>(0,u.R1)(O).targetTaskKey=e),xml:(0,u.R1)(C).xml,finishedInfo:(0,u.R1)(C).finishedInfo,placeholder:"请选择跳转任务节点"},null,8,["value","xml","finishedInfo"])]),_:1})]),_:1})):(0,p.Q3)("",!0),(0,u.R1)(K)||(0,u.R1)(C).operation.type===(0,u.R1)(h.SysFlowTaskOperationType).FREE_JUMP?((0,p.uX)(),(0,p.Wv)(v,{key:1,span:24},{default:(0,p.k6)(()=>[(0,p.bF)(t,{label:"指派用户",prop:(0,u.R1)(C).operation.type===(0,u.R1)(h.SysFlowTaskOperationType).FREE_JUMP?void 0:"assignee"},{default:(0,p.k6)(()=>[(0,p.bF)(f.A,{value:(0,u.R1)(P),"onUpdate:value":a[1]||(a[1]=e=>(0,u.i9)(P)?P.value=e:null)},{append:(0,p.k6)(()=>[(0,p.bF)(g,{class:"append-add",type:"default",icon:(0,u.R1)(m.Plus),onClick:X},null,8,["icon"])]),_:1},8,["value"])]),_:1},8,["prop"])]),_:1})):(0,p.Q3)("",!0),(0,u.R1)(C).operation.type===(0,u.R1)(h.SysFlowTaskOperationType).SIGN_REDUCTION?((0,p.uX)(),(0,p.Wv)(v,{key:2,span:24},{default:(0,p.k6)(()=>[(0,p.bF)(t,{label:"减签用户",prop:"assignee"},{default:(0,p.k6)(()=>[(0,p.bF)(T,{modelValue:(0,u.R1)(O).assignee,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,u.R1)(O).assignee=e),placeholder:"",clearable:"",multiple:"","collapse-tags":"",loading:(0,u.R1)(N).loading,onVisibleChange:(0,u.R1)(N).onVisibleChange},{default:(0,p.k6)(()=>[((0,p.uX)(!0),(0,p.CE)(p.FK,null,(0,p.pI)((0,u.R1)(N).dropdownList,e=>((0,p.uX)(),(0,p.Wv)(R,{key:e.assignee,value:e.assignee,label:e.showName,disabled:e.approved},{default:(0,p.k6)(()=>[(0,p.bF)(w,{type:"flex",justify:"space-between",align:"middle"},{default:(0,p.k6)(()=>[(0,p.Lk)("span",null,(0,y.v_)(e.showName),1),e.approved?((0,p.uX)(),(0,p.Wv)(I,{key:0,size:"default",type:"info",style:{"margin-right":"10px"}},{default:(0,p.k6)(()=>a[6]||(a[6]=[(0,p.eW)("已处理")])),_:1,__:[6]})):(0,p.Q3)("",!0)]),_:2},1024)]),_:2},1032,["value","label","disabled"]))),128))]),_:1},8,["modelValue","loading","onVisibleChange"])]),_:1})]),_:1})):(0,p.Q3)("",!0),null!=(0,u.R1)(C).processInstanceId&&null!=(0,u.R1)(C).taskId&&(0,u.R1)(C).operation.type===(0,u.R1)(h.SysFlowTaskOperationType).REJECT_TO_TASK?((0,p.uX)(),(0,p.Wv)(v,{key:3,span:24},{default:(0,p.k6)(()=>[(0,p.bF)(t,{label:"驳回节点",prop:"targetTaskKey"},{default:(0,p.k6)(()=>[(0,p.bF)(T,{modelValue:(0,u.R1)(O).targetTaskKey,"onUpdate:modelValue":a[3]||(a[3]=e=>(0,u.R1)(O).targetTaskKey=e),loading:(0,u.R1)(U).loading,onVisibleChange:(0,u.R1)(U).onVisibleChange},{default:(0,p.k6)(()=>[((0,p.uX)(!0),(0,p.CE)(p.FK,null,(0,p.pI)((0,u.R1)(U).dropdownList,e=>((0,p.uX)(),(0,p.Wv)(R,{key:e.taskKey,value:e.taskKey,label:e.showName},null,8,["value","label"]))),128))]),_:1},8,["modelValue","loading","onVisibleChange"])]),_:1})]),_:1})):(0,p.Q3)("",!0),-1===[(0,u.R1)(h.SysFlowTaskOperationType).CO_SIGN,(0,u.R1)(h.SysFlowTaskOperationType).SIGN_REDUCTION,(0,u.R1)(h.SysFlowTaskOperationType).BFORE_CONSIGN,(0,u.R1)(h.SysFlowTaskOperationType).AFTER_CONSIGN,(0,u.R1)(h.SysFlowTaskOperationType).MULTI_SIGN].indexOf((0,u.R1)(C).operation.type)?((0,p.uX)(),(0,p.Wv)(v,{key:4,span:24},{default:(0,p.k6)(()=>[(0,p.bF)(t,{label:"审批意见",prop:"message"},{default:(0,p.k6)(()=>[(0,p.bF)(F,{modelValue:(0,u.R1)(O).message,"onUpdate:modelValue":a[4]||(a[4]=e=>(0,u.R1)(O).message=e),clearable:"",placeholder:"请输入审批意见"},null,8,["modelValue"])]),_:1})]),_:1})):(0,p.Q3)("",!0)]),_:1})]),_:1},8,["model","size"]),(0,p.bF)(w,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end"},{default:(0,p.k6)(()=>[(0,p.bF)(g,{size:(0,u.R1)(_),plain:!0,onClick:G},{default:(0,p.k6)(()=>a[7]||(a[7]=[(0,p.eW)(" 取消 ")])),_:1,__:[7]},8,["size"]),(0,p.bF)(g,{type:"primary",size:(0,u.R1)(_),onClick:M},{default:(0,p.k6)(()=>a[8]||(a[8]=[(0,p.eW)(" 提交 ")])),_:1,__:[8]},8,["size"])]),_:1})])}}}),S=t(71241);const _=(0,S.A)(F,[["__scopeId","data-v-5ee40f74"]]);var E=_},93879:function(e,a,t){t.r(a),t.d(a,{default:function(){return h}});var l=t(65451),s=(t(97042),t(63390),t(25136)),o=(t(19784),t(69957),t(18111),t(20116),t(7588),t(56768)),n=t(45130),i=t(90144),r=t(24232),d=t(57477),p=t(26695),u=t(47887),c=t(64772),y=t(22414),m=t(71066);const f={class:"process-viewer",style:{height:"640px"}},v={style:{position:"absolute",top:"0",left:"0",width:"100%"}};var k=(0,o.pM)({__name:"userTaskSelectDlg",props:{xml:{},finishedInfo:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=e,{thirdParams:t,onCloseThirdDialog:k}=(0,m.P)(a),g=(0,i.KR)(),h=(0,i.KR)(),I=(0,i.KR)(1),w=(0,i.KR)(!0);let R=null,T=(0,i.KR)();const b=(0,i.KR)(),F=(0,i.KR)(y.DiagramType.ORDINARY),S=(0,o.EW)(()=>({xml:a.xml||t.value.xml,finishedInfo:a.finishedInfo||t.value.finishedInfo})),_=()=>{I.value=1,R?.get("canvas").zoom("fit-viewport","auto")},E=(e=.1)=>{let a=Math.floor(100*I.value+100*e)/100;if(a>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");I.value=a,R?.get("canvas").zoom(I.value)},O=(e=.1)=>{let a=Math.floor(100*I.value-100*e)/100;if(a<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");I.value=a,R?.get("canvas").zoom(I.value)},C=()=>{g.value&&(g.value.innerHTML=""),R&&R.destroy(),R=null},L=e=>{null!=e&&null!=e.businessObject&&"bpmn:Process"!==e.type&&("bpmn:UserTask"===e.type?(T.value={taskId:e.businessObject.id,taskName:e.businessObject.name},a.dialog?a.dialog.submit(T.value):k(!0,void 0,T.value)):p.nk.warning("请选择用户任务节点！"))},A=e=>{if(b.value=e,w.value||!b.value||!R)return;let{finishedSequenceFlowSet:a,finishedTaskSet:t,unfinishedTaskSet:l}=b.value;const s=R.get("canvas"),o=R.get("elementRegistry");Array.isArray(a)&&a.forEach(e=>{if(null!=e){let a=o.get(e);if(null!=a){s.addMarker(e,"success");const t=a.businessObject.conditionExpression;t&&s.addMarker(e,"condition-expression")}}}),Array.isArray(t)&&t.forEach(e=>{if(null!=e){let a=o.get(e);a&&s.addMarker(e,"success")}}),Array.isArray(l)&&l.forEach(e=>{if(null!=e){let a=o.get(e);a&&s.addMarker(e,"current")}})},N=async e=>{if(C(),e)try{R=new u.A({container:g.value}),R?.on("element.click",({element:e})=>{L(e)}),w.value=!0,await(R?.importXML(e));const a=R?.get("elementRegistry").find(e=>"bpmn:Process"===e.type);a?.businessObject?.extensionElements?.values&&a.businessObject.extensionElements.values.forEach(e=>{"flowable:properties"!==e.$type&&"flowable:properties"!==e.$type||(e.values||e.$children).forEach(e=>{"$OrangeDiagramType"===e.name&&(F.value=e.value||0)})})}catch(a){console.error(a),C()}finally{w.value=!1,(0,o.dY)(()=>{A(S.value.finishedInfo)})}};return(0,o.hi)(()=>{C()}),(0,o.wB)(()=>S.value.xml,e=>{setTimeout(()=>{N(e).then(()=>{_()}).catch(e=>{console.warn(e)})},30)},{immediate:!0}),(e,a)=>{const t=s.S2,p=s.fg,u=l.S2;return(0,o.uX)(),(0,o.CE)("div",f,[(0,o.bo)((0,o.Lk)("div",{class:"process-canvas",style:{height:"100%"},ref_key:"processCanvas",ref:g},null,512),[[n.aG,!(0,i.R1)(w)&&(0,i.R1)(F)==(0,i.R1)(y.DiagramType).ORDINARY]]),!(0,i.R1)(w)&&(0,i.R1)(R)&&(0,i.R1)(F)==(0,i.R1)(y.DiagramType).DINGDING?((0,o.uX)(),(0,o.Wv)(c.A,{key:0,bpmnModeler:(0,i.R1)(R),onElementClick:L,readonly:!0,finishedInfo:(0,i.R1)(S).finishedInfo},null,8,["bpmnModeler","finishedInfo"])):(0,o.Q3)("",!0),(0,o.Lk)("defs",{ref_key:"customDefs",ref:h},a[3]||(a[3]=[(0,o.Lk)("marker",{id:"sequenceflow-end-white-success",viewBox:"0 0 20 20",refX:"11",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[(0,o.Lk)("path",{class:"success-arrow",d:"M 1 5 L 11 10 L 1 15 Z",style:{"stroke-width":"1px","stroke-linecap":"round","stroke-dasharray":"10000, 1"}})],-1),(0,o.Lk)("marker",{id:"conditional-flow-marker-white-success",viewBox:"0 0 20 20",refX:"-1",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"},[(0,o.Lk)("path",{class:"success-conditional",d:"M 0 10 L 8 6 L 16 10 L 8 14 Z",style:{"stroke-width":"1px","stroke-linecap":"round","stroke-dasharray":"10000, 1"}})],-1)]),512),(0,o.bo)((0,o.Lk)("div",v,[(0,o.bF)(u,{type:"flex",justify:"end"},{default:(0,o.k6)(()=>[(0,o.bF)(p,{key:"scale-control",size:"default"},{default:(0,o.k6)(()=>[(0,o.bF)(t,{size:"default",type:"default",plain:!0,disabled:(0,i.R1)(I)<=.3,icon:(0,i.R1)(d.ZoomOut),onClick:a[0]||(a[0]=e=>O())},null,8,["disabled","icon"]),(0,o.bF)(t,{size:"default",type:"default",style:{width:"90px"}},{default:(0,o.k6)(()=>[(0,o.eW)((0,r.v_)(Math.floor(10*(0,i.R1)(I)*10)+"%"),1)]),_:1}),(0,o.bF)(t,{size:"default",type:"default",plain:!0,disabled:(0,i.R1)(I)>=3.9,icon:(0,i.R1)(d.ZoomIn),onClick:a[1]||(a[1]=e=>E())},null,8,["disabled","icon"]),(0,o.bF)(t,{size:"default",type:"default",icon:(0,i.R1)(d.ScaleToOriginal),onClick:a[2]||(a[2]=e=>_())},null,8,["icon"]),(0,o.RG)(e.$slots,"default")]),_:3})]),_:3})],512),[[n.aG,(0,i.R1)(F)==(0,i.R1)(y.DiagramType).ORDINARY]])])}}});const g=k;var h=g},99397:function(e,a,t){t.d(a,{A:function(){return y}});var l=t(12687),s=(t(97042),t(31112),t(18111),t(22489),t(61701),t(56768)),o=t(90144),n=t(24232),i=t(82572);const r={class:"tag-select"},d={class:"tag-box"};var p=(0,s.pM)({__name:"TagSelect",props:{value:{}},emits:["update:value"],setup(e,{emit:a}){const t=a,p=e,u=(0,i.l5)(),c=(0,o.KR)([]),y={"${startUserName}":"流程发起人","${appointedAssignee}":"指定审批人 "},m=e=>{let a=c.value.filter(a=>a.id!==e.id);Array.isArray(p.value)?t("update:value",a):t("update:value",a.map(e=>e.id).join(","))};return(0,s.wB)(()=>p.value,e=>{null==e||""===e?c.value=[]:Array.isArray(e)?c.value=[...e].map(e=>({id:e.id,name:y[e.id]?y[e.id]:e.name||e.id})):c.value=e.split(",").map(e=>({id:e,name:y[e]?y[e]:e}))},{immediate:!0,deep:!0}),(e,a)=>{const t=l.u;return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",d,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,o.R1)(c),e=>((0,s.uX)(),(0,s.Wv)(t,{key:e.id,effect:"dark",style:{"margin-right":"5px"},type:"primary",size:(0,o.R1)(u).defaultFormItemSize,closable:"",onClose:a=>m(e)},{default:(0,s.k6)(()=>[(0,s.eW)((0,n.v_)(e.name),1)]),_:2},1032,["size","onClose"]))),128))]),(0,s.RG)(e.$slots,"append")])}}}),u=t(71241);const c=(0,u.A)(p,[["__scopeId","data-v-907c424c"]]);var y=c},99564:function(e,a,t){t.r(a),t.d(a,{default:function(){return k}});var l=t(76408),s=(t(97042),t(87535),t(68368)),o=(t(81208),t(47001),t(21929)),n=(t(98421),t(65451)),i=(t(63390),t(25136)),r=(t(69957),t(56768)),d=t(90144),p=t(45130),u=t(61473),c=t(71066),y=t(82572);const m={class:"form-single-fragment",style:{position:"relative"}};var f=(0,r.pM)({__name:"TaskGroupSelect",props:{allGroupList:{},usedIdList:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=e,{thirdParams:t,onCloseThirdDialog:f}=(0,c.P)(a),v=(0,y.l5)();let k=(0,d.KR)([]);const g=(0,r.EW)(()=>({allGroupList:a.allGroupList||t.value.allGroupList,usedIdList:a.usedIdList||t.value.usedIdList})),h=(0,r.EW)(()=>k.value.length>0),I=e=>{k.value=e},w=()=>{a.dialog?a.dialog.submit(k.value):f(!0,void 0,k.value)},R=e=>!(Array.isArray(g.value.usedIdList)&&g.value.usedIdList.length>0)||-1===g.value.usedIdList.indexOf(e.id);return(e,a)=>{const t=i.S2,c=n.S2,y=o.US,f=s.o8,k=s.Up,T=l.uD;return(0,r.uX)(),(0,r.CE)("div",m,[(0,r.bF)(y,{"label-width":"100px",size:(0,d.R1)(v).defaultFormItemSize,"label-position":"right",onSubmit:a[0]||(a[0]=(0,p.D$)(()=>{},["prevent"]))},{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"flex",justify:"end"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{type:"primary",size:(0,d.R1)(v).defaultFormItemSize,onClick:w,disabled:!(0,d.R1)(h)},{default:(0,r.k6)(()=>a[1]||(a[1]=[(0,r.eW)(" 添加分组 ")])),_:1,__:[1]},8,["size","disabled"])]),_:1})]),_:1},8,["size"]),(0,r.bF)(c,{style:{"margin-top":"18px"}},{default:(0,r.k6)(()=>[(0,r.bF)(T,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(k,{data:(0,d.R1)(g).allGroupList,size:(0,d.R1)(v).defaultFormItemSize,height:"452px","header-cell-class-name":"table-header-gray","row-key":"id","default-expand-all":!0,onSelectionChange:I},{empty:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.Lk)("div",{class:"table-empty unified-font"},[(0,r.Lk)("img",{src:u}),(0,r.Lk)("span",null,"暂无数据")],-1)])),default:(0,r.k6)(()=>[(0,r.bF)(f,{type:"selection",width:"50px","header-align":"center",align:"center",selectable:R}),(0,r.bF)(f,{label:"部门名称",prop:"name"})]),_:1},8,["data","size"])]),_:1})]),_:1})])}}});const v=f;var k=v}}]);