"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,1997],{71066:function(e,a,t){t.d(a,{P:function(){return r},i:function(){return i}});var s=t(81387),o=t(27007),l=t(56768),n=t(90144);const r=e=>{console.log("接收到的第三方参数",e);const a=(0,n.KR)(0),t=(0,l.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(t){console.log(t),a={}}return a});console.log("thirdParams",t);const s=(s,o,l)=>{console.log("onCloseThirdDialog",o,l),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:t.value.path,rowData:o?JSON.parse(JSON.stringify(o)):void 0,data:l?JSON.parse(JSON.stringify(l)):void 0,isSuccess:s}},"*")},r=(e,t)=>{switch(e){case"setToken":t.token&&(0,o.WG)(t.token);break;case"dialogIndex":a.value=t;break;case"refreshData":break;case"message":break}},i=e=>{r(e.data.type,e.data.data)};return(0,l.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",i,!1)}),(0,l.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",i)}),{thirdParams:t,onCloseThirdDialog:s}},i=()=>{let e;const a=(0,s.lq)(),t=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,l.sV)(()=>{(0,o.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),t()},18e4))}),(0,l.hi)(()=>{e&&clearInterval(e)}))}},81997:function(e,a,t){t.r(a),t.d(a,{default:function(){return v}});var s=t(25136),o=(t(97042),t(69957),t(21929)),l=(t(98421),t(65451)),n=(t(63390),t(14022)),r=(t(72343),t(76408)),i=(t(87535),t(32465),t(85415)),d=(t(22243),t(7409),t(56768)),u=t(90144),c=t(45130),p=t(61617),m=t(71066),g=t(82572);const f={class:"form-single-fragment third-party-dlg",style:{position:"relative"}};var k=(0,d.pM)({__name:"formRestart",props:{processInstanceId:{},processDefinitionId:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,g.l5)(),t=e,{thirdParams:k,onCloseThirdDialog:h}=(0,m.P)(t),v=(0,d.EW)(()=>a.defaultFormItemSize||k.value.defaultFormItemSize?.value),b=(0,u.KR)(),I=(0,u.KR)({taskList:[],taskComment:void 0}),w={taskList:[{required:!0,message:"请选择复活任务",trigger:"blur"}],taskComment:[{required:!0,message:"请输入备注",trigger:"blur"}]},y=(0,u.KR)([]),_=(0,d.EW)(()=>({processInstanceId:t.processInstanceId||k.value.processInstanceId,processDefinitionId:t.processDefinitionId||k.value.processDefinitionId})),C=()=>{t.dialog?t.dialog.cancel():h(!1)},R=()=>{b.value.validate(e=>{e&&p.wI.restart({processInstanceId:_.value.processInstanceId,taskKeys:I.value.taskList,taskComment:I.value.taskComment}).then(()=>{t.dialog?t.dialog.submit(!0):h(!0)}).catch(e=>{console.log(e)})})},S=()=>{p.wI.listAllUserTask({processDefinitionId:_.value.processDefinitionId}).then(e=>{y.value=e.data}).catch(e=>{console.log(e)})};return(0,d.sV)(()=>{S()}),(e,a)=>{const t=i.P9,p=i.AV,m=o.xE,g=r.uD,k=n.WK,h=l.S2,_=o.US,S=s.S2;return(0,d.uX)(),(0,d.CE)("div",f,[(0,d.bF)(_,{ref_key:"form",ref:b,model:(0,u.R1)(I),class:"full-width-input form-box",rules:w,style:{width:"100%"},"label-width":"80px",size:(0,u.R1)(v),"label-position":"right",onSubmit:a[2]||(a[2]=(0,c.D$)(()=>{},["prevent"]))},{default:(0,d.k6)(()=>[(0,d.bF)(h,{gutter:20},{default:(0,d.k6)(()=>[(0,d.bF)(g,{span:24},{default:(0,d.k6)(()=>[(0,d.bF)(m,{label:"目标任务",prop:"taskList"},{default:(0,d.k6)(()=>[(0,d.bF)(p,{modelValue:(0,u.R1)(I).taskList,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,u.R1)(I).taskList=e),multiple:"",clearable:"",placeholder:"请选择目标任务"},{default:(0,d.k6)(()=>[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)((0,u.R1)(y),e=>((0,d.uX)(),(0,d.Wv)(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,d.bF)(g,{span:24},{default:(0,d.k6)(()=>[(0,d.bF)(m,{label:"操作备注",prop:"taskComment"},{default:(0,d.k6)(()=>[(0,d.bF)(k,{modelValue:(0,u.R1)(I).taskComment,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,u.R1)(I).taskComment=e),placeholder:"请输入操作备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","size"]),(0,d.bF)(h,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end"},{default:(0,d.k6)(()=>[(0,d.bF)(S,{size:(0,u.R1)(v),plain:!0,onClick:C},{default:(0,d.k6)(()=>a[3]||(a[3]=[(0,d.eW)(" 取消 ")])),_:1,__:[3]},8,["size"]),(0,d.bF)(S,{type:"primary",size:(0,u.R1)(v),onClick:R},{default:(0,d.k6)(()=>a[4]||(a[4]=[(0,d.eW)(" 提交 ")])),_:1,__:[4]},8,["size"])]),_:1})])}}});const h=k;var v=h}}]);