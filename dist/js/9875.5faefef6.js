"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,9875],{19875:function(e,a,l){l.r(a),l.d(a,{default:function(){return w}});var o=l(25136),t=(l(97042),l(69957),l(21929)),d=(l(98421),l(14022)),n=(l(72343),l(76408)),u=(l(87535),l(32465),l(18888)),s=(l(3172),l(85415)),i=(l(22243),l(7409),l(65451)),r=(l(63390),l(12687)),m=(l(31112),l(18111),l(61701),l(56768)),c=l(90144),p=l(45130),v=l(24232),f=l(27007),g=l(92380),h=l(71066),b=l(82572),k=(0,m.pM)({__name:"editWidgetCategoryColumn",props:{rowData:{},columnList:{},dataset:{},supportColumnWidth:{type:Boolean,default:!1},defaultFormItemSize:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,b.l5)(),l=e,{thirdParams:k,onCloseThirdDialog:y}=(0,h.P)(l),w=(0,m.EW)(()=>a.defaultFormItemSize),_=(0,c.KR)(),W=(0,c.KR)({id:void 0,columnId:void 0,showName:void 0,columnWidth:void 0}),I={columnId:[{required:!0,message:"请选择数据集字段！",trigger:"blur"}],showName:[{required:!0,message:"显示名称不能为空！",trigger:"blur"}]},R=(0,m.EW)(()=>F.value.dataset.datasetType===g.DatasetType.API),C=(0,m.EW)(()=>{let e=F.value.columnList.map(e=>({...e}));return(0,f.BN)(e,"columnId")}),D=(0,m.EW)(()=>null==W.value.columnId||""===W.value.columnId?[]:(0,f.Zi)(C.value,W.value.columnId,"columnId")),F=(0,m.EW)(()=>({rowData:l.rowData||k.value.rowData,dataset:l.dataset||k.value.dataset||{},supportColumnWidth:k.value.supportColumnWidth?k.value.supportColumnWidth:l.supportColumnWidth,columnList:(l.columnList||k.value.columnList||[]).map(e=>({...e,children:void 0}))})),N=()=>{l.dialog?l.dialog.cancel():y(!1)},V=()=>{_.value.validate(e=>{e&&(l.dialog?l.dialog.submit(W.value):y(!0,F.value.rowData,W.value))})},S=e=>{W.value.columnId=Array.isArray(e)?e[e.length-1]:void 0},P=e=>{let a=(0,f.PH)(F.value.columnList,e,"columnId");W.value.showName=a?a.columnName:void 0};return(0,m.sV)(()=>{null!=F.value.rowData&&(W.value={...F.value.rowData})}),(e,a)=>{const l=r.u,f=i.S2,g=s.P9,h=s.AV,b=u._m,k=t.xE,y=n.uD,E=d.WK,L=t.US,x=o.S2;return(0,m.uX)(),(0,m.Wv)(f,{class:"form-edit-widget-categroy-column third-party-dlg"},{default:(0,m.k6)(()=>[(0,m.bF)(L,{ref_key:"formEditWidgetCategroyColumn",ref:_,model:(0,c.R1)(W),class:"full-width-input form-box",rules:I,style:{width:"100%"},"label-width":"100px",size:(0,c.R1)(w),"label-position":"right",onSubmit:a[4]||(a[4]=(0,p.D$)(()=>{},["prevent"]))},{default:(0,m.k6)(()=>[(0,m.bF)(f,{gutter:20},{default:(0,m.k6)(()=>[(0,m.bF)(y,{span:24},{default:(0,m.k6)(()=>[(0,m.bF)(k,{label:"数据集字段",prop:"columnId"},{default:(0,m.k6)(()=>[(0,c.R1)(R)?((0,m.uX)(),(0,m.Wv)(b,{key:1,options:(0,c.R1)(C),placeholder:"",clearable:"",modelValue:(0,c.R1)(D),"onUpdate:modelValue":[a[1]||(a[1]=e=>(0,c.i9)(D)?D.value=e:null),S],disabled:null!=(0,c.R1)(F).rowData,props:{label:"columnName",value:"columnId"},onChange:P},{default:(0,m.k6)(({data:e})=>[(0,m.bF)(f,{type:"flex",justify:"space-between",align:"middle"},{default:(0,m.k6)(()=>[(0,m.Lk)("span",null,(0,v.v_)(e.columnName),1),"Object"!==e.fieldType&&"Array"!==e.fieldType?((0,m.uX)(),(0,m.Wv)(l,{key:0,size:"default",type:e.dimension?"success":"info"},{default:(0,m.k6)(()=>[(0,m.eW)((0,v.v_)(e.dimension?"维度字段":"指标字段"),1)]),_:2},1032,["type"])):(0,m.Q3)("",!0)]),_:2},1024)]),_:1},8,["options","modelValue","disabled"])):((0,m.uX)(),(0,m.Wv)(h,{key:0,modelValue:(0,c.R1)(W).columnId,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,c.R1)(W).columnId=e),placeholder:"",clearable:"",disabled:null!=(0,c.R1)(F).rowData,onChange:P},{default:(0,m.k6)(()=>[((0,m.uX)(!0),(0,m.CE)(m.FK,null,(0,m.pI)((0,c.R1)(F).columnList,e=>((0,m.uX)(),(0,m.Wv)(g,{key:e.columnId,label:e.columnName,value:e.columnId,disabled:e.disabled},{default:(0,m.k6)(()=>[(0,m.bF)(f,{type:"flex",justify:"space-between",align:"middle"},{default:(0,m.k6)(()=>[(0,m.Lk)("span",null,(0,v.v_)(e.columnName),1),(0,m.bF)(l,{size:"default",type:e.dimension?"success":"info"},{default:(0,m.k6)(()=>[(0,m.eW)((0,v.v_)(e.dimension?"维度字段":"指标字段"),1)]),_:2},1032,["type"])]),_:2},1024)]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue","disabled"]))]),_:1})]),_:1}),(0,m.bF)(y,{span:24},{default:(0,m.k6)(()=>[(0,m.bF)(k,{label:"显示名称",prop:"showName"},{default:(0,m.k6)(()=>[(0,m.bF)(E,{modelValue:(0,c.R1)(W).showName,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,c.R1)(W).showName=e),placeholder:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),(0,c.R1)(F).supportColumnWidth?((0,m.uX)(),(0,m.Wv)(y,{key:0,span:24},{default:(0,m.k6)(()=>[(0,m.bF)(k,{label:"字段最小宽度"},{default:(0,m.k6)(()=>[(0,m.bF)(E,{modelValue:(0,c.R1)(W).columnWidth,"onUpdate:modelValue":a[3]||(a[3]=e=>(0,c.R1)(W).columnWidth=e),placeholder:"最小列宽度，会自动将剩余空间按比例分配",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):(0,m.Q3)("",!0)]),_:1})]),_:1},8,["model","size"]),(0,m.bF)(f,{class:"no-scroll menu-box",type:"flex",justify:"end"},{default:(0,m.k6)(()=>[(0,m.bF)(x,{size:(0,c.R1)(w),plain:!0,onClick:N},{default:(0,m.k6)(()=>a[5]||(a[5]=[(0,m.eW)(" 取消 ")])),_:1,__:[5]},8,["size"]),(0,m.bF)(x,{type:"primary",size:(0,c.R1)(w),onClick:V},{default:(0,m.k6)(()=>a[6]||(a[6]=[(0,m.eW)(" 保存 ")])),_:1,__:[6]},8,["size"])]),_:1})]),_:1})}}});const y=k;var w=y},71066:function(e,a,l){l.d(a,{P:function(){return u},i:function(){return s}});var o=l(81387),t=l(27007),d=l(56768),n=l(90144);const u=e=>{console.log("接收到的第三方参数",e);const a=(0,n.KR)(0),l=(0,d.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(l){console.log(l),a={}}return a});console.log("thirdParams",l);const o=(o,t,d)=>{console.log("onCloseThirdDialog",t,d),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:l.value.path,rowData:t?JSON.parse(JSON.stringify(t)):void 0,data:d?JSON.parse(JSON.stringify(d)):void 0,isSuccess:o}},"*")},u=(e,l)=>{switch(e){case"setToken":l.token&&(0,t.WG)(l.token);break;case"dialogIndex":a.value=l;break;case"refreshData":break;case"message":break}},s=e=>{u(e.data.type,e.data.data)};return(0,d.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",s,!1)}),(0,d.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",s)}),{thirdParams:l,onCloseThirdDialog:o}},s=()=>{let e;const a=(0,o.lq)(),l=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,d.sV)(()=>{(0,t.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),l()},18e4))}),(0,d.hi)(()=>{e&&clearInterval(e)}))}}}]);