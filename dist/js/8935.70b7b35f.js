"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,8935],{71066:function(e,a,l){l.d(a,{P:function(){return n},i:function(){return s}});var t=l(81387),o=l(27007),i=l(56768),r=l(90144);const n=e=>{console.log("接收到的第三方参数",e);const a=(0,r.KR)(0),l=(0,i.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(l){console.log(l),a={}}return a});console.log("thirdParams",l);const t=(t,o,i)=>{console.log("onCloseThirdDialog",o,i),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:l.value.path,rowData:o?JSON.parse(JSON.stringify(o)):void 0,data:i?JSON.parse(JSON.stringify(i)):void 0,isSuccess:t}},"*")},n=(e,l)=>{switch(e){case"setToken":l.token&&(0,o.WG)(l.token);break;case"dialogIndex":a.value=l;break;case"refreshData":break;case"message":break}},s=e=>{n(e.data.type,e.data.data)};return(0,i.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",s,!1)}),(0,i.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",s)}),{thirdParams:l,onCloseThirdDialog:t}},s=()=>{let e;const a=(0,t.lq)(),l=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,i.sV)(()=>{(0,o.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),l()},18e4))}),(0,i.hi)(()=>{e&&clearInterval(e)}))}},78935:function(e,a,l){l.r(a),l.d(a,{default:function(){return k}});var t=l(65451),o=(l(97042),l(63390),l(25136)),i=(l(69957),l(21929)),r=(l(98421),l(14022)),n=(l(72343),l(32465),l(85415)),s=(l(22243),l(7409),l(56768)),d=l(90144),u=l(45130),g=l(22414),c=l(71066),m=l(82572),b=l(61617);const p={class:"form-single-fragment third-party-dlg",style:{position:"relative",height:"100%"}};var f=(0,s.pM)({__name:"editAggregationData",props:{srcDblinkId:{default:void 0},srcTableName:{default:void 0},data:{default:void 0},flowVariableList:{default:void 0},dialog:{default:void 0},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,m.l5)(),l=e,{thirdParams:f,onCloseThirdDialog:v}=(0,c.P)(l),k=(0,d.KR)(),h=(0,d.KR)({id:void 0,aggregationFunction:g.AutoTaskAggregationType.SUM,aggregationColumn:"",alias:""}),w=(0,d.KR)({aggregationFunction:[{required:!0,message:"请选择聚合函数",trigger:"blur"}],aggregationColumn:[{required:!0,message:"请选择聚合字段",trigger:"blur"}],alias:[{required:!0,message:"请输入聚合字段别名",trigger:"blur"},{pattern:/^[a-zA-Z]+$/,message:"聚合字段别名只允许英文字符",trigger:"blur"}]}),y=(0,d.KR)([]),F=(0,s.EW)(()=>({srcDblinkId:l.srcDblinkId||f.value.srcDblinkId,srcTableName:l.srcTableName||f.value.srcTableName,data:l.data||f.value.data,flowVariableList:l.flowVariableList||f.value.flowVariableList})),R=()=>{null!=F.value.srcDblinkId&&null!=F.value.srcTableName&&""!==F.value.srcDblinkId&&""!==F.value.srcTableName&&b.V7.listDblinkTableColumns({dblinkId:F.value.srcDblinkId,tableName:F.value.srcTableName}).then(e=>{y.value=e.data})},T=()=>{k.value.validate(e=>{if(e){let e={...h.value};null==e.id&&(e.id=(new Date).getTime()),l.dialog?l.dialog.submit(e):v(!0,F.value.data,e)}})},V=()=>{l.dialog?l.dialog.cancel():v(!1)};return(0,s.sV)(()=>{R(),F.value.data&&(h.value={...F.value.data})}),(e,l)=>{const c=n.P9,m=n.AV,b=i.xE,f=r.WK,v=i.US,F=o.S2,R=t.S2;return(0,s.uX)(),(0,s.CE)("div",p,[(0,s.bF)(v,{ref_key:"form",ref:k,model:(0,d.R1)(h),class:"full-width-input form-box",rules:(0,d.R1)(w),style:{width:"100%"},"label-width":"100px",size:(0,d.R1)(a).defaultFormItemSize,"label-position":"right",onSubmit:l[3]||(l[3]=(0,u.D$)(()=>{},["prevent"]))},{default:(0,s.k6)(()=>[(0,s.bF)(b,{label:"聚合函数",prop:"aggregationFunction"},{default:(0,s.k6)(()=>[(0,s.bF)(m,{modelValue:(0,d.R1)(h).aggregationFunction,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,d.R1)(h).aggregationFunction=e),placeholder:"请选择聚合函数"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,d.R1)(g.AutoTaskAggregationType).getList(),e=>((0,s.uX)(),(0,s.Wv)(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(b,{label:"聚合字段",prop:"aggregationColumn"},{default:(0,s.k6)(()=>[(0,s.bF)(m,{modelValue:(0,d.R1)(h).aggregationColumn,"onUpdate:modelValue":l[1]||(l[1]=e=>(0,d.R1)(h).aggregationColumn=e),clearable:"",filterable:"",placeholder:"请选择聚合字段"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,d.R1)(y),e=>((0,s.uX)(),(0,s.Wv)(c,{key:e.columnName,label:e.columnName,value:e.columnName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(b,{label:"字段别名",prop:"alias"},{default:(0,s.k6)(()=>[(0,s.bF)(f,{modelValue:(0,d.R1)(h).alias,"onUpdate:modelValue":l[2]||(l[2]=e=>(0,d.R1)(h).alias=e),clearable:"",placeholder:"请输入聚合字段别名（只允许英文）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","size"]),(0,s.bF)(R,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end",style:{"padding-top":"10px"}},{default:(0,s.k6)(()=>[(0,s.bF)(F,{size:(0,d.R1)(a).defaultFormItemSize,plain:!0,onClick:l[4]||(l[4]=e=>V())},{default:(0,s.k6)(()=>l[6]||(l[6]=[(0,s.eW)(" 取消 ")])),_:1,__:[6]},8,["size"]),(0,s.bF)(F,{type:"primary",size:(0,d.R1)(a).defaultFormItemSize,onClick:l[5]||(l[5]=e=>T())},{default:(0,s.k6)(()=>l[7]||(l[7]=[(0,s.eW)(" 保存 ")])),_:1,__:[7]},8,["size"])]),_:1})])}}});const v=f;var k=v}}]);