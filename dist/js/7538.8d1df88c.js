"use strict";(self["webpackChunkorange"]=self["webpackChunkorange"]||[]).push([[1066,7538],{3829:function(e,a,t){t.d(a,{x:function(){return r},z:function(){return o}});var l=t(47378),n=t(1211);const o=(0,l.b_)({type:{type:String,values:["primary","success","info","warning","danger"],default:"primary"},closable:Boolean,disableTransitions:Boolean,hit:Boolean,color:String,size:{type:String,values:n.I},effect:{type:String,values:["dark","light","plain"],default:"light"},round:Boolean}),r={close:e=>e instanceof MouseEvent,click:e=>e instanceof MouseEvent}},6301:function(e,a,t){t.d(a,{A:function(){return v}});var l=t(60168),n=t(39578),o=function(){return n.A.Date.now()},r=o,i=t(10754),u="Expected a function",s=Math.max,d=Math.min;function c(e,a,t){var n,o,c,v,m,f,p=0,b=!1,g=!1,h=!0;if("function"!=typeof e)throw new TypeError(u);function y(a){var t=n,l=o;return n=o=void 0,p=a,v=e.apply(l,t),v}function k(e){return p=e,m=setTimeout(R,a),b?y(e):v}function w(e){var t=e-f,l=e-p,n=a-t;return g?d(n,c-l):n}function I(e){var t=e-f,l=e-p;return void 0===f||t>=a||t<0||g&&l>=c}function R(){var e=r();if(I(e))return C(e);m=setTimeout(R,w(e))}function C(e){return m=void 0,h&&n?y(e):(n=o=void 0,v)}function T(){void 0!==m&&clearTimeout(m),p=0,n=f=o=m=void 0}function N(){return void 0===m?v:C(r())}function _(){var e=r(),t=I(e);if(n=arguments,o=this,f=e,t){if(void 0===m)return k(f);if(g)return clearTimeout(m),m=setTimeout(R,a),y(f)}return void 0===m&&(m=setTimeout(R,a)),v}return a=(0,i.A)(a)||0,(0,l.A)(t)&&(b=!!t.leading,g="maxWait"in t,c=g?s((0,i.A)(t.maxWait)||0,a):c,h="trailing"in t?!!t.trailing:h),_.cancel=T,_.flush=N,_}var v=c},10754:function(e,a,t){t.d(a,{A:function(){return g}});var l=/\s/;function n(e){var a=e.length;while(a--&&l.test(e.charAt(a)));return a}var o=n,r=/^\s+/;function i(e){return e?e.slice(0,o(e)+1).replace(r,""):e}var u=i,s=t(60168),d=t(18095),c=NaN,v=/^[-+]0x[0-9a-f]+$/i,m=/^0b[01]+$/i,f=/^0o[0-7]+$/i,p=parseInt;function b(e){if("number"==typeof e)return e;if((0,d.A)(e))return c;if((0,s.A)(e)){var a="function"==typeof e.valueOf?e.valueOf():e;e=(0,s.A)(a)?a+"":a}if("string"!=typeof e)return 0===e?e:+e;e=u(e);var t=m.test(e);return t||f.test(e)?p(e.slice(2),t?2:8):v.test(e)?c:+e}var g=b},12687:function(e,a,t){t.d(a,{u:function(){return g}});var l=t(56768),n=t(24232),o=t(90144),r=t(45130),i=t(91542),u=t(57477),s=t(3829),d=t(99077),c=t(37207),v=t(93513);const m=(0,l.pM)({name:"ElTag"}),f=(0,l.pM)({...m,props:s.z,emits:s.x,setup(e,{emit:a}){const t=e,s=(0,c.NV)(),d=(0,v.DU)("tag"),m=(0,l.EW)(()=>{const{type:e,hit:a,effect:l,closable:n,round:o}=t;return[d.b(),d.is("closable",n),d.m(e||"primary"),d.m(s.value),d.m(l),d.is("hit",a),d.is("round",o)]}),f=e=>{a("close",e)},p=e=>{a("click",e)},b=e=>{var a,t,l;(null==(l=null==(t=null==(a=null==e?void 0:e.component)?void 0:a.subTree)?void 0:t.component)?void 0:l.bum)&&(e.component.subTree.component.bum=null)};return(e,a)=>e.disableTransitions?((0,l.uX)(),(0,l.CE)("span",{key:0,class:(0,n.C4)((0,o.R1)(m)),style:(0,n.Tr)({backgroundColor:e.color}),onClick:p},[(0,l.Lk)("span",{class:(0,n.C4)((0,o.R1)(d).e("content"))},[(0,l.RG)(e.$slots,"default")],2),e.closable?((0,l.uX)(),(0,l.Wv)((0,o.R1)(i.tk),{key:0,class:(0,n.C4)((0,o.R1)(d).e("close")),onClick:(0,r.D$)(f,["stop"])},{default:(0,l.k6)(()=>[(0,l.bF)((0,o.R1)(u.Close))]),_:1},8,["class","onClick"])):(0,l.Q3)("v-if",!0)],6)):((0,l.uX)(),(0,l.Wv)(r.eB,{key:1,name:`${(0,o.R1)(d).namespace.value}-zoom-in-center`,appear:"",onVnodeMounted:b},{default:(0,l.k6)(()=>[(0,l.Lk)("span",{class:(0,n.C4)((0,o.R1)(m)),style:(0,n.Tr)({backgroundColor:e.color}),onClick:p},[(0,l.Lk)("span",{class:(0,n.C4)((0,o.R1)(d).e("content"))},[(0,l.RG)(e.$slots,"default")],2),e.closable?((0,l.uX)(),(0,l.Wv)((0,o.R1)(i.tk),{key:0,class:(0,n.C4)((0,o.R1)(d).e("close")),onClick:(0,r.D$)(f,["stop"])},{default:(0,l.k6)(()=>[(0,l.bF)((0,o.R1)(u.Close))]),_:1},8,["class","onClick"])):(0,l.Q3)("v-if",!0)],6)]),_:3},8,["name"]))}});var p=(0,d.A)(f,[["__file","tag.vue"]]),b=t(25376);const g=(0,b.GU)(p)},22609:function(e,a,t){t.r(a),t.d(a,{default:function(){return I}});var l=t(25136),n=(t(97042),t(69957),t(21929)),o=(t(98421),t(65451)),r=(t(63390),t(14022)),i=(t(72343),t(76408)),u=(t(87535),t(32465),t(18888)),s=(t(3172),t(44114),t(18111),t(7588),t(61701),t(56768)),d=t(90144),c=t(45130),v=t(26695),m=t(61617),f=t(27007),p=t(22414),b=t(36525),g=t(71066),h=t(82572);const y={class:"form-single-fragment third-party-dlg",style:{position:"relative"}};var k=(0,s.pM)({__name:"formEditFlowEntryVariable",props:{entryId:{},datasource:{},rowData:{},dialog:{},thirdParamsString:{},dialogKey:{}},setup(e){const a=(0,h.l5)(),t=e,{thirdParams:k,onCloseThirdDialog:w}=(0,g.P)(t),I=(0,s.EW)(()=>a.defaultFormItemSize||k.value.defaultFormItemSize?.value),R=(0,d.KR)(),C={showName:[{required:!0,message:"变量名称不能为空！",trigger:"blur"}],variableName:[{required:!0,message:"变量标识不能为空！",trigger:"blur"},{type:"string",pattern:/^[a-z][a-zA-Z]+$/,message:"变量标识必须是小驼峰命名",trigger:"blur"}]},T=(0,d.KR)([]),N=(0,d.KR)({showName:void 0,variableName:void 0,variableType:p.SysFlowVariableType.TASK,bindDatasourceId:void 0,bindRelationId:void 0,bindColumnId:void 0,builtIn:!1}),_=(0,s.EW)(()=>({entryId:t.entryId||k.value.entryId,datasource:t.datasource||k.value.datasource,rowData:t.rowData||k.value.rowData})),D=(0,s.EW)(()=>{if(null==_.value.datasource)return[];{let e=[{label:_.value.datasource.datasourceName,value:_.value.datasource.datasourceId,tableId:_.value.datasource.masterTableId,children:_.value.datasource.columnList.map(e=>({label:e.objectFieldName,value:e.columnId,tag:e})),tag:_.value.datasource}];return Array.isArray(_.value.datasource.relationList)&&_.value.datasource.relationList.forEach(a=>{a.relationType===b.SysOnlineRelationType.ONE_TO_ONE&&e.push({label:a.relationName,value:a.relationId,tableId:a.slaveTableId,children:a.columnList.map(e=>({label:e.objectFieldName,value:e.columnId,tag:e})),tag:a})}),e}}),E=e=>{if(N.value.bindDatasourceId=_.value.datasource?.datasourceId,N.value.bindRelationId=void 0,N.value.bindColumnId=void 0,Array.isArray(e)&&e.length>0){let a=e[e.length-1];if(a){e[0]!==N.value.bindDatasourceId&&(N.value.bindRelationId=e[0]);let t=(0,f.Ee)(D.value,a,"value");null!=t&&null!=t.tag&&(N.value.showName=t.tag.columnComment,N.value.variableName=t.tag.objectFieldName,N.value.bindColumnId=t.value)}}},F=()=>{t.dialog?t.dialog.cancel():w(!1)},S=()=>{R.value.validate(e=>{if(e){let e={flowEntryVariableDto:{...N.value,entryId:_.value.entryId}},a=null==_.value.rowData?m.nY.add(e):m.nY.update(e);a.then(e=>{v.nk.success("保存成功！"),t.dialog?t.dialog.submit(e):w(!0)}).catch(e=>{console.warn(e)})}})};return(0,s.sV)(()=>{null!=_.value.rowData&&(N.value={...N.value,..._.value.rowData},null!=N.value.bindColumnId&&null!=_.value.datasource&&(T.value=[N.value.bindRelationId||N.value.bindDatasourceId,N.value.bindColumnId]))}),(e,a)=>{const t=u._m,v=n.xE,m=i.uD,f=r.WK,p=o.S2,b=n.US,g=l.S2;return(0,s.uX)(),(0,s.CE)("div",y,[(0,s.bF)(b,{ref_key:"form",ref:R,model:(0,d.R1)(N),class:"full-width-input form-box",rules:C,style:{width:"100%"},"label-width":"80px",size:(0,d.R1)(I),"label-position":"right",onSubmit:a[3]||(a[3]=(0,c.D$)(()=>{},["prevent"]))},{default:(0,s.k6)(()=>[(0,s.bF)(p,{gutter:20},{default:(0,s.k6)(()=>[null!=(0,d.R1)(_).datasource?((0,s.uX)(),(0,s.Wv)(m,{key:0,span:24},{default:(0,s.k6)(()=>[(0,s.bF)(v,{label:"绑定字段"},{default:(0,s.k6)(()=>[(0,s.bF)(t,{class:"input-item",modelValue:(0,d.R1)(T),"onUpdate:modelValue":a[0]||(a[0]=e=>(0,d.i9)(T)?T.value=e:null),filterable:"",placeholder:"变量绑定的数据源字段",options:(0,d.R1)(D),disabled:null==(0,d.R1)(_).datasource,onChange:E},null,8,["modelValue","options","disabled"])]),_:1})]),_:1})):(0,s.Q3)("",!0),(0,s.bF)(m,{span:24},{default:(0,s.k6)(()=>[(0,s.bF)(v,{label:"变量名称",prop:"showName"},{default:(0,s.k6)(()=>[(0,s.bF)(f,{class:"input-item",modelValue:(0,d.R1)(N).showName,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,d.R1)(N).showName=e),clearable:!0,placeholder:"变量名称"},null,8,["modelValue"])]),_:1})]),_:1}),(0,s.bF)(m,{span:24},{default:(0,s.k6)(()=>[(0,s.bF)(v,{label:"变量标识",prop:"variableName"},{default:(0,s.k6)(()=>[(0,s.bF)(f,{class:"input-item",modelValue:(0,d.R1)(N).variableName,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,d.R1)(N).variableName=e),clearable:!0,placeholder:"变量标识"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","size"]),(0,s.bF)(p,{class:"no-scroll flex-box menu-box",type:"flex",justify:"end"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{size:(0,d.R1)(I),plain:!0,onClick:F},{default:(0,s.k6)(()=>a[4]||(a[4]=[(0,s.eW)(" 取消 ")])),_:1,__:[4]},8,["size"]),(0,s.bF)(g,{type:"primary",size:(0,d.R1)(I),onClick:S},{default:(0,s.k6)(()=>a[5]||(a[5]=[(0,s.eW)(" 保存 ")])),_:1,__:[5]},8,["size"])]),_:1})])}}});const w=k;var I=w},31112:function(e,a,t){t(97042)},71066:function(e,a,t){t.d(a,{P:function(){return i},i:function(){return u}});var l=t(81387),n=t(27007),o=t(56768),r=t(90144);const i=e=>{console.log("接收到的第三方参数",e);const a=(0,r.KR)(0),t=(0,o.EW)(()=>{let a={};try{e.thirdParamsString&&(a=JSON.parse(e.thirdParamsString))}catch(t){console.log(t),a={}}return a});console.log("thirdParams",t);const l=(l,n,o)=>{console.log("onCloseThirdDialog",n,o),window.parent&&window.parent.postMessage({type:"closeDialog",data:{index:a.value,dialogKey:e.dialogKey,path:t.value.path,rowData:n?JSON.parse(JSON.stringify(n)):void 0,data:o?JSON.parse(JSON.stringify(o)):void 0,isSuccess:l}},"*")},i=(e,t)=>{switch(e){case"setToken":t.token&&(0,n.WG)(t.token);break;case"dialogIndex":a.value=t;break;case"refreshData":break;case"message":break}},u=e=>{i(e.data.type,e.data.data)};return(0,o.sV)(()=>{console.log("onMounted message"),window.addEventListener("message",u,!1)}),(0,o.hi)(()=>{console.log("onUnmounted message"),window.removeEventListener("message",u)}),{thirdParams:t,onCloseThirdDialog:l}},u=()=>{let e;const a=(0,l.lq)(),t=()=>{window.parent&&window.parent.postMessage({type:"refreshToken"},"*")};-1!==a.path.indexOf("/thirdParty/")&&((0,o.sV)(()=>{(0,n.R7)()&&(e=setInterval(()=>{console.log("refreshToken thirdParty"),t()},18e4))}),(0,o.hi)(()=>{e&&clearInterval(e)}))}}}]);